var $jscomp={};$jscomp.scope={};$jscomp.defineProperty=typeof Object.defineProperties=='function'?Object.defineProperty:function(b,c,a){a=(a);if(a.get||a.set){throw new TypeError('ES3 does not support getters and setters.')}if(b==Array.prototype||b==Object.prototype){return}b[c]=a.value};$jscomp.getGlobal=function(a){return typeof window!='undefined'&&window===a?a:typeof global!='undefined'&&global!=null?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(i,f,j,k){if(!f){return}var a=$jscomp.global;var b=i.split('.');for(var e=0;e<b.length-1;e++){var d=b[e];if(!(d in a)){a[d]={}}a=a[d]}var g=b[b.length-1];var h=a[g];var c=f(h);if(c==h||c==null){return}$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:c})};$jscomp.polyfill('Array.prototype.copyWithin',function(a){if(a){return a}var b=function(c,b,a){var d=this.length;c=Number(c);b=Number(b);a=Number(a!=null?a:d);if(c<b){a=Math.min(a,d);while(b<a){if(b in this){this[c++]=this[b++]}else {delete this[c++];b++}}}else {a=Math.min(a,d+b-c);c+=a-b;while(a>b){if(--a in this){this[--c]=this[a]}else {delete this[c]}}}return this};return b},'es6-impl','es3');$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global.Symbol){$jscomp.global.Symbol=$jscomp.Symbol}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return ($jscomp.SYMBOL_PREFIX+(a||'')+$jscomp.symbolCounter_++)};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;if(!a){a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('iterator')}if(typeof Array.prototype[a]!='function'){$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}})}$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){if(b<a.length){return {done:!1,value:a[b++]}}else {return {done:!0}}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();var a={next:b};a[$jscomp.global.Symbol.iterator]=function(){return this};return (a)};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();if(a instanceof String){a=a+''}var c=0;var b={next:function(){if(c<a.length){var e=c++;return {value:d(e,a[e]),done:!1}}b.next=function(){return {done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill('Array.prototype.entries',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a,b){return [a,b]})};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.fill',function(a){if(a){return a}var b=function(e,b,a){var c=this.length||0;if(b<0){b=Math.max(0,c+(b))}if(a==null||a>c){a=c}a=Number(a);if(a<0){a=Math.max(0,c+a)}for(var d=Number(b||0);d<a;d++){this[d]=e}return this};return b},'es6-impl','es3');$jscomp.findInternal=function(a,d,e){if(a instanceof String){a=(String(a))}var f=a.length;for(var b=0;b<f;b++){var c=a[b];if(d.call(e,c,b,a)){return {i:b,v:c}}}return {i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).v};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.findIndex',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).i};return b},'es6-impl','es3');$jscomp.polyfill('Array.from',function(a){if(a){return a}var b=function(a,b,f){$jscomp.initSymbolIterator();b=b!=null?b:function(a){return a};var c=[];var e=(a)[Symbol.iterator];if(typeof e=='function'){a=e.call(a);var g;while(!(g=a.next()).done){c.push(b.call((f),g.value))}}else {var h=a.length;for(var d=0;d<h;d++){c.push(b.call((f),a[d]))}}return c};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.keys',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a){return a})};return b},'es6-impl','es3');$jscomp.polyfill('Array.of',function(a){if(a){return a}var b=function(a){return Array.from(arguments)};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.values',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})};return b},'es6','es3');$jscomp.executeAsyncGenerator=function(a){function passValueToGenerator(b){return a.next(b)}function passErrorToGenerator(b){return a['throw'](b)}return new Promise(function(b,c){function handleGeneratorRecord(a){if(a.done){b(a.value)}else {Promise.resolve(a.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,c)}}handleGeneratorRecord(a.next())})};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=(a)[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator((a))};$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};$jscomp.polyfill('WeakMap',function(c){function isConformant(){if(!c||!Object.seal){return !1}try{var b=Object.seal({});var d=Object.seal({});var a=new (c)([[b,2],[d,3]]);if(a.get(b)!=2||a.get(d)!=3){return !1}a['delete'](b);a.set(d,4);return !a.has(b)&&a.get(d)==4}catch(e){return !1}}if(isConformant()){return c}var a='$jscomp_hidden_'+Math.random().toString().substring(2);function insert(b){if(!$jscomp.owns(b,a)){var c={};$jscomp.defineProperty(b,a,{value:c})}}function patch(a){var b=Object[a];if(b){Object[a]=function(a){insert(a);return b(a)}}}patch('freeze');patch('preventExtensions');patch('seal');var d=0;var b=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=$jscomp.makeIterator(a);var b;while(!(b=e.next()).done){var c=b.value;this.set((c[0]),(c[1]))}}};b.prototype.set=function(b,c){insert(b);if(!$jscomp.owns(b,a)){throw new Error('WeakMap key fail: '+b)}b[a][this.id_]=c;return this};b.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:undefined};b.prototype.has=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};b.prototype['delete']=function(b){if(!$jscomp.owns(b,a)||!$jscomp.owns(b[a],this.id_)){return !1}return delete b[a][this.id_]};return b},'es6-impl','es3');$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.polyfill('Map',function(b){var h=!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var e=Object.seal({x:4});var c=new b($jscomp.makeIterator([[e,'s']]));if(c.get(e)!='s'||c.size!=1||c.get({x:4})||c.set({x:4},'t')!=c||c.size!=2){return !1}var d=c.entries();var a=d.next();if(a.done||a.value[0]!=e||a.value[1]!='s'){return !1}a=d.next();if(a.done||a.value[0].x!=4||a.value[1]!='t'||!d.next().done){return !1}return !0}catch(k){return !1}}();if(h){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=new WeakMap();var c=function(){};c.prototype.previous;c.prototype.next;c.prototype.head;c.prototype.key;c.prototype.value;var a=function(a){this.data_={};this.head_=g();this.size=0;if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.set((c[0]),(c[1]))}}};a.prototype.set=function(c,b){var a=d(this,c);if(!a.list){a.list=this.data_[a.id]=[]}if(!a.entry){a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,value:b};a.list.push(a.entry);this.head_.previous.next=a.entry;this.head_.previous=a.entry;this.size++}else {a.entry.value=b}return this};a.prototype['delete']=function(b){var a=d(this,b);if(a.entry&&a.list){a.list.splice(a.index,1);if(!a.list.length){delete this.data_[a.id]}a.entry.previous.next=a.entry.next;a.entry.next.previous=a.entry.previous;a.entry.head=null;this.size--;return !0}return !1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};a.prototype.has=function(a){return !!d(this,a).entry};a.prototype.get=function(b){var a=d(this,b).entry;return (a&&(a.value))};a.prototype.entries=function(){return e(this,function(a){return [a.key,a.value]})};a.prototype.keys=function(){return e(this,function(a){return a.key})};a.prototype.values=function(){return e(this,function(a){return a.value})};a.prototype.forEach=function(d,c){var e=this.entries();var b;while(!(b=e.next()).done){var a=b.value;d.call((c),(a[1]),(a[0]),this)}};(a.prototype)[Symbol.iterator]=a.prototype.entries;var d=function(f,d){var e=j(d);var a=f.data_[e];if(a&&$jscomp.owns(f.data_,e)){for(var c=0;c<a.length;c++){var b=a[c];if(d!==d&&b.key!==b.key||d===b.key){return {id:e,list:a,index:c,entry:b}}}}return {id:e,list:a,index:-1,entry:undefined}};var e=function(b,c){var a=b.head_;return $jscomp.iteratorPrototype(function(){if(a){while(a.head!=b.head_){a=a.previous}while(a.next!=a.head){a=a.next;return {done:!1,value:c(a)}}a=null}return {done:!0,value:void 0}})};var g=function(){var a={};a.previous=a.next=a.head=a;return a};var i=0;var j=function(a){var b=a&&typeof a;if(b=='object'||b=='function'){a=(a);if(!f.has(a)){var c=''+ ++i;f.set(a,c);return c}return f.get(a)}return 'p_'+a};return a},'es6-impl','es3');$jscomp.polyfill('Math.acosh',function(a){if(a){return a}var b=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};return b},'es6-impl','es3');$jscomp.polyfill('Math.asinh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.log1p',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var e=a;var f=1;var b=a;var c=0;var d=1;while(c!=b){e*=a;d*=-1;b=(c=b)+d*e/++f}return b}return Math.log(1+a)};return b},'es6-impl','es3');$jscomp.polyfill('Math.atanh',function(b){if(b){return b}var a=Math.log1p;var c=function(b){b=Number(b);return (a(b)-a(-b))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.cbrt',function(a){if(a){return a}var b=function(a){if(a===0){return a}a=Number(a);var b=Math.pow(Math.abs(a),1/3);return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.clz32',function(a){if(a){return a}var b=function(a){a=Number(a)>>>0;if(a===0){return 32}var b=0;if((a&4.29490176E9)===0){a<<=16;b+=16}if((a&4.27819008E9)===0){a<<=8;b+=8}if((a&4.02653184E9)===0){a<<=4;b+=4}if((a&3.221225472E9)===0){a<<=2;b+=2}if((a&2.147483648E9)===0){b++}return b};return b},'es6-impl','es3');$jscomp.polyfill('Math.cosh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);return (b(a)+b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.expm1',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var d=a;var e=1;var b=a;var c=0;while(c!=b){d*=a/++e;b=(c=b)+d}return b}return Math.exp(a)-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.hypot',function(a){if(a){return a}var b=function(b,c,g){b=Number(b);c=Number(c);var a,f,e;var d=Math.max(Math.abs(b),Math.abs(c));for(a=2;a<arguments.length;a++){d=Math.max(d,Math.abs(arguments[a]))}if(d>1.0E100||d<1.0E-100){b=b/d;c=c/d;e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a])/d;e+=f*f}return Math.sqrt(e)*d}else {e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a]);e+=f*f}return Math.sqrt(e)}};return b},'es6-impl','es3');$jscomp.polyfill('Math.imul',function(a){if(a){return a}var b=function(a,b){a=Number(a);b=Number(b);var e=a>>>16&65535;var c=a&65535;var f=b>>>16&65535;var d=b&65535;var g=e*d+c*f<<16>>>0;return c*d+g|0};return b},'es6-impl','es3');$jscomp.polyfill('Math.log10',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN10};return b},'es6-impl','es3');$jscomp.polyfill('Math.log2',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN2};return b},'es6-impl','es3');$jscomp.polyfill('Math.sign',function(a){if(a){return a}var b=function(a){a=Number(a);return a===0||isNaN(a)?a:a>0?1:-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.sinh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);if(a===0){return a}return (b(a)-b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.tanh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.exp(-2*Math.abs(a));var c=(1-b)/(1+b);return a<0?-c:c};return b},'es6-impl','es3');$jscomp.polyfill('Math.trunc',function(a){if(a){return a}var b=function(a){a=Number(a);if(isNaN(a)||a===Infinity||a===-Infinity||a===0){return a}var b=Math.floor(Math.abs(a));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Number.EPSILON',function(a){return Math.pow(2,-52)},'es6-impl','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.MIN_SAFE_INTEGER',function(){return -9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.isFinite',function(a){if(a){return a}var b=function(a){if(typeof a!=='number'){return !1}return !isNaN(a)&&a!==Infinity&&a!==-Infinity};return b},'es6-impl','es3');$jscomp.polyfill('Number.isInteger',function(a){if(a){return a}var b=function(a){if(!Number.isFinite(a)){return !1}return a===Math.floor(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isNaN',function(a){if(a){return a}var b=function(a){return typeof a==='number'&&isNaN(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isSafeInteger',function(a){if(a){return a}var b=function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER};return b},'es6-impl','es3');$jscomp.polyfill('Object.assign',function(a){if(a){return a}var b=function(d,e){for(var c=1;c<arguments.length;c++){var a=arguments[c];if(!a){continue}for(var b in a){if($jscomp.owns(a,b)){d[b]=a[b]}}}return d};return b},'es6-impl','es3');$jscomp.polyfill('Object.getOwnPropertySymbols',function(a){if(a){return a}return function(){return []}},'es6-impl','es5');$jscomp.polyfill('Object.is',function(a){if(a){return a}var b=function(a,b){if(a===b){return a!==0||1/a===1/(b)}else {return a!==a&&b!==b}};return b},'es6-impl','es3');$jscomp.polyfill('Object.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+' is not extensible')}return a};return b},'es6','es5');$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.polyfill('Promise',function(c){if(c&&!$jscomp.FORCE_POLYFILL_PROMISE){return c}function AsyncExecutor(){this.batch_=null}AsyncExecutor.prototype.asyncExecute=function(a){if(this.batch_==null){this.batch_=[];this.asyncExecuteBatch_()}this.batch_.push(a);return this};AsyncExecutor.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global['setTimeout'];AsyncExecutor.prototype.asyncExecuteFunction=function(a){e(a,0)};AsyncExecutor.prototype.executeBatch_=function(){while(this.batch_&&this.batch_.length){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var c=b[a];delete b[a];try{c()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var b={PENDING:0,FULFILLED:1,REJECTED:2};var a=function(c){this.state_=b.PENDING;this.result_=undefined;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.createResolveAndReject_=function(){var b=this;var a=!1;function firstCallWins(c){return function(d){if(!a){a=!0;c.call(b,d)}}}return {resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this){this.reject_(new TypeError('A Promise cannot resolve to itself'))}else {if(b instanceof a){this.settleSameAsPromise_((b))}else {if(isObject(b)){this.resolveToNonPromiseObj_((b))}else {this.fulfill_(b)}}}};a.prototype.resolveToNonPromiseObj_=function(b){var a=undefined;try{a=b.then}catch(f){this.reject_(f);return}if(typeof a=='function'){this.settleSameAsThenable_(a,(b))}else {this.fulfill_(b)}};function isObject(a){switch(typeof a){case 'object':return a!=null;case 'function':return !0;default:return !1;}}a.prototype.reject_=function(a){this.settle_(b.REJECTED,a)};a.prototype.fulfill_=function(a){this.settle_(b.FULFILLED,a)};a.prototype.settle_=function(c,a){if(this.state_!=b.PENDING){throw new Error('Cannot settle('+c+', '+a|'): Promise already settled in state'+this.state_)}this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){var b=this.onSettledCallbacks_;for(var a=0;a<b.length;++a){(b[a]).call();b[a]=null}this.onSettledCallbacks_=null}};var d=new AsyncExecutor();a.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};a.prototype.settleSameAsThenable_=function(b,c){var a=this.createResolveAndReject_();try{b.call(c,a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.then=function(e,f){var b;var c;var d=new a(function(a,d){b=a;c=d});function createCallback(a,d){if(typeof a=='function'){return function(d){try{b(a(d))}catch(g){c(g)}}}else {return d}}this.callWhenSettled_(createCallback(e,b),createCallback(f,c));return d};a.prototype['catch']=function(a){return this.then(undefined,a)};a.prototype.callWhenSettled_=function(c,e){var a=this;function callback(){switch(a.state_){case b.FULFILLED:c(a.result_);break;case b.REJECTED:e(a.result_);break;default:throw new Error('Unexpected state: '+a.state_);}}if(this.onSettledCallbacks_==null){d.asyncExecute(callback)}else {this.onSettledCallbacks_.push(function(){d.asyncExecute(callback)})}};a.resolve=function(b){if(b instanceof a){return b}else {return new a(function(a,c){a(b)})}};a.reject=function(b){return new a(function(c,a){a(b)})};a.race=function(b){return new a(function(e,f){var d=$jscomp.makeIterator(b);for(var c=d.next();!c.done;c=d.next()){a.resolve(c.value).callWhenSettled_(e,f)}})};a.all=function(d){var c=$jscomp.makeIterator(d);var b=c.next();if(b.done){return a.resolve([])}else {return new a(function(f,g){var d=[];var e=0;function onFulfilled(a){return function(b){d[a]=b;e--;if(e==0){f(d)}}}do{d.push(undefined);e++;a.resolve(b.value).callWhenSettled_(onFulfilled(d.length-1),g);b=c.next()}while(!b.done)})}};if($jscomp.EXPOSE_ASYNC_EXECUTOR){a['$jscomp$new$AsyncExecutor']=function(){return new AsyncExecutor()}}return a},'es6-impl','es3');$jscomp.polyfill('Reflect.apply',function(a){if(a){return a}var c=Function.prototype.apply;var b=function(d,b,a){return c.call(d,b,a)};return b},'es6','es3');$jscomp.polyfill('Reflect.construct',function(a){if(a){return a}var b=function(b,d,a){if(a===undefined){a=b}var e=a.prototype||Object.prototype;var c=Object.create(e);var f=Reflect.apply(b,c,d);return f||c};return b},'es6','es5');$jscomp.polyfill('Reflect.defineProperty',function(a){if(a){return a}var b=function(d,c,b){try{Object.defineProperty(d,c,b);var a=Object.getOwnPropertyDescriptor(d,c);if(!a){return !1}return a.configurable===(b.configurable||!1)&&a.enumerable===(b.enumerable||!1)&&('value' in a?a.value===b.value&&a.writable===(b.writable||!1):a.get===b.get&&a.set===b.set)}catch(e){return !1}};return b},'es6','es5');$jscomp.polyfill('Reflect.deleteProperty',function(a){if(a){return a}var b=function(b,a){if(!$jscomp.owns(b,a)){return !0}try{return delete b[a]}catch(c){return !1}};return b},'es6','es3');$jscomp.polyfill('Reflect.getOwnPropertyDescriptor',function(a){return a||Object.getOwnPropertyDescriptor},'es6','es5');$jscomp.polyfill('Reflect.getPrototypeOf',function(a){return a||Object.getPrototypeOf},'es6','es5');$jscomp.findDescriptor=function(d,c){var a=d;while(a){var b=Reflect.getOwnPropertyDescriptor(a,c);if(b){return b}a=Reflect.getPrototypeOf(a)}return undefined};$jscomp.polyfill('Reflect.get',function(a){if(a){return a}var b=function(c,b,d){if(arguments.length<=2){return c[b]}var a=$jscomp.findDescriptor(c,b);if(a){return a.get?a.get.call(d):a.value}return undefined};return b},'es6','es5');$jscomp.polyfill('Reflect.has',function(a){if(a){return a}var b=function(b,a){return a in b};return b},'es6','es3');$jscomp.polyfill('Reflect.isExtensible',function(a){if(a){return a}if(typeof Object.isExtensible=='function'){return Object.isExtensible}return function(){return !0}},'es6','es3');$jscomp.polyfill('Reflect.ownKeys',function(b){if(b){return b}var a='jscomp_symbol_';function isSymbol(b){return b.substring(0,a.length)==a}var c=function(d){var e=[];var b=Object.getOwnPropertyNames(d);var c=Object.getOwnPropertySymbols(d);for(var a=0;a<b.length;a++){(isSymbol(b[a])?c:e).push(b[a])}return e.concat(c)};return c},'es6','es5');$jscomp.polyfill('Reflect.preventExtensions',function(a){if(a){return a}if(typeof Object.preventExtensions!='function'){return function(){return !1}}var b=function(a){Object.preventExtensions(a);return !Object.isExtensible(a)};return b},'es6','es3');$jscomp.polyfill('Reflect.set',function(a){if(a){return a}var b=function(a,c,d,e){var b=$jscomp.findDescriptor(a,c);if(!b){if(Reflect.isExtensible(a)){a[c]=d;return !0}return !1}if(b.set){b.set.call(arguments.length>3?e:a,d);return !0}else {if(b.writable&&!Object.isFrozen(a)){a[c]=d;return !0}}return !1};return b},'es6','es5');$jscomp.polyfill('Reflect.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){try{a.__proto__=b;return a.__proto__===b}catch(c){return !1}};return b},'es6','es5');$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.polyfill('Set',function(b){var c=!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var d=Object.seal({x:4});var c=new b($jscomp.makeIterator([d]));if(!c.has(d)||c.size!=1||c.add(d)!=c||c.size!=1||c.add({x:4})!=c||c.size!=2){return !1}var e=c.entries();var a=e.next();if(a.done||a.value[0]!=d||a.value[1]!=d){return !1}a=e.next();if(a.done||a.value[0]==d||a.value[0].x!=4||a.value[1]!=a.value[0]){return !1}return e.next().done}catch(f){return !1}}();if(c){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=function(a){this.map_=new Map();if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.add(c)}}this.size=this.map_.size};a.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};a.prototype['delete']=function(b){var a=this.map_['delete'](b);this.size=this.map_.size;return a};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=function(a){return this.map_.has(a)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};(a.prototype)[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(b,a){var c=this;this.map_.forEach(function(d){return b.call((a),d,d,c)})};return a},'es6-impl','es3');$jscomp.checkStringArgs=function(a,c,b){if(a==null){throw new TypeError("The 'this' value for String.prototype."+b+' must not be null or undefined')}if(c instanceof RegExp){throw new TypeError('First argument to String.prototype.'+b+' must not be a regular expression')}return a+''};$jscomp.polyfill('String.prototype.codePointAt',function(a){if(a){return a}var b=function(a){var d=$jscomp.checkStringArgs(this,null,'codePointAt');var e=d.length;a=Number(a)||0;if(!(a>=0&&a<e)){return void 0}a=a|0;var b=d.charCodeAt(a);if(b<55296||b>56319||a+1===e){return b}var c=d.charCodeAt(a+1);if(c<56320||c>57343){return b}return (b-55296)*1024+c+9216};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.endsWith',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'endsWith');a=a+'';if(b===void 0){b=c.length}var e=Math.max(0,Math.min(b|0,c.length));var d=a.length;while(d>0&&e>0){if(c[--e]!=a[--d]){return !1}}return d<=0};return b},'es6-impl','es3');$jscomp.polyfill('String.fromCodePoint',function(a){if(a){return a}var b=function(d){var b='';for(var c=0;c<arguments.length;c++){var a=Number(arguments[c]);if(a<0||a>1114111||a!==Math.floor(a)){throw new RangeError('invalid_code_point '+a)}if(a<=65535){b+=String.fromCharCode(a)}else {a-=65536;b+=String.fromCharCode(a>>>10&1023|55296);b+=String.fromCharCode(a&1023|56320)}}return b};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.includes',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'includes');return c.indexOf(a,b||0)!==-1};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.repeat',function(a){if(a){return a}var b=function(a){var b=$jscomp.checkStringArgs(this,null,'repeat');if(a<0||a>1342177279){throw new RangeError('Invalid count value')}a=a|0;var c='';while(a){if(a&1){c+=b}if(a>>>=1){b+=b}}return c};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.startsWith',function(a){if(a){return a}var b=function(a,f){var b=$jscomp.checkStringArgs(this,a,'startsWith');a=a+'';var g=b.length;var d=a.length;var e=Math.max(0,Math.min((f)|0,b.length));var c=0;while(c<d&&e<g){if(b[e++]!=a[c++]){return !1}}return c>=d};return b},'es6-impl','es3');$jscomp.arrayFromIterator=function(c){var b;var a=[];while(!(b=c.next()).done){a.push(b.value)}return a};$jscomp.arrayFromIterable=function(a){if(a instanceof Array){return a}else {return $jscomp.arrayFromIterator($jscomp.makeIterator(a))}};$jscomp.inherits=function(a,b){function tempCtor(){}tempCtor.prototype=b.prototype;a.prototype=new tempCtor();a.prototype.constructor=a;for(var c in b){if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);if(d){Object.defineProperty(a,c,d)}}else {a[c]=b[c]}}};$jscomp.polyfill('WeakSet',function(b){function isConformant(){if(!b||!Object.seal){return !1}try{var c=Object.seal({});var d=Object.seal({});var a=new (b)([c]);if(!a.has(c)||a.has(d)){return !1}a['delete'](c);a.add(d);return !a.has(c)&&a.has(d)}catch(e){return !1}}if(isConformant()){return b}var a=function(a){this.map_=new WeakMap();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=b.value;this.add(c)}}};a.prototype.add=function(a){this.map_.set(a,!0);return this};a.prototype.has=function(a){return this.map_.has(a)};a.prototype['delete']=function(a){return this.map_['delete'](a)};return a},'es6-impl','es3');try{if(Array.prototype.values.toString().indexOf('[native code]')==-1){delete Array.prototype.values}}catch(a){}Ext.define('Robo.util.Array',{singleton:!0,reduce:function(a,f,e){a=Object(a);var b=0,d=a.length>>>0,c=e;if(arguments.length<3){while(!0){if(b in a){c=a[b++];break}if(++b>=d){throw new TypeError('Reduce of empty array with no initial value')}}}for(;b<d;++b){if(b in a){c=f(c,a[b],b,a)}}return c}});Ext.define('Robo.Transaction',{actions:null,title:null,constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent([a]);this.actions=[]},hasActions:function(){return this.actions.length>0},addAction:function(a){this.actions.push(a)},getActions:function(){return this.actions},undo:function(){for(var a=this.actions.length-1;a>=0;a--){this.actions[a].undo()}},redo:function(){for(var a=0;a<this.actions.length;a++){this.actions[a].redo()}},getTitle:function(){if(this.title){return this.title}var a=this.actions[0];return a?a.getTitle():null}});Ext.define('Robo.data.Model',{extend:'Ext.Mixin',modelName:null,editMementoFix:null,mixinConfig:{before:{endEdit:'onBeforeEndEdit'},after:{endEdit:'onAfterEndEdit'}},onBeforeEndEdit:function(c,b){var a=this.editMemento;if(a){this.editMementoFix=a;if(!b){b=this.getModifiedFieldNames(a.data)}if(!a.previousValues){a.previousValues={}}Ext.Array.each(b,function(b){a.previousValues[b]=a.data[b]})}},onAfterEndEdit:function(b,a){delete this.editMementoFix},getTitle:function(){return ''}});Ext.define('Robo.action.Base',{constructor:function(a){Ext.apply(this,a)},undo:function(){throw new Error('Abstract method call')},redo:function(){throw new Error('Abstract method call')},getTitle:function(){return ''},prepareRecord:function(a){a.phantom=!0;if(a.phantomIdField){a.data[a.phantomIdField]=a.getId()}return a}});Ext.define('Robo.action.flat.Update',{extend:'Robo.action.Base',requires:['Ext.Array'],inheritableStatics:{CUSTOMLY_PROCESSED:{}},config:{record:null,fieldNames:null},oldValues:null,newValues:null,constructor:function(b){var a=this;a.callParent([b]);a.initConfig(b);a.saveValues()},saveValues:function(){var a=this,c=a.getRecord(),b=a.getFieldNames();if(b){a.oldValues=Ext.Array.map(b,function(b){return a.processSavingOldValue(b,c)});a.newValues=Ext.Array.map(b,function(b){return a.processSavingNewValue(b,c)})}},undo:function(){var e,a=this,b=a.getRecord(),c=a.getFieldNames(),d;if(c){e=a.self.CUSTOMLY_PROCESSED;b.beginEdit();d=Robo.util.Array.reduce(c,function(f,d,g){var c;if(d){c=a.processRestoringValue(a.oldValues[g],d,b,'undo');if(c!==e){f[d]=c}}return f},{});b.set(d);b.endEdit()}},redo:function(){var e,a=this,b=a.getRecord(),c=a.getFieldNames(),d;if(c){e=a.self.CUSTOMLY_PROCESSED;b.beginEdit();d=Robo.util.Array.reduce(c,function(f,d,g){var c;if(d){c=a.processRestoringValue(a.newValues[g],d,b,'redo');if(c!==e){f[d]=c}}return f},{});b.set(d);b.endEdit()}},processSavingOldValue:function(b,a){var c=a.previous&&a.previous.hasOwnProperty(b)&&a.previous||a.previousValues&&a.previousValues.hasOwnProperty(b)&&a.previousValues||a.editMementoFix&&a.editMementoFix.previousValues&&a.editMementoFix.previousValues.hasOwnProperty(b)&&a.editMementoFix.previousValues||a.editMementoFix&&a.editMementoFix.data&&a.editMementoFix.data.hasOwnProperty(b)&&a.editMementoFix.data;if(!c){throw 'Can not get previous value'}return c[b]},processSavingNewValue:function(a,b){return b.get(a)},processRestoringValue:Ext.identityFn,getTitle:function(){var a=this.getRecord();var b=this.getFieldNames();if(a.getTitle){return 'Edit of '+b[0]+' for '+a.getTitle(this)}if(a.modelName){return 'Edit of '+a.modelName+' '+a.getId()}return ''}});Ext.define('Robo.action.flat.Add',{extend:'Robo.action.Base',store:null,records:null,index:null,autoSync:!1,undo:function(){var a=this.records;this.store.remove(a);if(!this.autoSync){for(var b=0;b<a.length;b++){this.store.removeFromRemoved(a[b])}}},redo:function(){if(this.autoSync){this.records=Ext.Array.map(this.records,this.prepareRecord)}this.store.insert(this.index,this.records)},getRecord:function(){return this.records[0]},getTitle:function(){var b=this;var a=Ext.Array.map(this.records,function(a){if(a.getTitle){return a.getTitle(b)}if(a.modelName){return a.modelName+' '+a.getId()}return 'unknown'});return 'Addition of '+a.join(',')}});Ext.define('Robo.action.flat.Remove',{extend:'Robo.action.Base',store:null,records:null,index:null,autoSync:!1,undo:function(){var a=this;if(a.autoSync){a.records=Ext.Array.map(a.records,a.prepareRecord)}a.store.insert(a.index,a.records)},redo:function(){var a=this;a.store.remove(a.records)},getRecord:function(){return this.records[0]},getTitle:function(){var b=this;var a=Ext.Array.map(this.records,function(a){if(a.getTitle){return a.getTitle(b)}if(a.modelName){return a.modelName+' '+a.getId()}return 'unknown'});return 'Removal of '+a.join(',')}});Ext.define('Robo.action.tree.Append',{extend:'Robo.action.Base',parent:null,newChild:null,autoSync:!1,undo:function(){var a=this.newChild;this.parent.removeChild(a);delete a.data.lastParentId;if(!this.autoSync){Ext.Array.remove(this.parent.getTreeStore().removedNodes,a)}},redo:function(){if(this.autoSync){this.newChild=this.prepareRecord(this.newChild)}this.parent.appendChild(this.newChild)},getRecord:function(){return this.newChild},getTitle:function(){var a=this.newChild;var b;if(a.getTitle){b=a.getTitle(this)}else {if(a.modelName){return a.modelName+' '+a.getId()}}return 'Append of '+b}});Ext.define('Robo.action.tree.Insert',{extend:'Robo.action.Base',parent:null,newChild:null,insertedBefore:null,autoSync:!1,undo:function(){var a=this.newChild;this.parent.removeChild(a);delete a.data.lastParentId;if(!this.autoSync){Ext.Array.remove(this.parent.getTreeStore().removedNodes,a)}},redo:function(){var a=this.insertedBefore,b=a&&a.isFirst();if(this.autoSync){this.newChild=this.prepareRecord(this.newChild)}this.parent.insertBefore(this.newChild,a);if(b){a.updateInfo(!1,{isFirst:!1})}},getRecord:function(){return this.newChild},getTitle:function(){var a=this.newChild;var b;if(a.getTitle){b=a.getTitle(this)}else {if(a.modelName){return a.modelName+' '+a.getId()}}return 'Insertion of '+b}});Ext.define('Robo.action.tree.Remove',{extend:'Robo.action.Base',parent:null,removedChild:null,nextSibling:null,newParent:null,newNextSibling:null,dirty:!1,isMove:!1,autoSync:!1,constructor:function(a){this.callParent(arguments);this.dirty=this.removedChild.dirty},undo:function(){var a=this;if(a.isMove){a.newParent=a.removedChild.parentNode;a.newNextSibling=a.removedChild.nextSibling}var c=a.nextSibling;var d=c&&c.isFirst();if(!a.isMove&&a.autoSync){a.removedChild=a.prepareRecord(a.removedChild)}var b=a.removedChild;a.parent.insertBefore(b,c);b.dirty=a.dirty;if(!a.isMove&&!a.autoSync){var e=b.getTreeStore();b.cascadeBy(function(a){Ext.Array.remove(e.removedNodes,a)})}if(d){c.updateInfo(!1,{isFirst:!1})}},redo:function(){if(this.isMove){var a=this.newNextSibling;var b=a&&a.isFirst();this.newParent.insertBefore(this.removedChild,a);if(b){a.updateInfo(!1,{isFirst:!1})}}else {this.parent.removeChild(this.removedChild);delete this.removedChild.data.lastParentId}},getRecord:function(){return this.removedChild},getTitle:function(){var a=this.removedChild;var b;if(a.getTitle){b=a.getTitle(this)}else {if(a.modelName){return a.modelName+' '+a.getId()}}return this.isMove?'Move of '+b:'Removal of '+b}});Ext.define('Robo.action.tree.Update',{extend:'Robo.action.flat.Update',processRestoringValue:function(a,d,b,e){var c=this;if(d==='expanded'){if(a){b.expand()}else {b.collapse()}a=c.self.CUSTOMLY_PROCESSED}else {if(d=='leaf'){a=c.callParent(arguments);if(a===!0&&e=='undo'){b.data.loaded=!1}}else {a=c.callParent(arguments)}}return a}});Ext.define('Robo.Manager',{extend:'Ext.util.Observable',requires:['Robo.util.Array','Robo.Transaction','Robo.data.Model','Robo.action.flat.Update','Robo.action.flat.Add','Robo.action.flat.Remove','Robo.action.tree.Append','Robo.action.tree.Insert','Robo.action.tree.Remove','Robo.action.tree.Update','Ext.data.Store','Ext.data.StoreManager'],stores:null,storesById:null,autoSync:!1,treeStoreListeners:null,flatStoreListeners:null,stub:function(){},undoQueue:null,redoQueue:null,ignoredFieldNames:{expanded:1},state:'created',transactionBoundary:'timeout',transactionMaxDuration:100,clearQueuesOnLoad:!1,transactionTimeout:null,currentTransaction:null,constructor:function(b){var a=this;b=b||{};Ext.apply(a,b);a.treeStoreListeners={nodeappend:a.onTreeStoreAppend,nodeinsert:a.onTreeStoreInsert,noderemove:a.onTreeStoreRemove,update:a.onTreeStoreUpdate,'robo-command':a.onIncomingCommand,scope:a};a.flatStoreListeners={add:a.onFlatStoreAdd,remove:a.onFlatStoreRemove,update:a.onFlatStoreUpdate,'robo-command':a.onIncomingCommand,scope:a};if(a.clearQueuesOnLoad){Ext.apply(a.treeStoreListeners,{load:a.clearQueues,clear:a.clearQueues});Ext.apply(a.flatStoreListeners,{load:a.clearQueues,clear:a.clearQueues})}a.callParent([b]);var c=a.stores||[];a.stores=[];a.storesById={};a.undoQueue=[];a.redoQueue=[];Ext.Array.forEach(c,function(b){a.addStore(b)})},addStore:function(a,f){a=Ext.data.StoreManager.lookup(a);this.stores.push(a);if(f){a.setStoreId(f)}var h=a.getModel();var d=h.prototype.associations||{};for(var g in d){var b=d[g];var e=b.getAssociatedStore;if(e&&(!b.ROBO_MANAGED||!b.ROBO_MANAGED[this.getId()])){var c=this;b.getAssociatedStore=function(){var a=e.apply(this,arguments);if(!c.hasStore(a)){c.addStore(a);if(c.state!=='disabled'&&c.state!=='created'){c.bindStore(a)}}return a};b.ROBO_MANAGED=b.ROBO_MANAGED||{};b.ROBO_MANAGED[this.getId()]=c}}if(a.storeId){this.storesById[a.storeId]=a}},getStoreById:function(a){return this.storesById[a]},hasStore:function(a){return Ext.Array.indexOf(this.stores,a)!==-1},bindStore:function(a){(a.undoRedoEventBus||a).on(this.getStoreTypeListeners(a));if(a.undoRedoEventBus){a.on(this.getStoreTypeListenerStubs(a))}},unbindStore:function(a){(a.undoRedoEventBus||a).un(this.getStoreTypeListeners(a));if(a.undoRedoEventBus){a.un(this.getStoreTypeListenerStubs(a))}},getStoreTypeListenerStubs:function(b){var c=this;var a=this.getStoreTypeListeners(b);a=Ext.apply({},a);Ext.Object.each(a,function(b){a[b]=c.stub});return a},getStoreTypeListeners:function(b){var a;if(Ext.data.TreeStore&&b instanceof Ext.data.TreeStore){a=this.treeStoreListeners}else {a=this.flatStoreListeners}return a},removeStore:function(a){Ext.Array.remove(this.stores,a);this.storesById[a.storeId]=null;this.unbindStore(a)},forEachStore:function(a){Ext.Array.forEach(this.stores,a,this)},onAnyChangeInAnyStore:function(a){if(this.state==='paused'||a.isRootSettingOrLoading&&a.isRootSettingOrLoading()){return !1}if(!this.currentTransaction){this.startTransaction()}return !0},hasPersistableChanges:function(c,a){var b=this.ignoredFieldNames;return Robo.util.Array.reduce(a,function(e,d){var a=c.getField(d);return e||!a||a.persist&&!b.hasOwnProperty(d)},!1)},onIncomingCommand:function(d,c,a){a=a||[];var b=this;if(b.areIncomingCommandsEnabled()){switch(c){case 'pause':case 'resume':case 'endTransaction':case 'startTransaction':case 'addTransaction':b[c].apply(b,a);break;}}},incomingCommandsDisabled:0,areIncomingCommandsEnabled:function(){return !this.incomingCommandsDisabled},disableIncomingCommands:function(){this.incomingCommandsDisabled++},enableIncomingCommands:function(){this.incomingCommandsDisabled--},onFlatStoreUpdate:function(e,c,d,a){var b=this;if(!b.onAnyChangeInAnyStore(e)||d!=='edit'||!a||!a.length||!b.hasPersistableChanges(c,a)){return}b.currentTransaction.addAction(new Robo.action.flat.Update({record:c,fieldNames:a.filter(function(a){return !(a in b.ignoredFieldNames)})}))},onFlatStoreAdd:function(a,b,c){if(!this.onAnyChangeInAnyStore(a)){return}this.currentTransaction.addAction(new Robo.action.flat.Add({autoSync:this.autoSync,store:a,records:b,index:c}))},onFlatStoreRemove:function(a,b,d,c){if(!this.onAnyChangeInAnyStore(a)){return}this.currentTransaction.addAction(new Robo.action.flat.Remove({autoSync:this.autoSync,store:a,records:b,index:d,isMove:c}))},onTreeStoreUpdate:function(e,c,d,a){var b=this;if(!b.onAnyChangeInAnyStore(e)||d!=='edit'||!a||!a.length||!b.hasPersistableChanges(c,a)){return}b.currentTransaction.addAction(new Robo.action.tree.Update({record:c,fieldNames:a.filter(function(a){return !(a in b.ignoredFieldNames)})}))},onTreeStoreAppend:function(b,a){if(!b||!this.onAnyChangeInAnyStore(b.getTreeStore())){return}if(a.$undoRedoMoving&&a.$undoRedoMoving[this.getId()]){delete a.$undoRedoMoving[this.getId()]}else {this.currentTransaction.addAction(new Robo.action.tree.Append({autoSync:this.autoSync,parent:b,newChild:a}))}},onTreeStoreInsert:function(b,a,c){if(!b||!this.onAnyChangeInAnyStore(b.getTreeStore())){return}if(a.$undoRedoMoving&&a.$undoRedoMoving[this.getId()]){delete a.$undoRedoMoving[this.getId()]}else {this.currentTransaction.addAction(new Robo.action.tree.Insert({autoSync:this.autoSync,parent:b,newChild:a,insertedBefore:c}))}},onTreeStoreRemove:function(b,a,c,d){if(!b||!this.onAnyChangeInAnyStore(b.getTreeStore())){return}if(c){a.$undoRedoMoving=a.$undoRedoMoving||{};a.$undoRedoMoving[this.getId()]=!0}this.currentTransaction.addAction(new Robo.action.tree.Remove({autoSync:this.autoSync,parent:b,removedChild:a,nextSibling:d.nextSibling,isMove:c}))},start:function(){if(this.state==='created'||this.state==='disabled'){this.fireEvent('start',this);this.fireEvent('undoqueuechange',this,this.undoQueue);this.fireEvent('redoqueuechange',this,this.redoQueue)}if(this.state!=='hold'){this.forEachStore(this.bindStore);this.state='enabled'}},stop:function(){this.endTransaction();this.forEachStore(this.unbindStore);this.state='disabled';this.clearQueues();this.fireEvent('stop',this)},clearQueues:function(){this.clearUndoQueue();this.clearRedoQueue()},pause:function(){this.state='paused'},resume:function(){this.state='enabled'},hold:function(){this.state='hold'},release:function(){this.state='enabled'},getUndoQueue:function(){return this.undoQueue.slice()},getRedoQueue:function(){return this.redoQueue.slice()},clearUndoQueue:function(){if(this.undoQueue.length){this.undoQueue=[];this.fireEvent('undoqueuechange',this,this.undoQueue.slice())}},clearRedoQueue:function(){if(this.redoQueue.length){this.redoQueue=[];this.fireEvent('redoqueuechange',this,this.redoQueue.slice())}},startTransaction:function(c){var a=this,b;if(a.state==='disabled'){return}if(a.currentTransaction){a.endTransaction()}b=new Robo.Transaction({title:c});a.currentTransaction=b;a.notifyStoresAboutTransactionStart(b);if(a.transactionBoundary==='timeout'){a.scheduleEndTransaction()}},scheduleEndTransaction:function(){var a=this;if(a.transactionTimeout){clearTimeout(a.transactionTimeout)}a.transactionTimeout=setTimeout(function(){if(a.state!=='hold'){a.endTransaction();a.transactionTimeout=null}else {a.scheduleEndTransaction()}},a.transactionMaxDuration)},endTransaction:function(){var a=this,b=a.currentTransaction;if(!b){return !1}a.currentTransaction=null;if(a.transactionBoundary==='timeout'){clearTimeout(a.transactionTimeout);a.transactionTimeout=null}if(b.hasActions()){a.addTransaction(b)}a.notifyStoresAboutTransactionEnd(b);return b.hasActions()},addTransaction:function(a){this.undoQueue.push(a);this.fireEvent('undoqueuechange',this,this.undoQueue.slice());if(this.redoQueue.length){this.redoQueue.length=0;this.fireEvent('redoqueuechange',this,this.redoQueue.slice())}this.fireEvent('transactionadd',this,a)},undo:function(a){var b=this.undoQueue,d,c,e,f=b.length;if(this.state==='disabled'||a===0||!b.length){return}if(a instanceof Robo.Transaction){d=Ext.Array.indexOf(b,a);if(d===-1){return}a=b.length-d}a=a||1;this.fireEvent('beforeundo',this);this.pause();this.notifyStoresAboutUndoRedoStart();for(e=0;e<Math.min(a,f);e++){c=b.pop();c.undo();this.redoQueue.unshift(c)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent('undoqueuechange',this,b.slice());this.fireEvent('redoqueuechange',this,this.redoQueue.slice());this.resume();this.fireEvent('afterundo',this)},redo:function(a){var c=this.redoQueue,b,d,e,f=c.length;if(this.state==='disabled'||a===0||!c.length){return}if(a instanceof Robo.Transaction){d=Ext.Array.indexOf(c,a);if(d===-1){return}a=d+1}a=a||1;this.fireEvent('beforeredo',this);this.pause();this.notifyStoresAboutUndoRedoStart();for(e=0;e<Math.min(a,f);e++){b=this.redoQueue.shift();b.redo();this.undoQueue.push(b)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent('redoqueuechange',this,this.redoQueue.slice());this.fireEvent('undoqueuechange',this,this.undoQueue.slice());this.resume();this.fireEvent('afterredo',this)},undoAll:function(){this.undo(this.undoQueue.length)},redoAll:function(){this.redo(this.redoQueue.length)},notifyStoresAboutTransactionStart:function(a){this.forEachStore(function(b){b.onUndoRedoTransactionStart&&b.onUndoRedoTransactionStart(this,a)})},notifyStoresAboutTransactionEnd:function(a){this.forEachStore(function(b){b.onUndoRedoTransactionEnd&&b.onUndoRedoTransactionEnd(this,a)})},notifyStoresAboutUndoRedoStart:function(){this.forEachStore(function(a){a.beforeUndoRedo&&a.beforeUndoRedo(this)})},notifyStoresAboutUndoRedoComplete:function(){this.forEachStore(function(a){a.afterUndoRedo&&a.afterUndoRedo(this)})}},function(){Ext.apply(Robo,{VERSION:'6.1.17'})});Ext.define('Robo.data.Store',{extend:'Ext.Mixin',requires:['Ext.util.Observable'],undoRedoPostponed:null,inUndoRedoTransaction:!1,undoRedoEventBus:null,mixinConfig:{before:{constructor:'constructor',destroy:'destroy',fireEventArgs:'fireEventArgs',setRoot:'beforeSetRoot',fillNode:'beforeFillNode'},after:{setRoot:'afterSetRoot',fillNode:'afterFillNode'}},constructor:function(){var a=this;a.undoRedoEventBus=new Ext.util.Observable()},destroy:function(){Ext.destroy(this.undoRedoEventBus)},fireEventArgs:function(b,a){var c=this;if(!a.hasOwnProperty('$undoRedoEventBusFired')){a.$undoRedoEventBusFired={}}if(!a.$undoRedoEventBusFired[b]){a.$undoRedoEventBusFired[b]=!0;c.undoRedoEventBus.hasListener(b)&&c.undoRedoEventBus.fireEventArgs(b,a)}},isInUndoRedoTransaction:function(){return this.inUndoRedoTransaction},onUndoRedoTransactionStart:function(b,a){this.inUndoRedoTransaction=!0},onUndoRedoTransactionEnd:function(b,a){this.inUndoRedoTransaction=!1},isUndoingOrRedoing:function(){return !!this.undoRedoPostponed},beforeUndoRedo:function(a){this.undoRedoPostponed=[]},afterUndoRedo:function(b){var a=this;if(a.undoRedoPostponed){Ext.Array.forEach(a.undoRedoPostponed,function(a){a()})}a.undoRedoPostponed=null},postponeAfterUndoRedo:function(a){this.undoRedoPostponed.push(a)},beforeSetRoot:function(){this.__isSettingRoot=!0},afterSetRoot:function(){this.__isSettingRoot=!1;if(!this.getRoot()){this.fireEvent('clear',this)}},beforeFillNode:function(a){if(a.isRoot()){this.beforeSetRoot()}},afterFillNode:function(a){if(a.isRoot()){this.afterSetRoot()}},isRootSettingOrLoading:function(){return this.isLoading()||this.isTreeStore&&this.__isSettingRoot}});Ext.define('Robo.widget.UndoButton',{extend:'Ext.button.Split',alias:'widget.roboundobutton',iconCls:Ext.baseCSSPrefix+'fa fa-undo',robo:null,transactionList:null,type:'undo',text:'Undo',disabled:!0,constructor:function(a){a=a||{};Ext.apply(this,a);if(!this.robo){throw new Error('`robo` is a required config for the '+this.$className)}this.callParent(a)},initComponent:function(){var a=this;Ext.apply(this,{menu:new Ext.menu.Menu({cls:'robo-transaction-list',items:this.getTransactionItems(),listeners:{click:this.onTransactionClick,scope:this}})});this.on('click',function(){a.robo[a.type]()});this.mon(a.robo,a.type+'queuechange',this.onTransactionQueueChange,this);this.callParent()},onTransactionQueueChange:function(c,b){this.setDisabled(b.length===0);var a=this.menu;a.removeAll();a.add(this.getTransactionItems());if(!b.length){a.hide()}},getTransactionItems:function(){var a=this;var b=Ext.Array.map(this.robo[this.type+'Queue'],function(b){return new Ext.menu.Item({text:b.getTitle(),transaction:b,listeners:{activate:a.onTransactionItemActivated,deactivate:a.onTransactionItemDeActivated,scope:a}})});if(this.type=='undo'){b.reverse()}return b},onTransactionClick:function(b,a){if(!a){return}this.robo[this.type](a.transaction)},onTransactionItemActivated:function(a){this.menu.items.each(function(b){if(b==a){return !1}if(b.rendered){b.el.addCls(b.activeCls)}})},onTransactionItemDeActivated:function(a){this.menu.items.each(function(b){if(b==a){return !1}if(b.rendered){b.el.removeCls(b.activeCls)}})}});Ext.define('Robo.widget.RedoButton',{extend:'Robo.widget.UndoButton',alias:'widget.roboredobutton',iconCls:Ext.baseCSSPrefix+'fa fa-repeat fa-redo',type:'redo',text:'Redo'});Ext.define('Robo.widget.StatusPanel',{extend:'Ext.tree.Panel',alias:'widget.robostatuspanel',robo:null,type:'undo',constructor:function(a){a=a||{};Ext.apply(this,a);if(!this.robo){throw new Error('`robo` is a required config for the '+this.$className)}this.callParent(a)},initComponent:function(){var a=this;Ext.apply(this,{rootVisible:!1,columns:[{xtype:'treecolumn',text:'Title',dataIndex:'title',width:250},{text:'Changed fields',dataIndex:'fieldNames',flex:1,tdCls:'fieldnames'}],store:{fields:['title','fieldNames','isActive']},viewConfig:{getRowClass:Ext.Function.bind(this.getActiveRowClass,this)}});this.mon(a.robo,a.type+'queuechange',this.onTransactionQueueChange,this);this.callParent()},getActiveRowClass:function(a,c,b,d){return a.get('isActive')?'robo-status-active':''},onTransactionQueueChange:function(d,a){var c=this.type;var b=Ext.Array.map(a,function(b,e){var d=c=='undo'?e==a.length-1:e===0;return {leaf:!1,expanded:!0,title:b.getTitle(),isActive:d,children:Ext.Array.map(b.getActions(),function(a){var b=a.getRecord();return {leaf:!0,title:a.getTitle(),fieldNames:a instanceof Robo.action.flat.Update?a.fieldNames.join(', '):'',isActive:d}})}});this.store.setRootNode({expanded:!0,children:b});this.getView().scrollTo(0,Infinity)}});Ext.define('Sch.crud.AbstractManager',{requires:['Ext.data.StoreManager'],mixins:{observable:'Ext.util.Observable'},isCrudManager:!0,revision:null,stores:null,storeIdProperty:'storeId',filterParam:'filter',storesIndex:null,activeRequests:null,delayedSyncs:null,transport:null,trackResponseType:!1,phantomIdField:'$PhantomId',autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:null,writeAllFields:!1,fieldMapping:!1,destroyed:!1,ignoreUpdates:0,loaded:!1,createMissingRecords:!1,autoSyncTimerId:null,applyingLoadResponse:!1,applyingSyncResponse:!1,constructor:function(a){a=a||{};this.mixins.observable.constructor.call(this,a);this.activeRequests={};this.delayedSyncs=[];this.transport=a.transport||this.transport||{};var c=a.stores||this.stores;this.stores=[];this.addStore(c);var b=a.syncApplySequence||this.syncApplySequence;if(b){this.syncApplySequence=null;this.addStoreToApplySequence(b)}if(this.autoLoad){this.load()}},updateStoreIndex:function(){var b={};for(var a=0,d=this.stores.length;a<d;a++){var c=this.stores[a];if(c.storeId){b[c.storeId]=this.stores[a]}}this.storesIndex=b},getStoreDescriptor:function(a){if(!a){return}if(a.isStore){for(var b=0,c=this.stores.length;b<c;b++){if(this.stores[b].store===a){return this.stores[b]}}}else {if(typeof a=='object'){return this.storesIndex[a.storeId]}else {return this.storesIndex[a]||this.getStoreDescriptor(Ext.data.StoreManager.get(a))}}},getStore:function(b){var a=this.getStoreDescriptor(b);return a&&a.store},forEachStore:function(c,d){if(!c){return}var b=this.stores;for(var a=0,e=b.length;a<e;a++){if(c.call(d||this,b[a].store,b[a].storeId,b[a])===!1){break}}},addStore:function(c,i,b){if(!c){return}if(!Ext.isArray(c)){c=[c]}var g=[];for(var h=0,k=c.length;h<k;h++){var a=c[h];if(a.isStore){a={store:a}}else {if(typeof a=='object'){if(a.stores){if(!Ext.isArray(a.stores)){a.stores=[a.stores]}for(var d=0,l=a.stores.length;d<l;d++){var f=a.stores[d],e=f;if('string'===typeof f){e={storeId:f}}e.masterStoreInfo=a;a.stores[d]=e}}}else {a={store:Ext.data.StoreManager.get(a)}}}g.push(this.fillStoreDescriptor(a));if(a.store.setCrudManager){a.store.setCrudManager(this)}else {a.store.crudManager=this}if(a.store.isTreeStore){a.store.setProxy({type:'memory'})}a.store.setAsynchronousLoad(!1);this.bindStoreListeners(a.store)}if(typeof i==='undefined'){this.stores.push.apply(this.stores,g)}else {var j=i;if(b){if(b.isStore||typeof b!=='object'){b=this.getStoreDescriptor(b)}j+=Ext.Array.indexOf(this.stores,b)}this.stores.splice.apply(this.stores,[].concat([j,0],g))}this.updateStoreIndex()},bindStoreListeners:function(b,c){var a={update:this.onStoreUpdate,clear:this.onStoreChange,scope:this};if(b.isTreeStore){Ext.apply(a,{nodeappend:this.onTreeStoreInsertOrAppend,nodeinsert:this.onTreeStoreInsertOrAppend,noderemove:this.onNodeRemove})}else {Ext.apply(a,{add:this.onStoreChange,remove:this.onStoreChange})}if(c){this.mun(b,a)}else {this.mon(b,a)}},unbindStoreListeners:function(a){this.bindStoreListeners(a,!0)},fillStoreDescriptor:function(c){var b=c.store,d=b.storeIdProperty||this.storeIdProperty,a=b.getModel&&b.getModel()||b.model;a=a&&a.prototype;Ext.applyIf(c,{storeId:b[d],phantomIdField:a&&a.phantomIdField,idProperty:a&&a.idProperty,writeAllFields:b.writeAllFields});return c},removeStore:function(b){for(var c=0,d=this.stores.length;c<d;c++){var a=this.stores[c];if(a===b||a.store===b||a.storeId===b){this.unbindStoreListeners(a.store);delete this.storesIndex[a.storeId];this.stores.splice(c,1);if(this.syncApplySequence){this.removeStoreFromApplySequence(b)}break}}},addStoreToApplySequence:function(b,e,a){if(!b){return}if(!Ext.isArray(b)){b=[b]}var c=[];for(var d=0,h=b.length;d<h;d++){var g=this.getStoreDescriptor(b[d]);if(g){c.push(g)}}if(!this.syncApplySequence){this.syncApplySequence=[]}if(typeof e==='undefined'){this.syncApplySequence.push.apply(this.syncApplySequence,c)}else {var f=e;if(a){if(a.isStore||typeof a!=='object'){a=this.getStoreDescriptor(a)}f+=Ext.Array.indexOf(this.syncApplySequence,a)}this.syncApplySequence.splice.apply(this.syncApplySequence,[].concat([f,0],c))}},removeStoreFromApplySequence:function(b){for(var a=0,d=this.syncApplySequence.length;a<d;a++){var c=this.syncApplySequence[a];if(c===b||c.store===b||c.storeId===b){this.syncApplySequence.splice(a,1);break}}},onNodeRemove:function(a){var b=a&&a.getTreeStore();b&&b.on('endupdate',this.onStoreChange,this,{single:!0})},onStoreUpdate:function(c,b,e,a){if(!c.isTreeStore||b!==c.getRoot()){var d=a&&a.length===1&&b.getField(a[0])&&!b.getField(a[0]).persist;if(!d){this.onStoreChange()}}},onTreeStoreInsertOrAppend:function(b,a){if(!a.isRoot()){this.onStoreChange()}},suspendChangesTracking:function(){this.ignoreUpdates++},resumeChangesTracking:function(a){this.ignoreUpdates--;a&&this.onStoreChange()},onStoreChange:function(){if(this.ignoreUpdates){return}var a=this;if(this.hasChanges()){this.fireEvent('haschanges',this);if(this.autoSync){if(!this.autoSyncTimerId){this.autoSyncTimerId=setTimeout(function(){a.autoSyncTimerId=null;a.sync()},this.autoSyncTimeout)}}}else {this.fireEvent('nochanges',this)}},hasChanges:function(c){var a;if(c){a=this.getStore(c);if(!a){return !1}return this.isStoreDirty(a)}for(var b=0,d=this.stores.length;b<d;b++){if(this.isStoreDirty(this.stores[b].store)){return !0}}return !1},isStoreDirty:function(b){if(b.getRemovedRecords().length){return !0}if(b.isTreeStore){for(var f in b.byIdMap){var a=b.byIdMap[f];if(a.dirty===!0&&!a.get('root')&&(Ext.Object.getKeys(a.modified).length!==1||!('expanded' in a.modified)&&!('lastParentId' in a.modified))){return !0}else {if(!a.get('root')&&a.phantom&&a.isValid()){return !0}}}}else {var d=b.getData().items;for(var c=0,e=d.length;c<e;c++){if(d[c].dirty||d[c].phantom){return !0}}}return !1},getLoadPackage:function(i){var k={type:'load',requestId:this.getRequestId(),stores:[]};var d=this.stores,f=k.stores;for(var c=0,l=d.length;c<l;c++){var a=d[c],e=a.filterParam||a.store.filterParam||this.filterParam,b=i&&i[a.storeId],g=a.pageSize||a.store.pageSize;if(a.store.remoteFilter&&e){b=b||{};var h=[];a.store.getFilters().each(function(a){h.push(a.serialize())});b[e]=h}if(b||g){var j=Ext.apply({storeId:a.storeId,page:1,pageSize:g},b);d[c].currentPage=j.page;f.push(j)}else {f.push(a.storeId)}}return k},getAddedRecordData:function(b,d,e){var c=this,a=b.getData({serialize:!0,persist:!0}),f=b.getData({serialize:!0,persist:!0,critical:!0,changes:!0});a=Ext.applyIf(a,f);if(!a.hasOwnProperty(d)){a[d]=b.getId()}if(c.resetIdsBeforeSync){delete a[b.idProperty]}c.processFieldMapping(a,b);if(e){c.processSubStores(b,a,e)}return a},prepareAdded:function(b,a,c){return b.map(function(b){return this.getAddedRecordData(b,a,c)},this)},getUpdatedRecordData:function(a,h,g){var e=this,d=g.writeAllFields||g.writeAllFields!==!1&&e.writeAllFields,b=a.getData({serialize:!0,persist:!0,critical:!d,changes:!d});b[a.idProperty]=a.getId();for(var f in b){var c=a.getField(f);var i=!c||(d?!c.persist&&!c.critical:!c.persist);if(i){delete b[f]}}e.processFieldMapping(b,a);if(h){e.processSubStores(a,b,h)}return b},prepareUpdated:function(b,c,a){return b.map(function(b){return this.getUpdatedRecordData(b,c,a)},this)},prepareRemoved:function(b){var d=[];for(var a=0,f=b.length;a<f;a++){var c=b[a],e={};e[c.idProperty]=c.getId();d.push(e)}return d},processFieldMapping:function(a,e){var b=this;if(!b.fieldMapping){return}if(Ext.isFunction(b.fieldMapping)){b.fieldMapping(a,e);return}for(var c in a){var f=e.getField(c),d=f&&f[Ext.isString(b.fieldMapping)?b.fieldMapping:'mapping'];if(d&&d!==c){a[d]=a[c];delete a[c]}}},processSubStores:function(g,d,c){for(var b=0,h=c.length;b<h;b++){var a=c[b].storeId,f=g.get(a);if(f){var e=this.getStoreChanges(Ext.apply({store:f},c[b]));if(e){d[a]=Ext.apply(e,{$store:!0})}else {delete d[a]}}else {delete d[a]}}},getStoreChanges:function(e,f){f=f||e.phantomIdField||this.phantomIdField;var g=e.store,c=g.getNewRecords(),b=g.getUpdatedRecords(),a=g.getRemovedRecords(),h=e.stores;var d;if(c.length){c=this.prepareAdded(c,f,h)}if(b.length){b=this.prepareUpdated(b,h,e)}if(a.length){a=this.prepareRemoved(a)}if(c.length||b.length||a.length){d={};if(c.length){d.added=c}if(b.length){d.updated=b}if(a.length){d.removed=a}}return d},getChangeSetPackage:function(){var f={type:'sync',requestId:this.getRequestId(),revision:this.revision};var d=this.stores,e=0;for(var b=0,i=d.length;b<i;b++){var a=d[b],g=a.phantomIdField||this.phantomIdField,h=a.storeId;var c=this.getStoreChanges(a,g);if(c){e++;f[h]=c}}return e?f:null},getSubStoresData:function(b,d,f,i){if(!b){return}var c=[];var g=function(a,d){for(var b=0,g=d.length;b<g;b++){var e=d[b].storeId;if(a[e]){c.push({id:a[f],storeDesc:d[b],data:a[e]});delete a[e]}}};var a=0,h=b.length;if(i){for(;a<h;a++){g(b[a],d);var e=this.getSubStoresData(b[a].children,d,f,!0);if(e){c=c.concat(e)}}}else {for(;a<h;a++){g(b[a],d)}}return c},loadDataToTreeStore:function(a,c,f,e){var d=c&&c.rows||[];var b=a.getRoot();if(b){b.modified=null;b.reject()}a.proxy.data=d;a.load({onChildNodesAvailable:function(){var a=this.getFilters();a.beginUpdate();a.endUpdate()}})},loadDataToFlatStore:function(a,b,c,e){var f=b&&b.rows||[];a.totalCount=b.total;a.currentPage=e.currentPage;var d=Ext.Array.map(f,function(b){return new a.model(b)});a.loadData(d,c&&c.append||b.append);a.fireEvent('load',a,d,!0)},applyMetaDataToStore:function(b,a){if(a){if(b.applyMetaData){b.applyMetaData(a,this)}else {b.metaData=a}}},loadDataToStore:function(b,e,m){var a=b.store,g=a.getModel(),i=b.stores,k=b.idProperty||g&&g.prototype&&g.prototype.idProperty||'id',f=a.isTreeStore,d;a.__loading=!0;if(e){this.applyMetaDataToStore(a,e.metaData);var j=e.rows||[];if(j){if(i){d=this.getSubStoresData(j,i,k,f)}var l=f?this.loadDataToTreeStore:this.loadDataToFlatStore;l.call(this,a,e,m,b);if(d){for(var h=0,n=d.length;h<n;h++){var c=d[h];this.loadDataToStore(Ext.apply({store:a[f?'getNodeById':'getById'](c.id).get(c.storeDesc.storeId)},c.storeDesc),c.data)}}}}a.__loading=!1},loadData:function(f,a){a=a||{};this.suspendChangesTracking();for(var b=0,g=this.stores.length;b<g;b++){var c=this.stores[b],d=c.storeId,e=f[d];if(e){this.loadDataToStore(c,e,a[d])}}this.resumeChangesTracking()},getRecordChangesStates:function(g,p,q,o){var a=this.getStoreDescriptor(o),m=g.idProperty,i=a&&a.phantomIdField||g.phantomIdField||this.phantomIdField,e=g.getId(),l=this.activeRequests.sync,f,c;if(l&&a){var d=l.pack[a.storeId],k=d&&d.updated,n=d&&d.added;var b=this._currentChangeSetPackage&&this._currentChangeSetPackage[a.storeId],h=b&&b.updated,j=b&&b.added;c=k&&Ext.Array.findBy(k,function(a){return a[m]==e});if(c){f=h&&Ext.Array.findBy(h,function(a){return a[m]==e})}else {c=n&&Ext.Array.findBy(n,function(a){return a[i]==e});f=j&&Ext.Array.findBy(j,function(a){return a[i]==e})}}return {sent:c,current:f}},isFieldValueEqual:function(d,c,a,b){if(c.isDateField){if(a instanceof Date){a=c.serialize(a)}if(b instanceof Date){b=c.serialize(b)}}return d.isEqual(a,b,c)},applyChangeToField:function(a,d,c,b){var e=b&&b.parentIdProperty||'parentId';if(d===a.idProperty){a.setId(c)}else {if(d===e&&b.isTreeStore){var f=c&&b.getNodeById(c)||b.getRoot();f.appendChild(a)}else {if(a.getField(d)){a.set(d,c)}}}},applyChangesToRecord:function(b,m,e,v){var n=b.data,f={},k=!1,a;var p=this.getRecordChangesStates.apply(this,arguments),l=p.sent,c=p.current,h=Ext.apply({},c);if(e){for(var g=0,x=e.length;g<x;g++){a=e[g].storeId;if(m.hasOwnProperty(a)){f[a]=!0;var r=b.get(a);if(r){this.applyChangesToStore(Ext.apply({store:r},e[g]),m[a])}else {Ext.log("Can't find store for the response sub-package")}}}}var i=!1,d=Ext.apply({},m,l),j=Ext.apply({},d);for(a in f){if(f.hasOwnProperty(a)){delete h[a]}}for(a in d){if(d.hasOwnProperty(a)&&!f[a]){var u=d[a];var t=b.getField(a);var q=l&&!this.isFieldValueEqual(b,t||a,l[a],c?c[a]:n[a]);i=i||q;delete h[a];if(!q){if(!this.isFieldValueEqual(b,t||a,n[a],u)){delete j[a];if(!k){k=!0;b.beginEdit()}this.applyChangeToField(b,a,u,v)}}else {delete j[a];if(!c||!c[a]){b.dirty=!0;b.modified[a]=n[a]}}}}if(k){b.endEdit()}if(!i&&!Ext.Object.getValues(h).length){b.commit()}else {if(b.modified){var s=Ext.Object.getKeys(j);for(var o=0,w=s.length;o<w;o++){delete b.modified[s[o]]}}}if(b.phantom){b.phantom=!1}},applyRemovals:function(f,h,d){var m=d.idProperty,a=f.isTreeStore?f.removedNodes:f.removed,l=d.findByIdFn,k=d.removeRecordFn,c=0;for(var g=0,o=h.length;g<o;g++){var i=!1;var j=h[g][m];for(var b=0,n=a.length;b<n;b++){if(a[b].getId()==j){a.splice(b,1);i=!0;c++;break}}if(!i){var e=l(j);if(e){this.suspendChangesTracking();k(e);Ext.Array.remove(a,e);c++;this.resumeChangesTracking()}else {Ext.log("Can't find record to remove from the response package")}}}return c},getApplyChangesToStoreHelpers:function(a){if(a.isTreeStore){var c=function(b){return a.getNodeById(b)},b=a.parentIdProperty||'parentId';return {findByPhantomFn:c,findByIdFn:c,addRecordFn:function(c){var d=c[b]&&a.getNodeById(c[b])||a.getRoot();return d.appendChild(c)},removeRecordFn:function(a){return a.parentNode.removeChild(a)}}}else {return {findByPhantomFn:function(b){return a.data.getByKey(b)},findByIdFn:function(b){return a.getById(b)},addRecordFn:function(b){return a.add(b)[0]},removeRecordFn:function(b){return a.remove(b)}}}},applyChangesToStore:function(i,k){var g=this,p=i.phantomIdField||g.phantomIdField,h=i.idProperty,a=i.store;if(!h){var e=a.getModel&&a.getModel()||a.model;e=e&&e.prototype;h=e&&e.idProperty||'id'}var j=g.getApplyChangesToStoreHelpers(a),v=j.findByPhantomFn,s=j.findByIdFn,x=j.addRecordFn,w=j.removeRecordFn,u=k.metaData,n=k.rows,q=k.removed,t=0,b;u&&g.applyMetaDataToStore(a,u);if(q){t=g.applyRemovals(a,q,{idProperty:h,findByIdFn:s,removeRecordFn:w})}if(n){var f,c,d,l,m,y=i.stores;for(var o=0,z=n.length;o<z;o++){f=n[o];d=f[p];c=f[h];l=d!=null&&d!=='';m=c!=null&&c!=='';b=null;if(l){b=v(d)}else {if(m){b=s(c)}}if(b){g.applyChangesToRecord(b,f,y,a)}else {var r=a.getRemovedRecords();if(!r.length||!m&&!l||!Ext.Array.findBy(r,c?function(a){return a.getId()==c}:function(a){return a.data[p]==d})){b=x(f);b.commit()}}}}if(t>0){a.fireEvent('datachanged',a);a.fireEvent('commit',a)}},applySyncResponse:function(d){this.applyingSyncResponse=!0;this.suspendChangesTracking();this._currentChangeSetPackage=this.getChangeSetPackage();var b=this.syncApplySequence||this.stores;for(var a=0,e=b.length;a<e;a++){var c=d[b[a].storeId];if(c){this.applyChangesToStore(b[a],c)}}this.applyingSyncResponse=!1;this.resumeChangesTracking()},applyLoadResponse:function(a,b){this.applyingLoadResponse=!0;this.loadData(a,b);this.applyingLoadResponse=!1},applyResponse:function(a,b,c){if(this.trackResponseType){a=b.type||a}switch(a){case 'load':this.applyLoadResponse(b,c);break;case 'sync':this.applySyncResponse(b);break;}},getRequestId:function(){return Math.floor(Math.random()*Date.now())},onResponse:function(b,d,c,e){var a=this.decode(d);if(!a||!a.success){this.fireEvent('requestfail',this,b,a,c);this.fireEvent(b+'fail',this,a,c,e);if('string'!=typeof d){d=''+d}this.warn('CrudManager: '+b+' failed, please inspect the server response',d.length<1024*1024&&d||'')}else {this.fireEvent('requestsuccess',this,b,a,c);this.fireEvent(b+'success',this,a,c,e);if(this.fireEvent('beforeresponseapply',this,b,a)!==!1&&this.fireEvent('before'+b+'apply',this,a,e)!==!1){this.revision=a.revision;this.applyResponse(b,a,e);this.fireEvent('requestdone',this,b,a,c);this.fireEvent(b,this,a,c,e);if(b==='load'||!this.hasChanges()){this.fireEvent('nochanges',this)}}else {this.fireEvent('responseapplycancelled',this,b,a);this.fireEvent(b+'applycancelled',this,a,e)}}this.activeRequests[b]=null;return a},onLoad:function(b,a,c){this.loaded=!0;return this.onResponse('load',b,a,c)},onSync:function(b,a,c){return this.onResponse('sync',b,a,c)},load:function(c,b,a){var d;if(typeof c==='object'){d=c;c=b;b=a;a=arguments[3]}var e=this.getLoadPackage(d);if(this.fireEvent('beforeload',this,e)!==!1){a=a||this;if(this.activeRequests.load){this.cancelRequest(this.activeRequests.load.desc);this.fireEvent('loadcanceled',this,e)}this.activeRequests.load={id:e.requestId};this.activeRequests.load.desc=this.sendRequest({data:this.encode(e),type:'load',success:function(f,g){var e=this.onLoad(f,g,d);if(b&&(!e||!e.success)){b.call(a,e,f,d)}else {if(c){c.call(a,e,f,d)}}},failure:function(d,c){this.onLoad(d,c);if(b){b.apply(a,arguments)}},scope:this})}else {this.fireEvent('loadcanceled',this,e)}},sync:function(c,d,a){if(this.activeRequests.sync){this.delayedSyncs.push(arguments);this.fireEvent('syncdelayed',this,arguments);return}var b=this.getChangeSetPackage();a=a||this;if(!b){if(c){c.call(a,null,null)}return}if(this.fireEvent('beforesync',this,b)===!1){this.fireEvent('synccanceled',this,b);return}this.activeRequests.sync={id:b.requestId,pack:b};this.activeRequests.sync.desc=this.sendRequest({data:this.encode(b),type:'sync',success:function(e,g){var f=this.activeRequests.sync;var b=this.onSync(e,g);if(d&&(!b||!b.success)){d.call(a,b,e,f)}else {if(c){c.call(a,b,e,f)}}this.runDelayedSync()},failure:function(b,c){this.onSync(b,c);if(d){d.apply(a,arguments)}this.runDelayedSync()},scope:this})},runDelayedSync:function(){var a=this.delayedSyncs.shift();if(!a){return}this.sync.apply(this,a)},commit:function(){for(var b=0,c=this.stores.length;b<c;b++){var a=this.stores[b].store;a.suspendEvents(!0);a.commitChanges();a.resumeEvents()}},reject:function(){for(var a=0,b=this.stores.length;a<b;a++){this.stores[a].store.rejectChanges()}},warn:function(){if('console' in window){var a=console;a.log&&a.log.apply&&a.log.apply(a,arguments)}},isLoading:function(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)},destroy:function(){var a=this;if(a.destroyed){return}a.activeRequests.load&&a.cancelRequest(a.activeRequests.load.desc);a.activeRequests.sync&&a.cancelRequest(a.activeRequests.sync.desc);while(a.stores.length>0){a.removeStore(a.stores[0])}clearTimeout(a.autoSyncTimerId);a.destroyed=!0}});Ext.define('Sch.app.CrudManagerDomain',{extend:'Ext.app.EventDomain',singleton:!0,requires:['Sch.crud.AbstractManager'],type:'crudmanager',prefix:'crudmanager.',constructor:function(){var a=this;a.callParent();a.monitor(Sch.crud.AbstractManager)},match:function(d,b){var a=!1,c=d.alias;if(b==='*'){a=!0}else {if(c){a=Ext.Array.indexOf(c,this.prefix+b)>-1}}return a}});Ext.define('Sch.column.Day',{extend:'Ext.grid.column.Column',alias:'widget.weekview-day',align:'center',start:null,end:null,draggable:!1,groupable:!1,hideable:!1,sortable:!1,menuDisabled:!0,enableLocking:!1,lockable:!1,flex:1,resizable:!1,cellFocusable:!1,tdCls:'sch-timetd',initComponent:function(){var a=new Date();this.addCls('sch-daycolumn-header');if(this.isWeekend()){this.addCls('sch-daycolumn-header-weekend');this.tdCls=(this.tdCls||'')+' sch-daycolumn-weekend'}if(this.start.getDate()===a.getDate()&&this.start.getMonth()===a.getMonth()&&this.start.getYear()===a.getYear()){this.addCls('sch-daycolumn-header-today');this.tdCls=(this.tdCls||'')+' sch-daycolumn-today'}this.callParent(arguments)},isWeekend:function(){var a=this.start.getDay();return a===6||a===0}});Ext.define('Sch.column.Resource',{extend:'Ext.grid.Column',alias:'widget.resourcecolumn',align:'center',menuDisabled:!0,hideable:!1,sortable:!1,locked:!1,lockable:!1,draggable:!1,enableLocking:!1,cellFocusable:!1,model:null,initComponent:function(){this.tdCls=(this.tdCls||'')+' sch-timetd';this.cls=(this.cls||'')+' sch-resourcecolumn-header';this.callParent(arguments)}});Ext.define('Sch.locale.Locale',{l10n:null,localeName:null,namespaceId:null,constructor:function(){if(!Sch.locale.Active){Sch.locale.Active={};this.bindRequire()}var b=this.self.getName().split('.');var c=this.localeName=b.pop();this.namespaceId=b.join('.');var a=Sch.locale.Active[this.namespaceId];if(!(c=='En'&&a&&a.localeName!='En')){this.apply()}},bindRequire:function(){var a=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(b){a.apply(this,arguments);if(b){var d=Ext.ClassManager.get(b);for(var c in Sch.locale.Active){Sch.locale.Active[c].apply(d)}}}},applyToClass:function(c,a){var e=this,d=e.self.getName();a=a||Ext.ClassManager.get(c);if(a&&a.activeLocaleId!==d){var b=e.l10n[c];if(typeof b==='function'){b(c)}else {if(a.singleton){a.l10n=Ext.apply({},b,a.prototype&&a.prototype.l10n)}else {if(a.prototype.hasOwnProperty('l10n')){b=Ext.apply({},b,a.prototype&&a.prototype.l10n)}Ext.override(a,{l10n:b})}}a.activeLocaleId=d;if(a.onLocalized){a.onLocalized()}}},apply:function(a){if(this.l10n){var e=this;if(a){if(!Ext.isArray(a)){a=[a]}var c,d;for(var b=0,g=a.length;b<g;b++){if(Ext.isObject(a[b])){if(a[b].singleton){d=a[b];c=Ext.getClassName(Ext.getClass(d))}else {d=Ext.getClass(a[b]);c=Ext.getClassName(d)}}else {d=null;c='string'===typeof a[b]?a[b]:Ext.getClassName(a[b])}if(c){if(c in this.l10n){e.applyToClass(c,d)}}}}else {Sch.locale.Active[this.namespaceId]=this;for(var f in this.l10n){e.applyToClass(f)}}}}});Ext.define('Sch.locale.En',{extend:'Sch.locale.Locale',singleton:!0,l10n:{'Sch.util.Date':{unitNames:{YEAR:{single:'year',plural:'years',abbrev:'yr'},QUARTER:{single:'quarter',plural:'quarters',abbrev:'q'},MONTH:{single:'month',plural:'months',abbrev:'mon'},WEEK:{single:'week',plural:'weeks',abbrev:'w'},DAY:{single:'day',plural:'days',abbrev:'d'},HOUR:{single:'hour',plural:'hours',abbrev:'h'},MINUTE:{single:'minute',plural:'minutes',abbrev:'min'},SECOND:{single:'second',plural:'seconds',abbrev:'s'},MILLI:{single:'ms',plural:'ms',abbrev:'ms'}}},'Sch.model.CalendarDay':{startTimeAfterEndTime:'Start time {0} is greater than end time {1}',availabilityIntervalsShouldNotIntersect:'Availability intervals should not intersect: [{0}] and [{1}]',invalidFormat:'Invalid format for availability string: {0}. It should have exact format: hh:mm-hh:mm'},'Sch.panel.SchedulerTree':{'All day':'All day'},'Sch.panel.SchedulerGrid':{'All day':'All day'},'Sch.panel.TimelineGridPanel':{weekStartDay:1,loadingText:'Loading, please wait...',savingText:'Saving changes, please wait...'},'Sch.panel.TimelineTreePanel':{weekStartDay:1,loadingText:'Loading, please wait...',savingText:'Saving changes, please wait...'},'Sch.mixin.SchedulerView':{loadingText:'Loading events...'},'Sch.plugin.CurrentTimeLine':{tooltipText:'Current time'},'Sch.widget.recurrence.ConfirmationDialog':{'delete-title':'You\u2019re deleting an event','delete-all-message':'Do you want to delete all occurrences of this event?','delete-further-message':'Do you want to delete this and all future occurrences of this event, or only the selected occurrence?','delete-all-btn-text':'Delete All','delete-further-btn-text':'Delete All Future Events','delete-only-this-btn-text':'Delete Only This Event','update-title':'You\u2019re changing a repeating event','update-all-message':'Do you want to change all occurrences of this event?','update-further-message':'Do you want to change only this occurrence of the event, or this and all future occurrences?','update-all-btn-text':'All','update-further-btn-text':'All Future Events','update-only-this-btn-text':'Only This Event','Yes':'Yes','Cancel':'Cancel'},'Sch.widget.recurrence.Dialog':{'Repeat event':'Repeat event','Cancel':'Cancel','Save':'Save'},'Sch.widget.recurrence.Form':{'Frequency':'Frequency','Every':'Every','DAILYintervalUnit':'day(s)','WEEKLYintervalUnit':'week(s) on:','MONTHLYintervalUnit':'month(s)','YEARLYintervalUnit':'year(s) in:','Each':'Each','On the':'On the','End repeat':'End repeat','time(s)':'time(s)'},'Sch.widget.recurrence.field.DaysComboBox':{'day':'day','weekday':'weekday','weekend day':'weekend day'},'Sch.widget.recurrence.field.PositionsComboBox':{'position1':'first','position2':'second','position3':'third','position4':'fourth','position5':'fifth','position-1':'last'},'Sch.data.util.recurrence.Legend':{', ':', ',' and ':' and ','Daily':'Daily','Weekly on {1}':'Weekly on {1}','Monthly on {1}':'Monthly on {1}','Yearly on {1} of {2}':'Yearly on {1} of {2}','Every {0} days':'Every {0} days','Every {0} weeks on {1}':'Every {0} weeks on {1}','Every {0} months on {1}':'Every {0} months on {1}','Every {0} years on {1} of {2}':'Every {0} years on {1} of {2}','position1':'the first','position2':'the second','position3':'the third','position4':'the fourth','position5':'the fifth','position-1':'the last','day':'day','weekday':'weekday','weekend day':'weekend day','daysFormat':'{0} {1}'},'Sch.widget.recurrence.field.StopConditionComboBox':{'Never':'Never','After':'After','On date':'On date'},'Sch.widget.recurrence.field.FrequencyComboBox':{'Daily':'Daily','Weekly':'Weekly','Monthly':'Monthly','Yearly':'Yearly'},'Sch.widget.recurrence.field.RecurrenceComboBox':{'None':'None','Custom...':'Custom...'},'Sch.widget.EventEditor':{'Repeat':'Repeat',saveText:'Save',deleteText:'Delete',cancelText:'Cancel',nameText:'Name',allDayText:'All day',startDateText:'Start',endDateText:'End',resourceText:'Resource'},'Sch.plugin.SimpleEditor':{newEventText:'New booking...'},'Sch.widget.ExportDialogForm':{formatFieldLabel:'Paper format',orientationFieldLabel:'Orientation',rangeFieldLabel:'Schedule range',showHeaderLabel:'Show header',showFooterLabel:'Show footer',orientationPortraitText:'Portrait',orientationLandscapeText:'Landscape',completeViewText:'Complete schedule',currentViewText:'Visible schedule',dateRangeText:'Date range',dateRangeFromText:'Export from',dateRangeToText:'Export to',exportersFieldLabel:'Control pagination',adjustCols:'Adjust column width',adjustColsAndRows:'Adjust column width and row height',specifyDateRange:'Specify date range',columnPickerLabel:'Select columns',completeDataText:'Complete schedule (for all events)',dpiFieldLabel:'DPI (dots per inch)',rowsRangeLabel:'Rows range',allRowsLabel:'All rows',visibleRowsLabel:'Visible rows',columnEmptyText:'[no title]'},'Sch.widget.ExportDialog':{title:'Export Settings',exportButtonText:'Export',cancelButtonText:'Cancel',progressBarText:'Exporting...'},'Sch.plugin.Export':{generalError:'An error occurred',fetchingRows:'Fetching row {0} of {1}',builtPage:'Built page {0} of {1}',requestingPrintServer:'Please wait...'},'Sch.plugin.Printable':{dialogTitle:'Print settings',exportButtonText:'Print',disablePopupBlocking:'Please disable pop-up blocker since the print-plugin needs to be able to open new tabs',popupBlockerDetected:'Browser pop-up blocker detected'},'Sch.plugin.exporter.AbstractExporter':{name:'Exporter'},'Sch.plugin.exporter.SinglePage':{name:'Single page'},'Sch.plugin.exporter.MultiPageVertical':{name:'Multiple pages (vertically)'},'Sch.plugin.exporter.MultiPage':{name:'Multiple pages'},'Sch.plugin.Split':{splitText:'Split',mergeText:'Hide split part'},'Sch.plugin.SummaryBar':{totalText:'Total'},'Sch.column.ResourceName':{name:'Name'},'Sch.template.DependencyInfo':{fromText:'From',toText:'To'},'Sch.preset.Manager':{hourAndDay:{displayDateFormat:'G:i',middleDateFormat:'G:i',topDateFormat:'D d/m'},secondAndMinute:{displayDateFormat:'g:i:s',topDateFormat:'D, d g:iA'},dayAndWeek:{displayDateFormat:'m/d h:i A',middleDateFormat:'D d M'},weekAndDay:{displayDateFormat:'m/d',bottomDateFormat:'d M',middleDateFormat:'Y F d'},weekAndMonth:{displayDateFormat:'m/d/Y',middleDateFormat:'m/d',topDateFormat:'m/d/Y'},weekAndDayLetter:{displayDateFormat:'m/d/Y',middleDateFormat:'D d M Y'},weekDateAndMonth:{displayDateFormat:'m/d/Y',middleDateFormat:'d',topDateFormat:'Y F'},monthAndYear:{displayDateFormat:'m/d/Y',middleDateFormat:'M Y',topDateFormat:'Y'},year:{displayDateFormat:'m/d/Y',middleDateFormat:'Y'},manyYears:{displayDateFormat:'m/d/Y',middleDateFormat:'Y'}}}});Ext.define('Sch.mixin.Localizable',{extend:'Ext.Mixin',requires:['Sch.locale.En'],activeLocaleId:'',l10n:null,inTextLocaleRegExp:/L\{([^}]+)\}/g,localizableProperties:null,isLocaleApplied:function(){var a=this.singleton&&this.activeLocaleId||this.self.activeLocaleId;if(!a){return !1}for(var b in Sch.locale.Active){if(a===Sch.locale.Active[b].self.getName()){return !0}}return !1},applyLocale:function(){for(var a in Sch.locale.Active){Sch.locale.Active[a].apply(this.singleton?this:this.self.getName())}},L:function(){return this.localize.apply(this,arguments)},localize:function(b,d,c){var a=this.getLocale(b,d,c);if(a===null||a===undefined){throw 'Cannot find locale: '+b+' ['+this.self.getName()+']'}return a},getLocale:function(a,f,e){if(!this.isLocaleApplied()&&!e){this.applyLocale()}if(this.hasOwnProperty('l10n')&&this.l10n&&this.l10n.hasOwnProperty(a)&&'function'!=typeof this.l10n[a]){return this.l10n[a]}var b=this.self&&this.self.prototype;var c=b.l10n&&b.l10n[a];if(c===null||c===undefined){var d=b&&b.superclass;if(d&&d.localize){c=d.localize(a,f,e)}}return c},localizeText:function(a){var b,c,d=this.inTextLocaleRegExp;while(b=d.exec(a)){if(c=this.getLocale(b[1])){a=a.replace(b[0],c)}}return a},localizeProperties:function(){var b=this,a=b.localizableProperties;if(a){a=a.split(',');for(var c=a.length-1;c>=0;c--){b[a[c]]=b.localizeText(b[a[c]])}}},mixinConfig:{before:{'initComponent':'beforeInitComponent'}},beforeInitComponent:function(){this.localizeProperties()}});Ext.define('Sch.column.ResourceName',{extend:'Ext.grid.Column',alias:'widget.scheduler_resourcenamecolumn',mixins:['Sch.mixin.Localizable'],initComponent:function(){Ext.apply(this,{text:this.L('name')});this.callParent(arguments)},renderer:function(b,c,a){return a.getName()}});Ext.define('Sch.column.Summary',{extend:'Ext.grid.column.Column',alias:['widget.summarycolumn'],lockableScope:'top',showPercent:!1,nbrDecimals:1,sortable:!1,fixed:!0,menuDisabled:!0,width:80,dataIndex:'_sch_not_used',schedulerPanel:null,lockable:!1,init:Ext.emptyFn,constructor:function(a){this.scope=this;this.callParent(arguments);this.on('beforerender',this.onMyBeforeRender,this)},onMyBeforeRender:function(){this.schedulerPanel=this.up('tablepanel[lockable=true]')},getTimeAxis:function(){return this.schedulerPanel.getTimeAxis()},getEventStore:function(){return this.schedulerPanel.getEventStore()},renderer:function(i,h,g){var c=this.getTimeAxis(),e=this.getEventStore(),b=c.getStart(),d=c.getEnd(),a=this.calculate(e.getEventsForResource(g),b,d);if(a<=0){return ''}if(this.showPercent){var f=Sch.util.Date.getDurationInMinutes(b,d);return Math.round(a*100/f)+' %'}else {if(a>1440){return (a/1440).toFixed(this.nbrDecimals)+' '+Sch.util.Date.getShortNameOfUnit('DAY')}if(a>=30){return (a/60).toFixed(this.nbrDecimals)+' '+Sch.util.Date.getShortNameOfUnit('HOUR')}return a+' '+Sch.util.Date.getShortNameOfUnit('MINUTE')}},calculate:function(g,e,f){var d=0,b,c,a=Sch.util.Date;Ext.Array.each(g,function(g){b=g.getStartDate();c=g.getEndDate();if(a.intersectSpans(e,f,b,c)){d+=a.getDurationInMinutes(a.max(b,e),a.min(c,f))}});return d}});Ext.define('Sch.view.HorizontalTimeAxis',{extend:'Ext.util.Observable',requires:['Ext.XTemplate'],statics:{encodeDateFormat:'Ymd_His'},trackHeaderOver:!0,compactCellWidthThreshold:15,baseCls:'sch-column-header',tableCls:'sch-header-row',enableTickResizing:!1,headerHtmlRowTpl:'<table border="0" cellspacing="0" cellpadding="0" style="width: {totalWidth}px; {tstyle}" class="{{tableCls}} sch-header-row-{position} {cls}">'+'<tbody>'+'<tr>'+'<tpl for="cells">'+'<td class="{{baseCls}} {headerCls} sch-header-cell-{align}" data-date="{[fm.date(values.start, Sch.view.HorizontalTimeAxis.encodeDateFormat)]}" style="text-align: {align}; width: {width}px; {style}" tabIndex="0"'+'headerPosition="{parent.position}" headerIndex="{[xindex-1]}">'+'<div class="sch-simple-timeheader">{header}</div>{{resizeHandle}}'+'</td>'+'</tpl>'+'</tr>'+'</tbody>'+'</table>',model:null,hoverCls:'',containerEl:null,height:null,constructor:function(d){var a=this;var c=!!Ext.versions.touch;Ext.apply(this,d);a.callParent(arguments);a.model.on('update',a.onModelUpdate,this,{priority:5});a.containerEl=Ext.get(a.containerEl);if(!(a.headerHtmlRowTpl instanceof Ext.Template)){if(Ext.isString(a.headerHtmlRowTpl)){a.headerHtmlRowTpl=a.headerHtmlRowTpl.replace('{{baseCls}}',this.baseCls).replace('{{tableCls}}',this.tableCls).replace('{{resizeHandle}}',this.enableTickResizing?'<div class="sch-header-cell-resizehandle"></div>':'')}a.headerHtmlRowTpl=new Ext.XTemplate(a.headerHtmlRowTpl)}if(a.trackHeaderOver&&a.hoverCls){a.containerEl.on({mousemove:a.highlightCell,delegate:'.'+this.baseCls,scope:a});a.containerEl.on({mouseleave:a.clearHighlight,scope:a})}var b={scope:this,delegate:'.'+this.baseCls};if(c){b.tap=this.onElClick('tap');b.doubletap=this.onElClick('doubletap')}else {b.click=this.onElClick('click');b.dblclick=this.onElClick('dblclick');b.contextmenu=this.onElClick('contextmenu')}a._listenerCfg=b;if(a.containerEl){a.containerEl.on(b)}},destroy:function(){var a=this;if(a.containerEl){a.containerEl.un(a._listenerCfg);a.containerEl.un({mousemove:a.highlightCell,delegate:'.sch-simple-timeheader',scope:a});a.containerEl.un({mouseleave:a.clearHighlight,scope:a})}a.model.un('update',a.onModelUpdate,this,{priority:5})},onModelUpdate:function(){this.height=null;this.render()},getHTML:function(){var a=this.model.getColumnConfig();var c=this.model.getTotalWidth();var d=Ext.Object.getKeys(a).length;var b='';if(a.top){this.embedCellWidths(a.top);b+=this.headerHtmlRowTpl.apply({totalWidth:c,cells:a.top,position:'top',tstyle:'border-top : 0;'})}if(a.middle){this.embedCellWidths(a.middle);b+=this.headerHtmlRowTpl.apply({totalWidth:c,cells:a.middle,position:'middle',tstyle:a.top?'':'border-top : 0;',cls:!a.bottom&&this.model.getTickWidth()<=this.compactCellWidthThreshold?'sch-header-row-compact':''})}if(a.bottom){this.embedCellWidths(a.bottom);b+=this.headerHtmlRowTpl.apply({totalWidth:c,cells:a.bottom,position:'bottom',cls:this.model.getTickWidth()<=this.compactCellWidthThreshold?'sch-header-row-compact':''})}return b},deleteTimeAxisRows:function(){var a=this.containerEl,b=a.dom;Ext.fly(b).select('table').remove()},render:function(){if(!this.containerEl){return}var e=this.containerEl,a=e.dom,d=a.style.display,c=this.model.getColumnConfig(),b=a.parentNode;a.style.display='none';b.removeChild(a);this.deleteTimeAxisRows();a.insertAdjacentHTML('afterbegin',this.getHTML());if(!c.top&&!c.middle){this.containerEl.addCls('sch-header-single-row')}else {this.containerEl.removeCls('sch-header-single-row')}b&&b.appendChild(a);a.style.display=d;this.fireEvent('refresh',this)},embedCellWidths:function(c,e){for(var b=0;b<c.length;b++){var a=c[b];var d=this.model.getDistanceBetweenDates(a.start,a.end);if(d){a.width=d}else {a.width=0;a.style='display: none'}}},onElClick:function(a){return function(d,b){b=d.delegatedTarget||b;var e=Ext.fly(b).getAttribute('headerPosition'),f=Ext.fly(b).getAttribute('headerIndex'),c=this.model.getColumnConfig()[e][f];this.fireEvent('timeheader'+a,this,c.start,c.end,d)}},highlightCell:function(c,b){var a=this;if(b!==a.highlightedCell){a.clearHighlight();a.highlightedCell=b;Ext.fly(b).addCls(a.hoverCls)}},clearHighlight:function(){var a=this,b=a.highlightedCell;if(b){Ext.fly(b).removeCls(a.hoverCls);delete a.highlightedCell}}});Ext.define('Sch.feature.HeaderResize',{extend:'Ext.AbstractPlugin',selector:null,currentCell:null,originalCellWidth:null,startClientX:null,timeAxisViewModel:null,minCellWidth:15,init:function(a){a.on('render',this.onColumnRender,this)},onColumnRender:function(a){a.getEl().on('mousedown',this.onMouseDown,this,{delegate:this.selector})},getClientX:function(a){return Ext.isNumber(a.clientX)?a.clientX:a.browserEvent.clientX},onMouseDown:function(c,d){var a=this,b=d.parentElement;a.originalCellWidth=Ext.fly(b).getWidth();a.startClientX=a.getClientX(c);a.currentCell=b;a.getCmp().mon(Ext.getBody(),'mousemove',a.onMouseMove,a);a.getCmp().mon(Ext.getBody(),'mouseup',a.onMouseUp,a,{capture:!0,single:!0})},onMouseMove:function(h,i){var a=this,e=a.currentCell,c=e.nextSibling,f=a.startClientX-a.getClientX(h),b=a.originalCellWidth,d=Math.max(a.minCellWidth,b-f);if(c&&d<b){var g=Math.min(b*2-a.minCellWidth,b+f);c.style.width=g+'px'}e.style.width=d+'px'},onMouseUp:function(h,i){var a=this,b=a.getCmp().up('timelinegrid,timelinetree'),g=b.getSchedulingView().getDateFromCoordinate(Ext.fly(a.currentCell).getLeft()),d=Ext.fly(a.currentCell).getX()-b.getSchedulingView().getX(),e=a.getClientX(h)-a.startClientX,f=a.originalCellWidth/a.timeAxisViewModel.getTickWidth(),c=Math.max(a.minCellWidth,a.timeAxisViewModel.getTickWidth()+e/f);a.timeAxisViewModel.setTickWidth(Math.round(c));b.scrollToDate(g,!1,d);a.getCmp().mun(Ext.getBody(),'mousemove',a.onMouseMove,a);this.currentCell=this.offset=null}});Ext.define('Sch.column.timeAxis.Horizontal',{extend:'Ext.grid.column.Column',alias:'widget.timeaxiscolumn',requires:['Sch.view.HorizontalTimeAxis','Sch.feature.HeaderResize'],draggable:!1,groupable:!1,hideable:!1,sortable:!1,resizable:!1,menuDisabled:!0,cls:'sch-simple-timeaxis',tdCls:'sch-timetd',enableLocking:!1,locked:!1,lockable:!1,enableTickResizing:!1,cellFocusable:!1,timeAxisViewModel:null,headerView:null,hoverCls:'',ownHoverCls:'sch-column-header-over',trackHeaderOver:!0,compactCellWidthThreshold:Ext.theme&&Ext.theme.name.toLowerCase()==='classic'?15:35,initComponent:function(){if(this.enableTickResizing){this.addPlugin(new Sch.feature.HeaderResize({selector:'.sch-header-cell-resizehandle',timeAxisViewModel:this.timeAxisViewModel}))}this.callParent(arguments)},afterRender:function(){var a=this;var b=a.titleEl.createChild({cls:'sch-horizontaltimeaxis-ct'});if(!(a.headerView instanceof Sch.view.HorizontalTimeAxis)){a.headerView=Ext.create(Ext.applyIf(a.headerView||{},{xclass:'Sch.view.HorizontalTimeAxis',model:a.timeAxisViewModel,containerEl:b,hoverCls:a.ownHoverCls,trackHeaderOver:a.trackHeaderOver,enableTickResizing:this.enableTickResizing,compactCellWidthThreshold:a.compactCellWidthThreshold}))}a.headerView.on('refresh',a.onTimeAxisViewRefresh,a);a.headerView.render();a.ownerCt.grid.on('afterlayout',function(){if(!a.ownerCt){return}a.mon(a.ownerCt,'resize',a.onHeaderContainerResize,a);if(this.getWidth()>0){if(a.getAvailableWidthForSchedule()!==a.timeAxisViewModel.getAvailableWidth()){a.timeAxisViewModel.update(a.getAvailableWidthForSchedule())}a.setWidth(a.timeAxisViewModel.getTotalWidth())}},null,{single:!0});this.enableBubble('timeheaderclick','timeheaderdblclick','timeheadercontextmenu','horizontaltimeaxiscolumnrender');a.relayEvents(a.headerView,['timeheaderclick','timeheaderdblclick','timeheadercontextmenu']);a.callParent(arguments);a.focusable=!1;this.fireEvent('horizontaltimeaxiscolumnrender',this)},initRenderData:function(){var a=this;a.renderData.headerCls=a.renderData.headerCls||a.headerCls;return a.callParent(arguments)},destroy:function(){if(this.headerView){this.headerView.destroy();this.headerView=null}this.callParent(arguments)},onTimeAxisViewRefresh:function(){var a=this.getRootHeaderCt().grid;if(!a||a.componentLayoutCounter){this.headerView.un('refresh',this.onTimeAxisViewRefresh,this);var b=this.timeAxisViewModel.getTotalWidth();if(this.getWidth()!==b){this.setWidth(b)}else {this.updateLayout()}this.ensureSizing();this.headerView.on('refresh',this.onTimeAxisViewRefresh,this)}},getAvailableWidthForSchedule:function(){if(!this.ownerCt){return 0}var c=this.ownerCt.isVisible(!0)?this.ownerCt.getWidth():this.ownerCt.lastBox&&this.ownerCt.lastBox.width||0,d=this.ownerCt.items,a;for(var b=1;b<d.length;b++){a=d.get(b);if(!a.hidden){c-=a.isVisible(!0)?a.getWidth():a.lastBox&&a.lastBox.width||0}}return Math.max(0,c-Ext.getScrollbarSize().width-1)},onResize:function(){this.callParent(arguments);this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule())},onHeaderContainerResize:function(d,e,b,c,a){this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule());if(b!==a){this.headerView.render()}},ensureSizing:function(){var a=this.headerView.containerEl;var b=this.ownerCt.getHeight();var c=a.getHeight();var d=b-c;if(d>0){var e=a.down('table:last-of-type tr');if(e){a.select('table tr').setHeight(b/this.timeAxisViewModel.getHeaders().length)}}},refresh:function(){if(this.rendered){this.timeAxisViewModel.update(null,!0);this.headerView.render()}}});Ext.define('Sch.column.timeAxis.Vertical',{extend:'Ext.grid.column.Column',alias:'widget.verticaltimeaxis',align:'right',draggable:!1,groupable:!1,hideable:!1,sortable:!1,menuDisabled:!0,timeAxis:null,timeAxisViewModel:null,enableLocking:!1,locked:!0,lockable:!1,dataIndex:'start',initComponent:function(){this.callParent(arguments);this.tdCls=(this.tdCls||'')+' sch-verticaltimeaxis-cell';this.scope=this;this.addCls('sch-verticaltimeaxis-header')},renderer:function(d,c,e,f){var a=this.timeAxisViewModel;if(!a.columnConfig.middle){return}c.style='height:'+(a.getTickWidth()-1)+'px';var b;if(!a.isWeek()&&d&&a.isMajorTick(d)){b=a.headerConfig[a.getMajorHeaderName()];c.tdCls+=' sch-column-line-solid'}else {b=a.getBottomHeader()}if(b.renderer){return b.renderer.call(b.scope||this,e.data.start,e.data.end,c,f)}else {return Ext.Date.format(d,b.dateFormat)}}});Ext.define('Sch.crud.encoder.Json',{format:'json',encode:function(a){return Ext.JSON.encode(a)},decode:function(a){if(typeof a=='object'){return a}return Ext.JSON.decode(a,!0)}});Ext.define('Sch.crud.encoder.Xml',{requires:['Ext.XTemplate'],format:'xml',stringReplaces:[[/&/g,'&amp;'],[/</g,'&lt;'],[/>/g,'&gt;'],[/"/g,'&quot;']],encodeString:function(d){if(!d){return d}var c=d.toString(),b=this.stringReplaces;for(var a=0,e=b.length;a<e;a++){c=c.replace(b[a][0],b[a][1])}return c},encodeRecords:function(b){var c='';for(var a=0,d=b.length;a<d;a++){c+=this.encodeRecord(b[a])}return c},encodeRecord:function(d){var b='<record>';for(var c in d){var a=d[c];b+='<field id="'+this.encodeString(c)+'">'+(a&&a.$store?this.encodeStoreChanges({storeId:c},a):this.encodeString(a))+'</field>'}b+='</record>';return b},encodeStoreChanges:function(c,a){var b='<store id="'+this.encodeString(c.storeId)+'">';if(a.added){b+='<added>'+this.encodeRecords(a.added)+'</added>'}if(a.updated){b+='<updated>'+this.encodeRecords(a.updated)+'</updated>'}if(a.removed){b+='<removed>'+this.encodeRecords(a.removed)+'</removed>'}b+='</store>';return b},encode:function(a){var b,d,e,c;switch(a.type){case 'load':b='<load requestId="'+this.encodeString(a.requestId)+'">';for(d=0,e=a.stores.length;d<e;d++){c=a.stores[d];if(typeof c==='string'){b+='<store id="'+this.encodeString(c)+'"/>'}else {b+='<store id="'+this.encodeString(c.storeId)+'" page="'+this.encodeString(c.page)+'" pageSize="'+this.encodeString(c.pageSize)+'"/>'}};b+='</load>';return b;case 'sync':b='<sync requestId="'+this.encodeString(a.requestId)+'" revision="'+this.encodeString(a.revision)+'">';for(d in a){if(a.hasOwnProperty(d)){c=this.getStore(d);if(c){b+=this.encodeStoreChanges(c,a[d])}}};b+='</sync>';break;}return b},stringToXML:function(b){if(!b){return}var a;if(window.DOMParser){a=(new DOMParser()).parseFromString(b,'text/xml')}else {if(window.ActiveXObject){a=new ActiveXObject('Microsoft.XMLDOM');a.async=!1;a.loadXML(b)}}return a},decodeRecords:function(c){var b=[];for(var a=0,d=c.length;a<d;a++){b.push(this.decodeRecord(c[a]))}return b},decodeRecord:function(g){var d=g.childNodes,e={},b;for(var c=0,h=d.length;c<h;c++){var a=d[c];if(a.nodeName=='field'){b='';if(a.firstChild){var f=this.getElementByTagName(a,'store');b=f?this.decodeStore(f):a.firstChild.nodeValue}e[a.getAttribute('id')]=b}}return e},getElementsByTagName:function(e,d){var b=e.childNodes,c=[];for(var a=0,f=b.length;a<f;a++){if(b[a].nodeName==d){c.push(b[a])}}return c},getElementByTagName:function(d,c){var b=d.childNodes;for(var a=0,e=b.length;a<e;a++){if(b[a].nodeName==c){return b[a]}}},decodeStore:function(e){var a={},c=this.getElementsByTagName(e,'rows');if(c.length){a.rows=this.decodeRecords(this.getElementsByTagName(c[0],'record'));var b=parseInt(c[0].getAttribute('total'),10);if(isNaN(b)||b<a.rows.length){b=a.rows.length}a.total=b}var d=this.getElementByTagName(e,'removed');if(d){a.removed=this.decodeRecords(this.getElementsByTagName(d,'record'))}return a},decode:function(e){var i=typeof e=='string'?this.stringToXML(e):e;if(!i){return}var a={},b=i.documentElement,h=b.getElementsByTagName('store'),f,d;a.requestId=b.getAttribute('requestId');a.revision=b.getAttribute('revision');a.success=b.getAttribute('success')||'false';a.success=a.success.toLowerCase()=='true';if(!a.success){a.code=b.getAttribute('code');var c=b.getElementsByTagName('message')[0];a.message=c&&c.firstChild&&c.firstChild.nodeValue}for(var g=0,j=h.length;g<j;g++){f=h[g];d=f.getAttribute('id');if(this.getStore(d)){a[d]=this.decodeStore(f)}}return a}});Ext.define('Sch.crud.transport.Ajax',{defaultMethod:{load:'GET',sync:'POST'},cancelRequest:function(a){Ext.Ajax.abort(a)},sendRequest:function(a){var d=a.data,c=this.transport[a.type],e=c.paramName,f=Ext.apply({},c&&c.params),g=c.method||this.defaultMethod[a.type];var b=Ext.apply({url:c.url,method:g,params:f,failure:a.failure,success:function(b,c){if(a.success){a.success.call(a.scope||this,b.responseXml||b.responseText)}},scope:a.scope},c.requestConfig);if(!e){if(this.format==='xml'){Ext.apply(b,{xmlData:d})}else {Ext.apply(b,{jsonData:d})}}else {b.params=b.params||{};b.params[e]=d}this.fireEvent('beforesend',this,f,a.type,b);return Ext.Ajax.request(b)}});Ext.define('Sch.util.Patch',{uses:['Ext.util.Cookies','Ext.data.Connection','Ext.Component'],target:null,minVersion:null,maxVersion:null,reportUrl:null,obsoleteTestName:null,description:null,applyFn:null,ieOnly:!1,macOnly:!1,overrides:null,onClassExtended:function(b,a){if(Sch.disableOverrides){return}if(a.ieOnly&&!Ext.isIE){return}if(a.macOnly&&!Ext.isMac){return}if((!a.minVersion||Ext.versions.extjs.equals(a.minVersion)||Ext.versions.extjs.isGreaterThan(a.minVersion))&&(!a.maxVersion||Ext.versions.extjs.equals(a.maxVersion)||Ext.versions.extjs.isLessThan(a.maxVersion))){Ext.require(a.target,function(){if(a.applyFn){a.applyFn()}else {if(a.overrides){Ext.ClassManager.get(a.target).override(a.overrides)}}})}}});Ext.define('Sch.patches.CollectionKey',{extend:'Sch.util.Patch',target:'Ext.util.CollectionKey',minVersion:'6.0.0',reportUrl:'https://www.sencha.com/forum/showthread.php?310532-Ext.util.Collection-key-configuration-application-and-cloning-is-broken',obsoleteTestName:'patches/001_collection_key.t.js',description:["Ext.util.CollectionKey::clone() is broken due to wrong usage of Ext's configuration facility.",'We relay on the (though) private Ext.data.LocalStore::extraKeys configuration, we use it to define additional','unique but complex keys for Assignment and Dependency stores. Upon store filtering such keys are being cloned',"but due to the broken config key's clone() method throws an exception"].join(' '),applyFn:function(){var a;a=Ext.util.CollectionKey.prototype.applyKeyFn;Ext.util.CollectionKey.prototype.applyKeyFn=Ext.identityFn;Ext.util.CollectionKey.prototype.updateKeyFn=a}});Ext.define('Sch.util.Cache',{cache:null,constructor:function(){var a=this;a.cache={}},key:function(a){var b;if(a&&a.isModel){b=a.getId().toString()}else {if(a===undefined||a===null){b='[ undefined / null ]'}else {b=a.toString()}}return b},has:function(a){var b=this;a=b.key(a);return b.cache.hasOwnProperty(a)},get:function(b,d){var c=this,a;b=c.key(b);a=c.cache.hasOwnProperty(b)&&c.cache[b];if(!a&&d){a=d()}else {if(!a){a=[]}}c.cache[b]=a;return a},add:function(c,d){var a=this,b=a.key(c);if(!a.cache.hasOwnProperty(b)){a.cache[b]=a.get(c)}arguments.length>1&&Ext.Array.include(a.cache[b],d);return a},set:function(d,c){var a=this,b=a.key(d);a.cache[b]=c;return a},remove:function(b,c){var a=this;b=a.key(b);if(a.cache.hasOwnProperty(b)){Ext.Array.remove(a.cache[b],c)}return a},move:function(b,c,d){var a=this;b=a.key(b);c=a.key(c);if(b!=c&&arguments.length>=3){a.remove(b,d);a.add(c,d)}else {if(b!=c&&a.cache.hasOwnProperty(b)&&a.cache.hasOwnProperty(c)){a.cache[c]=Ext.Array.union(a.cache[c],a.cache[b]);a.cache[b]=[]}else {if(b!=c&&a.cache.hasOwnProperty(b)){a.cache[c]=a.cache[b];a.cache[b]=[]}}}return a},clear:function(b){var a=this;if(!arguments.length){a.cache={}}else {b=a.key(b);if(a.cache.hasOwnProperty(b)){delete a.cache[b]}}return a},uncache:function(c){var a=this,b;for(b in a.cache){if(a.cache.hasOwnProperty(b)){a.cache[b]=Ext.Array.remove(a.cache[b],c)}}return a},inheritableStatics:{}});Ext.define('Sch.data.util.EventAssignmentsCache',{extend:'Sch.util.Cache',requires:['Ext.data.Model'],assignmentStore:null,assignmentStoreDetacher:null,assignmentStoreFiltersDetacher:null,eventStoreDetacher:null,constructor:function(b){var a=this,c=b.getEventStore();a.callParent();function onAssignmentAdd(c,b){Ext.Array.each(b,function(b){a.add(b.getEventId(),b)})}function onAssignmentRemove(c,b){Ext.Array.each(b,function(b){a.remove(b.getEventId(),b)})}function onAssignmentUpdate(g,b,f){var d=b.eventIdField,c=b.previous&&d in b.previous,e=c&&b.previous[d];if(c){a.move(e,b.getEventId(),b)}}function onAssignmentStoreClearOrReset(b){a.clear()}function onAssignmentStoreEventStoreChange(c,b){a.clear();attachToEventStore(b)}function onEventIdChanged(d,e,c,b){a.move(c,b)}function onEventRemove(c,b){Ext.Array.each(b,function(b){a.clear(b)})}function onEventStoreClearOrReset(){a.clear()}function attachToEventStore(b){Ext.destroy(a.eventStoreDetacher);a.eventStoreDetacher=b&&b.on({idchanged:onEventIdChanged,remove:onEventRemove,cacheresethint:onEventStoreClearOrReset,clear:onEventStoreClearOrReset,rootchange:onEventStoreClearOrReset,priority:100,destroyable:!0})}a.assignmentStoreDetacher=b.on({add:onAssignmentAdd,remove:onAssignmentRemove,update:onAssignmentUpdate,cacheresethint:onAssignmentStoreClearOrReset,clear:onAssignmentStoreClearOrReset,eventstorechange:onAssignmentStoreEventStoreChange,priority:100,destroyable:!0});a.assignmentStoreFiltersDetacher=b.getFilters().on({endupdate:onAssignmentStoreClearOrReset,priority:1002,destroyable:!0});attachToEventStore(c);a.assignmentStore=b},destroy:function(){var a=this;Ext.destroyMembers(a,'assignmentStoreDetacher','assignmentStoreFiltersDetacher','eventStoreDetacher');a.assignmentStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.assignmentStore.getRange(),function(b){return b.getEventId()==a})};return c.callParent([a,b])}});Ext.define('Sch.data.util.ResourceAssignmentsCache',{extend:'Sch.util.Cache',requires:['Ext.data.Model'],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(b){var a=this,c=b.getEventStore(),d=c&&c.getResourceStore();a.callParent();function onAssignmentAdd(c,b){Ext.Array.each(b,function(b){a.add(b.getResourceId(),b)})}function onAssignmentRemove(c,b){Ext.Array.each(b,function(b){a.remove(b.getResourceId(),b)})}function onAssignmentUpdate(g,b,f){var d=b.resourceIdField,c=b.previous&&d in b.previous,e=c&&b.previous[d];if(c){a.move(e,b.getResourceId(),b)}}function onAssignmentStoreClearOrReset(b){a.clear()}function onAssignmentStoreEventStoreChange(b,a){attachToEventStore(a);attachToResourceStore(a&&a.getResourceStore())}function onEventStoreResourceStoreChange(c,b){a.clear();attachToResourceStore(b)}function onResourceIdChanged(d,e,c,b){a.move(c,b)}function onResourceRemove(c,b){Ext.Array.each(b,function(b){a.clear(b)})}function onResourceStoreClearOrReset(){a.clear()}function attachToEventStore(b){Ext.destroy(a.eventStoreDetacher);a.eventStoreDetacher=b&&b.on({resourcestorechange:onEventStoreResourceStoreChange,priority:100,destroyable:!0})}function attachToResourceStore(b){Ext.destroy(a.resourceStoreDetacher);a.resourceStoreDetacher=b&&b.on({idchanged:onResourceIdChanged,remove:onResourceRemove,clear:onResourceStoreClearOrReset,cacheresethint:onResourceStoreClearOrReset,rootchange:onResourceStoreClearOrReset,priority:100,destroyable:!0})}a.assignmentStoreDetacher=b.on({add:onAssignmentAdd,remove:onAssignmentRemove,update:onAssignmentUpdate,clear:onAssignmentStoreClearOrReset,cacheresethint:onAssignmentStoreClearOrReset,eventstorechange:onAssignmentStoreEventStoreChange,priority:100,destroyable:!0});a.assignmentStoreFiltersDetacher=b.getFilters().on('endupdate',onAssignmentStoreClearOrReset,a,{priority:1002,destroyable:!0});attachToEventStore(c);attachToResourceStore(d);a.assignmentStore=b},destroy:function(){var a=this;Ext.destroyMembers(a,'assignmentStoreDetacher','assignmentStoreFiltersDetacher','eventStoreDetacher','resourceStoreDetacher');a.assignmentStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.assignmentStore.getRange(),function(b){return b.getResourceId()==a})};return c.callParent([a,b])}});Ext.define('Sch.data.mixin.UniversalModelGetter',{onClassMixedIn:function(a){var b={};if(a.prototype.isTreeStore){b.getModelById=a.prototype.getNodeById}else {b.getModelById=a.prototype.getById}if(a.prototype.isTreeStore){b.getModelByInternalId=function(a){return this.byInternalIdMap[a]||null}}else {b.getModelByInternalId=a.prototype.getByInternalId}Ext.override(a,b)}});Ext.define('Sch.data.mixin.CacheHintHelper',{extend:'Ext.Mixin',mixinConfig:{before:{loadRecords:'loadRecords',removeAll:'removeAll'}},loadRecords:function(){this.fireEvent('cacheresethint',this)},removeAll:function(a){if(a){this.fireEvent('cacheresethint',this)}}});Ext.define('Sch.util.Date',{requires:'Ext.Date',mixins:['Sch.mixin.Localizable'],singleton:!0,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},MIN_VALUE:new Date(-8.64E15),MAX_VALUE:new Date(8.64E15),constructor:function(){var a=this,b=Ext.Date;var c=a.unitHash={MILLI:b.MILLI,SECOND:b.SECOND,MINUTE:b.MINUTE,HOUR:b.HOUR,DAY:b.DAY,WEEK:'w',MONTH:b.MONTH,QUARTER:'q',YEAR:b.YEAR};Ext.apply(a,c);a.units=[a.MILLI,a.SECOND,a.MINUTE,a.HOUR,a.DAY,a.WEEK,a.MONTH,a.QUARTER,a.YEAR]},onLocalized:function(){this.setUnitNames(this.L('unitNames'))},setUnitNames:function(e){var d=this.unitsByName={};this.l10n.unitNames=e;this._unitNames=Ext.apply({},e);var c=this.unitHash;for(var b in c){if(c.hasOwnProperty(b)){var a=c[b];this._unitNames[a]=this._unitNames[b];d[b]=a;d[a]=a}}},betweenLesser:function(a,b,c){return b<=a&&a<c},betweenLesserEqual:function(a,b,c){return b<=a&&a<=c},constrain:function(a,c,b){return this.min(this.max(a,c),b)},compareUnits:function(c,d){var a=Ext.Array.indexOf(this.units,c),b=Ext.Array.indexOf(this.units,d);return a>b?1:a<b?-1:0},isUnitGreater:function(a,b){return this.compareUnits(a,b)>0},copyTimeValues:function(a,b){a.setHours(b.getHours());a.setMinutes(b.getMinutes());a.setSeconds(b.getSeconds());a.setMilliseconds(b.getMilliseconds());return a},add:function(b,e,c){var a=Ext.Date.clone(b);if(!e||c===0){return a}switch(e.toLowerCase()){case this.MILLI:a=new Date(b.getTime()+c);break;case this.SECOND:a=new Date(b.getTime()+c*1000);break;case this.MINUTE:a=new Date(b.getTime()+c*60000);break;case this.HOUR:a=new Date(b.getTime()+c*3600000);break;case this.DAY:a.setDate(b.getDate()+c);if(a.getHours()===23&&b.getHours()===0){a=Ext.Date.add(a,Ext.Date.HOUR,1)};break;case this.WEEK:a.setDate(b.getDate()+c*7);break;case this.MONTH:var d=b.getDate();if(d>28){d=Math.min(d,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(b),this.MONTH,c)).getDate())};a.setDate(d);a.setMonth(a.getMonth()+c);break;case this.QUARTER:a=this.add(b,this.MONTH,c*3);break;case this.YEAR:a.setFullYear(b.getFullYear()+c);break;}return a},getUnitDurationInMs:function(a){return this.add(new Date(1,0,1),a,1)-new Date(1,0,1)},getMeasuringUnit:function(a){if(a===this.WEEK){return this.DAY}return a},getDurationInUnit:function(b,c,e,d){var a;switch(e){case this.YEAR:a=this.getDurationInYears(b,c);break;case this.QUARTER:a=this.getDurationInMonths(b,c)/3;break;case this.MONTH:a=this.getDurationInMonths(b,c);break;case this.WEEK:a=this.getDurationInDays(b,c)/7;break;case this.DAY:a=this.getDurationInDays(b,c);break;case this.HOUR:a=this.getDurationInHours(b,c);break;case this.MINUTE:a=this.getDurationInMinutes(b,c);break;case this.SECOND:a=this.getDurationInSeconds(b,c);break;case this.MILLI:a=this.getDurationInMilliseconds(b,c);break;}return d?a:Math.round(a)},getUnitToBaseUnitRatio:function(b,a){if(b===a){return 1}switch(b){case this.YEAR:switch(a){case this.QUARTER:return 1/4;case this.MONTH:return 1/12;};break;case this.QUARTER:switch(a){case this.YEAR:return 4;case this.MONTH:return 1/3;};break;case this.MONTH:switch(a){case this.YEAR:return 12;case this.QUARTER:return 3;};break;case this.WEEK:switch(a){case this.DAY:return 1/7;case this.HOUR:return 1/168;};break;case this.DAY:switch(a){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440;};break;case this.HOUR:switch(a){case this.DAY:return 24;case this.MINUTE:return 1/60;};break;case this.MINUTE:switch(a){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/60000;};break;case this.SECOND:switch(a){case this.MILLI:return 1/1000;};break;case this.MILLI:switch(a){case this.SECOND:return 1000;};break;}return -1},isUnitDivisibleIntoSubunit:function(c,b){var a=c===this.MONTH&&b===this.WEEK;return !a},getDurationInMilliseconds:function(a,b){return b-a},getDurationInSeconds:function(a,b){return (b-a)/1000},getDurationInMinutes:function(a,b){return (b-a)/60000},getDurationInHours:function(a,b){return (b-a)/3600000},getDurationInDays:function(a,b){var c=a.getTimezoneOffset()-b.getTimezoneOffset();return (b-a+c*60*1000)/86400000},getDurationInMonths:function(a,b){return (b.getFullYear()-a.getFullYear())*12+(b.getMonth()-a.getMonth())},getDurationInYears:function(a,b){return this.getDurationInMonths(a,b)/12},min:function(a,b){return (a&&a.valueOf()||a)<(b&&b.valueOf()||b)?a:b},max:function(a,b){return (a&&a.valueOf()||a)>(b&&b.valueOf()||b)?a:b},intersectSpans:function(a,c,b,d){return this.betweenLesser(a,b,d)||this.betweenLesser(b,a,c)},getNameOfUnit:function(a){a=this.getUnitByName(a);switch(a.toLowerCase()){case this.YEAR:return 'YEAR';case this.QUARTER:return 'QUARTER';case this.MONTH:return 'MONTH';case this.WEEK:return 'WEEK';case this.DAY:return 'DAY';case this.HOUR:return 'HOUR';case this.MINUTE:return 'MINUTE';case this.SECOND:return 'SECOND';case this.MILLI:return 'MILLI';}throw 'Incorrect UnitName'},getReadableNameOfUnit:function(b,a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[b][a?'plural':'single']},getShortNameOfUnit:function(a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[a].abbrev},getUnitByName:function(a){if(!this.isLocaleApplied()){this.applyLocale()}if(!this.unitsByName[a]){Ext.Error.raise('Unknown unit name: '+a)}return this.unitsByName[a]},getNext:function(h,c,b,d,g){var a=Ext.Date.clone(h);var j=g!=null;var e=g===0;var i=this.compareUnits(this.DAY,c)<=0||c===this.HOUR&&g%60!==0;if(j&&!e&&i){a=Sch.util.Date.toTimeZone(a,g)}d=arguments.length<4?1:d;b=b==null?1:b;switch(c){case this.MILLI:a=this.add(a,c,b);break;case this.SECOND:a=this.add(a,c,b);if(a.getMilliseconds()>0){a.setMilliseconds(0)};break;case this.MINUTE:a=this.add(a,c,b);if(a.getSeconds()>0){a.setSeconds(0)};if(a.getMilliseconds()>0){a.setMilliseconds(0)};break;case this.HOUR:if(e){a=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours()+b))}else {a=this.add(a,c,b);if(a.getMinutes()>0){a.setMinutes(0)}if(a.getSeconds()>0){a.setSeconds(0)}if(a.getMilliseconds()>0){a.setMilliseconds(0)}};break;case this.DAY:if(e){a=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()+b))}else {var l=a.getHours()===23&&this.add(a,this.HOUR,1).getHours()===1;if(l){a=this.add(a,this.DAY,2);this.clearTime(a);return a}this.clearTime(a);a=this.add(a,this.DAY,b);if(a.getHours()===1){this.clearTime(a)}};break;case this.WEEK:var f;if(e){f=a.getUTCDay();var m=d-f+7*(b-(d<=f?0:1));a.setUTCDate(a.getUTCDate()+m);a=this.clearUTCTime(a)}else {this.clearTime(a);f=a.getDay();a=this.add(a,this.DAY,d-f+7*(b-(d<=f?0:1)));if(a.getDay()!==d){a=this.add(a,this.HOUR,1)}else {this.clearTime(a)}};break;case this.MONTH:if(e){a=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth()+b,1))}else {a=this.add(a,this.MONTH,b);a.setDate(1);this.clearTime(a)};break;case this.QUARTER:if(e){var n=(b-1)*3+(3-a.getUTCMonth()%3);a=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth()+n,1))}else {a=this.add(a,this.MONTH,(b-1)*3+(3-a.getMonth()%3));this.clearTime(a);a.setDate(1)};break;case this.YEAR:if(e){a=new Date(Date.UTC(a.getUTCFullYear()+b,0,1))}else {a=new Date(a.getFullYear()+b,0,1)};break;default:throw new Error('Invalid date unit'+c);}if(j&&!e&&i){if(Sch.util.Date.compareUnits(Sch.util.Date.WEEK,c)>0){var k=a.getTimezoneOffset()-h.getTimezoneOffset();if(k!==0){a=Sch.util.Date.add(a,this.MINUTE,k)}}a=Sch.util.Date.fromTimeZone(a,g);if(a-h===0){a=this.getNext(h,c,b,d)}}return a},getNumberOfMsFromTheStartOfDay:function(a){return a-this.clearTime(a,!0)||86400000},getNumberOfMsTillTheEndOfDay:function(a){return this.getStartOfNextDay(a,!0)-a},getStartOfNextDay:function(a,c,d){var b=this.add(d?a:this.clearTime(a,c),this.DAY,1);if(b.getDate()==a.getDate()){var e=this.add(this.clearTime(a,c),this.DAY,2).getTimezoneOffset();var f=a.getTimezoneOffset();b=this.add(b,this.MINUTE,f-e)}return b},getEndOfPreviousDay:function(b,c){var a=c?b:this.clearTime(b,!0);if(a-b){return a}else {return this.add(a,this.DAY,-1)}},timeSpanContains:function(c,d,a,b){return a-c>=0&&d-b>=0},compareWithPrecision:function(a,b,d){var c=Sch.util.Date,e=Ext.Date,f;switch(d){case c.DAY:a=Number(e.format(a,'Ymd'));b=Number(e.format(b,'Ymd'));break;case c.WEEK:a=Number(e.format(a,'YmW'));b=Number(e.format(b,'YmW'));break;case c.MONTH:a=Number(e.format(a,'Ym'));b=Number(e.format(b,'Ym'));break;case c.QUARTER:a=a.getFullYear()*4+Math.floor(a.getMonth()/3);b=b.getFullYear()*4+Math.floor(b.getMonth()/3);break;case c.YEAR:a=a.getFullYear();b=b.getFullYear();break;default:case c.MILLI:case c.SECOND:case c.MINUTE:case c.HOUR:d=d&&this.getUnitDurationInMs(d)||1;a=Math.floor(a.valueOf()/d);b=Math.floor(b.valueOf()/d);break;}a<b&&(f=-1)||a>b&&(f=+1)||(f=0);return f},getValueInUnits:function(a,b){switch(b){case this.YEAR:return a.getFullYear();case this.QUARTER:return Math.floor(a.getMonth()/3)+1;case this.MONTH:return a.getMonth();case this.WEEK:return Ext.Date.getWeekOfYear(a);case this.DAY:return a.getDate();case this.HOUR:return a.getHours();case this.MINUTE:return a.getMinutes();case this.SECOND:return a.getSeconds();}},setValueInUnits:function(d,e,c){var b=Ext.Date.clone(d),a;switch(e){case this.YEAR:a='setFullYear';break;case this.MONTH:a='setMonth';break;case this.DAY:a='setDate';break;case this.HOUR:a='setHours';break;case this.MINUTE:a='setMinutes';break;case this.SECOND:a='setSeconds';break;case this.MILLI:a='setMilliseconds';break;}b[a](c);return b},getSubUnit:function(a){switch(a){case this.YEAR:return this.MONTH;case this.MONTH:return this.DAY;case this.DAY:return this.HOUR;case this.HOUR:return this.MINUTE;case this.MINUTE:return this.SECOND;case this.SECOND:return this.MILLI;}},setValueInSubUnits:function(c,a,b){a=this.getSubUnit(a);return this.setValueInUnits(c,a,b)},mergeDates:function(d,b,c){var a=Ext.Date.clone(d);switch(c){case this.YEAR:a.setFullYear(b.getFullYear());case this.MONTH:a.setMonth(b.getMonth());case this.WEEK:case this.DAY:if(c===this.WEEK){a=this.add(a,this.DAY,b.getDay()-a.getDay())}else {a.setDate(b.getDate())};case this.HOUR:a.setHours(b.getHours());case this.MINUTE:a.setMinutes(b.getMinutes());case this.SECOND:a.setSeconds(b.getSeconds());case this.MILLI:a.setMilliseconds(b.getMilliseconds());}return a},splitToSubUnits:function(c,d,a,b){a=a||1;b=arguments.length<4?1:b;switch(d){case this.MONTH:return this.splitMonth(c,a,b);case this.WEEK:case this.DAY:return this.splitDay(c,a);default:break;}},splitYear:function(e,d){var b=this.clearTime(e,!0);b.setMonth(0);b.setDate(1);var c=[];for(var a=0;a<=12;a=a+d){c.push(this.add(b,this.MONTH,a))}return c},splitMonth:function(h,f,e){var a=this.clearTime(h,!0);a.setDate(1);a=this.add(a,this.DAY,e-a.getDay());var b=Ext.Date.clone(a);var g=this.add(a,this.MONTH,1);var d=[];for(var c=0;b.getTime()<g.getTime();c=c+f){b=this.add(a,this.WEEK,c);d.push(b)}return d},splitWeek:function(d,f,e){var b=this.add(d,this.DAY,e-d.getDay());b=this.clearTime(b);var c=[];for(var a=0;a<=7;a=a+f){c.push(this.add(b,this.DAY,a))}return c},splitDay:function(d,c){var e=this.clearTime(d,!0);var b=[];for(var a=0;a<=24;a=a+c){b.push(this.add(e,this.HOUR,a))}return b},splitHour:function(e,d){var a=new Date(e.getTime());a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);var c=[];for(var b=0;b<=60;b=b+d){c.push(this.add(a,this.MINUTE,b))}return c},splitMinute:function(e,d){var b=Ext.Date.clone(e);b.setSeconds(0);b.setMilliseconds(0);var c=[];for(var a=0;a<=60;a=a+d){c.push(this.add(b,this.SECOND,a))}return c},clearTime:function(a,b){if(a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0){return Ext.Date.clearTime(a,b)}return b?Ext.Date.clone(a):a},clearUTCTime:function(a){a=new Date(a);a.setUTCHours(0,0,0,0);return a},getWeekNumber:function(b){var a=new Date(b.valueOf());var d=(b.getDay()+6)%7;a.setDate(a.getDate()-d+3);var c=a.valueOf();a.setMonth(0,1);if(a.getDay()!=4){a.setMonth(0,1+(4-a.getDay()+7)%7)}return 1+Math.ceil((c-a)/604800000)},getWeekStartDate:function(c,a){var b=this.setDateToMidday(c,!0);a=typeof a!=='number'?1:a;while(b.getDay()!==a){b=Sch.util.Date.add(b,Sch.util.Date.DAY,-1)}return b},getWeekEndDate:function(c,a){var b=this.setDateToMidday(c,!0);a=typeof a!=='number'?0:a;while(b.getDay()!==a){b=Sch.util.Date.add(b,Sch.util.Date.DAY,1)}return b},setDateToHours:function(a,c,b){if(c){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),b)}a.setHours(b);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);return a},setDateToMidnight:function(b,a){return this.setDateToHours(b,a,0)},setDateToMidday:function(b,a){return this.setDateToHours(b,a,12)},isLaterDate:function(b,a){return !this.isSameDate(b,a)&&b>a},isSameDate:function(b,a){return b.getFullYear()===a.getFullYear()&&b.getMonth()===a.getMonth()&&b.getDate()===a.getDate()},isEarlierDate:function(b,a){return !this.isSameDate(b,a)&&b<a},toTimeZone:function(a,c){var d=a.getTimezoneOffset()+c;var b=this.add(a,this.MINUTE,d);return this.add(b,this.MINUTE,b.getTimezoneOffset()-a.getTimezoneOffset())},fromTimeZone:function(a,b){var c=-a.getTimezoneOffset()-b;return this.add(a,this.MINUTE,c)},getUTCTime:function(a){return new Date(2020,6,1,a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())},getUTCDate:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())},format:function(e,a,f){if(f===0){a=a.replace('a','%10');a=a.replace('A','%11');a=a.replace('g','%12');a=a.replace('G','%13');a=a.replace('h','%14');a=a.replace('H','%15');a=a.replace('O','%16');a=a.replace('P','%17');a=a.replace('Z','%18');a=a.replace('c','%19');a=a.replace('d','%20');a=a.replace('D','%21');a=a.replace('j','%22');a=a.replace('l','%23');a=a.replace('N','%24');a=a.replace('w','%25');a=a.replace('z','%26');a=a.replace('F','%27');a=a.replace('m','%28');a=a.replace('M','%29');a=a.replace('n','%30');a=a.replace('Y','%31');a=a.replace('y','%32');var b=Ext.Date.format(e,a);var d=this.getUTCTime(e);var c=this.getUTCDate(e);b=b.replace('%10',Ext.Date.format(d,'a'));b=b.replace('%11',Ext.Date.format(d,'A'));b=b.replace('%12',Ext.Date.format(d,'g'));b=b.replace('%13',Ext.Date.format(d,'G'));b=b.replace('%14',Ext.Date.format(d,'h'));b=b.replace('%15',Ext.Date.format(d,'H'));b=b.replace('%16','+0000');b=b.replace('%17','+00:00');b=b.replace('%18','0');b=b.replace('%19',Ext.Date.format(c,'Y-m-d')+'T'+Ext.Date.format(d,'H:i:s+00:00'));b=b.replace('%20',Ext.Date.format(c,'d'));b=b.replace('%21',Ext.Date.format(c,'D'));b=b.replace('%22',Ext.Date.format(c,'j'));b=b.replace('%23',Ext.Date.format(c,'l'));b=b.replace('%24',Ext.Date.format(c,'N'));b=b.replace('%25',Ext.Date.format(c,'w'));b=b.replace('%26',Ext.Date.format(c,'z'));b=b.replace('%27',Ext.Date.format(c,'F'));b=b.replace('%28',Ext.Date.format(c,'m'));b=b.replace('%29',Ext.Date.format(c,'M'));b=b.replace('%30',Ext.Date.format(c,'n'));b=b.replace('%31',Ext.Date.format(c,'Y'));b=b.replace('%32',Ext.Date.format(c,'y'));return b}else {e=this.toTimeZone(e,f);return Ext.Date.format(e,a)}}});Ext.define('Sch.model.Customizable',function(a){return {extend:'Ext.data.Model',requires:['Sch.util.Date'],mixins:{robo:'Robo.data.Model'},isCustomizableModel:!0,customizableFields:null,previous:null,__editing:null,__editCounter:0,constructor:function(){var a=this.callParent(arguments);return a},storePreviousFlex:Ext.Function.flexSetter(function(d,c){var b=this,a=b.get(d);if(a instanceof Date&&!(c instanceof Date)){c=b.getField(d).convert(c,b)}if(a instanceof Date&&a-c||!(a instanceof Date)&&a!==c){if(b.processFieldPreviousValue){a=b.processFieldPreviousValue(d,a)}b.previous[d]=a}}),deletePreviousFlex:Ext.Function.flexSetter(function(a,b){delete this.previous[a]}),set:function(c,e){var a=this,b=!1,d=null;if(!a.previous){b=!0;a.previous={}}a.storePreviousFlex(c,e);d=a.callParent(arguments);if(!a.__editing){if(b){delete a.previous}else {a.deletePreviousFlex(c,e)}}return d},reject:function(){var a=this,c=a.modified||{},b;a.__editing=!0;a.previous=a.previous||{};for(b in c){if(c.hasOwnProperty(b)){if(typeof c[b]!='function'){a.previous[b]=a.get(b)}}}a.callParent(arguments);delete a.previous;a.__editing=!1},beginEdit:function(){this.__editCounter++;this.__editing=!0;this.callParent(arguments)},cancelEdit:function(){this.__editCounter=0;this.__editing=!1;this.callParent(arguments);delete this.previous},endEdit:function(b,a){if(--this.__editCounter===0){if(!b&&this.getModifiedFieldNames){var c=this.editMemento;if(!a){a=this.getModifiedFieldNames(c.data)}if(a&&a.length===0){b=!0}}this.callParent([b].concat(Array.prototype.slice.call(arguments,1)));this.__editing=!1;delete this.previous}}}},function(a){a.$onExtended.unshift({fn:function(b,a){if(a){if(Ext.isArray(a)){b.fieldsInitialValue=a.slice()}else {if(a.fields){if(!Ext.isArray(a.fields)){b.fieldsInitialValue=[a.fields]}else {b.fieldsInitialValue=a.fields.slice()}}}}}});a.onExtended(function(a,e,d){var b=Ext.ClassManager,c=b.triggerCreated;b.triggerCreated=function(i){var d=a.prototype;if(d.customizableFields){d.allCustomizableFields=(a.superclass.allCustomizableFields||[]).concat(d.customizableFields)}else {d.allCustomizableFields=a.superclass.allCustomizableFields||[]}var f={};Ext.Array.each(d.allCustomizableFields,function(a){if(typeof a=='string'){a={name:a}}f[a.name]=a});var h=d.fields;var g=[];var e=[];Ext.Array.each(h,function(a){if(a.isCustomizableField){e.push(a.getName())}});if(d.idProperty!=='id'&&d.getField('id')){if(!d.getField('id').hasOwnProperty('name')){e.push('id')}}if(d.idProperty!=='Id'&&d.getField('Id')){if(!d.getField('Id').hasOwnProperty('name')){e.push('Id')}}a.removeFields(e);function applyFieldConfig(e,a,d){if(!a){return}if(!Ext.isArray(a)){a=[a]}var c;for(var b=a.length-1;b>=0;b--){if(a[b].name==d){c=a[b];break}}Ext.applyIf(e,c)}function getFieldConfig(c){var d=a,b=d.prototype,f=c==='Id'?'idProperty':c.charAt(0).toLowerCase()+c.substr(1)+'Field',e={name:b[f]||c,isCustomizableField:!0},g;while(b&&b.isCustomizableModel){g=b[f]||c;b.hasOwnProperty('customizableFields')&&applyFieldConfig(e,b.customizableFields,c);applyFieldConfig(e,d.fieldsInitialValue,g);b=d.superclass;d=b&&b.self}return e}e=[];Ext.Object.each(f,function(l,j){var b=j.name||j.getName();var i=b==='Id'?'idProperty':b.charAt(0).toLowerCase()+b.substr(1)+'Field';var a=d[i]||b;d.getField(a)&&e.push(a);var k=getFieldConfig(b);g.push(Ext.create('data.field.'+(k.type||'auto'),k));var h=Ext.String.capitalize(b);if(h!='Id'){var c='get'+h;var f='set'+h;if(!d[c]||d[c].__getterFor__&&d[c].__getterFor__!=a){d[c]=function(){return this.get(this[i]||a)};d[c].__getterFor__=a}if(!d[f]||d[f].__setterFor__&&d[f].__setterFor__!=a){d[f]=function(b){return this.set(this[i]||a,b)};d[f].__setterFor__=a}}});a.replaceFields(g,e);c.apply(this,arguments);b.triggerCreated=c}})});Ext.define('Sch.model.Assignment',{extend:'Sch.model.Customizable',idProperty:'Id',isAssignmentModel:!0,customizableFields:[{name:'ResourceId'},{name:'EventId'}],resourceIdField:'ResourceId',eventIdField:'EventId',getInternalId:function(){return this.internalId},getAssignmentStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var a=this.getAssignmentStore();return a&&a.getEventStore()},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getEvent:function(a){var b=this;a=a||b.getEventStore();return a&&a.getModelById(b.getEventId())},getResource:function(a){var b=this;a=a||b.getResourceStore();return a&&a.getModelById(b.getResourceId())},getEventName:function(b){var a=this.getEvent(b);return a&&a.getName()||''},getResourceName:function(b){var a=this.getResource(b);return a&&a.getName()||''},isPersistable:function(){var c=this,b=c.getEvent(),a=c.getResource();return b&&!b.phantom&&a&&!a.phantom},fullCopy:function(){return this.copy.apply(this,arguments)},getEventResourceCompositeKey:function(){var a=this;return a.self.makeAssignmentEventResourceCompositeKey(a.getEventId(),a.getResourceId())},inheritableStatics:{makeAssignmentEventResourceCompositeKey:function(){var a=[];return function(c,b){a.length=0;a.push('event(',c,')-resource(',b,')');return a.join('')}}()}});Ext.define('Sch.data.AssignmentStore',{extend:'Ext.data.Store',requires:['Sch.patches.CollectionKey','Sch.data.util.EventAssignmentsCache','Sch.data.util.ResourceAssignmentsCache'],uses:['Sch.data.util.EventAssignmentsCache','Sch.data.util.ResourceAssignmentsCache','Sch.data.util.AssignmentStoreEventResourcesCache','Sch.data.util.AssignmentStoreResourceEventsCache'],mixins:['Sch.data.mixin.UniversalModelGetter','Sch.data.mixin.CacheHintHelper','Robo.data.Store'],config:{extraKeys:{byEventIdResourceId:{keyFn:'getEventResourceCompositeKey'}}},model:'Sch.model.Assignment',alias:'store.assignmentstore',storeId:'assignments',eventResourceCache:null,resourceEventsCache:null,eventStoreDetacher:null,resourceStoreDetacher:null,eventStore:null,constructor:function(b){var a=this;a.callParent([b]);a.eventAssignmentsCache=a.eventAssignmentsCache||a.createEventAssignmentCache();a.resourceAssignmentsCache=a.resourceAssignmentsCache||a.createResourceAssignmentCache()},destroy:function(){var a=this;Ext.destroyMembers(a,'eventResourceCache','resourceEventsCache','eventAssignmentsCache','resourceEventsCache','eventStoreDetacher','resourceStoreDetacher');a.callParent()},createEventAssignmentCache:function(){return new Sch.data.util.EventAssignmentsCache(this)},createResourceAssignmentCache:function(){return new Sch.data.util.ResourceAssignmentsCache(this)},createAssignmentStoreEventResourcesCache:function(){return new Sch.data.util.AssignmentStoreEventResourcesCache(this)},createAssignmentStoreResourceEventsCache:function(){return new Sch.data.util.AssignmentStoreResourceEventsCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(b){var a=this,c=a.eventStore;a.eventStore=b&&Ext.StoreMgr.lookup(b)||null;a.attachToEventStore(a.eventStore);if((c||b)&&c!==b){a.fireEvent('eventstorechange',a,b,c)}},attachToEventStore:function(b){var a=this;Ext.destroy(a.eventStoreDetacher);if(b&&b.isTreeStore){a.eventStoreDetacher=b.on({'noderemove':a.onEventNodeRemove,'resourcestorechange':a.onEventStoreResourceStoreChange,scope:a,destroyable:!0,priority:200})}else {if(b){a.eventStoreDetacher=b.on({'remove':a.onEventRemove,'resourcestorechange':a.onEventStoreResourceStoreChange,scope:a,destroyable:!0,priority:200})}}a.attachToResourceStore(b&&b.getResourceStore())},attachToResourceStore:function(b){var a=this;Ext.destroy(a.resourceStoreDetacher);if(b){if(b.isTreeStore){a.resourceStoreDetacher=b.on({'noderemove':a.onResourceNodeRemove,scope:a,destroyable:!0,priority:200})}else {a.resourceStoreDetacher=b.on({'remove':a.onResourceRemove,scope:a,destroyable:!0,priority:200})}}},onEventStoreResourceStoreChange:function(c,a,b){this.attachToResourceStore(a)},onEventRemove:function(e,c,f,d){var b=this,a;if(!d){a=[];Ext.Array.each(c,function(c){a=a.concat(b.getAssignmentsForEvent(c))});a.length&&b.remove(a)}},onEventNodeRemove:function(e,d,c){var b=this,a;if(!c){a=[];d.cascadeBy(function(c){a=a.concat(b.getAssignmentsForEvent(c))});a.length&&b.remove(a)}},onResourceRemove:function(e,c,f,d){var b=this,a;if(!d){a=[];Ext.Array.each(c,function(c){a=a.concat(b.getAssignmentsForResource(c))});a.length&&b.remove(a)}},onResourceNodeRemove:function(e,c,d){var b=this,a;if(!d){a=[];c.cascadeBy(function(c){a=a.concat(b.getAssignmentsForResource(c))});a.length&&b.remove(a)}},mapAssignmentsForEvent:function(d,c,a){var e=this,b=[];c=c||Ext.identityFn;a=a||Ext.returnTrue;if(c!==Ext.identityFn||a!==Ext.returnTrue){Ext.Array.each(e.eventAssignmentsCache.get(d),function(e){var d=c(e);a(d)&&b.push(d)})}else {b=b.concat(e.eventAssignmentsCache.get(d))}return b},mapAssignmentsForResource:function(d,b,a){var e=this,c=[];b=b||Ext.identityFn;a=a||Ext.returnTrue;if(b!==Ext.identityFn||a!==Ext.returnTrue){Ext.Array.each(e.resourceAssignmentsCache.get(d),function(e){var d=b(e);a(d)&&c.push(d)})}else {c=[].concat(e.resourceAssignmentsCache.get(d))}return c},getAssignmentsForEvent:function(a){return this.mapAssignmentsForEvent(a)},removeAssignmentsForEvent:function(b){var a=this;a.remove(a.getAssignmentsForEvent(b))},getAssignmentsForResource:function(a){return this.mapAssignmentsForResource(a)},removeAssignmentsForResource:function(b){var a=this;a.remove(a.getAssignmentsForResource(b))},getResourcesForEvent:function(c){var b=this,a;if(b.eventResourceCache){a=b.eventResourceCache.get(c)}else {a=b.mapAssignmentsForEvent(c,function mapper(a){return a.getResource()},function filter(a){return !!a})}return a},getEventsForResource:function(c){var d=this,a=this.getEventStore(),b;b=d.mapAssignmentsForResource(c,function mapper(a){return a.getEvent()},function filter(b){return !!b&&(!a.isFiltered()||a.contains(b))});return b},assignEventToResource:function(a,d,b){var e=this,c=[];b=b||Ext.identityFn;var f=Ext.isArray(d)?d:[d];Ext.Array.each(f,function(f){if(!e.isEventAssignedToResource(a,f)){var d=new e.model();d=b(d);d.setEventId(a&&a.isModel&&a.getId()||a);d.setResourceId(f&&f.isModel&&f.getId()||f);c.push(d)}});e.add(c);return c},unassignEventFromResource:function(c,b){var d=this,a;if(!b){this.removeAssignmentsForEvent(c)}else {if(d.isEventAssignedToResource(c,b)){a=d.getAssignmentForEventAndResource(c,b);d.remove(a)}}return a},isEventAssignedToResource:function(f,a){var g=this,d=g.getResourcesForEvent(f),b=!1,c,e;if(a&&a.isModel){a=a.getId()}for(c=0,e=d.length;!b&&c<e;c++){b=d[c];b=b.getId()==a}return b},getAssignmentForEventAndResource:function(b,a){var c=this;if(b&&b.isModel){b=b.getId()}if(a&&a.isModel){a=a.getId()}return c.byEventIdResourceId.get(c.model.makeAssignmentEventResourceCompositeKey(b,a))},commitChanges:function(){this.suspendEvents(!0);this.callParent(arguments);this.resumeEvents()}});Ext.define('Sch.model.CalendarDay',{requires:['Ext.data.Types'],extend:'Sch.model.Customizable',mixins:['Sch.mixin.Localizable'],idProperty:'Id',isCalendarDayModel:!0,customizableFields:[{name:'Date',type:'date',dateFormat:'c',persist:!0,convert:function(b,c){if(!b){return}var a=Ext.data.Types.DATE.convert.call(this,b);if(a){Ext.Date.clearTime(a)}return a}},{name:'Weekday',type:'int'},{name:'OverrideStartDate',type:'date',dateFormat:'c'},{name:'OverrideEndDate',type:'date',dateFormat:'c'},{name:'Type',defaultValue:'DAY'},{name:'IsWorkingDay',type:'boolean',defaultValue:!1},{name:'Cls',defaultValue:'sch-nonworkingtime'},'Name',{name:'Availability',persist:!0,convert:function(a,b){if(a){return typeof a==='string'?[a]:a}else {return []}}}],availabilityCache:null,weekdayField:'Weekday',overrideStartDateField:'OverrideStartDate',overrideEndDateField:'OverrideEndDate',typeField:'Type',dateField:'Date',isWorkingDayField:'IsWorkingDay',clsField:'Cls',nameField:'Name',availabilityField:'Availability',setDate:function(a){if(a){a=Ext.Date.clearTime(a,!0)}this.set(this.dateField,a)},clearDate:function(){this.set(this.dateField,null)},getAvailability:function(b){var c=this;if(b){return this.get(this.availabilityField)}if(this.availabilityCache){return this.availabilityCache}var a=Ext.Array.map(this.get(this.availabilityField),function(a){return typeof a==='string'?c.parseInterval(a):a});this.verifyAvailability(a);return this.availabilityCache=a},setAvailability:function(a){this.availabilityCache=null;this.set(this.availabilityField,this.stringifyIntervals(a));this.getAvailability()},verifyAvailability:function(a){var b=this;a.sort(function(a,b){return a.startTime-b.startTime});Ext.Array.each(a,function(c,d){if(c.startTime>c.endTime){throw new Error(Ext.String.format(b.L('startTimeAfterEndTime'),Ext.Date.format(c.startTime,'H:i'),Ext.Date.format(c.endTime,'H:i')))}if(d>0&&a[d-1].endTime>c.startTime){throw new Error(Ext.String.format(b.L('availabilityIntervalsShouldNotIntersect'),b.stringifyInterval(a[d-1]),b.stringifyInterval(c)))}})},prependZero:function(a){return a<10?'0'+a:a},stringifyInterval:function(c){var b=c.startTime;var a=c.endTime;return this.prependZero(b.getHours())+':'+this.prependZero(b.getMinutes())+'-'+(a.getDate()==1?24:this.prependZero(a.getHours()))+':'+this.prependZero(a.getMinutes())},stringifyIntervals:function(a){var b=this;return Ext.Array.map(a,function(a){if(typeof a==='string'){return a}return b.stringifyInterval(a)})},parseInterval:function(b){var a=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(b);if(!a){throw new Error(Ext.String.format(this.L('invalidFormat'),b))}return {startTime:new Date(2016,11,0,a[1],a[2]),endTime:new Date(2016,11,0,a[3],a[4])}},getTotalHours:function(){return this.getTotalMS()/1000/60/60},getTotalMS:function(){var a=0;Ext.Array.each(this.getAvailability(),function(b){a+=b.endTime-b.startTime});return a},addAvailabilityInterval:function(a,c){var b;function prepareDate(a){return new Date(2016,11,a.getDate()==1?1:0,a.getHours(),a.getMinutes())}if(a instanceof Date){b={startTime:prepareDate(a),endTime:prepareDate(c)}}else {b=this.parseInterval(a+(c?'-'+c:''))}var d=this.getAvailability().concat(b);this.verifyAvailability(d);this.setAvailability(d)},removeAvailabilityInterval:function(b){var a=this.getAvailability();a.splice(b,1);this.setAvailability(a)},getAvailabilityIntervalsFor:function(a){a=typeof a=='number'?new Date(a):a;var d=a.getFullYear();var b=a.getMonth();var c=a.getDate();return Ext.Array.map(this.getAvailability(),function(a){var e=a.endTime.getDate();return {startDate:new Date(d,b,c,a.startTime.getHours(),a.startTime.getMinutes()),endDate:new Date(d,b,c+(e==1?1:0),a.endTime.getHours(),a.endTime.getMinutes())}})},getAvailabilityStartFor:function(b){var a=this.getAvailabilityIntervalsFor(b);if(!a.length){return null}return a[0].startDate},getAvailabilityEndFor:function(b){var a=this.getAvailabilityIntervalsFor(b);if(!a.length){return null}return a[a.length-1].endDate}});Ext.define('Sch.patches.DateFieldConvertDate',{extend:'Sch.util.Patch',target:'Ext.data.field.Date',minVersion:'7.0.0',maxVersion:'8.0.0',overrides:{convert:function(a){if(!a){return null}if(a instanceof Date){return a}var b=this.dateReadFormat||this.dateFormat,c;if(b){if((b==='c'||b==='C')&&/Z$/.test(a)){var d=new Date(a);return !isNaN(d.getTime())?d:null}return Ext.Date.parse(a,b,this.useStrict)}c=Date.parse(a);return c?new Date(c):null}}});Ext.define('Sch.model.Range',{extend:'Sch.model.Customizable',requires:['Sch.util.Date','Sch.patches.DateFieldConvertDate'],idProperty:'Id',isRangeModel:!0,startDateField:'StartDate',endDateField:'EndDate',nameField:'Name',clsField:'Cls',customizableFields:[{name:'StartDate',type:'date',dateFormat:'c'},{name:'EndDate',type:'date',dateFormat:'c'},{name:'Cls',type:'string'},{name:'Name',type:'string'}],setStartDate:function(c,d){var b=this.getEndDate();var a=this.getStartDate();this.beginEdit();this.set(this.startDateField,c);if(d===!0&&b&&a){this.setEndDate(Sch.util.Date.add(c,Sch.util.Date.MILLI,b-a))}this.endEdit()},setEndDate:function(c,d){var a=this.getStartDate();var b=this.getEndDate();this.beginEdit();this.set(this.endDateField,c);if(d===!0&&a&&b){this.setStartDate(Sch.util.Date.add(c,Sch.util.Date.MILLI,-(b-a)))}this.endEdit()},setStartEndDate:function(a,b){this.beginEdit();this.set(this.startDateField,a);this.set(this.endDateField,b);this.endEdit()},getDates:function(){var b=[],d=this.getEndDate();if(this.isScheduled()){var c=Ext.Date.clearTime(this.getStartDate(),!0);if(d-this.getStartDate()===0){b.push(c)}else {for(var a=c;a<d;a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)){b.push(a)}}}return b},forEachDate:function(b,a){return Ext.Array.each(this.getDates(),b,a)},isScheduled:function(){var a=this;return Boolean(a.getStartDate()&&a.getEndDate()&&a.areDatesValid())},isValid:function(){var d=this,a=d.callParent(),b,c;if(a){b=d.getStartDate(),c=d.getEndDate();a=!b||!c||c-b>=0}return a},areDatesValid:function(){var c=this,a=c.getStartDate(),b=c.getEndDate();return !a||!b||b-a>=0},shift:function(b,a){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),b,a),Sch.util.Date.add(this.getEndDate(),b,a))},fullCopy:function(){return this.copy.apply(this,arguments)},intersectsRange:function(c,d){var a=this.getStartDate();var b=this.getEndDate();return a&&b&&Sch.util.Date.intersectSpans(a,b,c,d)}});Ext.define('Sch.data.Calendar',{extend:'Ext.data.Store',alias:'store.calendar',requires:['Ext.Date','Sch.model.CalendarDay','Sch.model.Range','Sch.util.Date'],mixins:['Sch.data.mixin.UniversalModelGetter','Robo.data.Store'],model:'Sch.model.CalendarDay',daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:'sch-nonworkingtime',weekendsAreWorkdays:!1,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:['00:00-24:00'],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825,inheritableStatics:{getCalendar:function(a){if(a instanceof Sch.data.Calendar){return a}return Ext.data.StoreManager.lookup('GNT_CALENDAR:'+a)},getAllCalendars:function(){var a=[];Ext.data.StoreManager.each(function(b){if(b instanceof Sch.data.Calendar){a.push(b)}});return a},removeAll:function(){var a=Ext.data.StoreManager;a.each(function(b){if(b instanceof Sch.data.Calendar){a.unregister(b);Ext.destroy(b)}})}},constructor:function(a){a=a||{};var c=a.parent;delete a.parent;var b=a.calendarId;delete a.calendarId;this.callParent(arguments);this.setParent(c);this.setCalendarId(b);this.unitsInMs={MILLI:1,SECOND:1000,MINUTE:60*1000,HOUR:60*60*1000,DAY:this.hoursPerDay*60*60*1000,WEEK:this.daysPerWeek*this.hoursPerDay*60*60*1000,MONTH:this.daysPerMonth*this.hoursPerDay*60*60*1000,QUARTER:3*this.daysPerMonth*this.hoursPerDay*60*60*1000,YEAR:12*this.daysPerMonth*this.hoursPerDay*60*60*1000};this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.on({update:this.onCalendarUpdate,add:this.onCalendarDataChange,remove:this.onCalendarDataChange,filter:this.onCalendarDataChange,sort:this.onCalendarDataChange,clear:this.onCalendarDataChange,refresh:this.onCalendarDataChange,write:this.onCalendarDataChange,scope:this});this.clearCache()},shouldReactOnCalendarDayFieldUpdate:function(a,b){return Boolean(Ext.Array.some(b,function(b){return b!==a.clsField&&b!==a.nameField}))},onCalendarUpdate:function(d,c,a,b){if(a==Ext.data.Model.EDIT&&this.shouldReactOnCalendarDayFieldUpdate(c,b)){this.onCalendarDataChange()}},onCalendarDataChange:function(){this.clearCache()},getCalendarId:function(){return this.calendarId},setCalendarId:function(a){if(this.calendarId!=null){Ext.data.StoreManager.unregister(this)}this.calendarId=a;if(a!=null){this.storeId='GNT_CALENDAR:'+a;Ext.data.StoreManager.register(this)}else {this.storeId=null}var b=this.proxy;if(b&&b.extraParams){b.extraParams.calendarId=a}},getDefaultWeekAvailability:function(){var b=this.defaultAvailability;var e=this.weekendFirstDay;var d=this.weekendSecondDay;var c=[];for(var a=0;a<7;a++){c.push(this.weekendsAreWorkdays||a!=e&&a!=d?new this.model({Type:'WEEKDAY',Weekday:a,Availability:b&&b.slice()||[],IsWorkingDay:!0}):new this.model({Type:'WEEKDAY',Weekday:a,Availability:[]}))}return c},resetCache:function(){if(this.suspendCacheUpdate>0){return}this.holidaysCache={};this.availabilityIntervalsCache={};var d=this.daysIndex={};var c=this.weekAvailability=[];var b=this.nonStandardWeeksStartDates=[];var a=this.nonStandardWeeksByStartDate={};this.each(function(e){var n=e.getId();var g=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(n);var k=/^WEEKDAY:(\d+)$/.exec(n);var l=e.getType();var f=e.getWeekday();if(l=='WEEKDAYOVERRIDE'||g){var i,j;if(l=='WEEKDAYOVERRIDE'){i=e.getOverrideStartDate();j=e.getOverrideEndDate()}if(g){i=Ext.Date.parse(g[2],'Y/m/d');j=Ext.Date.parse(g[3],'Y/m/d');f=g[1]}if(i&&j&&f!=null){var h=i-0;if(!a[h]){a[h]={startDate:new Date(i),endDate:new Date(j),name:e.getName(),weekAvailability:[],mainDay:null};b.push(h)}if(f>=0){a[h].weekAvailability[f]=e}else {a[h].mainDay=e}}}else {if(l=='WEEKDAY'||k){if(k){f=k[1]}if(f!=null){if(f<0||f>6){throw new Error('Incorrect week day index')}c[f]=e}}else {var m=e.getDate();if(m){d[m-0]=e}}}});b.sort(function(a,b){return a-b})},clearCache:function(){if(this.suspendCacheUpdate>0){return}this.resetCache();this.fireEvent('calendarchange',this)},intersectsWithCurrentWeeks:function(a,b){var c=!1;this.forEachNonStandardWeek(function(f){var d=f.startDate;var e=f.endDate;if(d<=a&&a<e||d<b&&b<=e){c=!0;return !1}});return c},addNonStandardWeek:function(a,b,g,e){a=Ext.Date.clearTime(new Date(a));b=Ext.Date.clearTime(new Date(b));if(this.intersectsWithCurrentWeeks(a,b)){throw new Error('Can not add intersecting week')}var f=this.model;var d=[];Ext.Array.each(g,function(c,h){if(c&&c.isCalendarDayModel){c.setType('WEEKDAYOVERRIDE');c.setOverrideStartDate(a);c.setOverrideEndDate(b);c.setWeekday(h);c.setName(e||'Week override');d.push(c)}else {if(Ext.isArray(c)){var g=new f();g.setType('WEEKDAYOVERRIDE');g.setOverrideStartDate(a);g.setOverrideEndDate(b);g.setWeekday(h);g.setName(e||'Week override');g.setAvailability(c);d.push(g)}}});var c=new f();c.setType('WEEKDAYOVERRIDE');c.setOverrideStartDate(a);c.setOverrideEndDate(b);c.setWeekday(-1);c.setName(e||'Week override');d.push(c);this.add(d)},getNonStandardWeekByStartDate:function(a){return this.nonStandardWeeksByStartDate[Ext.Date.clearTime(new Date(a))-0]||null},getNonStandardWeekByDate:function(a){a=Ext.Date.clearTime(new Date(a))-0;var d=this.nonStandardWeeksStartDates;var e=this.nonStandardWeeksByStartDate;for(var c=0;c<d.length;c++){var b=e[d[c]];if(b.startDate>a){break}if(b.startDate<=a&&a<=b.endDate){return b}}return null},removeNonStandardWeek:function(a){a=Ext.Date.clearTime(new Date(a))-0;var b=this.getNonStandardWeekByStartDate(a);if(!b){return}this.remove(Ext.Array.clean(b.weekAvailability).concat(b.mainDay))},forEachNonStandardWeek:function(e,d){var f=this;var b=this.nonStandardWeeksStartDates;var c=this.nonStandardWeeksByStartDate;for(var a=0;a<b.length;a++){if(e.call(d||f,c[b[a]])===!1){return !1}}},setWeekendsAreWorkDays:function(a){if(a!==this.weekendsAreWorkdays){this.weekendsAreWorkdays=a;this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.clearCache()}},areWeekendsWorkDays:function(){return this.weekendsAreWorkdays},getCalendarDay:function(a){a=typeof a=='number'?new Date(a):a;return this.getOverrideDay(a)||this.getWeekDay(a.getDay(),a)||this.getDefaultCalendarDay(a.getDay())},getOverrideDay:function(a){return this.getOwnCalendarDay(a)||this.parent&&this.parent.getOverrideDay(a)||null},getOwnCalendarDay:function(a){a=typeof a=='number'?new Date(a):a;return this.daysIndex[Ext.Date.clearTime(a,!0)-0]},getWeekDay:function(a,b){if(b){var c=this.getNonStandardWeekByDate(b);if(c&&c.weekAvailability[a]){return c.weekAvailability[a]}}return this.weekAvailability[a]||this.parent&&this.parent.getWeekDay(a,b)||null},getDefaultCalendarDay:function(a){if(!this.hasOwnProperty('defaultAvailability')&&!this.hasOwnProperty('weekendsAreWorkdays')&&this.parent){return this.parent.getDefaultCalendarDay(a)}return this.defaultWeekAvailability[a]},isHoliday:function(a){var b=a-0;var c=this.holidaysCache;if(c[b]!=null){return c[b]}a=typeof a=='number'?new Date(a):a;var d=this.getCalendarDay(a);if(!d){throw new Error("Can't find day for "+a)}return c[b]=!d.getIsWorkingDay()},isWeekend:function(b){var a=b.getDay();return a===this.weekendFirstDay||a===this.weekendSecondDay},isWorkingDay:function(a){return !this.isHoliday(a)},convertMSDurationToUnit:function(a,b){return a/this.unitsInMs[Sch.util.Date.getNameOfUnit(b)]},convertDurationToMs:function(a,b){return a*this.unitsInMs[Sch.util.Date.getNameOfUnit(b)]},convertDuration:function(a,b,d){var e=this,c=a;if(b!=d){c=e.convertMSDurationToUnit(e.convertDurationToMs(a,b),d)}return c},getHolidaysRanges:function(e,c,k,f){if(e>c){Ext.Error.raise("startDate can't be bigger than endDate")}e=Ext.Date.clearTime(e,!0);c=c-Ext.Date.clearTime(c,!0)>0?Sch.util.Date.getStartOfNextDay(c,!0,!0):c;var g=[],a,b;for(b=e;b<c;b=Sch.util.Date.getNext(b,Sch.util.Date.DAY,1,null,f)){var d=b;if(f){d=Sch.util.Date.toTimeZone(d,f)}if(this.isHoliday(d)||this.weekendsAreWorkdays&&k&&this.isWeekend(d)){var j=this.getCalendarDay(d);var h=j&&j.getCls()||this.defaultNonWorkingTimeCssCls;var i=Sch.util.Date.getNext(b,Sch.util.Date.DAY,1,null,f);if(!a){a=new Sch.model.Range({StartDate:b,EndDate:i,Cls:h})}else {if(a.getCls()==h){a.setEndDate(i)}else {g.push(a);a=new Sch.model.Range({StartDate:b,EndDate:i,Cls:h})}}}else {if(a){g.push(a);a=null}}}if(a){g.push(a)}return g},forEachAvailabilityInterval:function(f,p,l){l=l||this;var b=f.startDate;var c=f.endDate;var a=f.isForward!==!1;if(a?!b:!c){throw new Error('At least `startDate` or `endDate` is required, depending from the `isForward` option')}var d=new Date(a?b:c);var e=Sch.util.Date;if(a){if(!c){c=e.add(b,e.DAY,f.availabilitySearchLimit||this.availabilitySearchLimit||5*365)}}else {if(!b){b=e.add(c,e.DAY,-(f.availabilitySearchLimit||this.availabilitySearchLimit||5*365))}}var h=!1;while(a?d<c:d>b){var k=this.getAvailabilityIntervalsFor(d-(a?0:1),a?h:!1);for(var g=a?0:k.length-1;a?g<k.length:g>=0;a?g++:g--){var m=k[g];var i=m.startDate;var j=m.endDate;if(i>=c||j<=b){continue}var n=i<b?b:i;var o=j>c?c:j;if(p.call(l,n,o)===!1){return !1}}d=a?e.getStartOfNextDay(d,!1,h):e.getEndOfPreviousDay(d,h);h=!0}},calculateDuration:function(b,c,d){var a=0;this.forEachAvailabilityInterval({startDate:b,endDate:c},function(b,c){var d=b.getTimezoneOffset()-c.getTimezoneOffset();a+=c-b+d*60*1000});return this.convertMSDurationToUnit(a,d)},calculateEndDate:function(b,a,f){if(!a){return new Date(b)}var e=Sch.util.Date,c;a=this.convertDurationToMs(a,f);var d=a===0&&Ext.Date.clearTime(b,!0)-b===0?e.add(b,Sch.util.Date.DAY,-1):b;this.forEachAvailabilityInterval({startDate:d},function(b,d){var e=d-b;var f=b.getTimezoneOffset()-d.getTimezoneOffset();if(e>=a){c=new Date(b-0+a);return !1}else {a-=e+f*60*1000}});return c},calculateStartDate:function(c,a,d){if(!a){return new Date(c)}var b;a=this.convertDurationToMs(a,d);this.forEachAvailabilityInterval({endDate:c,isForward:!1},function(e,c){var d=c-e;if(d>=a){b=new Date(c-a);return !1}else {a-=d}});return b},skipNonWorkingTime:function(a,b){var c=!1;this.forEachAvailabilityInterval(b?{startDate:a}:{endDate:a,isForward:!1},function(d,e){a=b?d:e;c=!0;return !1});if(!c){throw new Error('skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified')}return new Date(a)},skipWorkingTime:function(b,a,c){return a>=0?this.calculateEndDate(b,a,c):this.calculateStartDate(b,-a,c)},getAvailabilityIntervalsFor:function(a,b){if(b){a=a.valueOf()}else {if(a instanceof Date){a=(new Date(a.getFullYear(),a.getMonth(),a.getDate())).valueOf()}else {a=Ext.Date.clearTime(new Date(a)).valueOf()}}return this.availabilityIntervalsCache[a]=this.availabilityIntervalsCache[a]||this.getCalendarDay(a).getAvailabilityIntervalsFor(a)},isChildOf:function(c){var a=this,b=!1;while(a&&!b){b=a===c;a=a.parent}return b},getParentableCalendars:function(){var b=this,a=[],c=Sch.data.Calendar.getAllCalendars();Ext.Array.each(c,function(c){if(c!==b&&!c.isChildOf(b)){a.push({Id:c.calendarId,Name:c.name||c.calendarId})}});return a},setParent:function(d){var a=Sch.data.Calendar.getCalendar(d);if(d&&!a){throw new Error('Invalid parent specified for the calendar')}if(this.parent!=a){var c=this.proxy;var e={calendarchange:this.onParentCalendarChange,destroy:this.onParentDestroy,scope:this};var b=this.parent;if(b){b.un(e)}this.parent=a;if(a){a.on(e)}if(c&&c.extraParams){c.extraParams.parentId=a?a.calendarId:null}this.clearCache();this.fireEvent('parentchange',this,a,b)}},onParentCalendarChange:function(){this.clearCache()},onParentDestroy:function(){this.setParent(null)},isAvailabilityIntersected:function(h,j,k){var g,c,f,b;for(var a=0;a<7;a++){g=this.getWeekDay(a)||this.getDefaultCalendarDay(a);f=h.getWeekDay(a)||h.getDefaultCalendarDay(a);if(!g||!f){continue}c=g.getAvailability();b=f.getAvailability();for(var d=0,m=c.length;d<m;d++){for(var e=0,l=b.length;e<l;e++){if(b[e].startTime<c[d].endTime&&b[e].endTime>c[d].startTime){return !0}}}}var i=!1;this.forEachNonStandardWeek(function(a){if(a.startDate>=k){return !1}if(j<a.endDate){i=!0;return !1}});return i}});Ext.define('Sch.data.CrudManager',{extend:'Sch.crud.AbstractManager',mixins:['Sch.crud.encoder.Json','Sch.crud.transport.Ajax'],resourceStore:null,eventStore:null,assignmentStore:null,dependencyStore:null,addRelatedStores:!0,constructor:function(a){a=a||{};var d=a.resourceStore||this.resourceStore||new Sch.data.ResourceStore(),e=a.eventStore||this.eventStore||new Sch.data.EventStore(),b=a.assignmentStore||this.assignmentStore,c=a.dependencyStore||this.dependencyStore,g=[];if(e&&a.addRelatedStores!==!1){var i=this.getEventStoreInfo(e,a);b=b||i.assignmentStore;d=d||i.resourceStore;c=c||i.dependencyStore}e&&g.push(e);d&&g.push(d);b&&g.push(b);c&&g.push(c);if(g.length){var f=[];d&&f.push(d);e&&f.push(e);b&&f.push(b);c&&f.push(c);if(f.length){a.syncApplySequence=(a.syncApplySequence||a.stores||[]).concat(f)}var h=a.stores||this.stores;if(h&&!Ext.isArray(h)){h=[h]}a.stores=(h||[]).concat(g)}this.callParent([a]);this.eventStore=this.getStoreDescriptor(e);this.resourceStore=this.getStoreDescriptor(d);this.assignmentStore=this.getStoreDescriptor(b);this.dependencyStore=this.getStoreDescriptor(c)},getEventStoreInfo:function(a,c){if(!a.isStore){if(typeof a=='string'){a=Ext.data.StoreManager.get(a)}else {a=a.store}}var b={},d=c.assignmentStore,f=c.resourceStore,e=c.dependencyStore;!d&&(b.assignmentStore=a.getAssignmentStore());!f&&(b.resourceStore=a.getResourceStore());!e&&(b.dependencyStore=a.getDependencyStore());return b},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},setResourceStore:function(a){if(this.getResourceStore()){this.removeStore(this.getResourceStore())}this.addStore(a);this.resourceStore={store:a}},getEventStore:function(){return this.eventStore&&this.eventStore.store},setEventStore:function(a){if(this.getEventStore()){this.removeStore(this.getEventStore())}this.addStore(a);this.eventStore={store:a}},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store},setAssignmentStore:function(a){if(this.getAssignmentStore()){this.removeStore(this.getAssignmentStore())}this.addStore(a);this.assignmentStore={store:a}},getDependencyStore:function(){return this.dependencyStore&&this.dependencyStore.store},setDependencyStore:function(a){if(this.getDependencyStore()){this.removeStore(this.getDependencyStore())}this.addStore(a);this.dependencyStore={store:a}}});Ext.define('Sch.data.util.EventDependencyCache',function(){var b={allowNull:!1,filtered:!1,collapsed:!0};var a=[null];function cacheDependencies(a,b){Ext.Array.each(b,function(b){var c=b.getSourceId(),d=b.getTargetId();if(c){a.add(c,b)}if(d){a.add(d,b)}if(c&&d){a.addSuccessor(c,b);a.addPredecessor(d,b)}})}function uncacheDependencies(a,b){Ext.Array.each(b,function(b){var c=b.getSourceId(),d=b.getTargetId();if(c){a.remove(c,b);a.removeSuccessor(c,b)}if(d){a.remove(d,b);a.removePredecessor(d,b)}})}function uncacheEventDependencies(a,b){Ext.Array.each(b,function(b){a.clear(b);a.clearSuccessors(b);a.clearPredecessors(b)})}function updateDependency(b,c,e,d,f,a){if(c!==e){b.move(e,c,a);b.moveSuccessors(e,c,a)}if(d!==f){b.move(f,d,a);b.movePredecessors(f,d,a)}}function moveDependencies(c,b,a){c.move(b,a);c.moveSuccessors(b,a);c.movePredecessors(b,a)}function complementCache(a,b){Ext.Array.each(b,function(b){if(!a.has(b)){a.set(b,[]);a.setSuccessors(b,[]);a.setPredecessors(b,[])}})}function recacheAll(c,d,a){c.clear();cacheDependencies(c,d.getRange());a&&(!a.getRoot||a.getRoot())&&complementCache(c,a.collect(a.getModel().idProperty,b))}function recacheKeys(a,b,d,c){b=Ext.Array.reduce(b,function(c,b){a.set(b,[]);c[a.key(b)]=!0},{});d.each(function(c){var d=c.getSourceId(),e=c.getTargetId(),g=b.hasOwnProperty(d),f=b.hasOwnProperty(e);g&&a.add(d,c);g&&a.addSuccessor(d,c);f&&a.add(e,c);f&&a.addPredecessor(e,c)});Ext.Object.each(b,function(b){if(!a.has(b)&&(c.getNodeById?c.getNodeById(b):c.getById(b))){a.set(b,[])}})}return {extend:'Sch.util.Cache',dependencyStore:null,dependencyStoreDetacher:null,eventStoreDetacher:null,constructor:function(c){var b=this;b.callParent();b.dependencyStore=c;function onDependencyAdd(c,a){cacheDependencies(b,a)}function onDependencyRemove(e,a,d,c){!c&&uncacheDependencies(b,a)}function onDependencyUpdate(j,a,i){var e=a.fromField,f=a.toField,c=a.previous&&e in a.previous,d=a.previous&&f in a.previous,g=c&&a.previous[e],h=d&&a.previous[f];if(c||d){if(!g&&a.previous.hasOwnProperty(e)||!h&&a.previous.hasOwnProperty(f)){uncacheDependencies(b,[a]);cacheDependencies(b,[a])}else {updateDependency(b,c?a.getSourceId():!1,c?g:!1,d?a.getTargetId():!1,d?h:!1,a)}}}function onDependencyStoreRefreshClearReset(a){recacheAll(b,a,a.getEventStore())}function onDependencyStoreEventStoreChange(c,a){recacheAll(b,c,a);attachToEventStore(a)}function onEventIdChanged(d,e,c,a){moveDependencies(b,c,a)}function onEventAdd(c,a){complementCache(b,a)}function onEventNodeAppend(d,c){complementCache(b,a[0]=c,a)}function onEventNodeInsert(d,c){complementCache(b,a[0]=c,a)}function onEventRemove(e,a,d,c){!c&&uncacheEventDependencies(b,a)}function onEventNodeRemove(e,d,c){!c&&uncacheEventDependencies(b,a[0]=d,a)}function onEventStoreRefreshClearReset(){recacheAll(b,b.dependencyStore,b.dependencyStore.getEventStore())}function onCacheInvalidate(c,a){if(!a){recacheAll(b,b.dependencyStore,b.eventStore)}else {if(!Ext.isArray(a)){a=[a]}recacheKeys(b,a,b.dependencyStore,b.eventStore)}}function attachToEventStore(c){var a;Ext.destroy(b.eventStoreDetacher);if(c){a={'idchanged':onEventIdChanged,'cacheresethint':onEventStoreRefreshClearReset,'clear':onEventStoreRefreshClearReset,'refresh':onEventStoreRefreshClearReset,'event-dependency-cache-invalidate':onCacheInvalidate,priority:100,destroyable:!0};if(c.isTreeStore){a=Ext.apply(a,{'nodeappend':onEventNodeAppend,'nodeinsert':onEventNodeInsert,'noderemove':onEventNodeRemove,'rootchange':onEventStoreRefreshClearReset})}else {a=Ext.apply(a,{'add':onEventAdd,'remove':onEventRemove})}b.eventStoreDetacher=c.on(a)}}b.dependencyStoreDetacher=c.on({'add':onDependencyAdd,'remove':onDependencyRemove,'update':onDependencyUpdate,'refresh':onDependencyStoreRefreshClearReset,'cacheresethint':onDependencyStoreRefreshClearReset,'clear':onDependencyStoreRefreshClearReset,'eventstorechange':onDependencyStoreEventStoreChange,'event-dependency-cache-invalidate':onCacheInvalidate,priority:100,destroyable:!0});recacheAll(b,c,c.getEventStore())},destroy:function(){var a=this;Ext.destroyMembers(a,'dependencyStoreDetacher','eventStoreDetacher');a.dependencyStore=null},get:function(b,c){var a=this;return a.callParent([b])},getSuccessors:function(c,b){var a=this;return a.get(a.self.makeSuccessorsKey(a.key(c)),b)},getPredecessors:function(c,b){var a=this;return a.get(a.self.makePredecessorsKey(a.key(c)),b)},addSuccessor:function(b,c){var a=this;return arguments.length>1?a.add(a.self.makeSuccessorsKey(a.key(b)),c):a.add(a.self.makeSuccessorsKey(a.key(b)))},addPredecessor:function(b,c){var a=this;return arguments.length>1?a.add(a.self.makePredecessorsKey(a.key(b)),c):a.add(a.self.makePredecessorsKey(a.key(b)))},setSuccessors:function(c,b){var a=this;a.set(a.self.makeSuccessorsKey(a.key(c)),b)},setPredecessors:function(c,b){var a=this;a.set(a.self.makePredecessorsKey(a.key(c)),b)},removeSuccessor:function(b,c){var a=this;return a.remove(a.self.makeSuccessorsKey(a.key(b)),c)},removePredecessor:function(b,c){var a=this;return a.remove(a.self.makePredecessorsKey(a.key(b)),c)},moveSuccessors:function(c,b,d){var a=this;return arguments.length>=3?a.move(a.self.makeSuccessorsKey(a.key(c)),a.self.makeSuccessorsKey(a.key(b)),d):a.move(a.self.makeSuccessorsKey(a.key(c)),a.self.makeSuccessorsKey(a.key(b)))},movePredecessors:function(c,b,d){var a=this;return arguments.length>=3?a.move(a.self.makePredecessorsKey(a.key(c)),a.self.makePredecessorsKey(a.key(b)),d):a.move(a.self.makePredecessorsKey(a.key(c)),a.self.makePredecessorsKey(a.key(b)))},clearSuccessors:function(b){var a=this;return a.clear(a.self.makeSuccessorsKey(a.key(b)))},clearPredecessors:function(b){var a=this;return a.clear(a.self.makePredecessorsKey(a.key(b)))},inheritableStatics:{splitKey:function(a){a=a.split('@#!#@');return {id:a[0],type:a.length&&a[1]||!1}},makeSuccessorsKey:function(a){return a+'@#!#@succ'},makePredecessorsKey:function(a){return a+'@#!#@pred'}}}});Ext.define('Sch.model.DependencyBase',{extend:'Sch.model.Customizable',isDependencyModel:!0,inheritableStatics:{Type:{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}},idProperty:'Id',customizableFields:[{name:'From'},{name:'To'},{name:'Type',type:'int',defaultValue:2},{name:'Cls',defaultValue:''},{name:'Bidirectional',type:'boolean'},{name:'FromSide',type:'string'},{name:'ToSide',type:'string'},{name:'Highlighted',type:'string',persist:!1,defaultValue:''}],fromField:'From',toField:'To',typeField:'Type',clsField:'Cls',bidirectionalField:'Bidirectional',highlightedField:'Highlighted',constructor:function(a){var b=this;b.callParent(arguments);if(a){if(a[b.fromField]&&a[b.fromField].isRangeModel){b.setSourceEvent(a[b.fromField]);delete a.fromField}if(a[b.toField]&&a[b.toField].isRangeModel){b.setTargetEvent(a[b.toField]);delete a.toField}}},getEventStore:function(){return this.store.getEventStore()},getSourceEvent:function(b){var a=this;return (b||a.getEventStore()).getModelById(a.getSourceId())},setSourceEvent:function(a){this.setSourceId(a.getId())},getTargetEvent:function(b){var a=this;return (b||a.getEventStore()).getModelById(a.getTargetId())},setTargetEvent:function(a){this.setTargetId(a.getId())},getSourceId:function(){return this.getFrom()},setSourceId:function(a){return this.setFrom(a)},getTargetId:function(){return this.getTo()},setTargetId:function(a){return this.setTo(a)},isPersistable:function(){var c=this,a=c.getSourceEvent(),b=c.getTargetEvent();return a&&!a.phantom&&b&&!b.phantom},getDateRange:function(){var b=this.getSourceEvent();var d=this.getTargetEvent();if(b&&d&&b.isScheduled()&&d.isScheduled()){var e=this.self.Type;var a,c;switch(this.getType()){case e.StartToStart:a=b.getStartDate();c=d.getStartDate();break;case e.StartToEnd:a=b.getStartDate();c=d.getEndDate();break;case e.EndToEnd:a=b.getEndDate();c=d.getEndDate();break;case e.EndToStart:a=b.getEndDate();c=d.getStartDate();break;}return {start:Sch.util.Date.min(a,c),end:Sch.util.Date.max(a,c)}}return null},highlight:function(b){var c=this,a=c.getHighlighted().split(' ');if(!Ext.Array.contains(a,b)){var d=a.concat(b);c.setHighlighted(d.join(' '))}},unhighlight:function(b){var c=this,a=c.getHighlighted().split(' ');if(Ext.Array.contains(a,b)){var d=Ext.Array.remove(a,b);c.setHighlighted(d.join(' '))}},isHighlightedWith:function(b){var c=this,a=c.getHighlighted().split(' ');return Ext.Array.contains(a,b)}});Ext.define('Sch.model.Dependency',{extend:'Sch.model.DependencyBase',isValid:function(e){var a=this,f=a.callParent(arguments),b=a.getSourceId(),c=a.getTargetId(),d=a.getType();return Ext.isNumber(d)&&!Ext.isEmpty(b)&&!Ext.isEmpty(c)&&b!=c},getTypeFromSides:function(e,c,d){var a=this.self.Type,b=d?'right':'left',f=d?'left':'right';if(e===b){return c===b?a.StartToStart:a.StartToEnd}return c===f?a.EndToEnd:a.EndToStart}});Ext.define('Sch.data.DependencyStore',{extend:'Ext.data.Store',requires:['Sch.patches.CollectionKey','Sch.data.util.EventDependencyCache'],mixins:['Sch.data.mixin.UniversalModelGetter','Sch.data.mixin.CacheHintHelper','Robo.data.Store'],config:{extraKeys:{bySourceTargetId:{keyFn:function(a){return Sch.data.DependencyStore.makeDependencySourceTargetCompositeKey(a.getSourceId(),a.getTargetId())}}}},model:'Sch.model.Dependency',alias:'store.sch_dependencystore',storeId:'dependencies',eventStoreDetacher:null,eventStore:null,constructor:function(b){var a=this;a.callParent([b]);a.eventDependencyCache=a.eventDependencyCache||a.createEventDependencyCache()},destroy:function(){var a=this;Ext.destroyMembers(a,'eventDependencyCache','eventStoreDetacher');a.callParent()},createEventDependencyCache:function(){return new Sch.data.util.EventDependencyCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(b){var a=this,c=a.eventStore;a.eventStore=b&&Ext.StoreMgr.lookup(b)||null;a.attachToEventStore(a.eventStore);if((c||b)&&c!==b){a.fireEvent('eventstorechange',a,b,c)}},attachToEventStore:function(b){var a=this;Ext.destroy(a.eventStoreDetacher);if(b&&b.isTreeStore){a.eventStoreDetacher=b.on({'noderemove':a.onEventNodeRemove,scope:a,destroyable:!0,priority:200})}else {if(b){a.eventStoreDetacher=b.on({'remove':a.onEventRemove,scope:a,destroyable:!0,priority:200})}}},onEventRemove:function(c,a,d,b){!b&&this.removeEventDependencies(a,!1)},onEventNodeRemove:function(c,b,a){!a&&this.removeEventDependencies(b,!1)},reduceEventDependencies:function(a,d,e,c,b){var f=this;b=b||function(a){var b=a&&a.isModel?a.getId():a;return f.eventDependencyCache.get(a,function(){return Ext.Array.filter(f.getRange(),function(a){return a.getTargetId()==b||a.getSourceId()==b})})};a=Ext.isArray(a)?a:[a];c=c===undefined?!0:!1;Ext.Array.reduce(a,function(a,e){if(e.isNode&&!c){e.cascadeBy(function(c){a=Ext.Array.reduce(b(c),d,a)})}else {a=Ext.Array.reduce(b(e),d,a)}},e);return e},reduceEventIncomingDependencies:function(d,b,c,e){var a=this;return a.reduceEventDependencies(d,b,c,e,function(b){var c=b&&b.isModel?b.getId():b;return a.eventDependencyCache.getPredecessors(b,function(){return Ext.Array.filter(a.getRange(),function(a){return a.getTargetId()==c})})})},reduceEventOutgoingDependencies:function(d,b,c,e){var a=this;return a.reduceEventDependencies(d,b,c,e,function(b){var c=b&&b.isModel?b.getId():b;return a.eventDependencyCache.getSuccessors(b,function(){return Ext.Array.filter(a.getRange(),function(a){return a.getSourceId()==c})})})},mapEventDependencies:function(c,e,b,d,a){return this.reduceEventDependencies(c,function(c,a){b(a)&&c.push(a);return c},[],d,a)},mapEventIncomingDependencies:function(b,d,a,c){return this.reduceEventIncomingDependencies(b,function(c,b){a(b)&&c.push(b);return c},[],c)},mapEventOutgoingDependencies:function(b,d,a,c){return this.reduceEventOutgoingDependencies(b,function(c,b){a(b)&&c.push(b);return c},[],c)},getEventDependencies:function(a,b){return this.mapEventDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventIncomingDependencies:function(a,b){return this.mapEventIncomingDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventOutgoingDependencies:function(a,b){return this.mapEventOutgoingDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventPredecessors:function(c,d){var a=this,b=a.getEventStore();return a.reduceEventDependencies(c,function(d,e){var a=e.getFrom(),c=a&&b.getModelById(a);if(c){d.push(c)}return d},[],d,function(b){return a.eventDependencyCache.getPredecessors(b)})},getEventSuccessors:function(c,d){var a=this,b=a.getEventStore();return a.reduceEventDependencies(c,function(d,e){var a=e.getTo(),c=a&&b.getModelById(a);if(c){d.push(c)}return d},[],d,function(b){return a.eventDependencyCache.getSuccessors(b)})},removeEventDependencies:function(c,d){var b=this,a;a=b.getEventDependencies(c,d);a.length&&b.remove(Ext.Array.unique(a))},removeEventIncomingDependencies:function(c,d){var b=this,a;a=b.getEventIncomingDependencies(c,d);a.length&&b.remove(Ext.Array.unique(a))},removeEventOutgoingDependencies:function(c,d){var b=this,a;a=b.getEventOutgoingDependencies(c,d);a.length&&b.remove(Ext.Array.unique(a))},getDependencyForSourceAndTargetEvents:function(a,b){var c=this;a=a&&a.isModel&&a.getId()||a;b=b&&b.isModel&&b.getId()||b;return c.bySourceTargetId.get(c.self.makeDependencySourceTargetCompositeKey(a,b))},getEventsLinkingDependency:function(a,b){var c=this;return c.getDependencyForSourceAndTargetEvents(a,b)||c.getDependencyForSourceAndTargetEvents(b,a)},isValidDependency:function(a){var b=a.getSourceId();var c=a.getTargetId();return b!=null&&c!=null&&b!==c},getHighlightedDependencies:function(a){return Ext.Array.reduce(this.getRange(),function(b,c){if(c.isHighlightedWith(a)){b.push(c)}return b},[])},inheritableStatics:{makeDependencySourceTargetCompositeKey:function(){var a=[];return function(b,c){a.length=0;a.push('source(',b,')-target(',c,')');return a.join('')}}()}});Ext.define('Sch.data.util.IdConsistencyManager',{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(b,c){var a=this;Ext.destroyMembers(a,'eventStoreDetacher');if(b){a.eventStoreDetacher=b.on({idchanged:a.onEventIdChanged,scope:a,destroyable:!0,priority:200})}},updateResourceStore:function(b,c){var a=this;Ext.destroyMembers(a,'resourceStoreDetacher');if(b){a.resourceStoreDetacher=b.on({idchanged:a.onResourceIdChanged,scope:a,destroyable:!0,priority:200})}},onEventIdChanged:function(h,i,g,f){var c=this,d=c.getAssignmentStore(),e=c.getDependencyStore(),b,a;if(d){b=c.getUpdateAssignmentEventIdFieldFn(d,g,f)}if(e){a=c.getUpdateDependencySourceTargedIdFieldFn(e,g,f)}if(b||a){h.on('update',function(){b&&b();a&&a()},null,{single:!0,priority:200})}},onResourceIdChanged:function(h,i,g,f){var c=this,e=c.getEventStore(),a=c.getAssignmentStore(),b,d;if(e&&!a){b=c.getUpdateEventResourceIdFieldFn(e,g,f)}if(a){d=c.getUpdateAssignmentResourceIdFieldFn(a,g,f)}if(b||a){h.on('update',function(){b&&b();d&&d()},null,{single:!0,priority:200})}},getUpdateEventResourceIdFieldFn:function(a,d,c){var b=a.getRange();return function(){Ext.Array.each(b,function(a){a.getResourceId()==d&&a.setResourceId(c)})}},getUpdateAssignmentEventIdFieldFn:function(b,a,d){var c=b.getAssignmentsForEvent(a);return function(){Ext.Array.each(c,function(b){b.getEventId()==a&&b.setEventId(d)})}},getUpdateAssignmentResourceIdFieldFn:function(b,a,d){var c=b.getAssignmentsForResource(a);return function(){Ext.Array.each(c,function(b){b.getResourceId()==a&&b.setResourceId(d)})}},getUpdateDependencySourceTargedIdFieldFn:function(c,a,b){var d=c.getEventDependencies(a);return function(){Ext.Array.each(d,function(c){c.getSourceId()==a&&c.setSourceId(b);c.getTargetId()==a&&c.setTargetId(b)})}}});Ext.define('Sch.data.util.ModelPersistencyManager',{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,dependencyStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(b,c){var a=this;Ext.destroyMembers(a,'eventStoreDetacher');if(b&&b.autoSync){a.eventStoreDetacher=b.on({beforesync:a.onEventStoreBeforeSync,scope:a,destroyable:!0,priority:100})}},updateResourceStore:function(b,c){var a=this;Ext.destroyMembers(a,'resourceStoreDetacher');if(b&&b.autoSync){a.resourceStoreDetacher=b.on({beforesync:a.onResourceStoreBeforeSync,scope:a,destroyable:!0,priority:100})}},updateAssignmentStore:function(b,c){var a=this;Ext.destroyMembers(a,'assignmentStoreDetacher');if(b&&b.autoSync){a.assignmentStoreDetacher=b.on({beforesync:a.onAssignmentStoreBeforeSync,scope:a,destroyable:!0,priority:100})}},updateDependencyStore:function(b,c){var a=this;Ext.destroyMembers(a,'dependencyStoreDetacher');if(b&&b.autoSync){a.dependencyStoreDetacher=b.on({beforesync:a.onDependencyStoreBeforeSync,scope:a,destroyable:!0,priority:100})}},onEventStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onResourceStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onAssignmentStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onDependencyStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},removeNonPersistableRecordsToCreate:function(d){var a=d.create||[],c,b;for(b=a.length-1;b>=0;--b){c=a[b];if(!c.isPersistable()){Ext.Array.remove(a,c)}}if(a.length===0){delete d.create}},shallContinueSync:function(a){return Boolean(a.create&&a.create.length>0||a.update&&a.update.length>0||a.destroy&&a.destroy.length>0)}});Ext.define('Sch.data.util.ResourceEventsCache',{extend:'Sch.util.Cache',requires:['Ext.data.Model'],eventStore:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(b){var a=this,c=b.getResourceStore();a.callParent();function onEventAdd(c,b){Ext.Array.each(b,function(b){a.add(b.getResourceId(),b)})}function onEventRemove(c,b){Ext.Array.each(b,function(b){a.remove(b.getResourceId(),b)})}function onEventUpdate(g,b,h,f){var d=b.resourceIdField,c=b.previous&&d in b.previous,e=c&&b.previous[d];if(c){a.move(e,b.getResourceId(),b)}}function onEventStoreClearOrReset(){a.clear()}function onEventStoreResourceStoreChange(d,b,c){a.clear();attachToResourceStore(b)}function onResourceIdChanged(d,e,c,b){a.move(c,b)}function onResourceRemove(c,b){Ext.Array.each(b,function(b){a.clear(b)})}function onResourceStoreClearOrReset(){a.clear()}function attachToResourceStore(b){Ext.destroy(a.resourceStoreDetacher);a.resourceStoreDetacher=b&&b.on({idchanged:onResourceIdChanged,remove:onResourceRemove,clear:onResourceStoreClearOrReset,cacheresethint:onResourceStoreClearOrReset,rootchange:onResourceStoreClearOrReset,priority:100,destroyable:!0})}a.eventStoreDetacher=b.on({add:onEventAdd,remove:onEventRemove,update:onEventUpdate,clear:onEventStoreClearOrReset,cacheresethint:onEventStoreClearOrReset,rootchange:onEventStoreClearOrReset,resourcestorechange:onEventStoreResourceStoreChange,priority:100,destroyable:!0});a.eventStoreFiltersDetacher=b.getFilters().on('endupdate',onEventStoreClearOrReset,this,{priority:1002,destroyable:!0});attachToResourceStore(c);a.eventStore=b},destroy:function(){var a=this;Ext.destroyMembers(a,'eventStoreDetacher','eventStoreFiltersDetacher','resourceStoreDetacher');a.eventStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.eventStore.getRange(),function(b){return b.getResourceId()==a})};return c.callParent([a,b])}});Ext.define('Sch.data.mixin.EventStore',{extend:'Ext.Mixin',requires:['Sch.util.Date','Sch.data.util.IdConsistencyManager','Sch.data.util.ModelPersistencyManager','Sch.data.util.ResourceEventsCache'],isEventStore:!0,assignmentStore:null,resourceStore:null,resourceEventsCache:null,idConsistencyManager:null,modelPersistencyManager:null,mixinConfig:{after:{constructor:'constructor',destroy:'destroy'}},constructor:function(){var a=this;a.resourceEventsCache=a.createResourceEventsCache();a.idConsistencyManager=a.createIdConsistencyManager();a.modelPersistencyManager=a.createModelPersistencyManager()},destroy:function(){var a=this;Ext.destroyMembers(a,'resourceEventsCache','idConsistencyManager','modelPersistencyManager')},createResourceEventsCache:function(){return new Sch.data.util.ResourceEventsCache(this)},createIdConsistencyManager:function(){var a=this;return new Sch.data.util.IdConsistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},createModelPersistencyManager:function(){var a=this;return new Sch.data.util.ModelPersistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(b){var a=this,c=a.resourceStore;if(a.resourceStore){a.resourceStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(null)}a.resourceStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.resourceStore){a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(a.resourceStore);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(a.resourceStore);b.setEventStore(a)}if((c||b)&&c!==b){a.fireEvent('resourcestorechange',a,b,c)}},getAssignmentStore:function(){return this.assignmentStore},setAssignmentStore:function(b){var a=this,c=a.assignmentStore;if(a.assignmentStore){a.assignmentStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(null)}a.assignmentStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.assignmentStore){a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(a.assignmentStore);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(a.assignmentStore);a.assignmentStore.setEventStore(a);Ext.destroy(a.resourceEventsCache)}else {a.resourceEventsCache=a.createResourceEventsCache()}if((c||b)&&c!==b){a.fireEvent('assignmentstorechange',a,b,c)}},getDependencyStore:function(){return this.dependencyStore},setDependencyStore:function(b){var a=this,c=a.DependencyStore;if(a.dependencyStore){a.dependencyStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setDependencyStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setDependencyStore(null)}a.dependencyStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.dependencyStore){a.modelPersistencyManager&&a.modelPersistencyManager.setDependencyStore(a.dependencyStore);a.idConsistencyManager&&a.idConsistencyManager.setDependencyStore(a.dependencyStore);a.dependencyStore.setEventStore(a)}if((c||b)&&c!==b){a.fireEvent('dependencystorechange',a,b,c)}},isDateRangeAvailable:function(e,g,a,c){var f=Sch.util.Date,d=c?this.getEventsForResource(c):this.getRange(),b=!0;if(Sch.model.Assignment&&a instanceof Sch.model.Assignment){a=a.getEvent(this)}Ext.each(d,function(c){b=a===c||!f.intersectSpans(e,g,c.getStartDate(),c.getEndDate());return b});return b},getEventsInTimeSpan:function(b,d,e){var c=new Ext.util.MixedCollection();var a=[];if(e!==!1){var f=Sch.util.Date;this.forEachScheduledEvent(function(g,c,e){if(f.intersectSpans(c,e,b,d)){a.push(g)}})}else {this.forEachScheduledEvent(function(f,c,e){if(c-b>=0&&d-e>=0){a.push(f)}})}c.addAll(a);return c},getEventsByStartDate:function(c){var b=Sch.util.Date;var a=[];this.forEachScheduledEvent(function(e,d,f){if(b.compareWithPrecision(d,c,b.DAY)===0){a.push(e)}});return a},forEachScheduledEvent:function(b,a){this.each(function(c){var d=c.getStartDate(),e=c.getEndDate();if(d&&e){return b.call(a||this,c,d,e)}},this)},getTotalTimeSpan:function(){var a=Sch.util.Date.MAX_VALUE,b=Sch.util.Date.MIN_VALUE,c=Sch.util.Date;this.each(function(d){if(d.getStartDate()){a=c.min(d.getStartDate(),a)}if(d.getEndDate()){b=c.max(d.getEndDate(),b)}});a=a<Sch.util.Date.MAX_VALUE?a:null;b=b>Sch.util.Date.MIN_VALUE?b:null;this.lastTotalTimeSpan={start:a||null,end:b||a||null};return this.lastTotalTimeSpan},filterEventsForResource:function(a,d,c){var b=a.getEvents(this);return Ext.Array.filter(b,d,c||this)},append:function(a){throw 'Must be implemented by consuming class'},getResourcesForEvent:function(b){var c=this,d=c.getAssignmentStore(),e=c.getResourceStore(),a;if(d){a=d.getResourcesForEvent(b)}else {if(e){b=b instanceof Sch.model.Event&&b||c.getModelById(b);a=b&&e.getModelById(b.getResourceId());a=a&&[a]||[]}else {a=[]}}return a},getEventsForResource:function(d){var b=this,c=b.getAssignmentStore(),a;if(c){a=c.getEventsForResource(d)}else {if(b.resourceEventsCache){a=b.resourceEventsCache.get(d)}else {a=[]}}return a},getAssignmentsForEvent:function(b){var c=this,a=c.getAssignmentStore();return a&&a.getAssignmentsForEvent(b)||[]},getAssignmentsForResource:function(b){var c=this,a=c.getAssignmentStore();return a&&a.getAssignmentsForResource(b)||[]},assignEventToResource:function(b,a){var d=this,c=d.getAssignmentStore();if(c){c.assignEventToResource(b,a)}else {if(Ext.isArray(a)){a=a[0]}b=b instanceof Sch.model.Event&&b||d.getModelById(b);a=a instanceof Sch.model.Resource?a.getId():a;b&&b.setResourceId(a)}},unassignEventFromResource:function(a,b){var d=this,c=d.getAssignmentStore();if(c){c.unassignEventFromResource(a,b)}else {a=a instanceof Sch.model.Event&&a||d.getModelById(a);b=b instanceof Sch.model.Resource?b.getId():b;if(a&&(typeof b=='undefined'||a.getResourceId()==b)){a.setResourceId(null)}}},reassignEventFromResourceToResource:function(a,c,b){var g=this,d=g.getAssignmentStore();var e=b instanceof Sch.model.Resource?b.getId():b;var h=c instanceof Sch.model.Resource?c.getId():c;if(d){var f=d.getAssignmentForEventAndResource(a,c);if(f){f.setResourceId(e)}else {d.assignEventToResource(a,b)}}else {a=a instanceof Sch.model.Event&&a||g.getModelById(a);if(a.getResourceId()==h){a.setResourceId(e)}}},isEventAssignedToResource:function(a,b){var e=this,d=e.getAssignmentStore(),c;if(d){c=d.isEventAssignedToResource(a,b)}else {a=a instanceof Sch.model.Event&&a||e.getModelById(a);b=b instanceof Sch.model.Resource?b.getId():b;c=a&&a.getResourceId()==b||!1}return c},removeAssignmentsForEvent:function(a){var c=this,b=c.getAssignmentStore();if(b){b.removeAssignmentsForEvent(a)}else {a=a instanceof Sch.model.Event&&a||c.getModelById(a);a&&a.setResourceId(null)}},removeAssignmentsForResource:function(a){var b=this,c=b.getAssignmentStore(),d=b.getResourceStore();if(c){c.removeAssignmentsForResource(a)}else {if(d){a=a instanceof Sch.model.Resource&&a||d.getModelById(a);a&&Ext.Array.each(b.resourceEventsCache.get(a),function(a){a.setResourceId(null)})}else {a=a instanceof Sch.model.Resource?a.getId():a;Ext.Array.each(b.getRange(),function(b){b.getResourceId()==a&&b.setResourceId(null)})}}},isEventPersistable:function(f){var g=this,e=g.getAssignmentStore(),b,a,d,c=!0;if(!e){b=f.getResources();for(a=0,d=b.length;c&&a<d;++a){c=b[a].phantom!==!0}}return c}});Ext.define('Sch.model.Recurrence',{extend:'Sch.model.Customizable',idProperty:'Id',isRecurrenceModel:!0,customizableFields:[{name:'Frequency',defaultValue:'DAILY'},{name:'Interval',type:'int',defaultValue:1},{name:'EndDate',type:'date'},{name:'Count',type:'int',allowNull:!0},{name:'Days',convert:function(a,b){if(a){if(Ext.isString(a)){a=a.split(',')}}else {a=null}return a},isEqual:function(a,b){return String(a)===String(b)}},{name:'MonthDays',convert:function(a,b){if(a){if(Ext.isString(a)){a=Ext.Array.map(a.split(','),function(a){return parseInt(a,10)})}}else {a=null}return a},isEqual:function(a,b){return String(a)===String(b)}},{name:'Months',convert:function(a,b){if(a){if(Ext.isString(a)){a=Ext.Array.map(a.split(','),function(a){return parseInt(a,10)})}}else {a=null}return a},isEqual:function(a,b){return String(a)===String(b)}},{name:'Positions',convert:function(a,b){if(a){if(Ext.isString(a)){a=Ext.Array.map(a.split(','),function(a){return parseInt(a,10)})}}else {a=null}return a},isEqual:function(a,b){return String(a)===String(b)}}],frequencyField:'Frequency',intervalField:'Interval',endDateField:'EndDate',countField:'Count',daysField:'Days',monthDaysField:'MonthDays',monthsField:'Months',positionsField:'Positions',inheritableStatics:{DAILY:'DAILY',WEEKLY:'WEEKLY',MONTHLY:'MONTHLY',YEARLY:'YEARLY'},dateFormat:'Ymd\\THis\\Z',event:null,rule:null,suspendedEventNotifying:0,constructor:function(a){a=a||{};var b,c;if(a.event){c=a.event;delete a.event}if(a.rule){b=a.rule;delete a.rule}this.callParent(arguments);this.suspendEventNotifying();if(b){this.setRule(b)}this.resumeEventNotifying();this.event=c},sanitize:function(){var a=this,h=a.getFrequency(),f=a.getEvent(),b=f&&f.getStartDate();a.sanitizing=!0;switch(h){case 'DAILY':a.setPositions(null);a.setDays(null);a.setMonthDays(null);a.setMonths(null);break;case 'WEEKLY':a.setPositions(null);a.setMonthDays(null);a.setMonths(null);var e=a.getDays(),g=Sch.data.util.recurrence.DayRuleEncoder.encodeDay;if(b&&e&&e.length==1&&e[0]==g(b.getDay())){a.setDays(null)};break;case 'MONTHLY':if(a.getMonthDays()&&a.getMonthDays().length){a.setPositions(null);a.setDays(null)};a.setMonths(null);var c=a.getMonthDays();if(b&&c&&c.length==1&&c[0]==b.getDate()){a.setMonthDays(null)};break;case 'YEARLY':a.setMonthDays(null);var d=a.getMonths();if(b&&d&&d.length==1&&d[0]==b.getMonth()+1){a.setMonths(null)};break;}a.sanitizing=!1},copy:function(){var a=this.callParent(arguments);a.dateFormat=this.dateFormat;a.event=this.event;return a},set:function(b,c){this.callParent(arguments);if(!this.sanitizing){this.sanitize()}var a=this.getEvent();if(a&&!this.suspendedEventNotifying){a.onRecurrenceChanged()}},suspendEventNotifying:function(){this.suspendedEventNotifying++},resumeEventNotifying:function(){if(this.suspendedEventNotifying){this.suspendedEventNotifying--}},getEvent:function(){return this.event},setEvent:function(a){return this.event=a},getRule:function(){var a=this,b=[];if(a.getFrequency()){b.push('FREQ='+a.getFrequency());if(a.getInterval()>1){b.push('INTERVAL='+a.getInterval())}if(a.getDays()&&a.getDays().length){b.push('BYDAY='+a.getDays().join(','))}if(a.getMonthDays()&&a.getMonthDays().length){b.push('BYMONTHDAY='+a.getMonthDays().join(','))}if(a.getMonths()&&a.getMonths().length){b.push('BYMONTH='+a.getMonths().join(','))}if(a.getCount()){b.push('COUNT='+a.getCount())}if(a.getEndDate()){b.push('UNTIL='+Ext.Date.format(a.getEndDate(),a.dateFormat))}if(a.getPositions()&&a.getPositions().length){b.push('BYSETPOS='+a.getPositions().join(','))}}return b.join(';')},setRule:function(f){var a=this;if(f){a.beginEdit();var d=f.split(';');for(var c=0,g=d.length;c<g;c++){var e=d[c].split('='),b=e[1];switch(e[0]){case 'FREQ':a.setFrequency(b);break;case 'INTERVAL':a.setInterval(b);break;case 'COUNT':a.setCount(b);break;case 'UNTIL':a.setEndDate(Ext.Date.parse(b,a.dateFormat));break;case 'BYDAY':a.setDays(b);break;case 'BYMONTHDAY':a.setMonthDays(b);break;case 'BYMONTH':a.setMonths(b);break;case 'BYSETPOS':a.setPositions(b);break;}}a.endEdit()}}});Ext.define('Sch.data.util.DelayedCalls',{singleton:!0,mixins:['Ext.util.Observable'],delayedCallTimeout:100,delayedCalls:null,constructor:function(a){this.mixins.observable.constructor.call(this,a);Ext.apply(this,a)},cancel:function(){var e=this,a=e.delayedCalls;if(a){var d=arguments.length?arguments:Ext.Oject.getKeys(a);for(var c=d.length-1;c>=0;c--){var b=d[c];if(a[b]&&a[b].timer){clearTimeout(a[b].timer);a[b].timer=null}}}},execute:function(a){var b=a.scope,c;this.fireEvent('delayed-'+a.id+'-start',this,a);a.beforeFn&&a.beforeFn.call(b,a);var d=a.fn;while(c=a.entries.shift()){d.apply(b,c)}a.afterFn&&a.afterFn.call(b,a);this.fireEvent('delayed-'+a.id+'-end',this,a)},schedule:function(c){c=c||{};var a=this;a.delayedCalls=a.delayedCalls||{};var b=c.id||a.schedule.caller.$name;var e=c.args||[];if(!a.delayedCalls[b]){a.delayedCalls[b]=Ext.apply({scope:this},{id:b,entries:[]},c);delete a.delayedCalls[b].args}var d=a.delayedCalls[b];a.cancel(b);d.entries.push(e);d.timer=setTimeout(function(){a.execute(d);delete a.delayedCalls[b]},c.timeout||a.delayedCallTimeout);return d}});Ext.define('Sch.data.util.recurrence.AbstractIterator',{frequency:'NONE',MAX_OCCURRENCES_COUNT:1000000,getNthDayInPeriod:function(f,g,j,d){var a,b,e,c;if(d){var i=86400000,h=604800000;if(d>0){b=1;c=f}else {b=-1;c=g}e=j-c.getDay();if(b*e<0){d+=b}a=new Date(c.getTime()+(d-b)*h+e*i);if(a<f||a>g){a=null}}return a},buildDate:function(d,b,c){var a=new Date(d,b,c);if(a.getFullYear()==d&&a.getMonth()==b&&a.getDate()==c){return a}},isValidPosition:function(a){return Boolean(a)},forEachDateAtPositions:function(c,e,i,h){var g=c.length,f={};for(var d=0;d<e.length;d++){var a=e[d];if(this.isValidPosition(a)){var b=a>0?c[a-1]:c[g+a];if(b&&!f[b.getTime()]){f[b.getTime()]=!0;if(i.call(h,b)===!1){return !1}}}}}});Ext.define('Sch.data.util.recurrence.DailyIterator',{extend:'Sch.data.util.recurrence.AbstractIterator',requires:['Sch.util.Date'],singleton:!0,frequency:'DAILY',forEachDate:function(d){var l=this,e=d.recurrence,p=e.getEvent(),c=p.getStartDate(),f=d.startDate||c,h=e.getEndDate(),a=d.endDate||h,r=d.fn,q=d.scope||l,i=Sch.util.Date,k=e.getInterval(),g=e.getCount(),j=0;if(h&&a&&a>h){a=h}if(c>f){f=c}var o=f-c,n=k*86400000,m=Math.floor(o/n);if(!a&&!g){g=l.MAX_OCCURRENCES_COUNT}var b=i.add(c,i.DAY,m);while(!a||b<=a){j++;if(b>=f){if(a&&b>a||r.call(q,b,j)===!1||g&&j>=g){break}}b=i.add(b,i.DAY,k)}}});Ext.define('Sch.data.util.recurrence.DayRuleEncoder',{singleton:!0,dayParseRegExp:/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,decodeDay:function(c){var b,a;if(b=this.dayParseRegExp.exec(c)){a=[];switch(b[2]){case 'SU':a.push(0);break;case 'MO':a.push(1);break;case 'TU':a.push(2);break;case 'WE':a.push(3);break;case 'TH':a.push(4);break;case 'FR':a.push(5);break;case 'SA':a.push(6);break;}if(a){if(b[1]){b[1]=parseInt(b[1],10)}a.push(b[1])}}return a},encodeDay:function(b){var c;if(Ext.isArray(b)){b=b[0];c=b[1]}var a=c?c.toString():'';switch(b){case 0:a+='SU';break;case 1:a+='MO';break;case 2:a+='TU';break;case 3:a+='WE';break;case 4:a+='TH';break;case 5:a+='FR';break;case 6:a+='SA';break;}return a},decode:function(a){var d=[],c;if(a){for(var b=0;b<a.length;b++){if(c=this.decodeDay(a[b])){d.push(c)}}}return d},encode:function(a){var c=[],d;if(a){for(var b=0;b<a.length;b++){if(d=this.encodeDay(a[b])){c.push(d)}}}return c}});Ext.define('Sch.data.util.recurrence.WeeklyIterator',{extend:'Sch.data.util.recurrence.AbstractIterator',requires:['Sch.util.Date','Sch.data.util.recurrence.DayRuleEncoder'],singleton:!0,frequency:'WEEKLY',forEachDate:function(a){var n=this,c=Sch.util.Date,r=a.fn,q=a.scope||n,b=a.recurrence,p=a.event||b&&b.getEvent(),e=a.eventStartDate||p.getStartDate(),j=a.startDate||e,k=b&&b.getEndDate(),d=a.endDate||k,o=a.interval||b.getInterval(),g=Sch.data.util.recurrence.DayRuleEncoder.decode(a.days||b&&b.getDays()),h=a.count||b&&b.getCount(),l=0,f,i;if(k&&d&&d>k){d=k}if(g&&g.length){g.sort(function(a,b){return a[0]-b[0]})}else {g=[[e.getDay()]]}if(e>j){j=e}if(h){f=c.getNext(e,c.WEEK,0,0)}else {f=c.getNext(j,c.WEEK,0,0)}if(!d&&!h){h=n.MAX_OCCURRENCES_COUNT}while(!d||f<=d){for(var m=0;m<g.length;m++){i=c.copyTimeValues(c.add(f,c.DAY,g[m][0]),e);if(i>=e){l++;if(i>=j){if(d&&i>d||r.call(q,i,l)===!1||h&&l>=h){return}}}}f=c.getNext(f,c.WEEK,o,0)}}});Ext.define('Sch.data.util.recurrence.MonthlyIterator',{extend:'Sch.data.util.recurrence.AbstractIterator',requires:['Sch.util.Date','Sch.data.util.recurrence.DayRuleEncoder'],singleton:!0,frequency:'MONTHLY',getNthDayOfMonth:function(b,a){var d=null,c=Ext.Date.getDaysInMonth(b);if(a&&Math.abs(a)<=c){d=new Date(b.getFullYear(),b.getMonth(),a<0?c+a+1:a)}return d},isValidPosition:function(a){return a&&Math.abs(a)>0&&Math.abs(a)<=31},forEachDate:function(d){var r=this,e=Sch.util.Date,x=d.fn,w=d.scope||r,c=d.recurrence,A=d.event||c.getEvent(),g=d.eventStartDate||A.getStartDate(),m=d.startDate||g,q=c&&c.getEndDate(),f=d.endDate||q,y=d.interval||c.getInterval(),z=d.days||c&&c.getDays(),k=Sch.data.util.recurrence.DayRuleEncoder.decode(z),n=d.monthDays||c&&c.getMonthDays(),j=d.count||c&&c.getCount(),v=d.positions||c&&c.getPositions(),t=v&&v.length,h=0,p={},s,i,u,l,a,b;if(q&&f&&f>q){f=q}if(g>m){m=g}if(j){i=new Date(e.getNext(g,e.MONTH,0))}else {i=new Date(e.getNext(m,e.MONTH,0))}u=new Date(e.getNext(i,e.MONTH,1)-1);if(!(n&&n.length)&&!(k&&k.length)){n=[g.getDate()]}if(k&&k.length){Ext.each(k,function(a){if(a[1]){s=s||{};s[a[0]]=a[1]}})}top: while((!f||f>=i)&&(!j||h<j)){l=[];if(k&&k.length){Ext.each(k,function(c){var h=c[0],d=1,f=53;if(c[1]){d=f=c[1]}for(b=d;b<=f;b++){if(a=r.getNthDayInPeriod(i,u,h,b)){a=e.copyTimeValues(a,g);if(!p[a.getTime()]){p[a.getTime()]=!0;l.push(a)}}}});l.sort(function(a,b){return a-b});if(!t){for(b=0;b<l.length;b++){a=l[b];if(a>=g){h++;if(a>=m){if(f&&a>f||x.call(w,a,h)===!1||j&&h>=j){return !1}}}}}}else {var o=[];for(b=0;b<n.length;b++){if((a=r.getNthDayOfMonth(i,n[b]))&&!p[a.getTime()]){p[a.getTime()]=!0;o.push(a)}}o.sort(function(a,b){return a-b});for(b=0;b<o.length;b++){a=e.copyTimeValues(o[b],g);if(t){l.push(a)}else {if(a>=g){h++;if(a>=m){if(f&&a>f||x.call(w,a,h)===!1||j&&h>=j){break top}}}}}}if(t&&l.length){r.forEachDateAtPositions(l,v,function(a){if(a>=g){h++;if(a>=m&&(!f||a<=f)){if(x.call(w,a,h)===!1||j&&h>=j){return !1}}}})}i=e.getNext(i,e.MONTH,y);u=new Date(e.getNext(i,e.MONTH,1)-1)}}});Ext.define('Sch.data.util.recurrence.YearlyIterator',{extend:'Sch.data.util.recurrence.AbstractIterator',requires:['Sch.util.Date','Sch.data.util.recurrence.DayRuleEncoder'],singleton:!0,frequency:'YEARLY',forEachDate:function(c){var q=this,d=Sch.util.Date,w=c.fn,v=c.scope||q,b=c.recurrence,z=c.event||b.getEvent(),f=c.eventStartDate||z.getStartDate(),n=c.startDate||f,p=b&&b.getEndDate(),g=c.endDate||p,x=c.interval||b.getInterval(),y=c.days||b&&b.getDays(),k=Sch.data.util.recurrence.DayRuleEncoder.decode(y),m=c.months||b&&b.getMonths(),j=c.count||b&&b.getCount(),u=c.positions||b&&b.getPositions(),s=u&&u.length,h=0,o={},r,i,t,l,a,e;if(p&&g&&g>p){g=p}if(f>n){n=f}if(j){i=new Date(d.getNext(f,d.YEAR,0))}else {i=new Date(d.getNext(n,d.YEAR,0))}t=new Date(d.getNext(i,d.YEAR,1)-1);m&&m.sort(function(a,b){return a-b});if(!(m&&m.length)&&!(k&&k.length)){m=[f.getMonth()+1]}if(k&&k.length){Ext.each(k,function(a){if(a[1]){r=r||{};r[a[0]]=a[1]}})}top: while((!g||g>=i)&&(!j||h<j)){l=[];if(k&&k.length){Ext.each(k,function(b){var h=b[0],c=1,g=53;if(b[1]){c=g=b[1]}for(e=c;e<=g;e++){if(a=q.getNthDayInPeriod(i,t,h,e)){a=d.copyTimeValues(a,f);if(!o[a.getTime()]){o[a.getTime()]=!0;l.push(a)}}}});l.sort(function(a,b){return a-b});if(!s){for(e=0;e<l.length;e++){a=l[e];if(a>=f){h++;if(a>=n){if(g&&a>g||w.call(v,a,h)===!1||j&&h>=j){return !1}}}}}}else {for(e=0;e<m.length;e++){if(a=q.buildDate(i.getFullYear(),m[e]-1,f.getDate())){a=d.copyTimeValues(a,f);if(!o[a.getTime()]){o[a.getTime()]=!0;if(s){l.push(a)}else {if(a>=f){h++;if(a>=n){if(g&&a>g||w.call(v,a,h)===!1||j&&h>=j){break top}}}}}}}}if(s&&l.length){q.forEachDateAtPositions(l,u,function(a){if(a>=f){h++;if(a>=n&&(!g||a<=g)){if(w.call(v,a,h)===!1||j&&h>=j){return !1}}}})}i=d.getNext(i,d.YEAR,x);t=new Date(d.getNext(i,d.YEAR,1)-1)}}});Ext.define('Sch.data.mixin.RecurringEvents',{extend:'Ext.Mixin',requires:['Sch.model.Recurrence','Sch.data.util.DelayedCalls','Sch.data.util.recurrence.DailyIterator','Sch.data.util.recurrence.WeeklyIterator','Sch.data.util.recurrence.MonthlyIterator','Sch.data.util.recurrence.YearlyIterator'],isRecurringEventStore:!0,delayedCallTimeout:100,setupRecurringEvents:function(){this.recurrenceIterators=this.recurrenceIterators||[];this.addRecurrenceIterators(Sch.data.util.recurrence.DailyIterator,Sch.data.util.recurrence.WeeklyIterator,Sch.data.util.recurrence.MonthlyIterator,Sch.data.util.recurrence.YearlyIterator);this.relayEvents(Sch.data.util.DelayedCalls,['delayed-regenerate-occurrences-start','delayed-regenerate-occurrences-end','delayed-generate-occurrences-start','delayed-generate-occurrences-end']);this.mon(Sch.data.util.DelayedCalls,{'delayed-regenerate-occurrences-end':this.onDelayedRegenerateOccurrencesEnd,'delayed-generate-occurrences-end':this.onDelayedGenerateOccurrencesEnd,scope:this});this.on('destroy',this.onEventStoreDestroy,this)},onEventStoreDestroy:function(){Sch.data.util.DelayedCalls.cancel('generate-occurrences','regenerate-occurrences')},addRecurrenceIterators:function(){for(var a=0;a<arguments.length;a++){this.recurrenceIterators[arguments[a].frequency]=arguments[a]}},getRecurrenceIteratorForEvent:function(a){return this.recurrenceIterators[a.getRecurrence().getFrequency()]},buildOccurrencesForEvent:function(a,f,i,d){var b=[];if(a.isRecurring()&&a.getStartDate()){var j=this,e=a.getRecurrence(),h=j.getRecurrenceIteratorForEvent(a);var g=a.getEndDate()-a.getStartDate();var c=a.getExceptionDates()?Ext.Array.toMap(a.getExceptionDates(),function(a){return a-0}):{};h.forEachDate({recurrence:e,startDate:f,endDate:i,fn:function(e){if(!c[e-0]&&(!d||!a.getOccurrenceByStartDate(e))){b.push(a.buildOccurrence(e,g))}}})}return b},mergeDelayedCallEntries:function(m){var h=m.entries,j={},c,d,k,e,a;for(var b=0;b<h.length;b++){a=h[b];k=a[0];c=a[1];d=a[2];for(var l=0;l<k.length;l++){e=k[l];var g=j[e.getId()];if(g){if(g[1]>c){g[1]=c}if(g[2]<d){g[2]=d}}else {j[e.getId()]=[[e]].concat(a.slice(1))}}}h=Ext.Object.getValues(j);var f={};for(b=0;b<h.length;b++){a=h[b];e=a[0];c=a[1];d=a[2];var i=(c?c.getTime():'')+'-'+(d?d.getTime():'');if(f[i]){f[i][0]=f[i][0].concat(e)}else {f[i]=a}}m.entries=Ext.Object.getValues(f)},regenerateOccurrencesForEventsBuffered:function(a,d,e){var b=this;if(!Ext.isIterable(a)){a=[a]}a=Ext.Array.filter(a,function(a){return a.isRecurring()});if(a.length){var c=Sch.data.util.DelayedCalls.schedule({id:'regenerate-occurrences',timeout:b.delayedCallTimeout,beforeFn:b.mergeDelayedCallEntries,fn:function(d,e,f){var a=c.occurrencesToRemove=c.occurrencesToRemove||[];a.push.apply(a,b.getOccurrencesForEvents(d));b.generateOccurrencesForEvents(d,e,f,!1)},args:[a,d,e],afterFn:function(a){a.occurrencesToRemove.length&&b.remove(a.occurrencesToRemove)},scope:b})}},generateOccurrencesForEventsBuffered:function(a,d,e,c){var b=this;c=c!==!1;if(!Ext.isIterable(a)){a=[a]}a=Ext.Array.filter(a,function(a){return a.isRecurring()});if(a.length){Sch.data.util.DelayedCalls.schedule({id:'generate-occurrences',timeout:b.delayedCallTimeout,beforeFn:b.mergeDelayedCallEntries,fn:b.generateOccurrencesForEvents,args:[a,d,e,c],scope:b})}},generateOccurrencesForEvents:function(a,e,k,c){if(a){var b=this,j=[],d=[];c=c!==!1;if(!Ext.isIterable(a)){a=[a]}if(a.length){b.fireEvent('generate-occurrences-start',b,a,e,k,c);for(var l=0;l<a.length;l++){var f=a[l],g,h,i;if(j=b.buildOccurrencesForEvent(f,e,k,c)){i=f.getStartDate();if(e<=i){if(h=j.shift()){g=h.getStartDate();if(g-i){f.setStartEndDate(g,h.getEndDate());f.getRecurrence().sanitize()}}}d.push.apply(d,j)}}if(d.length){b.add(d)}b.fireEvent('generate-occurrences-end',b,a,d,e,k,c)}}},generateOccurrencesForAll:function(d,e,c){var a=this,b;if((b=a.getRecurringEvents())&&b.length){a.fireEvent('generate-occurrences-all-start',a,b,d,e,c);a.generateOccurrencesForEvents(b,d,e,c);a.fireEvent('generate-occurrences-all-end',a,b,d,e,c)}},getRecurringEvents:function(){var a=this;return a.queryBy(function(a){return a.isRecurrableEvent&&a.isRecurring()}).getRange()},getOccurrencesForEvents:function(a){var b=[];if(!Ext.isIterable(a)){a=[a]}if(a.length){for(var c=0;c<a.length;c++){var d=a[c].getId();b.push.apply(b,this.queryBy(function(a){return a.isRecurrableEvent&&a.getRecurringEventId()==d}).getRange())}}return b},getOccurrencesForAll:function(){return this.queryBy(function(a){return a.isRecurrableEvent&&a.isOccurrence()}).getRange()},removeOccurrencesForEvents:function(a){return this.remove(this.getOccurrencesForEvents(a))},removeOccurrencesForAll:function(){return this.remove(this.getOccurrencesForAll())},onDelayedRegenerateOccurrencesEnd:function(){this.fireEvent('occurrencesready',this)},onDelayedGenerateOccurrencesEnd:function(){this.fireEvent('occurrencesready',this)}});Ext.define('Sch.model.mixin.RecurrableEvent',{extend:'Ext.Mixin',requires:['Sch.model.Recurrence'],isRecurrableEvent:!0,recurringEventIdField:'RecurringEventId',recurrenceRuleField:'RecurrenceRule',exceptionDatesField:'ExceptionDates',customizableFields:[{name:'RecurringEventId'},{name:'RecurrenceRule',allowNull:!0,convert:function(a,b){if(Ext.isEmpty(a)){a=null}return a}},{name:'ExceptionDates',dateFormat:'c',convert:function(a,d){if(a){var b=this.dateFormat,c=this.useStrict;a=Ext.isString(a)?a.split(','):a;a=Ext.Array.map(a,function(a){if(!Ext.isDate(a)){a=Ext.Date.parse(a,b,c)}return a})}return a}}],recurrenceModel:'Sch.model.Recurrence',setRecurrence:function(c,g,d){var b=this,e,a,h;if(b.isOccurrence()){var f=b.getRecurringEvent();e=f&&f.getRecurrence();b.setRecurringEventId(null)}if(c){e&&e.setEndDate(new Date(b.getStartDate()-1));if(c.isRecurrenceModel){a=c}else {if(Ext.isObject(c)){a=new this.recurrenceModel(c)}else {a=new this.recurrenceModel();a.setFrequency(c);g&&a.setInterval(g);if(d){if(d instanceof Date){a.setEndDate(d)}else {a.setCount(d)}}}}a.setEvent(b);h=a.getRule()}b.recurrence=a;b.set(b.recurrenceRuleField,h)},getRecurrence:function(){var a=this,b=a.getRecurrenceRule();if(!a.recurrence&&b){a.recurrence=new a.recurrenceModel({rule:b,event:a})}return a.recurrence},isRecurring:function(){return this.getRecurrence()&&!this.isOccurrence()},isOccurrence:function(){return Boolean(this.getRecurringEventId())},getRecurringEvent:function(){var a=this.getRecurringEventId(),b=this.getEventStore();return a&&b&&b.getModelById(a)},getOccurrenceByStartDate:function(c){var d,a;if(c){a=this.getOccurrences();for(var b=0;b<a.length;b++){if(a[b].getStartDate()-c===0){d=a[b];break}}}return d},getOccurrences:function(){var a=this.getEventStore();return a&&a.getOccurrencesForEvents(this)},removeOccurrences:function(){var a=this.getEventStore();return a&&a.removeOccurrencesForEvents(this)},onRecurrenceChanged:function(){var a=this.getRecurrence();this.setRecurrenceRule(a&&a.getRule()||null)},buildOccurrence:function(c,b){b=b||this.getEndDate()-this.getStartDate();var a=this.copy(null);a.beginEdit();a.setStartEndDate(c,new Date(c.getTime()+b));a.setRecurringEventId(this.getId());a.endEdit();return a},setRecurrenceRule:function(b){var a=this,c;if(b!=a.getRecurrenceRule()){if(b){c=new a.recurrenceModel({rule:b,event:a})}a.recurrence=c;a.set(a.recurrenceRuleField,b)}},addExceptionDate:function(a){var b=this,c=b.getExceptionDates()||[];if(a){b.setExceptionDates(c.concat(a))}},beforeStartDateChange:function(){this._startDateValue=this.getStartDate()},afterStartDateChange:function(){if(this._startDateValue-this.getStartDate()&&this.getExceptionDates()){this.setExceptionDates()}},mixinConfig:{before:{setStartDate:'beforeStartDateChange',setStartEndDate:'beforeStartDateChange'},after:{setStartDate:'afterStartDateChange',setStartEndDate:'afterStartDateChange'},extended:function(d,c,b){var a=b.recurrenceModel;if(typeof a=='string'){Ext.require(a,function(){b.recurrenceModel=Ext.data.schema.Schema.lookupEntity(a);Ext.override(c,{recurrenceModel:Ext.data.schema.Schema.lookupEntity(a)})})}}},onClassMixedIn:function(a){var b=a.prototype.recurrenceModel||this.prototype.recurrenceModel;if(typeof b=='string'){Ext.require(b,function(){Ext.override(a,{recurrenceModel:Ext.data.schema.Schema.lookupEntity(b)})})}Ext.override(a,{isPersistable:function(){var a=this;return a.callParent(arguments)&&!a.isOccurrence()},set:function(a,b){if(typeof a=='string'?a==this.recurrenceRuleField:this.recurrenceRuleField in a){this.recurrence=null}return this.callParent(arguments)},customizableFields:(a.prototype.customizableFields||[]).concat(this.prototype.customizableFields)})}});Ext.define('Sch.model.Event',{extend:'Sch.model.Range',uses:['Sch.util.Date'],idProperty:'Id',mixins:['Sch.model.mixin.RecurrableEvent'],isEventModel:!0,customizableFields:[{name:'IconCls'},{name:'ResourceId'},{name:'Draggable',type:'boolean',persist:!1,defaultValue:!0},{name:'Resizable',persist:!1,defaultValue:!0},{name:'AllDay',defaultValue:!1}],resourceIdField:'ResourceId',draggableField:'Draggable',resizableField:'Resizable',allDayField:'AllDay',iconClsField:'IconCls',getInternalId:function(){return this.internalId},isHighlighted:!1,getEventStore:function(){var b=this,a=b.joined&&b.joined[0];if(a&&!a.isEventStore){Ext.Array.sort(b.joined,function(a,b){return (a.isEventStore||!1)>(b.isEventStore||!1)&&-1||1});a=b.joined[0];a=a.isEventStore?a:null}return a},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getResources:function(a){var b=this;a=a||b.getEventStore();return a&&a.getResourcesForEvent(b)||[]},forEachResource:function(d,c){var b=this.getResources();for(var a=0;a<b.length;a++){if(d.call(c||this,b[a])===!1){return}}},getResource:function(b){var d=this,a=null,c=d.getEventStore(),e=c&&c.getResourceStore();b=b==null?d.getResourceId():b;if(c&&(b===null||b===undefined)){a=c.getResourcesForEvent(d);if(a.length==1){a=a[0]}else {if(a.length>1){Ext.Error.raise('Event::getResource() is not applicable for events with multiple assignments, please use Event::getResources() instead.')}else {a=null}}}else {if(e){a=e.getModelById(b)}}return a},setResource:function(c){var a=this,b=a.getEventStore();b&&b.removeAssignmentsForEvent(a);a.assign(c)},assign:function(a){var b=this,c=b.getEventStore();if(a&&a.isResourceModel){a=a.getId()}if(c){c.assignEventToResource(b,a)}else {b.setResourceId(a)}},unassign:function(a){var b=this,c=b.getEventStore();if(a&&a.isResourceModel){a=a.getId()}if(c){c.unassignEventFromResource(b,a)}else {if(b.getResourceId()==a){b.setResourceId(null)}}},reassign:function(b,a){var c=this,d=c.getEventStore();if(b&&b.isResourceModel){b=b.getId()}if(a&&a.isResourceModel){a=a.getId()}if(d){d.reassignEventFromResourceToResource(c,b,a)}else {c.setResourceId(a)}},isAssignedTo:function(a){var c=this,d=c.getEventStore(),b=!1;if(a&&a.isResourceModel){a=a.getId()}if(d){b=d.isEventAssignedToResource(c,a)}else {b=c.getResourceId()==a}return b},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForEvent(b)},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){var b=this,a=b.getEventStore();return a&&a.isEventPersistable(b)},getStartDate:function(){var a=this.data[this.startDateField];if(this.getAllDay()){a=this.statics().getAllDayStartDate(a)}return a},getEndDate:function(){var a=this.data[this.endDateField];if(this.getAllDay()){a=this.statics().getAllDayEndDate(a)}return a},inheritableStatics:{getAllDayStartDate:function(a){if(a instanceof Sch.model.Event){a=a.get(a.startDateField)}if(a){a=Sch.util.Date.clearTime(a,!0)}return a},getAllDayEndDate:function(a){if(a instanceof Sch.model.Event){a=a.get(a.endDateField)}if(a&&(a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0||a.getMilliseconds()>0)){a=Sch.util.Date.getNext(a,'d',1)}return a},getAllDayDisplayStartDate:function(a){if(a instanceof Sch.model.Event){a=a.get(a.startDateField)}return Sch.util.Date.clearTime(a,!0)},getAllDayDisplayEndDate:function(b,a){var c=b;if(b instanceof Sch.model.Event){b=c.get(c.startDateField);a=c.get(c.endDateField)}b=Sch.model.Event.getAllDayDisplayStartDate(b);if(Sch.util.Date.clearTime(a,!0).valueOf()===a.valueOf()){a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1)}else {if(b.valueOf()!==a.valueOf()){a=Sch.util.Date.clearTime(a,!0)}}return a}}});Ext.define('Sch.data.EventStore',{extend:'Ext.data.Store',alias:'store.eventstore',mixins:['Sch.data.mixin.UniversalModelGetter','Sch.data.mixin.CacheHintHelper','Sch.data.mixin.EventStore','Robo.data.Store','Sch.data.mixin.RecurringEvents'],storeId:'events',model:'Sch.model.Event',config:{model:'Sch.model.Event'},constructor:function(b){var a=this;a.callParent([b]);a.resourceStore&&a.setResourceStore(a.resourceStore);a.assignmentStore&&a.setAssignmentStore(a.assignmentStore);if(a.getModel()!==Sch.model.Event&&!(a.getModel().prototype instanceof Sch.model.Event)){throw 'The model for the EventStore must subclass Sch.model.Event'}a.setupRecurringEvents()},append:function(a){this.add(a)}});Ext.define('Sch.data.mixin.ResourceStore',{eventStore:null,getEventStore:function(){return this.eventStore},setEventStore:function(b){var a=this,c;if(a.eventStore!==b){c=a.eventStore;a.eventStore=b&&Ext.StoreMgr.lookup(b)||null;a.fireEvent('eventstorechange',a,b,c)}},getScheduledEventsInTimeSpan:function(c,d,a){var b=[];var e=Sch.util.Date;a=a||this.getEventStore();Ext.Array.each(this.getRange(),function(e){Ext.Array.each(a.getEventsForResource(e),function(a){if(a.intersectsRange(c,d)){b.push(a)}})});return b}});Ext.define('Sch.model.Resource',{extend:'Sch.model.Customizable',isResourceModel:!0,idProperty:'Id',config:Ext.versions.touch?{idProperty:'Id'}:null,nameField:'Name',customizableFields:[{name:'Name',type:'string'}],getInternalId:function(){return this.internalId},getResourceStore:function(){return this.joined&&this.joined[0]||this.getTreeStore&&this.getTreeStore()},getEventStore:function(){var a=this.getResourceStore();return a&&a.getEventStore()||this.parentNode&&this.parentNode.getEventStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getEvents:function(a){var b=this;a=a||b.getEventStore();return a&&a.getEventsForResource(b)||[]},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForResource(b)},isPersistable:function(){var a=this.parentNode;return !a||!a.phantom||a.isRoot&&a.isRoot()},isAbove:function(f){var d=this,h=d.getResourceStore(),g=!1,a,c,e,b,i;if(d==f){g=!1}else {if(h&&h.isTreeStore){a=d;c=[];while(a){c.push(a);a=a.parentNode}a=f;e=[];while(a){e.push(a);a=a.parentNode}b=0;while(b<c.length-1&&b<e.length-1&&c[b]==e[b]){++b}i=c[b];d=c[b+1];f=e[b+1];g=i.indexOf(d)<i.indexOf(f)}else {g=h.indexOf(d)<h.indexOf(f)}}return g}});Ext.define('Sch.data.ResourceStore',{extend:'Ext.data.Store',model:'Sch.model.Resource',config:{model:'Sch.model.Resource'},alias:'store.resourcestore',mixins:['Sch.data.mixin.UniversalModelGetter','Sch.data.mixin.CacheHintHelper','Sch.data.mixin.ResourceStore','Robo.data.Store'],storeId:'resources',constructor:function(){this.callParent(arguments);if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw 'The model for the ResourceStore must subclass Sch.model.Resource'}}});Ext.define('Sch.patches.TreeStore',{extend:'Sch.util.Patch',target:'Ext.data.TreeStore',minVersion:'5.1.0',overrides:{remove:function(a){if(a.isModel){return a.remove()}else {if(a instanceof Array&&a[0].isModel){for(var b=0;b<a.length;b++){a[b].remove()}return a}else {return this.callParent(arguments)}}}}});Ext.define('Sch.patches.TreeStoreInternalIdMap',{extend:'Sch.util.Patch',target:'Ext.data.TreeStore',minVersion:'5.1.1',overrides:{registerNode:function(b,c){var a=this;if(!a.byInternalIdMap){a.byInternalIdMap={}}a.byInternalIdMap[b.internalId]=b;a.callParent(arguments)},unregisterNode:function(b,c){var a=this;if(a.byInternalIdMap){delete a.byInternalIdMap[b.internalId]}a.callParent(arguments)},updateRoot:function(){this.byInternalIdMap={};this.callParent(arguments)}}});Ext.define('Sch.data.mixin.FilterableTreeStore',{isFilteredFlag:!1,isHiddenFlag:!1,treeFilter:null,lastTreeFilter:null,lastTreeHiding:null,allowExpandCollapseWhileFiltered:!0,keepExpandStateWhileFiltered:!1,reApplyFilterOnDataChange:null,reapplyFilterOnDataChange:!0,suspendIncrementalFilterRefresh:0,filterGeneration:0,currentFilterGeneration:null,dataChangeListeners:null,monitoringDataChange:!1,filterUpdateSuspended:!1,onClassMixedIn:function(a){a.override(Sch.data.mixin.FilterableTreeStore.prototype.inheritables()||{})},initTreeFiltering:function(){if(this.reApplyFilterOnDataChange!=null){this.reapplyFilterOnDataChange=this.reApplyFilterOnDataChange}this.treeFilter=new Ext.util.Filter({filterFn:this.isNodeFilteredIn,scope:this});this.dataChangeListeners={nodeappend:this.onNeedToUpdateFilter,nodeinsert:this.onNeedToUpdateFilter,scope:this};Ext.apply(this.dataChangeListeners,{beforeload:this.onStoreBeforeLoad,load:this.onStoreLoad})},onStoreBeforeLoad:function(){this.filterUpdateSuspended=!0},onStoreLoad:function(){this.filterUpdateSuspended=!1;this.onNeedToUpdateFilter()},startDataChangeMonitoring:function(){if(this.monitoringDataChange){return}this.monitoringDataChange=!0;this.on(this.dataChangeListeners)},stopDataChangeMonitoring:function(){if(!this.monitoringDataChange){return}this.monitoringDataChange=!1;this.un(this.dataChangeListeners)},onNeedToUpdateFilter:function(){if(this.reapplyFilterOnDataChange&&!this.filterUpdateSuspended&&!this.suspendIncrementalFilterRefresh){this.reapplyFilter()}},clearTreeFilter:function(){if(!this.isTreeFiltered()){return}this.currentFilterGeneration=null;this.isFilteredFlag=!1;this.lastTreeFilter=null;if(!this.isTreeFiltered(!0)){this.stopDataChangeMonitoring()}this.refreshNodeStoreContent();this.fireEvent('filter-clear',this)},reapplyFilter:function(){if(this.isHiddenFlag){this.hideNodesBy.apply(this,this.lastTreeHiding.concat(this.isFilteredFlag))}if(this.isFilteredFlag){this.filterTreeBy(this.lastTreeFilter)}},reApplyFilter:function(){this.reapplyFilter()},refreshNodeStoreContent:function(){var a=this,b=a.getFilters();if(b.indexOf(a.treeFilter)<0){a.addFilter(a.treeFilter)}else {this.getFilters().fireEvent('endupdate',this.getFilters())}},getIndexInTotalDataset:function(a){var b=this.getRootNode(),e=-1;var d=this.rootVisible;if(!d&&a==b){return -1}var g=this.isTreeFiltered();var f=this.currentFilterGeneration;var c=function(h){if(g&&h.__filterGen!=f||h.hidden){if(h==a){return !1}}if(d||h!=b){e++}if(h==a){return !1}if(!h.isLeaf()&&h.isExpanded()){var j=h.childNodes,k=j.length;for(var i=0;i<k;i++){if(c(j[i])===!1){return !1}}}};c(b);return e},isTreeFiltered:function(a){return this.isFilteredFlag||a&&this.isHiddenFlag},markFilteredNodes:function(o,b){var p=this;var n=this.currentFilterGeneration;var a={};var i=this.getRootNode(),l=this.rootVisible;var c=function(c){var b=c.parentNode;while(b&&!a[b.internalId]){a[b.internalId]=!0;b=b.parentNode}};var g=b.filter;var h=b.scope||this;var f=b.shallow;var d=b.checkParents||f;var j=b.fullMatchingParents;var k=b.onlyParents||j;var m=!b.isOldFilter;if(k&&d){throw new Error("Can't combine `onlyParents` and `checkParents` options")}if(l){a[i.internalId]=!0}var e=function(b){if(b.hidden){return}var o,n,p,m;if(b.isLeaf()){if(g.call(h,b,a)){a[b.internalId]=!0;c(b)}}else {if(k){o=g.call(h,b);n=b.childNodes;p=n.length;if(o){a[b.internalId]=!0;c(b);if(j){b.cascadeBy(function(b){a[b.internalId]=!0});return}}for(m=0;m<p;m++){if(o&&n[m].isLeaf()){a[n[m].internalId]=!0}else {if(!n[m].isLeaf()){e(n[m])}}}}else {if(d){o=g.call(h,b,a);if(o){a[b.internalId]=!0;c(b)}}if(!d||!f||f&&(o||b==i&&!l)){n=b.childNodes;p=n.length;for(m=0;m<p;m++){e(n[m])}}}}};e(o);i.cascadeBy(function(b){if(m){b.addedWhileFiltered=!1}if(a[b.internalId]){b.__filterGen=n;if(!p.keepExpandStateWhileFiltered&&!b.isLeaf()){b.expand()}}})},filterTreeBy:function(a,c){this.currentFilterGeneration=this.filterGeneration++;var b;if(arguments.length==1&&Ext.isObject(arguments[0])){c=a.scope;b=a.filter}else {b=a;a={filter:b,scope:c}}this.fireEvent('nodestore-datachange-start',this);a=a||{};this.markFilteredNodes(this.getRootNode(),a);a.isOldFilter=!0;this.startDataChangeMonitoring();this.isFilteredFlag=!0;this.lastTreeFilter=a;this.fireEvent('nodestore-datachange-end',this);this.fireEvent('filter-set',this);this.refreshNodeStoreContent()},isNodeFilteredIn:function(a){var c=this.isTreeFiltered();var b=this.currentFilterGeneration;return this.loading||a.addedWhileFiltered&&a.isVisible()||!Boolean(c&&a.__filterGen!=b||a.hidden)},hasNativeFilters:function(){var c=this,a=c.getFilters(),b=a.getCount();return b&&b>1||a.indexOf(c.treeFilter)<0},hideNodesBy:function(c,b,d){var a=this;if(a.isFiltered()&&a.hasNativeFilters()){throw new Error("Can't hide nodes of a filtered tree store")}b=b||a;a.getRootNode().cascadeBy(function(d){d.hidden=Boolean(c.call(b,d,a))});a.startDataChangeMonitoring();a.isHiddenFlag=!0;a.lastTreeHiding=[c,b];if(!d){a.refreshNodeStoreContent()}},showAllNodes:function(a){this.getRootNode().cascadeBy(function(a){a.hidden=!1});this.isHiddenFlag=!1;this.lastTreeHiding=null;if(!this.isTreeFiltered(!0)){this.stopDataChangeMonitoring()}if(!a){this.refreshNodeStoreContent()}},inheritables:function(){return {onNodeExpand:function(a){if(this.isTreeFiltered(!0)&&a==this.getRoot()){this.callParent(arguments);this.reapplyFilter()}else {return this.callParent(arguments)}},onNodeCollapse:function(c,b){var a=this;var d=a.data;var g=d.contains;var h=a.isTreeFiltered();var e=a.currentFilterGeneration;d.contains=function(){var f,d,j;var k=a.indexOf(c)+1;var l=!1;for(var i=0;i<b.length;i++){if(!(b[i].hidden||h&&b[i].__filterGen!=e)&&g.call(this,b[i])){f=c;while(f.parentNode){d=f;do{d=d.nextSibling}while(d&&(d.hidden||h&&d.__filterGen!=e));if(d){l=!0;j=a.indexOf(d);break}else {f=f.parentNode}}if(!l){j=a.getCount()}a.removeAt(k,j-k);break}}return !1};this.callParent(arguments);if(this.isTreeFiltered()){if(a.needsLocalFilter()){b=Ext.Array.filter(b,a.filterVisible)}if(!b.length&&a.indexOf(c)!==-1){var f=a.indexOf(c)+1;var i=a.indexOfNextVisibleNode(c);a.removeAt(f,i-f)}}d.contains=g},handleNodeExpand:function(h,d,i){var e=this;var a=[];var g=e.isTreeFiltered();var f=e.currentFilterGeneration;for(var c=0;c<d.length;c++){var b=d[c];if(!(g&&b.__filterGen!=f||b.hidden)){a[a.length]=b}}return this.callParent([h,a,i])},onNodeInsert:function(g,a,n){var b=this,o=a.raw||a.data,m=b.removedNodes,j,e,c,h,f,d,i=this.isTreeFiltered();if(b.filterFn){var l=b.filterFn(a);a.set('visible',l);if(l){g.set('visible',b.filterFn(g))}}if(!this.reapplyFilterOnDataChange&&i){a.addedWhileFiltered=!0}b.registerNode(a,!0);b.beginUpdate();if(b.isVisible(a)||i&&a.addedWhileFiltered){if(n===0||!a.previousSibling){d=b.indexOf(g)}else {d=b.indexOfPreviousVisibleNode(a.previousSibling)}b.insert(d+1,a);if(!a.isLeaf()&&a.isExpanded()){if(a.isLoaded()){b.onNodeExpand(a,a.childNodes)}else {if(!b.fillCount){a.set('expanded',!1);a.expand()}}}}Ext.Array.remove(m,a);b.needsSync=b.needsSync||a.phantom||a.dirty;if(!a.isLeaf()&&!a.isLoaded()&&!b.lazyFill){j=b.getProxy().getReader();e=a.getProxy();c=e?e.getReader():null;h=c&&c.initialConfig.rootProperty?c:j;f=h.getRoot(o);if(f){var k=a.childType;b.fillNode(a,h.extractData(f,k?{model:k}:undefined))}}b.endUpdate()},isFiltered:function(){return this.callParent(arguments)||this.isTreeFiltered()},afterEdit:function(b,c){var a=this;a.getFilters();if(a.needsLocalFilter()&&a.reapplyFilterOnDataChange){a.doFilter(b)}Ext.data.Store.prototype.afterEdit.apply(a,[b,c])}}}});Ext.define('Sch.data.ResourceTreeStore',{extend:'Ext.data.TreeStore',requires:['Sch.patches.TreeStore','Sch.patches.TreeStoreInternalIdMap'],mixins:['Sch.data.mixin.UniversalModelGetter','Sch.data.mixin.CacheHintHelper','Sch.data.mixin.ResourceStore','Sch.data.mixin.FilterableTreeStore','Robo.data.Store'],alias:'store.resourcetreestore',model:'Sch.model.Resource',storeId:'resources',constructor:function(){this.callParent(arguments);this.initTreeFiltering();if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw 'The model for the ResourceTreeStore must subclass Sch.model.Resource'}},setRootNode:function(){this.isSettingRoot=!0;var a=this.callParent(arguments);this.isSettingRoot=!1;return a}});Ext.define('Sch.model.TimeAxisTick',{extend:'Sch.model.Range',isTimeAxisTickModel:!0,startDateField:'start',endDateField:'end'});Ext.define('Sch.data.TimeAxis',{extend:'Ext.data.JsonStore',requires:['Sch.util.Date','Sch.model.TimeAxisTick'],model:'Sch.model.TimeAxisTick',continuous:!0,originalContinuous:null,autoAdjust:!0,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,isConfigured:!1,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,presetName:null,mode:'plain',startTime:0,endTime:24,timeZone:null,constructor:function(b){var a=this;b=b||{};if(a.setModel){a.setModel(a.model)}a.setMode(b.mode||a.mode);a.originalContinuous=a.continuous;a.callParent(arguments);a.on(Ext.versions.touch?'refresh':'datachanged',function(){a.fireEvent('reconfigure',a,!1)});a.on('endreconfigure',function(a,b){a.fireEvent('reconfigure',a,b)});if(b.viewPreset){var c=Sch.preset.Manager.getPreset(b.viewPreset);c&&a.consumeViewPreset(c)}if(b.start||a.start){a.reconfigure(b)}},reconfigure:function(b,l){this.isConfigured=!0;Ext.apply(this,b);var f=this.getAdjustedDates(b.start,b.end,!0);var i=this.getAdjustedDates(b.start,b.end);var j=i.start;var k=i.end;if(this.fireEvent('beforereconfigure',this,j,k)!==!1){this._isTickLengthVarying=null;this._hasTimeZone=null;this.fireEvent('beginreconfigure',this);var c=this.unit;var d=this.increment||1;var g=this.generateTicks(j,k,c,d);this.removeAll(!0);this.suspendEvents();this.add(g);if(this.getCount()===0){Ext.Error.raise('Invalid time axis configuration or filter, please check your input data.')}this.resumeEvents();var h=Sch.util.Date;var a=g.length;if(this.isContinuous()){this.adjustedStart=f.start;this.adjustedEnd=this.hasTimeZone()?f.end:this.getNext(a>1?g[a-1].start:f.start,c,d)}else {this.adjustedStart=this.getStart();this.adjustedEnd=this.getEnd()}var e=h.getUnitDurationInMs(c)*d;if(this.hasTimeZone()){this.timezoneTickStart=1-(this.first().getEndDate()-this.first().getStartDate())/e;this.timezoneTickEnd=a-1+(this.last().getEndDate()-this.last().getStartDate())/e}do{this.visibleTickStart=(this.getStart()-this.adjustedStart)/e;if(this.visibleTickStart>=1){this.adjustedStart=h.getNext(this.adjustedStart,c,d,this.weekStartDay,this.timeZone)}}while(this.visibleTickStart>=1);do{this.visibleTickEnd=a-(this.adjustedEnd-this.getEnd())/e;if(a-this.visibleTickEnd>=1){this.adjustedEnd=h.getNext(this.adjustedEnd,c,-1,this.weekStartDay,this.timeZone)}}while(a-this.visibleTickEnd>=1);this.fireEvent('endreconfigure',this,l)}},isWeek:function(){return this.mode!=='plain'},hasTimeZone:function(){if(this._hasTimeZone==null){this._hasTimeZone=this.timeZone!=null&&Sch.util.Date.compareUnits(Sch.util.Date.DAY,this.unit)>=0&&(this.timeZone===0||(!this.first()||this.first()&&this.getStart().getTimezoneOffset()!==-this.timeZone))}return this._hasTimeZone},isUTCTimeZone:function(){return this.hasTimeZone()&&this.timeZone===0},roundDateInTimeZone:function(a,c){var d=this.isUTCTimeZone();if(!d){a=this.toTimeZone(a)}if(c){if(d&&c==='floor'){a=this.floorUTCDate(a)}else {if(c==='round'){var b=this.getStart();if(Sch.util.Date.compareUnits(Sch.util.Date.DAY,this.unit)<=0){if(d){b=this.floorUTCDate(b)}else {b=this.fromTimeZone(b)}}a=this.roundDate(a,b)}else {a=this[c+'Date'](a)}}}return a},isTickLengthVarying:function(){if(this._isTickLengthVarying==null){this._isTickLengthVarying=this.hasTimeZone()&&(this.unit===Sch.util.Date.DAY||this.unit===Sch.util.Date.HOUR&&this.timeZone%60!==0)}return this._isTickLengthVarying},setMode:function(a){this.mode=a;if(this.isWeek()){this.generateTicksValidatorFn=function(a){if(this.startTime>0||this.endTime<24){return a.getHours()>=this.startTime&&a.getHours()<this.endTime}else {return !0}}}else {this.generateTicksValidatorFn=function(){return !0}}},setTimeSpan:function(b,c,a){var d=this.getAdjustedDates(b,c);b=d.start;c=d.end;a=a===undefined?this.timeZone:a;if(this.getStart()-b!==0||this.getEnd()-c!==0||this.timeZone!=a){this.reconfigure({start:b,end:c,timeZone:a})}},setTimeZone:function(a){if(a!=null&&a!==this.timeZone){this.setTimeSpan(this.getStart(),this.getEnd(),a)}},filterBy:function(b,a){this.continuous=!1;a=a||this;this.clearFilter(!0);this.suspendEvents(!0);this.filter([{filterFn:function(d,c){return b.call(a,d.data,c)}}]);if(this.getCount()===0){this.clearFilter();this.resumeEvents();Ext.Error.raise('Invalid time axis filter - no ticks passed through the filter. Please check your filter method.')}this.resumeEvents()},isContinuous:function(){var a=this.continuous&&!this.isFiltered();if(this.isWeek()){a=a&&this.startTime===0&&this.endTime===24}return a},clearFilter:function(){this.continuous=this.originalContinuous;this.callParent(arguments)},generateTicks:function(b,e,g,c){var d=[],a,h=Sch.util.Date,f=0;g=g||this.unit;c=c||this.increment;var i=this.getAdjustedDates(b,e);b=i.start;e=i.end;while(b<e){a=this.getNext(b,g,c);if((!this.autoAdjust||this.hasTimeZone())&&a>e){a=e}if(g===h.HOUR&&c>1&&d.length>0&&f===0&&!this.isUTCTimeZone()){var j=d[d.length-1];f=(j.start.getHours()+c)%24-j.end.getHours();if(f!==0){a=h.add(a,h.HOUR,f)}}this.generateTicksValidatorFn(b)&&d.push({start:b,end:a});b=a}return d},getVisibleTickTimeSpan:function(){var a;if(this.hasTimeZone()&&this.isContinuous()){a=this.timezoneTickEnd-this.timezoneTickStart}else {if(this.isContinuous()){a=this.visibleTickEnd-this.visibleTickStart}else {a=this.getCount()}}return a},toTimeZone:function(a){a=new Date(a);if(this.hasTimeZone()){a=Sch.util.Date.toTimeZone(a,this.timeZone)}return a},fromTimeZone:function(a){a=new Date(a);if(this.hasTimeZone()){a=Sch.util.Date.fromTimeZone(a,this.timeZone)}return a},getAdjustedDates:function(b,a,i){var d=Sch.util.Date;b=b||this.getStart();a=a||d.add(b,this.mainUnit,this.defaultSpan);if(this.isWeek()){if(this.shiftUnit===d.MONTH){var h=d.add(b,d.WEEK,1);var g=d.add(a,d.WEEK,-1);if(!a){a=this.getNext(b,this.shiftUnit,1);a=this.ceilDate(a,!1,this.shiftUnit);a=this.ceilDate(a,!1,this.mainUnit)}if(h.getMonth()!==b.getMonth()&&g.getMonth()!==a.getMonth()){return {start:b,end:a}}}var e,c,f;e=this.floorDate(b,!1,this.shiftUnit,1);e=this.floorDate(e,!1,this.mainUnit,1);if(this.autoAdjust){f=this.getNext(b,this.shiftUnit,1);c=this.ceilDate(f,!1,this.shiftUnit);c=this.ceilDate(c,!1,this.mainUnit)}else {c=this.ceilDate(a,!1,this.shiftUnit);c=this.ceilDate(c,!1,this.mainUnit)}return {start:e,end:c}}else {return this.autoAdjust||i?{start:this.floorDate(b,!1,this.autoAdjust?this.mainUnit:this.unit,1),end:this.ceilDate(a,!1,this.autoAdjust?this.mainUnit:this.unit,1)}:{start:b,end:a}}},getTickFromDate:function(b){var a=this.data.items;var e=a.length-1;if(b.valueOf()<a[0].data.start.valueOf()||b.valueOf()>a[e].data.end.valueOf()){return -1}var f,d,g;if(this.isContinuous()&&!(this.hasTimeZone()&&this.isTickLengthVarying())){if(b-a[0].data.start===0){return this.visibleTickStart}if(b-a[e].data.end===0){return this.visibleTickEnd}var i=this.adjustedStart;var j=this.adjustedEnd;var c=Math.floor(a.length*(b-i)/(j-i));if(c>e){c=e}d=c===0?i:a[c].data.start;g=c==e?j:a[c].data.end;f=c+(b-d)/(g-d);if(f<this.visibleTickStart||f>this.visibleTickEnd){return -1}return f}else {for(var h=0;h<=e;h++){g=a[h].data.end;if(b<=g){d=a[h].data.start;f=h+(b>d?(b-d)/(g-d):0);return f}}}return -1},getDateFromTick:function(b,d){if(b===this.visibleTickEnd||!this.isContinuous()&&b===this.getCount()){return this.getEnd()}var a=Math.floor(b),h=b-a,g=this.getAt(a);if(!g){return null}var e=g.data;var f=a===0&&this.isContinuous()?this.adjustedStart:e.start;var i=a===this.getCount()-1&&this.isContinuous()?this.adjustedEnd:e.end;var c=Sch.util.Date.add(f,Sch.util.Date.MILLI,h*(i-f));if(d){c=this[d+'Date'](c)}return c},getTicks:function(){var a=[];this.each(function(b){a.push(b.data)});return a},getStart:function(){var a=this.first();if(a){return a.data.start}return null},getEnd:function(){var a=this.last();if(a){return a.data.end}return null},floorDate:function(k,f,j,m){f=f!==!1;var a=Ext.Date.clone(k),c=f?this.getStart():null,d=m||this.resolutionIncrement,h;if(j){h=j}else {h=f?this.resolutionUnit:this.mainUnit}var b=Sch.util.Date;var e=function(b,a){return Math.floor(b/a)*a};switch(h){case b.MILLI:if(f){a=b.add(c,b.MILLI,e(b.getDurationInMilliseconds(c,a),d))};break;case b.SECOND:if(f){a=b.add(c,b.MILLI,e(b.getDurationInSeconds(c,a),d)*1000)}else {a.setUTCMilliseconds(0);a.setUTCSeconds(e(a.getUTCSeconds(),d))};break;case b.MINUTE:if(f){a=b.add(c,b.SECOND,e(b.getDurationInMinutes(c,a),d)*60)}else {a.setUTCMinutes(e(a.getUTCMinutes(),d));a.setUTCSeconds(0);a.setUTCMilliseconds(0)};break;case b.HOUR:if(f){a=b.add(c,b.MINUTE,e(b.getDurationInHours(this.getStart(),a),d)*60)}else {a=this.floorUTCDate(a,h,d)};break;case b.DAY:if(f){a=b.add(c,b.DAY,e(b.getDurationInDays(c,a),d))}else {Sch.util.Date.clearTime(a);a.setDate(e(a.getDate()-1,d)+1)};break;case b.WEEK:var i=a.getDay()||7;var g=this.weekStartDay||7;Sch.util.Date.clearTime(a);a=b.add(a,b.DAY,i>=g?g-i:-(7-g+i));if(a.getDay()!==g&&a.getHours()===23){a=b.add(a,b.HOUR,1)};break;case b.MONTH:if(f){a=b.add(c,b.MONTH,e(b.getDurationInMonths(c,a),d))}else {Sch.util.Date.clearTime(a);a.setDate(1);a.setMonth(e(a.getMonth(),d))};break;case b.QUARTER:Sch.util.Date.clearTime(a);a.setDate(1);a=b.add(a,b.MONTH,-(a.getMonth()%3));break;case b.YEAR:if(f){a=b.add(c,b.YEAR,e(b.getDurationInYears(c,a),d))}else {var l=e(k.getFullYear()-1,d)+1;a=new Date(0,0,1);a.setFullYear(l)};break;}return a},floorUTCDate:function(e,b,f){var a=Ext.Date.clone(e),d=f||this.resolutionIncrement;if(!b){b=this.resolutionUnit}var c=Sch.util.Date;var g=function(b,a){return Math.floor(b/a)*a};switch(b){case c.HOUR:var h=g(a.getHours(),d)-a.getHours();a.setUTCHours(a.getUTCHours()+h,0,0,0);break;case c.DAY:a=c.clearUTCTime(a);a.setUTCDate(g(a.getUTCDate()-1,d)+1);break;default:a=this.floorDate(e,null,b,f);break;}return a},roundDate:function(x,b){var a=Ext.Date.clone(x),c=this.resolutionIncrement;b=b||this.getStart();var e=b.getTimezoneOffset()-a.getTimezoneOffset();switch(this.resolutionUnit){case Sch.util.Date.MILLI:var n=Sch.util.Date.getDurationInMilliseconds(b,a);var g=e*60*1000;var j=Math.round((n+g)/c)*c;a=Sch.util.Date.add(b,Sch.util.Date.MILLI,j-g);break;case Sch.util.Date.SECOND:var w=Sch.util.Date.getDurationInSeconds(b,a);var h=e*60;var l=Math.round((w+h)/c)*c;a=Sch.util.Date.add(b,Sch.util.Date.MILLI,(l-h)*1000);break;case Sch.util.Date.MINUTE:var u=Sch.util.Date.getDurationInMinutes(b,a);var k=Math.round((u+e)/c)*c;a=Sch.util.Date.add(b,Sch.util.Date.SECOND,(k-e)*60);break;case Sch.util.Date.HOUR:var s=Sch.util.Date.getDurationInHours(b,a);var i=e/60;var o=Math.round((s+i)/c)*c;a=Sch.util.Date.add(b,Sch.util.Date.MINUTE,(o-i)*60);break;case Sch.util.Date.DAY:var v=Sch.util.Date.getDurationInDays(b,a),q=Math.round(v/c)*c;a=Sch.util.Date.add(b,Sch.util.Date.DAY,q);if(this.hasTimeZone()){a=Sch.util.Date.add(a,Sch.util.Date.MINUTE,b.getTimezoneOffset()-a.getTimezoneOffset())};break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(a);var d=a.getDay()-this.weekStartDay,f;if(d<0){d=7+d};if(Math.round(d/7)===1){f=7-d}else {f=-d};a=Sch.util.Date.add(a,Sch.util.Date.DAY,f);break;case Sch.util.Date.MONTH:var r=Sch.util.Date.getDurationInMonths(b,a)+a.getDate()/Ext.Date.getDaysInMonth(a),m=Math.round(r/c)*c;a=Sch.util.Date.add(b,Sch.util.Date.MONTH,m);break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(a);a.setDate(1);a=Sch.util.Date.add(a,Sch.util.Date.MONTH,3-a.getMonth()%3);break;case Sch.util.Date.YEAR:var t=Sch.util.Date.getDurationInYears(b,a),p=Math.round(t/c)*c;a=Sch.util.Date.add(b,Sch.util.Date.YEAR,p);break;}return a},ceilDate:function(c,d,g,f){var a=Ext.Date.clone(c);d=d!==!1;f=f||(d?this.resolutionIncrement:1);var b=!1,e;if(g){e=g}else {e=d?this.resolutionUnit:this.mainUnit}switch(e){case Sch.util.Date.HOUR:if(a.getMinutes()>0||a.getSeconds()>0||a.getMilliseconds()>0){b=!0};break;case Sch.util.Date.DAY:if(a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0||a.getMilliseconds()>0){b=!0};break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(a);if(a.getDay()!==this.weekStartDay||c.getTime()-a.getTime()>0){b=!0};break;case Sch.util.Date.MONTH:Sch.util.Date.clearTime(a);if(a.getDate()!==1||c.getTime()-a.getTime()>0){b=!0};break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(a);if(a.getMonth()%3!==0||a.getDate()!==1||c.getTime()-a.getTime()>0){b=!0};break;case Sch.util.Date.YEAR:Sch.util.Date.clearTime(a);if(a.getMonth()!==0||a.getDate()!==1||c.getTime()-a.getTime()>0){b=!0};break;default:break;}if(b){return this.getNext(a,e,f)}else {return a}},getNext:function(b,c,a){return Sch.util.Date.getNext(b,c,a,this.weekStartDay,this.hasTimeZone()?this.timeZone:null)},getResolution:function(){return {unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(b,a){this.resolutionUnit=b;this.resolutionIncrement=a||1},shift:function(a,b){this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},shiftTo:function(a){var b=this.getEnd()-this.getStart(),c=new Date(a.getTime()+b);this.setTimeSpan(a,c)},shiftNext:function(a){a=a||this.getShiftIncrement();var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},shiftPrevious:function(a){a=-(a||this.getShiftIncrement());var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},getShiftUnit:function(){return this.shiftUnit||this.mainUnit},getShiftIncrement:function(){return this.shiftIncrement||1},getUnit:function(){return this.unit},getIncrement:function(){return this.increment},getRowTicks:function(){if(this.isWeek()){var b=this.getStart();var c=Sch.util.Date.add(b,this.headerConfig.middle.splitUnit,1);var a=this.findBy(function(a){return a.getStartDate().getTime()>=c.getTime()});if(a===-1){return this.getRange()}return this.getRange(0,a-1)}},dateInAxis:function(a,b){var h=!1;var e=this.getStart();var g=this.getEnd();if(this.isContinuous()){h=b?Sch.util.Date.betweenLesserEqual(a,e,g):Sch.util.Date.betweenLesser(a,e,g)}else {var j=this.getCount(),f,c;for(var d=0;d<j;d++){var i=this.getAt(d);f=i.data.start;c=i.data.end;if(b&&a<=c||!b&&a<c){return a>=f}}}return h},timeSpanInAxis:function(a,b){var c=this.getStart();var d=this.getEnd();var g=b-a;if(g===0){return this.dateInAxis(a,!0)}if(this.isContinuous()){return Sch.util.Date.intersectSpans(a,b,c,d)}else {var e=a<c&&b>d;if(e){return !0}var f=this.getTickFromDate(a);var h=this.getTickFromDate(b);return f!==h&&(a<d&&b>c)}},isRangeInAxis:function(a){var b=a.getStartDate(),c=a.getEndDate();if(!b||!c){return !1}return this.timeSpanInAxis(b,c)},forEachAuxInterval:function(h,g,f,c){c=c||this;var d=this.getEnd(),a=this.getStart(),e=0,b;if(a>d){throw new Error('Invalid time axis configuration')}while(a<d){b=Sch.util.Date.min(this.getNext(a,h,g||1),d);f.call(c,a,b,e);a=b;e++}},consumeViewPreset:function(a){Ext.apply(this,{unit:a.getBottomHeader().unit,increment:a.getBottomHeader().increment||1,resolutionUnit:a.timeResolution.unit,resolutionIncrement:a.timeResolution.increment,mainUnit:a.getMainHeader().unit,shiftUnit:a.shiftUnit,shiftIncrement:a.shiftIncrement||1,defaultSpan:a.defaultSpan||1,presetName:a.name,headerConfig:a.headerConfig})}});Ext.define('Sch.data.util.AssignmentStoreEventResourcesCache',{extend:'Sch.util.Cache',requires:['Ext.data.Model'],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(b){var a=this,c=b.getEventStore(),d=c&&c.getResourceStore();a.callParent();function onAssignmentAdd(e,d){var c=a.assignmentStore.getEventStore(),b=c&&c.getResourceStore();Ext.Array.each(d,function(c){var d=b&&b.getModelById(c.getResourceId());if(d){a.add(c.getEventId(),d)}else {a.clear(c.getEventId())}})}function onAssignmentRemove(e,d){var b=a.assignmentStore.getEventStore(),c=b&&b.getResourceStore();Ext.Array.each(d,function(b){var d=c.getModelById(b.getResourceId());if(d){a.remove(b.getEventId(),d)}else {a.clear(b.getEventId())}})}function onAssignmentUpdate(m,b,l){var h=b.resourceIdField,f=b.previous&&h in b.previous,e=f&&b.previous[h],j=b.eventIdField,g=b.previous&&j in b.previous,d=g&&b.previous[j],k=a.assignmentStore.getEventStore(),i=k&&k.getResourceStore(),c;if(f||g){e=f?e:b.getResourceId();d=g?d:b.getEventId();c=i.getModelById(e);if(c){a.remove(d,c)}else {a.clear(d)}c=i.getModelById(b.getResourceId());if(c){a.add(b.getEventId(),c)}else {a.clear(b.getEventId())}}}function onAssignmentStoreClearOrReset(b){a.clear()}function onAssignmentStoreEventStoreChange(c,b){a.clear();attachToEventStore(b);attachToResourceStore(b&&b.getResourceStore())}function onEventIdChanged(d,e,c,b){a.move(c,b)}function onEventRemove(c,b){Ext.Array.each(b,function(b){a.clear(b)})}function onEventStoreClearOrReset(){a.clear()}function onEventStoreResourceStoreChange(c,b){a.clear();attachToResourceStore(b)}function onResourceRemove(c,b){Ext.Array.each(b,function(b){a.uncache(b)})}function onResourceStoreClearOrReset(){a.clear()}function attachToEventStore(b){Ext.destroy(a.eventStoreDetacher);a.eventStoreDetacher=b&&b.on({idchanged:onEventIdChanged,remove:onEventRemove,clear:onEventStoreClearOrReset,cacheresethint:onEventStoreClearOrReset,rootchange:onEventStoreClearOrReset,resourcestorechange:onEventStoreResourceStoreChange,priority:100,destroyable:!0})}function attachToResourceStore(b){Ext.destory(a.resourceStoreDetacher);a.resourceStoreDetacher=b&&b.on({remove:onResourceRemove,clear:onResourceStoreClearOrReset,cacheresethint:onResourceStoreClearOrReset,rootchange:onResourceStoreClearOrReset,priority:100,destroyable:!0})}a.assignmentStoreDetacher=b.on({add:onAssignmentAdd,remove:onAssignmentRemove,update:onAssignmentUpdate,clear:onAssignmentStoreClearOrReset,cacheresethint:onAssignmentStoreClearOrReset,priority:100,destroyable:!0});a.assignmentStore=b},destroy:function(){var a=this;Ext.destroyMembers(a,'assignmentStoreDetacher','eventStoreDetacher','resourceStoreDetacher');a.assignmentStore=null},get:function(c,a){var b=this;a=a||function(){return b.assignmentStore.mapAssignmentsForEvent(c,function mapper(a){return a.getResource()},function filter(a){return !!a})};return b.callParent([c,a])}});Ext.define('Sch.data.util.AssignmentStoreResourceEventsCache',{extend:'Sch.util.Cache',requires:['Ext.data.Model'],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(b){var a=this,c=b.getEventStore(),d=c&&c.getResourceStore();a.callParent();function onAssignmentAdd(d,c){var b=a.assignmentStore.getEventStore();Ext.Array.each(c,function(c){var d=b&&b.getModelById(c.getEventId());if(d){a.add(c.getResourceId(),d)}else {a.clear(c.getResourceId())}})}function onAssignmentRemove(d,c){var b=a.assignmentStore.getEventStore();Ext.Array.each(c,function(c){var d=b&&b.getModelById(c.getEventId());if(d){a.remove(c.getResourceId(),d)}else {a.clear(c.getResourceId())}})}function onAssignmentUpdate(l,b,k){var i=b.resourceIdField,f=b.previous&&i in b.previous,d=f&&b.previous[i],j=b.eventIdField,h=b.previous&&j in b.previous,g=h&&b.previous[j],e=a.assignmentStore.getEventStore(),c;if(f||h){d=f?d:b.getResourceId();g=h?g:b.getEventId();c=e&&e.getModelById(g);if(c){a.remove(d,c)}else {a.clear(d)}c=e&&e.getModelById(b.getEventId());if(c){a.add(b.getResourceId(),c)}else {a.clear(b.getResourceId())}}}function onAssignmentStoreClearOrReset(b){a.clear()}function onAssignmentStoreEventStoreChange(c,b){a.clear();attachToEventStore(b);attachToResourceStore(b&&b.getResourceStore())}function onEventRemove(c,b){Ext.Array.each(b,function(b){a.uncache(b)})}function onEventStoreClearOrReset(){a.clear()}function onEventStoreResourceStoreChange(c,b){a.clear();attachToResourceStore(b)}function onResourceIdChanged(d,e,c,b){a.move(c,b)}function onResourceRemove(c,b){Ext.Array.each(b,function(b){a.clear(b)})}function onResourceStoreClearOrReset(){a.clear()}function attachToEventStore(b){Ext.destroy(a.eventStoreDetacher);a.eventStoreDetacher=b&&b.on({remove:onEventRemove,cacheresethint:onEventStoreClearOrReset,clear:onEventStoreClearOrReset,rootchange:onEventStoreClearOrReset,resourcestorechange:onEventStoreResourceStoreChange,priority:100,destroyable:!0})}function attachToResourceStore(b){Ext.destroy(a.resourceStoreDetacher);a.resourceStoreDetacher=b&&b.on({idchanged:onResourceIdChanged,remove:onResourceRemove,cacheresethint:onResourceStoreClearOrReset,clear:onResourceStoreClearOrReset,rootchange:onResourceStoreClearOrReset,priority:100,destroyable:!0})}a.assignmentStoreDetacher=b.on({add:onAssignmentAdd,remove:onAssignmentRemove,update:onAssignmentUpdate,cacheresethint:onAssignmentStoreClearOrReset,clear:onAssignmentStoreClearOrReset,eventstorechange:onAssignmentStoreEventStoreChange,priority:100,destroyable:!0});attachToEventStore(c);attachToResourceStore(d);a.assignmentStore=b},destroy:function(){var a=this;Ext.destroyMembers(a,'assignmentStoreDetacher','eventStoreDetacher','resourceStoreDetacher');a.assignmentStore=null},get:function(c,a){var b=this;a=a||function(){return b.assignmentStore.mapAssignmentsForResource(c,function mapper(a){return a.getEvent()},function filter(a){return !!a})};return b.callParent([c,a])}});Ext.define('Sch.data.util.recurrence.Legend',{requires:['Sch.data.util.recurrence.DayRuleEncoder'],mixins:['Sch.mixin.Localizable'],singleton:!0,allDaysValue:'SU,MO,TU,WE,TH,FR,SA',workingDaysValue:'MO,TU,WE,TH,FR',nonWorkingDaysValue:'SU,SA',getLegend:function(d,p){var a=this,s=Sch.data.util.recurrence.DayRuleEncoder,k=Ext.String.format,r=d.getEvent(),g=p||r.getStartDate(),c=d.getInterval(),b=d.getDays(),j=d.getMonthDays(),h=d.getMonths(),f=d.getPositions(),i='',e='',m;switch(d.getFrequency()){case 'DAILY':i=c==1?a.L('Daily'):k(a.L('Every {0} days'),c);break;case 'WEEKLY':if(b&&b.length){e=a.getDaysLegend(b)}else {if(g){e=Ext.Date.dayNames[g.getDay()]}};i=k(c==1?a.L('Weekly on {1}'):a.L('Every {0} weeks on {1}'),c,e);break;case 'MONTHLY':if(b&&b.length&&f&&f.length){e=a.getDaysLegend(b,f)}else {if(j&&j.length){j.sort(function(a,b){return a-b});e=a.arrayToText(j)}else {if(g){e=g.getDate()}}};i=k(c==1?a.L('Monthly on {1}'):a.L('Every {0} months on {1}'),c,e);break;case 'YEARLY':var o=b&&b.length&&f&&f.length,q=h&&h.length,l,n;n=o?a.getDaysLegend(b,f):g.getDate();if(q){h.sort(function(a,b){return a-b});if(h.length>2){m=function(a){return Ext.Date.getShortMonthName(a-1)}}else {m=function(a){return Ext.Date.monthNames[a-1]}}l=a.arrayToText(h,m)}else {l=Ext.Date.monthNames[g.getMonth()]};i=k(c==1?a.L('Yearly on {1} of {2}'):a.L('Every {0} years on {1} of {2}'),c,n,l);break;}return i},getDaysLegend:function(c,e){var a=this,d=Sch.data.util.recurrence.DayRuleEncoder,g='',b='',f;if(e&&e.length){g=a.arrayToText(e,function(b){return a.L('position'+b)})}if(c.length){c.sort(function(a,b){return d.decodeDay(a)[0]-d.decodeDay(b)[0]});var h=c.join(',');switch(h){case a.allDaysValue:b=a.L('day');break;case a.workingDaysValue:b=a.L('weekday');break;case a.nonWorkingDaysValue:b=a.L('weekend day');break;default:if(c.length>2){f=function(a){return Ext.Date.getShortDayName(d.decodeDay(a)[0])}}else {f=function(a){return Ext.Date.dayNames[d.decodeDay(a)[0]]}};b=a.arrayToText(c,f);}}return Ext.String.format(a.L('daysFormat'),g,b)},arrayToText:function(c,g,d,b){d=d||this.L(', ');b=b||this.L(' and ');var e='',f='';for(var a=0,h=c.length;a<h;){e+=f+(g?g(c[a]):c[a]);a++;f=a==h-1?b:d}return e}});Ext.define('Sch.eventlayout.Horizontal',{nbrOfBandsByResource:null,bandIndexToPxConvertFn:null,bandIndexToPxConvertScope:null,constructor:function(a){Ext.apply(this,a);this.nbrOfBandsByResource={}},clearCache:function(a){if(a){delete this.nbrOfBandsByResource[a.internalId]}else {this.nbrOfBandsByResource={}}},getNumberOfBands:function(b,a){var c=this.nbrOfBandsByResource;if(c.hasOwnProperty(b.internalId)){return c[b.internalId]}var d=Ext.isFunction(a)?a():a;var e=Ext.Array.map(d,function(a){return {start:a.getStartDate(),end:a.getEndDate(),event:a}});return this.applyLayout(e,b)},applyLayout:function(c,b){var a=c.slice();var d=this;a.sort(function(a,b){return d.sortEvents(a.event,b.event)});return this.nbrOfBandsByResource[b.internalId]=this.layoutEventsInBands(a)},sortEvents:function(c,d){var a=c.getStartDate();var b=d.getStartDate();var e=a-b===0;if(e){return c.getEndDate()>d.getEndDate()?-1:1}else {return a<b?-1:1}},layoutEventsInBands:function(b){var c=0;do{var a=b[0];while(a){a.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,c,a.event);Ext.Array.remove(b,a);a=this.findClosestSuccessor(a,b)}c++}while(b.length>0);return c},findClosestSuccessor:function(d,b){var f=Infinity,e,h=d.end,c,g=d.end-d.start===0;for(var a=0,i=b.length;a<i;a++){c=b[a].start-h;if(c>=0&&c<f&&(c>0||b[a].end-b[a].start>0||!g)){e=b[a];f=c}}return e}});Ext.define('Sch.eventlayout.Table',{extend:'Sch.eventlayout.Horizontal',timeAxisViewModel:null,layoutEventsInBands:function(b){var e=this.timeAxisViewModel;var d=e.timeAxis;var c=0;do{var a=b[0];while(a){a.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,c,a.event);var h=Math.floor(d.getTickFromDate(a.start));var g=this.timeAxisViewModel.getPositionFromDate(d.getAt(h).getStartDate());var f=this.timeAxisViewModel.getTickWidth();a.left=g;a.width=f;Ext.Array.remove(b,a);a=this.findClosestSuccessor(a,b)}c++}while(b.length>0);return c},findClosestSuccessor:function(e,b){var c=this.timeAxisViewModel.timeAxis;var d=Math.floor(c.getTickFromDate(e.start));var f=c.getAt(d);for(var a=0,g=b.length;a<g;a++){if(b[a].start>=f.getEndDate()){return b[a]}}}});Ext.define('Sch.eventlayout.Vertical',{requires:['Sch.util.Date'],view:null,constructor:function(a){Ext.apply(this,a)},applyLayout:function(a,i){if(a.length===0){return}var l=this;a.sort(function(a,b){return l.sortEvents(a.event,b.event)});var e,f,c;for(var b=0,h=a.length;b<h;b++){f=a[b];e=this.findStartSlot(a,f);var d=this.getCluster(a,b);if(d.length>1){f.left=e.start;f.width=e.end-e.start;c=1;while(c<d.length-1&&d[c+1].start-f.start===0){c++}var k=this.findStartSlot(a,d[c]);if(k&&k.start<0.8){d=d.slice(0,c)}}var g=d.length,j=(e.end-e.start)/g;for(c=0;c<g;c++){d[c].width=j;d[c].left=e.start+c*j}b+=g-1}for(b=0,h=a.length;b<h;b++){a[b].width=a[b].width*i;a[b].left=this.view.barMargin+a[b].left*i}},findStartSlot:function(c,d){var a=this.getPriorOverlappingEvents(c,d),b;if(a.length===0){return {start:0,end:1}}for(b=0;b<a.length;b++){if(b===0&&a[0].left>0){return {start:0,end:a[0].left}}else {if(a[b].left+a[b].width<(b<a.length-1?a[b+1].left:1)){return {start:a[b].left+a[b].width,end:b<a.length-1?a[b+1].left:1}}}}return !1},getPriorOverlappingEvents:function(b,d){var g=Sch.util.Date,e=d.start,f=d.end,c=[];for(var a=0,h=Ext.Array.indexOf(b,d);a<h;a++){if(g.intersectSpans(e,f,b[a].start,b[a].end)){c.push(b[a])}}c.sort(this.sortOverlappers);return c},sortOverlappers:function(a,b){return a.left<b.left?-1:1},getCluster:function(a,c){if(c>=a.length-1){return [a[c]]}var g=[a[c]],d=a[c].start,e=a[c].end,h=a.length,f=Sch.util.Date,b=c+1;while(b<h&&f.intersectSpans(d,e,a[b].start,a[b].end)){g.push(a[b]);d=f.max(d,a[b].start);e=f.min(a[b].end,e);b++}return g},sortEvents:function(c,d){var a=c.getStartDate(),f=c.getEndDate();var b=d.getStartDate(),g=d.getEndDate();var e=a-b===0;if(e){return f>g?-1:1}else {return a<b?-1:1}}});Ext.define('Sch.feature.AbstractTimeSpan',{extend:'Ext.AbstractPlugin',mixins:{observable:'Ext.util.Observable'},lockableScope:'top',schedulerView:null,timeAxis:null,expandToFitView:!1,disabled:!1,cls:null,clsField:'Cls',template:null,store:null,renderElementsBuffered:!1,renderDelay:0,refreshSizeOnItemUpdate:!0,_renderTimer:null,showHeaderElements:!1,headerTemplate:null,innerHeaderTpl:null,headerContainerCls:'sch-header-secondary-canvas',headerContainerEl:null,renderingDoneEvent:null,constructor:function(a){this.uniqueCls=this.uniqueCls||'sch-timespangroup-'+Ext.id();Ext.apply(this,a);this.mixins.observable.constructor.call(this);this.callParent(arguments)},init:function(a){if(Ext.versions.touch&&!a.isReady()){a.on('viewready',function(){this.init(a)},this);return}if(typeof this.innerHeaderTpl==='string'){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}var b=this.innerHeaderTpl;if(!this.headerTemplate){this.headerTemplate=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="{cls}" title="{[values.Name || values.Text || ""]}" style="{side}:{position}px;">'+(b?'{[this.renderInner(values)]}':'')+'</div>','</tpl>',{renderInner:function(a){return b.apply(a)}})}this.schedulerView=a.getSchedulingView();this.panel=a;this.timeAxis=a.getTimeAxis();this.store=Ext.StoreManager.lookup(this.store);if(!this.store){Ext.Error.raise('Error: You must define a store for this plugin')}if(this.showHeaderElements){this.panel.on({horizontaltimeaxiscolumnrender:this.renderHeaderElements,scope:this})}if(!this.schedulerView.getEl()){this.schedulerView.on({viewready:this.onViewReady,scope:this})}else {this.onViewReady()}},setDisabled:function(a){if(a){this.removeElements()}this.disabled=a},removeElements:function(){this.removeBodyElements();if(this.showHeaderElements){this.removeHeaderElements()}},getBodyElements:function(){var a=this.getContainerEl();if(a){return a.select('.'+this.uniqueCls)}return null},getHeaderContainerEl:function(){var a=this.headerContainerEl,d=Ext.baseCSSPrefix,b;if(!a||!a.dom){if(this.schedulerView.isHorizontal()){var c=this.panel.getHorizontalTimeAxisColumn();if(c.headerView){b=c.headerView.containerEl}else {return null}}else {b=this.panel.lockedGrid.getView().el}if(b){a=b.down('.'+this.headerContainerCls);if(!a){a=b.appendChild({cls:this.headerContainerCls})}this.headerContainerEl=a}}return a},getHeaderElements:function(){var a=this.getHeaderContainerEl();if(a){return a.select('.'+this.uniqueCls)}return null},removeBodyElements:function(){var a=this.getBodyElements();if(a){a.each(function(a){a.destroy()})}},removeHeaderElements:function(){var a=this.getHeaderElements();if(a){a.each(function(a){a.destroy()})}},getElementId:function(a){return this.uniqueCls+'-'+a.internalId},getHeaderElementId:function(a){return this.uniqueCls+'-header-'+a.internalId},getTemplateData:function(a){return this.prepareTemplateData?this.prepareTemplateData(a):a.data},getElementCls:function(b,a){var c=b.clsField||this.clsField;if(!a){a=this.getTemplateData(b)}return this.cls+' '+this.uniqueCls+' '+(a[c]||'')},getHeaderElementCls:function(b,a){var c=b.clsField||this.clsField;if(!a){a=this.getTemplateData(b)}return 'sch-header-indicator '+this.uniqueCls+' '+(a[c]||'')},getContainerEl:function(){return this.schedulerView.getSecondaryCanvasEl()},onViewReady:function(b){var a=this.schedulerView;this.storeListeners={load:this.renderElements,datachanged:this.renderElements,clear:this.renderElements,update:this.refreshSingle,scope:this};this.store.on(this.storeListeners);this.panel.on({beforemodechange:this.onTimelinePanelBeforeModeChange,modechange:this.onTimelinePanelModeChange,scope:this});this.viewListeners={refresh:this.renderElements,scope:this};this.headerListeners={afterlayout:this.renderElements,scope:this};if(a.isWeekView()){a.headerCt.on(this.headerListeners)}else {a.on(this.viewListeners);this.renderElements()}},onTimelinePanelBeforeModeChange:function(){var a=this.schedulerView;if(a.isWeekView()){a.headerCt.un(this.headerListeners)}else {this.schedulerView.un(this.viewListeners)}},onTimelinePanelModeChange:function(){var a=this.schedulerView;if(a.isWeekView()){a.headerCt.on(this.headerListeners)}else {a.on(this.viewListeners)}this.forceNewRenderingTimeout()},forceNewRenderingTimeout:function(){this.renderElementsBuffered=!1;clearTimeout(this._renderTimer);this.renderElements()},renderElements:function(){if(this.renderElementsBuffered||this.disabled){return}this.renderElementsBuffered=!0;clearTimeout(this._renderTimer);this._renderTimer=Ext.Function.defer(this.renderElementsInternal,this.renderDelay,this)},setElementX:function(a,b){if(this.panel.rtl){a.setRight(b)}else {a.setLeft(b)}},getHeaderElementPosition:function(b){var a=this.schedulerView.getTimeAxisViewModel();return Math.round(a.getPositionFromDate(b))},renderBodyElementsInternal:function(b){var c=this.timeAxis.getStart(),d=this.timeAxis.getEnd(),a=this.getElementData(c,d,b);if(a){this.template.append(this.getContainerEl(),a)}},getHeaderElementData:function(b,a){throw 'Abstract method call'},renderHeaderElements:function(b){var a=this.getHeaderContainerEl();if(a){var c=this.getHeaderElementData(b);this.headerTemplate.append(a,c)}},renderElementsInternal:function(){this.renderElementsBuffered=!1;var a=this.schedulerView;if(this.disabled||a.isDestroyed||!this.getContainerEl()||a.store.getCount()===0){return}if(a.isWeekView()){var b=a.getColumnManager().getColumns();if(b[0]&&!b[0].rendered){return}}this.removeElements();this.renderBodyElementsInternal();if(this.showHeaderElements){this.headerContainerEl=null;this.renderHeaderElements()}if(this.renderingDoneEvent){this.fireEvent(this.renderingDoneEvent,this)}},getElementData:function(a,d,c,b){throw 'Abstract method call'},updateBodyElement:function(c){var b=Ext.get(this.getElementId(c));if(b){var d=this.timeAxis.getStart(),e=this.timeAxis.getEnd(),a=this.getElementData(d,e,[c])[0];if(a){b.dom.className=a.$cls;b.setTop(a.top);this.setElementX(b,a.left);b.setSize(a.width,a.height)}else {Ext.destroy(b)}}else {this.renderBodyElementsInternal([c])}},updateHeaderElement:function(c){var a=Ext.get(this.getHeaderElementId(c));if(a){var b=this.getHeaderElementData([c])[0];if(b){a.dom.className=b.cls;if(this.schedulerView.isHorizontal()){this.setElementX(a,b.position);a.setWidth(b.size)}else {a.setTop(b.position);a.setHeight(b.size)}}else {Ext.destroy(a)}}else {this.renderHeaderElements([c])}},destroy:function(){clearTimeout(this._renderTimer);this.store.un(this.storeListeners);if(this.store.autoDestroy){this.store.destroy()}},refreshSingle:function(b,a){a=a instanceof Array?a:[a];Ext.Array.each(a,function(a){this.updateBodyElement(a);if(this.showHeaderElements){this.updateHeaderElement(a)}},this)}});Ext.define('Sch.plugin.Lines',{extend:'Sch.feature.AbstractTimeSpan',alias:'plugin.scheduler_lines',cls:'sch-timeline',showTip:!0,innerTpl:null,prepareTemplateData:null,side:null,init:function(a){if(typeof this.innerTpl==='string'){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=a.rtl?'right':'left';var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div id="{id}" '+(this.showTip?'title="{[this.getTipText(values)]}" ':'')+'class="{$cls}" style="'+this.side+':{left}px;top:{top}px;width:{width}px">'+(b?'{[this.renderInner(values)]}':'')+'</div>','</tpl>',{getTipText:function(b){var c=a.getSchedulingView();return c.getFormattedDate(c.convertDateToTimeZone(b.Date))+' '+(b.Text||'')},renderInner:function(a){return b.apply(a)}})}this.callParent(arguments)},getElementData:function(l,p,m){var o=this.store,b=this.schedulerView,j=b.isHorizontal(),k=b.isWeekView(),i=m||o.getRange(),g=[],q,r,d,c,a;for(var f=0,n=i.length;f<n;f++){d=i[f];c=d.get('Date');if(c&&b.timeAxis.dateInAxis(c)){a=Ext.apply({},this.getTemplateData(d));a.id=this.getElementId(d);a.$cls=this.getElementCls(d,a);if(k){var e=b.getTimeSpanRegion(l,null,this.expandToFitView);e=b.getTimeSpanRegion(c,c);a.left=e.x;a.top=e.y;a.width=e.right-e.left}else {var h=b.getCoordinateFromDate(c);if(j){a.left=h}else {a.top=h}}g.push(a)}}return g},getHeaderElementData:function(c){var i=this.timeAxis.getStart(),j=this.timeAxis.getEnd(),h=this.schedulerView.isHorizontal(),g=[],b,d,f,a;c=c||this.store.getRange();for(var e=0,k=c.length;e<k;e++){b=c[e];d=b.get('Date');if(d&&Sch.util.Date.betweenLesser(d,i,j)){f=this.getHeaderElementPosition(d);a=this.getTemplateData(b);a=Ext.apply({side:h?this.side:'top',cls:this.getHeaderElementCls(b,a),position:f},a);a.id=this.getHeaderElementId(b);g.push(a)}}return g}});Ext.define('Sch.feature.ColumnLines',{extend:'Sch.plugin.Lines',requires:['Ext.data.JsonStore'],showTip:!1,cls:'sch-column-line',timeAxisViewModel:null,renderingDoneEvent:'columnlinessynced',useLowestHeader:null,init:function(a){this.timeAxis=a.getTimeAxis();this.timeAxisViewModel=a.timeAxisViewModel;this.panel=a;this.store=new Ext.data.JsonStore({fields:['Date']});this.callParent(arguments);a.on({destroy:this.onHostDestroy,scope:this});this.timeAxisViewModel.on('update',this.populate,this);this.populate()},onHostDestroy:function(){this.timeAxisViewModel.un('update',this.populate,this)},populate:function(){this.store.setData(this.getData())},getData:function(){var c=[];var a=this.timeAxisViewModel;var b=this.useLowestHeader?a.getLowestHeader():a.columnLinesFor;var f=!!(a.headerConfig&&a.headerConfig[b].cellGenerator);if(f){var e=a.getColumnConfig()[b];for(var d=1,g=e.length;d<g;d++){c.push({Date:e[d].start})}}else {a.forEachInterval(b,function(b,e,d){if(d>0){c.push({Date:b,Cls:a.isMajorTick(b)?'sch-column-line-solid':''})}})}return c}});Ext.define('Sch.util.ScrollManager',{singleton:!0,vthresh:25,hthresh:25,increment:100,frequency:500,animate:!0,animDuration:200,activeCmp:null,activeEl:null,scrollElRegion:null,scrollProcess:{},pt:null,direction:'both',constructor:function(){this.doScroll=Ext.Function.bind(this.doScroll,this)},triggerRefresh:function(){if(this.activeEl){this.refreshElRegion();this.clearScrollInterval();this.onMouseMove()}},doScroll:function(){var g=this.scrollProcess,d=g.cmp,f=d.rtl&&!d.up('[isViewport]'),c=g.dir[0],a=this.increment,h=this.activeCmp.getScrollX(),i=this.activeCmp.getVerticalScroll();if(c==='r'){a=Math.min(a,f?h:this.maxPosition.x-h)}else {if(c==='d'){a=Math.min(a,this.maxPosition.y-i)}}a=Math.max(a,0);var b=0,e=0;if(c==='r'){b=a}if(c==='l'){b=-a}if(c==='u'){e=-a}if(c==='d'){e=a}if(f){b=-b}if(b){d.scrollHorizontallyBy(b,{duration:this.animDuration,callback:this.triggerRefresh,scope:this})}else {if(e){d.scrollVerticallyBy(e,{duration:this.animDuration,callback:this.triggerRefresh,scope:this})}}},clearScrollInterval:function(){var a=this.scrollProcess;if(a.id){clearTimeout(a.id)}a.id=0;a.cmp=null;a.dir=''},isScrollAllowed:function(a){switch(this.direction){case 'both':return !0;case 'horizontal':return a==='right'||a==='left';case 'vertical':return a==='up'||a==='down';default:throw new Error('Invalid direction: '+this.direction);}},startScrollInterval:function(b,a){if(!this.isScrollAllowed(a)){return}this.clearScrollInterval();this.scrollProcess.cmp=b;this.scrollProcess.dir=a;this.scrollProcess.id=setTimeout(this.doScroll,this.frequency)},onMouseMove:function(c){var g=c?{x:c.getX(),y:c.getY(),right:c.getX(),bottom:c.getY()}:this.pt,k=g.x,l=g.y,d=this.scrollProcess,a=this.activeCmp,e=a.getScrollX(),i=a.getVerticalScroll(),o,h=a.rtl&&!a.up('[isViewport]'),j=this.activeEl,b=this.scrollElRegion,n=j.dom,f=this,m=a.up('timelinegrid,timelinetree').getScrollable().getElement().isScrollable()||j.isScrollable();this.pt=g;if(b&&b.contains(g)&&m){if(b.bottom-l<=f.vthresh&&i<this.maxPosition.y){if(d.cmp!=a){this.startScrollInterval(a,'down')}return}else {if(b.right-k<=f.hthresh&&(h?e>0:e<this.maxPosition.x)){if(d.cmp!=a){this.startScrollInterval(a,'right')}return}else {if(l-b.top<=f.vthresh&&i>0){if(d.cmp!=a){this.startScrollInterval(a,'up')}return}else {if(k-b.left<=f.hthresh&&(h?e<this.maxPosition.x:e>0)){if(d.cmp!=a){this.startScrollInterval(a,'left')}return}}}}}this.clearScrollInterval()},refreshElRegion:function(){var a=this.activeEl.getRegion();this.scrollElRegion=this.activeCmp.getScrollableContainerRegion()},activate:function(a,b){var c=Ext.getScrollbarSize();this.direction=b||'both';this.activeCmp=a;this.activeEl=a.getEl();this.maxPosition=a.getScrollableMaxPosition();this.refreshElRegion();this.activeEl.on('mousemove',this.onMouseMove,this)},deactivate:function(){if(this.activeEl){this.clearScrollInterval();this.activeEl.un('mousemove',this.onMouseMove,this);this.activeEl=this.activeCmp=this.scrollElRegion=null;this.direction='both'}}});Ext.define('Sch.util.DragTracker',{extend:'Ext.dd.DragTracker',requires:['Ext.util.Region'],xStep:1,yStep:1,initEl:function(d){var a=this,c,b;a.callParent(arguments);if(Ext.supports.Touch){if(!Ext.isEdge||!window.TouchEvent){a.mun(a.handle,a.handleListeners);a.handleListeners.mousedown.translate=!0;a.mon(a.handle,a.handleListeners)}}},constructor:function(){this.callParent(arguments);this.on('dragstart',this.bindListenersOnDragStart)},bindListenersOnDragStart:function(){var a=this.el;a.on(this.getListeners());this.on('dragend',this.unbindListenersOnDragEnd,this,{single:!0})},unbindListenersOnDragEnd:function(){this.el&&this.el.un(this.getListeners())},getListeners:function(){return {scroll:this.onMouseMove,pinchstart:this.onMouseUp,scope:this}},destroy:function(){clearTimeout(this.deferTimer);this.callParent(arguments)},setXStep:function(a){this.xStep=a},startScroll:null,setYStep:function(a){this.yStep=a},getCurrentScroll:function(){return this.el.getScroll()},getRegion:function(){var e=this.startXY,a=this.getCurrentScroll();if(Ext.isIE&&this.rtl){a.left=this.el.dom.scrollWidth-this.el.getWidth()-a.left}var b=this.getXY(),c=b[0],d=b[1],j=a.left-this.startScroll.left,k=a.top-this.startScroll.top,f=e[0]-j,g=e[1]-k,h=Math.min(f,c),i=Math.min(g,d),m=Math.abs(f-c),l=Math.abs(g-d);return new Ext.util.Region(i,h+m,i+l,h)},onMouseDown:function(a,c){var b=a.event.touches||[];if(b.length>1||!(a.type==='mousedown'&&a.pointerType==='mouse')){return}a.stopPropagation=Ext.emptyFn;this.startXY=a.getXY();this.callParent([a,c]);this.lastXY=this.startXY;this.startScroll=this.getCurrentScroll();if(Ext.isIE&&this.rtl){this.startScroll.left=this.el.dom.scrollWidth-this.el.getWidth()-this.startScroll.left}},onMouseMove:function(a,g){a.preventDefault();var b=a.type==='scroll'?this.lastXY:a.getXY(),e=this.startXY;if(!this.active){if(Math.max(Math.abs(e[0]-b[0]),Math.abs(e[1]-b[1]))>this.tolerance){this.triggerStart(a)}else {return}}var c=b[0],d=b[1];if(this.xStep>1){c-=this.startXY[0];c=Math.round(c/this.xStep)*this.xStep;c+=this.startXY[0]}if(this.yStep>1){d-=this.startXY[1];d=Math.round(d/this.yStep)*this.yStep;d+=this.startXY[1]}var f=this.xStep>1||this.yStep>1;if(!f||c!==b[0]||d!==b[1]){this.lastXY=[c,d];if(this.fireEvent('mousemove',this,a)===!1){this.onMouseUp(a)}else {this.onDrag(a);this.fireEvent('drag',this,a)}}}});Ext.define('Sch.tooltip.ClockTemplate',{extend:'Ext.XTemplate',minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,mode:'hour',setMode:function(a){this.mode=a},getRotateStyle:function(a){return 'transform:rotate(Ddeg);'.replace(/D/g,a)},constructor:function(){var a=this;a.callParent(['<div class="sch-clockwrap sch-supports-border-radius'+' sch-clock-{[this.mode]}">'+'<div class="sch-clock">'+'<div class="sch-hourIndicator" style="{[this.getHourStyle((values.date.getHours() % 12) * 30,'+this.hourTop+', + '+this.hourHeight+')]}">{[Ext.Date.monthNames[values.date.getMonth()].substr(0,3)]}</div>'+'<div class="sch-minuteIndicator" style="{[this.getMinuteStyle(values.date.getMinutes() * 6,'+this.minuteTop+', + '+this.minuteHeight+')]}">{[values.date.getDate()]}</div>'+'<div class="sch-clock-dot"></div>'+'</div>'+'<span class="sch-clock-text">{text}</span>'+'</div>',{getMinuteStyle:a.getRotateStyle,getHourStyle:a.getRotateStyle}])}});Ext.define('Sch.tooltip.Tooltip',{extend:'Ext.tip.ToolTip',requires:['Ext.XTemplate','Sch.tooltip.ClockTemplate'],autoHide:!1,anchor:'b',padding:'0 3 0 0',showDelay:0,hideDelay:0,quickShowInterval:0,dismissDelay:0,trackMouse:!1,anchorOffset:5,shadow:!1,frame:!1,schedulerView:null,message:null,startDate:null,endDate:null,template:null,valid:!0,mode:null,offsetAdjust:[18,5],clockTpl:null,constructor:function(b){var a=this;a.clockTpl=new Sch.tooltip.ClockTemplate();a.startDate=a.endDate=new Date();if(!a.template){a.template=new Ext.XTemplate(['<div class="'+Ext.baseCSSPrefix+'fa sch-tip-{[values.valid ? "ok fa-check" : "notok fa-ban"]} ">'+'{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}'+'{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}'+'<div class="sch-tip-message">{message}</div>'+'</div>',{renderClock:function(b,c,d){return a.clockTpl.apply({date:b,text:c,cls:d})}}])}a.callParent(arguments)},update:function(b,a,g,f,c){if(this.startDate-b!==0||this.endDate-a!==0||this.valid!==g||this.message!==f||this.allDay!=c){var i=this.schedulerView.timeAxis;var h=i.isUTCTimeZone();if(!h){b=this.schedulerView.convertDateToTimeZone(b);a=this.schedulerView.convertDateToTimeZone(a)}this.startDate=b;this.endDate=a;this.valid=g;this.message=f;this.allDay=c;var d,e;if(h){d=this.schedulerView.getTimeZoneFormattedDate(b);e=this.schedulerView.getTimeZoneFormattedEndDate(a)}else {d=this.schedulerView.getFormattedDate(b);e=this.schedulerView.getFormattedEndDate(a,b)}if(c){this.mode='calendar';this.clockTpl.setMode('allday')}else {this.mode='day';this.clockTpl.setMode('hour')}if(this.mode==='calendar'&&a.getHours()===0&&a.getMinutes()===0&&!(a.getYear()===b.getYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate())){a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1)}this.callParent([this.template.apply({valid:g,startDate:b,endDate:a,startText:d,endText:e,message:f,allDay:c})])}if(this.rendered&&this.isVisible()){if(Ext.getVersion().isGreaterThan('6.2.1')){this.realignToTarget()}else {this.realign()}}},showForElement:function(b,a){if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){this.mode='calendar';this.addCls('sch-day-resolution');this.removeCls('sch-hour-resolution')}else {this.mode='clock';this.removeCls('sch-day-resolution');this.addCls('sch-hour-resolution')}a=arguments.length>1?a:this.offsetAdjust[0];this.mouseOffsets=[a-this.offsetAdjust[0],-this.offsetAdjust[1]];this.setTarget(b);this.show();this.realign()},realign:function(){this.alignTo(this.target,'bl-tl?',this.mouseOffsets)},afterRender:function(){this.callParent(arguments);this.el.on('mouseenter',this.realign,this)}});Ext.define('Sch.tooltip.HoverTip',{extend:'Ext.tip.ToolTip',alias:'widget.scheduler_hovertip',requires:['Sch.tooltip.ClockTemplate'],trackMouse:!0,bodyCls:'sch-hovertip',messageTpl:'<div class="sch-hovertip-msg">{message}</div>',autoHide:!1,dismissDelay:1000,showDelay:0,schedulerView:null,clockTpl:null,lastTime:null,lastResource:null,initComponent:function(){var a=this;var b=a.schedulerView;a.clockTpl=new Sch.tooltip.ClockTemplate();a.messageTpl=new Ext.XTemplate(a.messageTpl);a.callParent(arguments);a.on('beforeshow',a.tipOnBeforeShow,a);b.mon(b.el,{mouseleave:function(){a.hide()},mousemove:a.handleMouseMove,scope:a});b.mon(b.el,{click:a.onBodyMouseDown,scope:a,delay:1})},onBodyMouseDown:function(){this.hide()},handleMouseMove:function(b){var a=this,c=a.schedulerView;if(a.disabled){return}if(b.getTarget('.'+c.itemCls,5)&&!b.getTarget(c.eventSelector)&&b.pointerType==='mouse'){var d=c.getTimeZoneDateFromDomEvent(b,'floor');if(d){var e=c.resolveResource(b.getTarget());if(!a.lastTime||d-a.lastTime!==0||e!==a.lastResource){a.lastResource=e;if(a.hidden){a.setClockMode();a.show()}a.updateHoverTip(d,b)}}else {a.hide()}}else {a.hide()}},setClockMode:function(){var a=this,b=Sch.util.Date,c=a.schedulerView.getTimeResolution();if(b.compareUnits(c.unit,b.DAY)>=0){a.clockTpl.setMode('day')}else {a.clockTpl.setMode('hour')}},getText:function(){},updateHoverTip:function(a,h){if(a){var d=this.schedulerView,g=d.timeAxis,b,c;if(g.isUTCTimeZone()){c=Sch.util.Date.format(a,d.getDisplayDateFormat(),0);if(this.clockTpl.mode==='hour'){b=Sch.util.Date.getUTCTime(a)}else {b=Sch.util.Date.getUTCDate(a)}}else {b=a;c=d.getFormattedDate(b)}var f=this.clockTpl.apply({date:b,text:c});var e=this.messageTpl.apply({message:this.getText(a,h)});this.update(f+e);this.lastTime=a}},hide:function(){this.callParent(arguments);this.lastTime=this.lastResource=null},tipOnBeforeShow:function(a){this.setClockMode();return !this.disabled}});Ext.define('Sch.feature.DragCreator',{requires:['Ext.XTemplate','Ext.ToolTip','Sch.util.Date','Sch.util.ScrollManager','Sch.util.DragTracker','Sch.tooltip.Tooltip','Sch.tooltip.HoverTip'],disabled:!1,showHoverTip:!0,showDragTip:!0,dragTip:null,dragTolerance:2,hoverTip:null,validatorFn:Ext.emptyFn,validatorFnScope:null,trackerConfig:null,schedulerView:null,template:'<div class="sch-dragcreator-proxy">'+'<div class="sch-event-inner">&#160;</div>'+'</div>',constructor:function(a){Ext.apply(this,a||{});this.lastTime=new Date();if(!(this.template instanceof Ext.Template)){this.template=new Ext.Template(this.template)}this.schedulerView.on('destroy',this.onSchedulerDestroy,this);if(Ext.supports.Touch){this.schedulerView.on('boxready',this.initDragTracker,this)}else {this.schedulerView.el.on('mousemove',this.initDragTracker,this,{single:!0})}this.callParent([a])},setDisabled:function(a){this.disabled=a;if(this.hoverTip&&this.hoverTip.setDisabled){this.hoverTip.setDisabled(a)}if(this.dragTip&&this.dragTip.setDisabled){this.dragTip.setDisabled(a)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.schedulerView.getEl(),{},!0);this.proxy.hide=function(){this.setStyle({left:0,right:0,top:'-10000px'})}}return this.proxy},onBeforeDragStart:function(g,b){var a=this.schedulerView,d=b.getTarget('.'+a.timeCellCls,5);if(d&&this.isCreateAllowed(b)&&(!b.event.touches||b.event.touches.length===1)){var c=a.resolveResource(d),e=a.isWeekView()?null:c,f=a.getDateFromDomEvent(b);if(!this.disabled&&d&&a.fireEvent('beforedragcreate',a,e,f,b)!==!1){this.resourceRecord=e;this.originalStart=f;this.resourceRegion=a.getScheduleRegion(c,this.originalStart);this.dateConstraints=a.getDateConstraints(c,this.originalStart);return !0}}return !1},isCreateAllowed:function(a){return !a.getTarget(this.schedulerView.eventSelector)},disableHoverTip:function(){this.hoverTip&&this.hoverTip.disable&&this.hoverTip.disable()},onDragStart:function(){var a=this,b=a.schedulerView,d=a.tracker.getRegion(),c=a.getProxy();this.dragging=!0;if(this.hoverTip){this.hoverTip.on('enable',this.disableHoverTip,this);this.hoverTip.disable()}a.start=a.originalStart;a.end=a.start;a.originalScroll=b.getScroll();if(b.isHorizontal()){a.rowBoundaries={top:a.resourceRegion.top,bottom:a.resourceRegion.bottom}}else {a.rowBoundaries={left:a.resourceRegion.left,right:a.resourceRegion.right}}Ext.apply(d,a.rowBoundaries);if(b.rtl){c.setStyle({right:'auto'})}c.setBox(d);c.show();b.fireEvent('dragcreatestart',b,c);if(a.showDragTip){a.dragTip.enable();a.dragTip.update(a.start,a.end,!0);a.dragTip.showForElement(c);a.dragTip.setStyle('visibility','visible')}Sch.util.ScrollManager.activate(b,b.isHorizontal()?'horizontal':'vertical')},onDrag:function(){var a=this,e=a.schedulerView,c=a.tracker.getRegion(),f='',d=e.getTimeZoneStartEndDatesFromRegion(c,'round');if(!d){return}a.start=d.start||a.start;a.end=d.end||a.end;var b=a.dateConstraints;if(b){a.end=Sch.util.Date.constrain(a.end,b.start,b.end);a.start=Sch.util.Date.constrain(a.start,b.start,b.end)}a.valid=this.validatorFn.call(a.validatorFnScope||a,a.resourceRecord,a.start,a.end);if(a.valid&&typeof a.valid!=='boolean'){f=a.valid.message;a.valid=a.valid.valid}a.valid=a.valid!==!1;if(a.showDragTip){a.dragTip.update(a.start,a.end,a.valid,f)}Ext.apply(c,a.rowBoundaries);var h=e.getScroll();var g=this.getProxy();g.setBox(c);if(e.isHorizontal()){g.setY(a.resourceRegion.top+a.originalScroll.top-h.top)}},eventSwallower:function(a){a.stopPropagation();a.preventDefault()},onDragEnd:function(h,c){var a=this,f=a.schedulerView,d=!0,g=c.getTarget(),e=Ext.get(g);e.on('click',this.eventSwallower);a.unbindTimer=setTimeout(function(){e.un('click',a.eventSwallower)},100);a.dragging=!1;if(a.showDragTip){a.dragTip.disable()}if(!a.start||!a.end||a.end-a.start<=0){a.valid=!1}var b={start:a.start,end:a.end,resourceRecord:a.resourceRecord,e:c,valid:a.valid,finalize:function(c){a.finalize(c,b)}};if(a.valid){d=f.fireEvent('beforedragcreatefinalize',f,b,c,this.getProxy())!==!1}if(d){a.finalize(a.valid,b)}Sch.util.ScrollManager.deactivate()},createEvent:function(d){var f=this.schedulerView,e=f.getEventStore(),a=Ext.create(e.getModel()),b,c;if(a.isTaskModel){a.taskStore=e;c=d.resourceRecord;b=c&&c.getCalendar&&c.getCalendar(!0);if(b){a.setCalendar(b)}}a.setStartEndDate(d.start,d.end);if(b){a.setCalendar(null)}return a},finalize:function(c,b){var a=this.schedulerView;if(c){a.fireEvent('dragcreateend',a,this.createEvent(b),b.resourceRecord,b.e,this.getProxy())}this.proxy.hide();this.schedulerView.fireEvent('afterdragcreate',a,this.getProxy());if(this.hoverTip){this.hoverTip.un('enable',this.disableHoverTip,this);this.hoverTip.enable()}},dragging:!1,initDragTracker:function(){var a=this,c=Ext.supports.Touch,b=a.schedulerView;var d=Ext.apply({el:b.el,rtl:b.rtl,tolerance:a.dragTolerance,listeners:{mousedown:a.verifyLeftButtonPressed,beforedragstart:a.onBeforeDragStart,dragstart:a.onDragStart,drag:a.onDrag,dragend:a.onDragEnd,scope:a}},this.trackerConfig);this.bindRightClickPreventer();if(c&&!Ext.platformTags.windows){this.showDragTip=!1;this.showHoverTip=!1;this.dragTip=null;this.hoverTip=null}else {this.setupTooltips()}a.tracker=new Sch.util.DragTracker(d)},bindRightClickPreventer:function(){this.schedulerView.el.on('contextmenu',this.stopDragCreateOnRightClick,this,{priority:999})},stopDragCreateOnRightClick:function(a){if(a.button!==0&&this.dragging){this.tracker.onMouseUp(a)}},setupTooltips:function(){var a=this,b=a.schedulerView;if(this.showDragTip){var c=this.dragTip;if(c instanceof Ext.tip.ToolTip){c.schedulerView=b;c.on('beforeshow',function(){return a.dragging})}else {this.dragTip=new Sch.tooltip.Tooltip(Ext.apply({cls:'sch-dragcreate-tip',schedulerView:b,constrainTo:b.up('grid').el,listeners:{beforeshow:function(){return a.dragging}}},c))}}if(a.showHoverTip){var d=a.hoverTip;if(d instanceof Ext.tip.ToolTip){d.schedulerView=b}else {a.hoverTip=Ext.ComponentManager.create(Ext.applyIf({renderTo:Ext.getBody(),target:b.el,schedulerView:b},d),'scheduler_hovertip')}}},verifyLeftButtonPressed:function(b,a){return a.button===0},onSchedulerDestroy:function(){if(this.hoverTip&&this.hoverTip.destroy){this.hoverTip.destroy()}if(this.dragTip&&this.dragTip.destroy){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}clearTimeout(this.unbindTimer)}});Ext.define('Sch.feature.SchedulerDragZone',{extend:'Ext.dd.DragZone',requires:['Ext.dd.StatusProxy','Sch.tooltip.Tooltip'],uses:['Sch.model.Event','Sch.model.Assignment','Sch.util.Date','Sch.patches.DragZone'],animRepair:!1,repairHighlight:!1,repairHighlightColor:'transparent',containerScroll:!1,checkDraggingFlag:!0,getConstrainRegion:null,showTooltip:!0,tip:null,deltaSetXY:null,schedulerView:null,_onValidDropTimer:null,lastXY:null,showExactDropPosition:!1,enableCopy:!1,enableCopyKey:'SHIFT',validatorFn:function(b,a,d,c,e){return !0},validatorFnScope:null,copyKeyPressed:!1,keyListener:null,viewScrollListener:null,gridScrollListener:null,dragDropProxyCls:'sch-dd-ref',invalidCssClasses:['sch-resizable-handle','sch-terminal'],constructor:function(e,d){var c=this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:!1,dropAllowed:this.dropAllowed,dropNotAllowed:this.dropNotAllowed,ensureAttachedToBody:Ext.emptyFn});this.callParent(arguments);this.isTarget=!0;this.scroll=!1;this.ignoreSelf=!1;var a=this.schedulerView;Ext.Array.each(this.invalidCssClasses,this.addInvalidHandleClass,this);if(a.touchScroll){this.showTooltip=!1}this.el.appendChild(c.el);this.bindRightClickPreventer();this.el.highlight=Ext.emptyFn;c.addCls('sch-dragproxy');a.on({eventdragstart:function(){Sch.util.ScrollManager.activate(a,a.constrainDragToResource&&a.getMode())},aftereventdrop:function(){Sch.util.ScrollManager.deactivate()},scope:this});if(this.showTooltip){var b=this.tip;if(b instanceof Ext.tip.ToolTip){b.schedulerView=a}else {this.tip=new Sch.tooltip.Tooltip(Ext.apply({schedulerView:a,constrainTo:a.up('grid').el,alignOnScroll:!1,cls:'sch-dragdrop-tip'},b))}}},bindRightClickPreventer:function(){this.schedulerView.el.on('mousedown',this.preventRightClick,this,{priority:999})},destroy:function(){this.tip&&this.tip.destroy();this.cleanupListeners();clearTimeout(this._onValidDropTimer);this.callParent(arguments)},preventRightClick:function(a){if(this.dragging&&a.button!==0){return !1}},autoOffset:function(){this.setDelta(0,0)},setupConstraints:function(a,d,b,c,f,e,i){this.clearTicks();var g=f&&!this.showExactDropPosition&&e>1?e:0;var h=!f&&!this.showExactDropPosition&&e>1?e:0;this.resetConstraints();this.initPageX=a.left+b;this.initPageY=a.top+c;var k=d.right-d.left;var j=d.bottom-d.top;if(f){if(i){this.setXConstraint(a.left+b,a.right-k+b,g)}else {this.setXConstraint(a.left,a.right,g)}this.setYConstraint(a.top+c,a.bottom-j+c,h)}else {this.setXConstraint(a.left+b,a.right-k+b,g);if(i){this.setYConstraint(a.top+c,a.bottom-j+c,h)}else {this.setYConstraint(a.top,a.bottom,h)}}},setXConstraint:function(c,b,a){this.leftConstraint=c;this.rightConstraint=b;this.minX=c;this.maxX=b;if(a){this.setXTicks(this.initPageX,a)}this.constrainX=!0},setYConstraint:function(c,b,a){this.topConstraint=c;this.bottomConstraint=b;this.minY=c;this.maxY=b;if(a){this.setYTicks(this.initPageY,a)}this.constrainY=!0},onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,setVisibilityForSourceEvents:function(a){Ext.Array.each(this.dragData.getEventBarElements(),function(b){b&&Ext.fly(b)[a?'show':'hide']()})},onDragOver:function(b){if(b&&b.event.touches&&b.event.touches.length>1){Ext.dd.DragDropManager.handleMouseUp(b);return}var e=b?b.getXY():this.lastXY;if(!e){return}var a=this.dragData;if(!a.originalHidden){this.setVisibilityForSourceEvents(!1);a.originalHidden=!0;if(this.enableCopy){this.onShiftKeyStateChange(b[this.enableCopyKey.toLowerCase()+'Key'])}}var k=a.startDate;var i=a.newResource;var c=this.schedulerView;this.updateDragContext(b);if(this.showExactDropPosition){var j=c.getDateFromXY(e)-a.sourceDate;var h=new Date(a.origStart-0+j);var d=c.timeAxisViewModel.getDistanceBetweenDates(h,a.startDate);if(a.startDate>c.timeAxis.getStart()){var f=this.proxy.el;if(d){if(c.isHorizontal()){f.setX(e[0]+(c.shouldAdjustForRtl()?-d:d))}else {f.setY(e[1]+d)}}}}if(a.startDate-k!==0||i!==a.newResource){c.fireEvent('eventdrag',c,a.draggedRecords,a.startDate,a.newResource,a)}if(this.showTooltip){var g=a.getEventRecord();if(g.getAllDay&&g.getAllDay()&&!a.isAllDayDrop){this.tip.update(a.vAdjustedPointerDate,Sch.util.Date.add(a.vAdjustedPointerDate,Sch.util.Date.HOUR,1),a.valid,a.message,a.isAllDayDrop)}else {if(a.isAllDayDrop){this.tip.update(Sch.model.Event.getAllDayDisplayStartDate(a.startDate),Sch.model.Event.getAllDayDisplayEndDate(a.startDate,a.endDate),a.valid,a.message,a.isAllDayDrop)}else {this.tip.update(a.startDate,a.endDate,a.valid,a.message,a.isAllDayDrop)}}}if(b){this.lastXY=[b.browserEvent.clientX+document.body.scrollLeft,b.getY()]}},getDragData:function(e){var a=this.schedulerView,d=e.getTarget(a.eventSelector);this.started=!1;if(!d||e.event.touches&&e.event.touches.length>1){return}var b=a.resolveEventRecord(d),g=a.resolveResource(d),n=a.resolveAssignmentRecord(d),t=b&&b.isDraggable()&&!a.isReadOnly();if(!t){return null}var m=e.getXY(),k=Ext.fly(d).getXY(),l=[m[0]-k[0],m[1]-k[1]],s=Ext.fly(d).getRegion();this.lastXY=null;var r=a.isHorizontal();a.constrainDragToResource&&!g&&Ext.Error.raise('Resource could not be resolved for event: '+b.getId());var o=a.getDateConstraints(a.constrainDragToResource?g:null,b);var f;if(a.isWeekView()){f=this.el.getRegion();if(b.getAllDay()){f=f.adjust(-10000,10000,10000,-10000)}}else {f=this.getConstrainRegion?this.getConstrainRegion():a.getScheduleRegion(a.constrainDragToResource?g:null,b)}this.setupConstraints(f,s,l[0],l[1],r,b.getAllDay&&b.getAllDay()?1:a.getSnapPixelAmount(),Boolean(o));var i=b.get(b.startDateField),j=b.get(b.endDateField),q=a.timeAxis,p=this.getRelatedRecords(n||b)||[],c=a.getElementsFromEventRecord(b,a.isWeekView()?null:g,null,!0);Ext.Array.each(p,function(b){if(b&&b.isAssignmentModel){c=c.concat(a.getElementsFromEventRecord(b.getEvent(),b.getResource(),null,!0))}else {c=c.concat(a.getElementsFromEventRecord(b,null,null,!0))}});c=Ext.Array.unique(c);var h={offsets:l,repairXY:k,triggerEvent:e,prevScroll:a.getScroll(),dateConstraints:o,eventBarEls:c,getEventBarElements:function(){return h.eventBarEls=Ext.Array.map(h.eventBarEls,function(a){return a&&document.getElementById(a.id)})},draggedRecords:[n||b].concat(p),getEventRecord:function(){var a=this.draggedRecords[0];if(a instanceof Sch.model.Assignment){a=a.getEvent()}return a},resourceRecord:g,sourceDate:a.getTimeZoneDateFromXY(m),origStart:i,origEnd:j,startDate:i,endDate:j,timeDiff:0,startsOutsideView:i<q.getStart(),endsOutsideView:j>q.getEnd(),duration:j-i};this.copyKeyPressed=this.enableCopy&&e[this.enableCopyKey.toLowerCase()+'Key'];h.ddel=this.getDragElement(d,h);return h},onStartDrag:function(){var a=this.schedulerView,b=this.dragData;Ext.Array.each(b.getEventBarElements(),function(a){Ext.fly(a).removeCls('sch-event-hover')});a.fireEvent('eventdragstart',a,b.draggedRecords);this.viewScrollListener=a.getScrollable().on({scroll:this.onViewScroll,destroyable:!0,scope:this});this.gridScrollListener=a.up('timelinetree,timelinegrid').getScrollable().on({scroll:this.onViewScroll,destroyable:!0,scope:this})},alignElWithMouse:function(a,c,d){this.callParent(arguments);if(Ext.isIE&&this.schedulerView.rtl&&this.schedulerView.up('[isViewport]')){this.deltaSetXY=null;this.callParent(arguments)}var b=this.getTargetCoord(c,d),e=a.dom?a:Ext.fly(a,'_dd');this.setLocalXY(e,b.x+this.deltaSetXY[0],b.y+this.deltaSetXY[1])},onViewScroll:function(a){this.setVisibilityForSourceEvents(!1);this.onDragOver()},isCopyKeyPressed:function(){return this.enableCopy&&this.copyKeyPressed},onShiftKeyStateChange:function(a){var b=this.dragData;if(a){b.refElements.addCls('sch-event-copy')}else {b.refElements.removeCls('sch-event-copy')}this.setVisibilityForSourceEvents(a);this.copyKeyPressed=a},onKey:function(a){if(this.enableCopy&&a.getKey()===a[this.enableCopyKey]){this.onShiftKeyStateChange(a.type==='keydown')}if(a.getKey()===a.ESC){this.abortDrag(a)}},abortDrag:function(a){this.dragData.ddCallbackArgs=[a.getTarget(),a,this.id];this.finalize(!1);Ext.dd.DragDropManager.stopDrag(a);Ext.dd.DragDropManager.stopEvent(a)},startDrag:function(){var b=this.schedulerView,a=this.dragData;if(b.fireEvent('beforeeventdrag',b,a.draggedRecords[0],a.triggerEvent)===!1){this.abortDrag(a.triggerEvent);return}var c=this.callParent(arguments);this.started=!0;this.keyListener=Ext.getDoc().on({keydown:this.onKey,keyup:this.onKey,useCapture:!0,destroyable:!0,scope:this});a.refElement=this.proxy.el.down('.'+this.dragDropProxyCls);a.refElements=this.proxy.el.select('.sch-event');a.refElement.removeCls('sch-event-hover');if(this.showTooltip){this.tip.setStyle('visibility');this.tip.update(a.origStart,a.origEnd,!0);this.tip.showForElement(a.refElement,a.offsets[0])}if(this.copyKeyPressed){a.refElements.addCls('sch-event-copy');a.originalHidden=!0}return c},endDrag:function(){this.cleanupListeners();this.callParent(arguments)},cleanupListeners:function(){if(this.viewScrollListener){this.viewScrollListener.destroy();this.viewScrollListener=null}if(this.gridScrollListener){this.gridScrollListener.destroy();this.gridScrollListener=null}if(this.keyListener){this.keyListener.destroy();this.keyListener=null}},onMouseUp:function(){if(!this.dragging){this.afterDragFinalized()}},afterDragFinalized:function(){this.proxy.el.dom.style.top=this.proxy.el.dom.style.left=0},updateRecords:function(a){var e=this,c=e.schedulerView,d=c.getEventStore(),m=c.getResourceStore(),j=d.getAssignmentStore(),o=a.newResource,l=a.draggedRecords[0],g=a.draggedRecords.slice(1),k=a.resourceRecord,b=e.isCopyKeyPressed(),f=a.startDate,i=a.vAdjustedPointerDate,h=a.hAdjustedPointerDate,q=f-a.origStart,p=c.isWeekView(),n;if(j&&d instanceof Sch.data.EventStore){e.updateRecordsMultipleAssignmentMode(f,q,l,g,k,o,d,m,j,b,p,h,i)}else {if(j){n=e.updateRecordsSingleAssignmentMode(f,q,l.getEvent(),Ext.Array.map(g,function(a){return a.getEvent()}),k,o,d,m,b,p,h,i)}else {n=e.updateRecordsSingleAssignmentMode(f,q,l,g,k,o,d,m,b,p,h,i)}}if(b){a.copiedRecords=n}c.fireEvent('eventdrop',c,a.copiedRecords||a.draggedRecords,b)},updateRecordsSingleAssignmentMode:function(m,p,a,n,e,d,f,c,i,l,q,k){var j=this,g=[],o=a.getAllDay&&a.getAllDay(),b=Sch.util.Date,h;if(i){a=a.fullCopy(null);g.push(a)}a.beginEdit();if(e&&e.isResourceModel&&d&&d.isResourceModel&&d!==e){if(i){a.assign(d)}else {a.reassign(e,d)}}a.setAllDay&&a.setAllDay(j.dragData.isAllDayDrop);if(a.getAllDay&&a.getAllDay()){h=b.copyTimeValues(b.clearTime(m,!0),j.dragData.origStart);a.setStartEndDate(h,b.add(h,b.MILLI,j.dragData.duration),f.skipWeekendsDuringDragDrop)}else {if(o){a.setStartEndDate(k,b.add(k,b.HOUR,1),f.skipWeekendsDuringDragDrop)}else {a.setStartDate(m,!0,f.skipWeekendsDuringDragDrop)}}a.endEdit();Ext.Array.each(n,function(a){var h=l?null:a.getResources();if(i){a=a.fullCopy(null);g.push(a)}a.beginEdit();a.setStartDate(b.add(a.getStartDate(),b.MILLI,p),!0,f.skipWeekendsDuringDragDrop);if(!l){var j=c.indexOf(e)-c.indexOf(d);j!==0&&h.length&&Ext.Array.each(h,function(e){var b=c.indexOf(e)-j,d;if(b<0){b=0}else {if(b>=c.getCount()){b=c.getCount()-1}}d=c.getAt(b);a.reassign(e,d)})}a.endEdit()});if(g.length){f.append(g)}return g},updateRecordsMultipleAssignmentMode:function(o,i,e,d,f,a,g,l,k,j,h,m,n){var p=this,c=Sch.util.Date;var b={};Ext.Array.each([].concat(e,d),function(e){var d=e.getEvent();if(b[d.getId()]){return}b[d.getId()]=!0;d.setStartDate(c.add(d.getStartDate(),c.MILLI,i),!0,g.skipWeekendsDuringDragDrop);if(!h&&f!==a){if(j){d.assign(a)}else {if(!d.isAssignedTo(a)){d.reassign(e.getResource(),a)}else {d.unassign(e.getResource())}}}})},isValidDrop:function(c,b,a){if(c!==b){if(a.isAssignmentModel){return !a.getEvent().isAssignedTo(b)}else {return !a.isAssignedTo(b)}}return !0},resolveResource:function(b){var e=this.proxy.el.dom;var d=Ext.getBody().getScroll();var c=this.schedulerView;e.style.display='none';var a=document.elementFromPoint(b[0]-d.left,b[1]-d.top);e.style.display='block';if(!a){return null}if(Ext.fly(a).up('.'+Ext.baseCSSPrefix+'grid-group-hd',4,!0)){return null}if(a.className.match(Ext.baseCSSPrefix+'grid-item')){return this.resolveResource([b[0],b[1]+3])}if(!a.className.match(c.timeCellCls)){var f=Ext.fly(a).up('.'+c.timeCellCls);if(f){a=f.dom}else {return null}}return c.resolveResource(a)},adjustStartDate:function(c,e,d){var a=d||this.schedulerView;var b=new Date(c-0+e);if(a.timeAxis.hasTimeZone()&&Sch.util.Date.compareUnits(Sch.util.Date.DAY,a.timeAxis.resolutionUnit)<=0){return a.roundDateInTimeZone(b,'round')}else {return a.timeAxis.roundDate(b,a.snapRelativeToEventStartDate?c:!1)}},resolveSchedulerView:function(b){var a=b.getTarget('.sch-schedulerview');return a&&Ext.getCmp(a.id)||this.schedulerView},updateDragContext:function(b){var a=this.dragData,d=b?b.getXY():this.lastXY,j,k;if(b){if(b.browserEvent.touches&&b.browserEvent.touches.length>0){j=b.browserEvent.touches[0].clientX}else {j=b.browserEvent.clientX!=null?b.browserEvent.clientX:b.clientX}k=[j+document.body.scrollLeft,b.getY()]}else {k=this.lastXY}if(!a.refElement){return}var c=b&&this.schedulerView.isWeekView()&&this.resolveSchedulerView(b)||this.schedulerView,f=a.refElement.getRegion(),i;i=c.getTimeZoneDateFromXY(d);a.pointerDate=i;a.vAdjustedPointerDate=this.adjustStartDate(c.getDateFromXY([d[0]-a.offsets[0],d[1]]),0,c);a.hAdjustedPointerDate=this.adjustStartDate(c.getDateFromXY([d[0],d[1]-a.offsets[1]]),0,c);a.isAllDayDrop=Boolean(c.allDay);if(c.timeAxis.isContinuous()){if(c.isHorizontal()&&this.minX<d[0]&&d[0]<this.maxX||!c.isHorizontal()&&this.minY<d[1]&&d[1]<this.maxY){a.timeDiff=i-a.sourceDate;a.startDate=this.adjustStartDate(a.origStart,a.timeDiff);a.endDate=new Date(a.startDate-0+a.duration)}}else {var g;if(c.isWeekView()){var h={bottom:f.bottom,top:f.top};h.left=h.right=f.left+a.offsets[0];g=this.resolveStartEndDates(c,h)}else {g=this.resolveStartEndDates(c,f)}a.startDate=g.startDate;a.endDate=g.endDate;a.timeDiff=a.startDate-a.origStart}a.newResource=c.constrainDragToResource?a.resourceRecord:this.resolveResource(k);if(a.newResource){var e=!b||this.validatorFn.call(this.validatorFnScope||this,a.draggedRecords,a.newResource,a.startDate,a.duration,b);if(!e||typeof e==='boolean'){a.valid=e!==!1;a.message=''}else {a.valid=e.valid!==!1;a.message=e.message}}else {a.valid=!1}},getRelatedRecords:function(a){var c=this.schedulerView,d=c.getEventSelectionModel(),b=d.getDraggableSelections();return Ext.Array.filter(b,function(b){return a!==b})},getDragElement:function(f,d){var e=d.getEventBarElements();var a;var c;var g=d.offsets[0];var h=d.offsets[1];var b=f.dom||f;var j=this.schedulerView.rtl?'right':'left';if(e.length>1){var i=Ext.core.DomHelper.createDom({tag:'div',cls:'sch-dd-wrap',style:{overflow:'visible'}});Ext.Array.each(e,function(c){a=c.cloneNode(!0);a.id=Ext.id();if(c===b){a.className+=' '+this.dragDropProxyCls}i.appendChild(a);var d=Ext.fly(c).getOffsetsTo(b);a.style[j]=d[0]-g+'px';a.style.top=d[1]-h+'px'},this);c=i}else {a=b.cloneNode(!0);a.id=Ext.id();a.style[j]=-g+'px';a.style.top=-h+'px';a.className+=' '+this.dragDropProxyCls;c=a}if(!b.style.height){Ext.fly(c).setHeight(Ext.fly(b).getHeight())}return c},onDragDrop:function(c,f){var b=this;b.updateDragContext(c);var k=b.schedulerView,i=b.cachedTarget||Ext.dd.DragDropMgr.getDDById(f),a=b.dragData,g=a.startDate&&a.endDate,l=!0;if(b.tip){b.tip.hide()}var h=a.startDate-a.origStart!==0||a.newResource!==a.resourceRecord;var j=(h||b.isCopyKeyPressed())&&a.valid&&g&&b.isValidDrop(a.resourceRecord,a.newResource,a.draggedRecords[0]);Ext.apply(a,{ddCallbackArgs:[i,c,f],start:a.startDate,end:a.endDate,finalize:function(){b.finalize.apply(b,arguments)}});b.proxy.el.addCls('sch-before-drag-finalized');var d=function(){b.finalize(!0)};var e=function(){b.finalize(!1)};if(j){if(k.fireEvent('beforeeventdropfinalize',b.schedulerView,a,c,d,e)!==!1){d()}}else {e()}},finalize:function(f){var a=this,b=a.schedulerView,c=b.getEventStore();a.proxy.el.removeCls('sch-before-drag-finalized');if(f){var e,d=function(){e=!0};c.on('update',d,null,{single:!0});a.updateRecords(a.dragData);c.un('update',d,null,{single:!0});if(!e){a.onInvalidDrop.apply(a,a.dragData.ddCallbackArgs)}else {a.onValidDrop.apply(a,a.dragData.ddCallbackArgs);b.fireEvent('aftereventdrop',b,a.dragData.copiedRecords||a.dragData.draggedRecords)}a.afterDragFinalized()}else {a.onInvalidDrop.apply(a,a.dragData.ddCallbackArgs)}},onInvalidDrop:function(b,a,e){if(!a){a=b;b=a.getTarget()||document.body}if(this.tip){this.tip.hide()}this.setVisibilityForSourceEvents(!0);var c=this.schedulerView,d=this.callParent([b,a,e]);if(this.started){c.fireEvent('aftereventdrop',c,this.dragData.copiedRecords||this.dragData.draggedRecords)}this.afterDragFinalized();return d},resolveStartEndDates:function(c,g){var b=this.dragData,a,d=b.origStart,f=b.origEnd,e=Sch.util.Date;if(!b.startsOutsideView){a=c.getStartEndDatesFromRegion(g,'round');if(a.start){if(!c.timeAxis.dateInAxis(a.start,!1)){var h=c.timeAxis.getTickFromDate(a.start);if(h){a.start=c.timeAxis.getDateFromTick(h)}}d=a.start||b.startDate;f=e.add(d,e.MILLI,b.duration)}}else {if(!b.endsOutsideView){a=c.getStartEndDatesFromRegion(g,'round');if(a){f=a.end||b.endDate;d=e.add(f,e.MILLI,-b.duration)}}}return {startDate:d,endDate:f}}});Ext.define('Sch.feature.DragDrop',{requires:['Ext.XTemplate','Sch.feature.SchedulerDragZone'],validatorFn:function(b,a,d,c,e){return !0},validatorFnScope:null,dragConfig:null,constructor:function(a,b){Ext.apply(this,b);this.schedulerView=a;a.eventDragZone=new Sch.feature.SchedulerDragZone(b.targetEl,Ext.apply({ddGroup:a.id,schedulerView:a,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope},this.dragConfig));this.schedulerView.on('destroy',this.cleanUp,this);this.callParent([b])},cleanUp:function(){var a=this.schedulerView;if(a.eventDragZone){a.eventDragZone.destroy()}}});Ext.define('Sch.patches.Grouping',{extend:'Sch.util.Patch',maxVersion:'6.5.2',target:'Ext.grid.feature.Grouping',overrides:{injectGroupingMenu:function(){var b=this,a=b.view.headerCt;a.showMenuBy=Ext.Function.createInterceptor(a.showMenuBy,b.showMenuBy);a.getMenuItems=b.getMenuItems()},showMenuBy:function(h,i,d){var b=this,e=b.getMenu(),f=e.down('#groupMenuItem'),g=d.groupable===!1||!d.dataIndex||b.view.headerCt.getVisibleGridColumns().length<2?'disable':'enable',a=e.down('#groupToggleMenuItem'),c=b.grid.getStore().isGrouped();f[g]();if(a){a.setChecked(c,!0);a[c?'enable':'disable']()}}}});Ext.define('Sch.feature.Grouping',{extend:'Ext.grid.feature.Grouping',requires:['Sch.patches.Grouping'],alias:'feature.scheduler_grouping',headerRenderer:Ext.emptyFn,eventStoreDetacher:null,assignmentStoreDetacher:null,resourceStoreDetacher:null,schedulerGroupHeaderTpl:'{[this.renderCells(values)]}',headerCellTpl:'<tpl for=".">'+'<div class="sch-grid-group-hd-cell {cellCls}" style="{cellStyle}; width: {width}px;">'+'<span>{value}</span>'+'</div>'+'</tpl>',renderCells:function(d){var a=this.view.getTimeAxisViewModel();var c=a.columnConfig[a.columnLinesFor];var b=Ext.Array.map(c,function(c){var b={};var e=this.headerRenderer(c.start,c.end,d.children,b);b.value=Ext.isEmpty(e)?'&nbsp;':e;b.width=a.getDistanceBetweenDates(c.start,c.end);return b},this);return this.headerCellTpl.apply(b)},disable:function(){this.unbindStoreListeners();this.callParent(arguments)},enable:function(){this.bindStoreListeners();this.callParent(arguments)},init:function(){var a=this.view;var b=this;this.callParent(arguments);if(typeof this.headerCellTpl==='string'){this.headerCellTpl=new Ext.XTemplate(this.headerCellTpl)}if(a.getResourceStore){this.bindStoreListeners();this.groupHeaderTpl=new Ext.XTemplate(this.schedulerGroupHeaderTpl,{renderCells:Ext.Function.bind(b.renderCells,b)});a.on({resourcestorechange:this.bindStoreListeners,eventstorechange:this.bindStoreListeners,assignmentstorechange:this.bindStoreListeners,scope:this})}Ext.apply(a,{getRowNode:function(a){return this.retrieveNode(this.getRowId(a),!0)}});a.groupingFeature=this},bindStoreListeners:function(){var a=this.view;if(!a.isLockedView){var b=a.getEventStore();var c=this.getStoreListeners();this.unbindStoreListeners();if(b){this.eventStoreDetacher=a.mon(b,c.eventStore)}if(b&&b.getAssignmentStore()){this.assignmentStoreDetacher=a.mon(b.getAssignmentStore(),c.assignmentStore)}if(a.getResourceStore()){this.resourceStoreDetacher=a.mon(a.getResourceStore(),c.resourceStore)}}},unbindStoreListeners:function(){if(!this.view.isLockedView){Ext.destroyMembers(this,'eventStoreDetacher','resourceStoreDetacher','assignmentStoreDetacher')}},getStoreListeners:function(){var b=this.view,a={resourceStore:{add:this.onResourceAdd,destroyable:!0,scope:this}};if(b.getEventStore){a.eventStore={add:this.onEventAddOrRemove,remove:this.onEventAddOrRemove,update:this.onEventUpdate,destroyable:!0,scope:this};if(b.getEventStore().getAssignmentStore()){a.assignmentStore={add:this.onAssignmentAddOrRemove,update:this.onAssignmentUpdate,remove:this.onAssignmentAddOrRemove,destroyable:!0,scope:this}}}return a},refreshGrouping:function(c){if(!this.view.getStore().isGrouped()){return}var b=this;var a={};Ext.Array.each(c,function(d){if(d){var f=b.getRecordGroup(d);if(f){var c=f.first();var e=c.getId();if(!a[e]){a[e]=c;b.refreshGroupHeader(c,!0)}}}})},onAssignmentAddOrRemove:function(c,b){if(!this.view.getStore().isGrouped()){return}var a=this.view.getResourceStore();this.refreshGrouping(Ext.Array.map(b,function(b){return b.getResource(a)}))},onAssignmentUpdate:function(d,a){if(!this.view.getStore().isGrouped()){return}var b=this.view.getResourceStore();var c=[a.getResource(b)];if(a.previous&&a.previous[a.resourceIdField]){c.push(b.getById(a.previous[a.resourceIdField]))}this.refreshGrouping(c)},onEventUpdate:function(d,a){if(!this.view.getStore().isGrouped()){return}var e=this;var g=d.getAssignmentStore();if(g){e.refreshGrouping(a.getResources())}else {var f=d.getResourceStore().getGroupField();var h=a.previous&&a.resourceIdField in a.previous;var b=a.getResource();if(h){var c=d.getResourceStore().getById(a.previous[a.resourceIdField]);if(c&&(!b||c.get(f)!==b.get(f))){e.refreshGroupHeader(c)}}if(b){e.refreshGroupHeader(b)}}},onEventAddOrRemove:function(d,b){if(!this.view.getStore().isGrouped()||d.ignoreCollectionAdd){return}var f=this;var e=f.view;var c=e.getEventStore();var a=Ext.Array.map(b,function(a){return c.getResourcesForEvent(a)});a=[].concat.apply([],a);this.refreshGrouping(Ext.Array.unique(a))},onResourceAdd:function(b,a){if(!this.view.getStore().isGrouped()){return}this.refreshGrouping(a)},refreshGroupHeader:function(b,c){var a=this,d=a.view;if(a.disabled||!a.view.getResourceStore().isGrouped()){return}d.refreshNode(c?b:a.getRecordGroup(b).first())}});Ext.define('Sch.widget.recurrence.ConfirmationDialog',{extend:'Ext.window.MessageBox',alias:'widget.recurrenceconfirmationdialog',mixins:['Sch.mixin.Localizable'],dialogCls:'sch-recurrenceconfirmation',show:function(a){var b=this;a.cls=b.dialogCls+(a.cls?' '+a.cls:'');var c=a.eventRecord.isRecurring();a=Ext.apply({title:b.L(a.actionType+'-title'),msg:b.L(a.actionType+(c?'-all-message':'-further-message')),icon:Ext.MessageBox.QUESTION,scope:b,fn:b.dispatchHandler,buttonText:a.buttonText||b.getButtonText(a)},a);return b.callParent([a])},getButtonText:function(c){var a=this,d=c.eventRecord.isRecurring();var b={yes:a.L(c.actionType+(d?'-all-btn-text':'-further-btn-text')),no:a.L(c.actionType+'-only-this-btn-text'),cancel:a.L('Cancel')};if(d){b.yes=a.L('Yes');delete b.no}return b},getButtonHandler:function(c,d,b){var a;switch(c){case 'yes':a=b.multipleHandler||this.multipleHandler;break;case 'no':a=b.singleHandler||this.singleHandler;break;case 'cancel':a=b.cancelHandler||this.cancelHandler;break;}return a},dispatchHandler:function(f,e,a){a=a||{};var b=this,g=b.getButtonHandler(f,e,a),d=a.handlerScope||b,c=a.changerFn||Ext.emptyFn;g.call(d,a.eventRecord,a.values,a.actionType,c,a.changerFnScope||b)},multipleHandler:function(a,f,g,c,e){var b=a.getRecurringEvent(),d=new Date(a.getStartDate()-1);c.call(e);a.setRecurringEventId(null);b&&b.getRecurrence().setEndDate(d)},singleHandler:function(a,f,g,d,e){var b=a.getRecurringEvent(),c=a.getStartDate();d.call(e);a.beginEdit();a.setRecurringEventId(null);a.setRecurrence(null);a.endEdit();b.addExceptionDate(c)},cancelHandler:Ext.emptyFn});Ext.define('Sch.widget.RecurrenceConfirmation',{extend:'Sch.widget.recurrence.ConfirmationDialog',singleton:!0});Ext.define('Sch.feature.RecurringEvents',{alias:'feature.scheduler_recurring_events',requires:['Sch.widget.RecurrenceConfirmation'],mixins:['Ext.util.Observable'],panelCls:'sch-recurringevents',eventStoreDetacher:null,timeAxisDetacher:null,panelDetacher:null,viewDetacher:null,panel:null,eventStore:null,timeAxis:null,trackingSuspended:0,constructor:function(a){a=a||{};this.mixins.observable.constructor.call(this);if(a.panel){this.init(a.panel)}},init:function(a){this.setPanel(a)},setPanel:function(a){var b=this;b.panel=a;b.bindPanel(a);b.setEventStore(a&&a.getEventStore())},startTracking:function(){var a=this,b=a.panel;if(b){a.setView(a.getView(b));a.setTimeAxis(b.getTimeAxis&&b.getTimeAxis());a.refreshOccurrences();b.addCls(a.panelCls)}else {a.stopTracking()}},stopTracking:function(){var a=this,b=a.panel;a.setView();a.setTimeAxis();b&&b.removeCls(a.panelCls)},getPanel:function(){return this.panel},getView:function(a){a=a||this.panel;return a&&a.getSchedulingView()},setView:function(a){if(a){if(a.viewReady){this.bindView(a)}else {this.mon(a,{'viewready':this.onViewReady,single:!0,scope:this})}}else {this.bindView()}},bindPanel:function(a){this.panelDetacher&&this.panelDetacher.destroy();if(a){this.mon(a,{'eventstorechange':this.onPanelEventStoreChange,'destroy':this.onPanelDestroy,scope:this})}},onPanelDestroy:function(){this.setPanel()},onViewReady:function(a){this.bindView(a)},bindView:function(b){var a=this;a.viewDetacher&&a.viewDetacher.destroy();if(b){a.viewDetacher=a.mon(b,{'beforeeventdropfinalize':a.onBeforeEventDropFinalize,'beforeeventresizefinalize':a.onBeforeEventResizeFinalize,destroyable:!0,scope:a,priority:-100})}},setEventStore:function(a){var b=this,c=a&&a.isRecurringEventStore;a=c?a:null;b.eventStore=a;b.bindEventStore(a);b[c?'startTracking':'stopTracking']()},getEventStore:function(){return this.eventStore},bindEventStore:function(a){this.eventStoreDetacher&&this.eventStoreDetacher.destroy();if(a){this.eventStoreDetacher=this.mon(a,{'load':this.onEventsLoaded,'add':this.onEventAdd,'update':this.onEventUpdate,'remove':this.onEventRemove,'generate-occurrences-start':this.onGenerateOccurrencesStart,'generate-occurrences-end':this.onGenerateOccurrencesEnd,'delayed-regenerate-occurrences-start':this.onDelayedRegenerateOccurrencesStart,'delayed-regenerate-occurrences-end':this.onDelayedRegenerateOccurrencesEnd,scope:this,destroyable:!0})}},setTimeAxis:function(a){this.timeAxis=a;this.bindTimeAxis(a)},getTimeAxis:function(){return this.timeAxis},getStartDate:function(){return this.getTimeAxis()&&this.getTimeAxis().getStart()},getEndDate:function(){return this.getTimeAxis()&&this.getTimeAxis().getEnd()},bindTimeAxis:function(a){this.timeAxisDetacher&&this.timeAxisDetacher.destroy();if(a){this.timeAxisDetacher=this.mon(a,{'reconfigure':this.onTimeAxisReconfigure,scope:this,destroyable:!0})}},onDelayedRegenerateOccurrencesStart:function(){var a=this.getView();if(a&&a.getMode()=='horizontal'){this._fadeOutRemoval=a.horizontal.fadeOutRemoval;a.horizontal.fadeOutRemoval=!1}},onDelayedRegenerateOccurrencesEnd:function(){var a=this.getView();if(a&&a.getMode()=='horizontal'){a.horizontal.fadeOutRemoval=this._fadeOutRemoval}},onGenerateOccurrencesStart:function(a,d,b,c){this.suspendTracking()},onGenerateOccurrencesEnd:function(b,e,a,c,d){this.resumeTracking()},refreshOccurrences:function(){var a=this.getEventStore(),b=this.getStartDate(),c=this.getEndDate();if(a&&b&&c){a.generateOccurrencesForEventsBuffered(a.getRecurringEvents(),b,c)}},onPanelEventStoreChange:function(b,a){this.setEventStore(a)},onTimeAxisReconfigure:function(){if(!this.isTrackingSuspended()){this.refreshOccurrences()}},onEventsLoaded:function(b,a,c){if(c&&!this.isTrackingSuspended()){a=Ext.Array.filter(a,function(a){return a.isRecurring()});if(a.length){b.generateOccurrencesForEventsBuffered(a,this.getStartDate(),this.getEndDate())}}},onEventAdd:function(b,a){if(!this.isTrackingSuspended()){a=Ext.Array.filter(a,function(a){return a.isRecurring()});if(a.length){b.generateOccurrencesForEventsBuffered(a,this.getStartDate(),this.getEndDate())}}},onEventUpdate:function(f,a,h,g){if(h=='edit'&&!this.isTrackingSuspended()&&this.isRecurrenceRelatedFieldChange(a,g)){var c=this.getStartDate(),d=this.getEndDate(),e=a.getStartDate(),b=a.getRecurrence();if(!b){f.removeOccurrencesForEvents(a)}else {if(c&&d&&e&&(!b.getEndDate()||b.getEndDate()>=c&&e<=d)){f.regenerateOccurrencesForEventsBuffered(a,c,d)}}}},onEventRemove:function(b,a){if(!this.isTrackingSuspended()){a=Ext.Array.filter(a,function(a){return a.isRecurring()});if(a.length){b.removeOccurrencesForEvents(a)}}},isRecurrenceRelatedFieldChange:function(a,b){return a.isRecurring()||Ext.Array.contains(b,a.recurrenceRuleField)},isTrackingSuspended:function(){return this.trackingSuspended},suspendTracking:function(){this.trackingSuspended++},resumeTracking:function(){this.trackingSuspended--},onBeforeEventDropFinalize:function(e,b,f,c,d){var a=b.draggedRecords[0];if(a.isRecurrableEvent&&(a.isRecurring()||a.isOccurrence())){Sch.widget.RecurrenceConfirmation.show({actionType:'update',eventRecord:a,changerFn:c,cancelHandler:d});return !1}},onBeforeEventResizeFinalize:function(e,b,f,c,d){var a=b.eventRecord;if(a.isRecurrableEvent&&(a.isRecurring()||a.isOccurrence())){Sch.widget.RecurrenceConfirmation.show({actionType:'update',eventRecord:a,changerFn:c,cancelHandler:d});return !1}}});Ext.define('Sch.feature.ResizeZone',{extend:'Ext.util.Observable',requires:['Ext.resizer.Resizer','Sch.tooltip.Tooltip','Sch.util.ScrollManager'],showTooltip:!0,showExactResizePosition:!1,validatorFn:Ext.emptyFn,validatorFnScope:null,schedulerView:null,origEl:null,handlePos:null,eventRec:null,mouseDownEvent:null,tip:null,tipInstance:null,startScroll:null,constructor:function(b){Ext.apply(this,b);var a=this.schedulerView;a.on({destroy:this.cleanUp,scope:this});a.el.on({mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,delegate:'.sch-resizable-handle'});this.bindRightClickPreventer();this.callParent(arguments)},bindRightClickPreventer:function(){this.schedulerView.el.on('contextmenu',this.preventRightClick,this,{priority:999})},preventRightClick:function(a){if(a.button!==0&&this.resizer){a.stopEvent();return !1}},onMouseDown:function(b,c){var e=this.schedulerView;var d=this.eventRec=e.resolveEventRecord(c);var a=d.isResizable();if(b.button!==0||(a===!1||typeof a==='string'&&!c.className.match(a))){return}this.eventRec=d;this.handlePos=this.getHandlePosition(c);this.origEl=Ext.get(b.getTarget('.sch-event'));this.mouseDownEvent=b;e.el.on({mousemove:this.onMouseMove,scope:this,single:!0})},onMouseUp:function(b,c){var a=this.schedulerView;a.el.un({mousemove:this.onMouseMove,scope:this,single:!0});this.mouseDownEvent=null},getTipInstance:function(){if(this.tipInstance){return this.tipInstance}var b=this.schedulerView;var a=this.tip;if(a instanceof Ext.tip.ToolTip){a.schedulerView=b}else {a=new Sch.tooltip.Tooltip(Ext.apply({rtl:this.rtl,schedulerView:b,constrainTo:b.up('grid').el,cls:'sch-resize-tip'},a))}return this.tipInstance=a},onMouseMove:function(c,g){var b=this.schedulerView,a=this.eventRec,d=this.handlePos;if(!a||b.fireEvent('beforeeventresize',b,a,c)===!1){return}delete this.eventRec;c.stopEvent();this.origEl.addCls('sch-event-resizing');this.resizer=this.createResizer(this.origEl,a,d);var e=this.resizer.resizeTracker;e.onMouseDown(this.mouseDownEvent,this.resizer[d].dom);e.onMouseMove(c,this.resizer[d].dom);if(this.showTooltip){var f=this.getTipInstance();f.update(a.getStartDate(),a.getEndDate(),!0);f.showForElement(this.origEl,c.getX()-this.origEl.getX())}b.fireEvent('eventresizestart',b,a);b.getScrollable().on('scroll',this.onViewScroll,this)},getHandlePosition:function(b){var a=b.className.match('start');if(this.schedulerView.isHorizontal()){if(this.schedulerView.rtl){return a?'east':'west'}return a?'west':'east'}else {return a?'north':'south'}},createResizer:function(a,f,d){var b=this.schedulerView,o=this,e=b.resolveResource(a),c=b.getSnapPixelAmount(),l=b.getScheduleRegion(e,f),m=b.getDateConstraints(e,f),j=a.getHeight(),h=b.rtl&&d[0]==='e'||!b.rtl&&d[0]==='w'||d[0]==='n',n=!b.isHorizontal(),g={otherEdgeX:h?a.getRight():a.getLeft(),otherEdgeY:h?a.getBottom():a.getTop(),target:a,isStart:h,dateConstraints:m,resourceRecord:e,eventRecord:f,handles:d[0],minHeight:j,constrainTo:l,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};if(n){if(c>0){var k=a.getWidth();Ext.apply(g,{minHeight:c,minWidth:k,maxWidth:k,heightIncrement:c})}}else {if(c>0){Ext.apply(g,{minWidth:c,maxHeight:j,widthIncrement:c})}}var i=new Ext.resizer.Resizer(g);if(i.resizeTracker){i.resizeTracker.tolerance=-1}a.setStyle('z-index',parseInt(a.getStyle('z-index'),10)+1);Sch.util.ScrollManager.activate(b,b.isHorizontal()?'horizontal':'vertical');this.startScroll=b.getScroll();return i},getStartEndDates:function(){var b=this.resizer,e=b.el,a=this.schedulerView,h=b.isStart,c,d,g,f;if(h){if(a.isHorizontal()){g=a.rtl&&a.shouldAdjustForRtl()?e.getRight():e.getLeft()+1;f=[g,0]}else {f=[(e.getRight()+e.getLeft())/2,e.getTop()]}d=b.eventRecord.getEndDate();if(a.snapRelativeToEventStartDate){c=a.getDateFromXY(f);c=a.timeAxis.roundDate(c,b.eventRecord.getStartDate())}else {c=a.getTimeZoneDateFromXY(f,'round')}}else {if(a.isHorizontal()){g=a.rtl&&a.shouldAdjustForRtl()?e.getLeft():e.getRight();f=[g,0]}else {f=[(e.getRight()+e.getLeft())/2,e.getBottom()]}c=b.eventRecord.getStartDate();if(a.snapRelativeToEventStartDate){d=a.getDateFromXY(f);d=a.timeAxis.roundDate(d,b.eventRecord.getEndDate())}else {d=a.getTimeZoneDateFromXY(f,'round')}}c=c||b.start;d=d||b.end;if(b.dateConstraints){c=Sch.util.Date.constrain(c,b.dateConstraints.start,b.dateConstraints.end);d=Sch.util.Date.constrain(d,b.dateConstraints.start,b.dateConstraints.end)}return {start:c,end:d}},partialResize:function(a,q,p,n){var c=this.schedulerView,r=n?n.getXY():this.resizer.resizeTracker.lastXY,k=this.getStartEndDates(r),b=k.start,f=k.end,h=a.eventRecord,l=c.isHorizontal();if(this.showTooltip){var g=this.validatorFn.call(this.validatorFnScope||this,a.resourceRecord,h,b,f);var m='';if(g&&typeof g!=='boolean'){m=g.message;g=g.valid}this.getTipInstance().update(b,f,g!==!1,m)}if(this.showExactResizePosition){var d=a.target.el,e,i,j;if(a.isStart){if(c.isWeekView()){var o=c.weekview.getEventColumns(h)[0];e=c.timeAxisViewModel.getDistanceBetweenDates(b,o.end)}else {e=c.timeAxisViewModel.getDistanceBetweenDates(b,h.getEndDate())}if(l){i=c.getDateFromCoordinate(a.otherEdgeX-Math.min(q,a.maxWidth))||b;j=c.timeAxisViewModel.getDistanceBetweenDates(i,b);if(d.getWidth()!==e){d.setWidth(e);d.setX(d.getX()+j)}}else {i=c.getDateFromCoordinate(a.otherEdgeY-Math.min(p,a.maxHeight))||b;j=c.timeAxisViewModel.getDistanceBetweenDates(i,b);if(d.getHeight()!==e){d.setHeight(e);d.setY(d.getY()+j)}}}else {e=c.timeAxisViewModel.getDistanceBetweenDates(h.getStartDate(),f);if(l){d.setWidth(e)}else {d.setHeight(e)}}}else {if(!b||!f||a.start-b===0&&a.end-f===0){return}}a.end=f;a.start=b;c.fireEvent('eventpartialresize',c,h,b,f,a.el)},onViewScroll:function(b,c,d,a){if(a!==0){this.resizer.resizeTracker.onDrag({});this.partialResize(this.resizer,0,0)}},afterResize:function(e,q,p,n){var b=this,o=e.resourceRecord,g=e.eventRecord,l=g.getStartDate(),m=g.getEndDate(),c=e.start||l,d=e.end||m,h=b.schedulerView,j=c-l||d-m,a=b.validatorFn.call(b.validatorFnScope||b,o,g,c,d,n);Sch.util.ScrollManager.deactivate();h.getScrollable().un('scroll',this.onViewScroll,this);if(this.showTooltip){this.getTipInstance().hide()}if(Ext.isObject(a)){a=a.valid}a=a!==!1&&c&&d&&d-c>0;var f={resourceRecord:e.resourceRecord,eventRecord:g,start:c,end:d,valid:a,modified:j,finalize:function(a){b.finalize(a,f)}};var i=function(){b.finalize(!0,f)};var k=function(){b.finalize(!1,f)};if(a&&j){if(h.fireEvent('beforeeventresizefinalize',h,f,n,i,k)!==!1){i()}}else {k()}},finalize:function(e,b){var a=this.schedulerView;var c=!1;var d=function(){c=!0};a.getEventStore().on('update',d);this.resizer.target.destroy();if(e){if(this.resizer.isStart){b.eventRecord.setStartDate(b.start,!1,a.getEventStore().skipWeekendsDuringDragDrop)}else {b.eventRecord.setEndDate(b.end,!1,a.getEventStore().skipWeekendsDuringDragDrop)}if(!c){a.repaintEventsForResource(b.resourceRecord)}}else {a.repaintEventsForResource(b.resourceRecord)}this.resizer.destroy();delete this.resizer;a.getEventStore().un('update',d);a.fireEvent('eventresizeend',a,b.eventRecord);a.fireEvent('aftereventresize',a,b.eventRecord)},cleanUp:function(){if(this.tipInstance){this.tipInstance.destroy()}this.mouseDownEvent=null}});Ext.define('Sch.field.CellEditor',{extend:'Ext.form.field.Text',alias:'widget.celleditorfield',hidden:!0,enableKeyEvents:!0,divider:'-',dateFormat:'H',getErrors:function(c){var d=this,a=d.callParent(arguments);if(c==null||c===''){return a}var b=this.getDates(c);if(!b[0]){a.push('Start date is incorrect')}if(!b[1]){a.push('End date is incorrect')}if(b[1]-b[0]<0){a.push('Start date is less then end date')}return a},getDates:function(f){var a=this;var d=f.split(a.divider);var b,c;if(Ext.isArray(a.dateFormat)){for(var e=0;e<a.dateFormat.length;e++){b=b||Ext.Date.parse(d[0],a.dateFormat[e]);c=c||Ext.Date.parse(d[1],a.dateFormat[e])}}else {b=Ext.Date.parse(d[0],a.dateFormat);c=Ext.Date.parse(d[1],a.dateFormat)}if(!b||!c){return []}if(a.record){b=Sch.util.Date.mergeDates(a.record.getStartDate(),b,a.bottomUnit);c=Sch.util.Date.mergeDates(a.record.getEndDate(),c,a.bottomUnit)}else {b=Sch.util.Date.mergeDates(a.startDate,b,a.bottomUnit);c=Sch.util.Date.mergeDates(a.startDate,c,a.bottomUnit)}return [b,c]}});Ext.define('Sch.field.SegmentedButton',{extend:'Ext.button.Segmented',alias:'widget.segmentedbuttonfield',mixins:['Ext.form.field.Field'],segmentedButtonFieldCls:'sch-segmentedbuttonfield',layout:'checkboxgroup',allowMultiple:!0,defaults:{enableToggle:!0,border:0},allowBlank:!0,initComponent:function(){var a=this;a.initField();a.initDefaultName();a.addCls(a.segmentedButtonFieldCls);a.callParent();a.on('change',a.onFieldChange,a)},initDefaultName:function(){this.name=this.name||this.getId()},onFieldChange:function(c,b,a){if(!this.allowBlank&&Ext.isEmpty(b)){this.setValue(a)}}});Ext.define('Sch.layout.TableLayout',{extend:'Ext.view.TableLayout',alias:'layout.timeline_tablelayout',beginLayout:function(a){var b=this,g=b.owner,e=g.ownerGrid,c=g.lockingPartner,d=c&&c.grid.isVisible()&&!c.grid.collapsed,f=a.context;a.doSyncRowHeights=d&&(e.syncRowHeight||e.syncRowHeightOnNextLayout);if(!b.columnFlusherId){b.columnFlusherId=b.id+'-columns';b.rowHeightFlusherId=b.id+'-rows'}if(b.owner.bufferedRenderer){b.owner.bufferedRenderer.beforeTableLayout(a)}b.superclass.superclass.beginLayout.apply(this,[a]);if(d&&c.componentLayout.isRunning()){if(!a.lockingPartnerContext){(a.lockingPartnerContext=f.getCmp(c)).lockingPartnerContext=a}if(a.doSyncRowHeights){a.rowHeightSynchronizer=b.owner.syncRowHeightBegin()}}(a.headerContext=f.getCmp(b.headerCt)).viewContext=a}});Ext.define('Sch.plugin.Zones',{extend:'Sch.feature.AbstractTimeSpan',alias:'plugin.scheduler_zones',requires:['Sch.model.Range'],innerTpl:null,cls:'sch-zone',side:null,init:function(b){if(typeof this.innerTpl==='string'){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=b.rtl?'right':'left';var a=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">'+'<div id="{id}" class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px;{style}">'+(a?'{[this.renderInner(values)]}':'')+'</div>'+'</tpl>',{renderInner:function(b){return a.apply(b)}})}if(typeof this.innerHeaderTpl==='string'){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}this.callParent(arguments)},getElementData:function(l,m,i,h){var c=this.schedulerView,p=[];var o=c.getTimeSpanRegion(l,m,this.expandToFitView);var e,f,g,a,r,k;i=i||this.store.getRange();for(var n=0,q=i.length;n<q;n++){e=i[n];f=e.getStartDate();g=e.getEndDate();k=this.getTemplateData(e);if(f&&g&&Sch.util.Date.intersectSpans(f,g,l,m)){a=Ext.apply({},k);a.id=this.getElementId(e);a.$cls=this.getElementCls(e,k);if(c.isWeekView()){var b=c.getTimeSpanRegion(f,g);a.left=b.left;a.top=b.top;a.height=b.bottom-b.top;a.width=b.right-b.left}else {var d=c.getCoordinateFromDate(Sch.util.Date.max(f,l));var j=c.getCoordinateFromDate(Sch.util.Date.min(g,m));if(c.isHorizontal()){a.left=d;a.top=o.top;a.width=h?0:j-d;a.style=h?'border-left-width:'+(j-d)+'px':''}else {a.left=o.left;a.top=d;a.height=h?0:j-d;a.style=h?'border-top-width:'+(j-d)+'px':''}}p.push(a)}}return p},getHeaderElementId:function(b,a){return this.callParent([b])+(a?'-start':'-end')},getHeaderElementCls:function(b,a,d){var c=b.clsField||this.clsField;if(!a){a=this.getTemplateData(b)}return 'sch-header-indicator sch-header-indicator-'+(d?'start ':'end ')+this.uniqueCls+' '+(a[c]||'')},getZoneHeaderElementData:function(h,i,a,b){var d=b?a.getStartDate():a.getEndDate(),g=null,f,e,c;if(d&&Sch.util.Date.betweenLesser(d,h,i)){f=this.getHeaderElementPosition(d);e=this.schedulerView.isHorizontal();c=this.getTemplateData(a);g=Ext.apply({id:this.getHeaderElementId(a,b),cls:this.getHeaderElementCls(a,c,b),isStart:b,side:e?this.side:'top',position:f},c)}return g},getHeaderElementData:function(a){var g=this.timeAxis.getStart(),h=this.timeAxis.getEnd(),e=[],d,b,c;a=a||this.store.getRange();for(var f=0,i=a.length;f<i;f++){d=a[f];b=this.getZoneHeaderElementData(g,h,d,!0);if(b){e.push(b)}c=this.getZoneHeaderElementData(g,h,d,!1);if(c){e.push(c)}}return e},updateZoneHeaderElement:function(b,a){b.dom.className=a.cls;if(this.schedulerView.isHorizontal()){this.setElementX(b,a.position)}else {b.setTop(a.position)}},updateHeaderElement:function(b){var f=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),a=Ext.get(this.getHeaderElementId(b,!0)),c=Ext.get(this.getHeaderElementId(b,!1)),e=this.getZoneHeaderElementData(f,g,b,!0),d=this.getZoneHeaderElementData(f,g,b,!1);if(!(a&&d)||!(c&&d)){Ext.destroy(a,c);this.renderHeaderElements([b])}else {if(a){if(!e){Ext.destroy(a)}else {this.updateZoneHeaderElement(a,e)}}if(c){if(!d){Ext.destroy(c)}else {this.updateZoneHeaderElement(c,d)}}}}});Ext.define('Sch.plugin.RowZones',{extend:'Sch.plugin.Zones',requires:['Ext.XTemplate','Sch.util.Date'],innerTpl:null,store:null,init:function(a){this.store=Ext.StoreManager.lookup(this.store);this.uniqueCls=this.uniqueCls||'sch-timespangroup-'+Ext.id();this.scheduler=a;a.registerRenderer(this.renderer,this);if(typeof this.innerTpl==='string'){this.innerTpl=new Ext.XTemplate(this.innerTpl)}var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">'+'<div id="'+this.uniqueCls+'-{id}" class="'+this.cls+' '+this.uniqueCls+' {Cls}" style="'+(a.rtl?'right':'left')+':{start}px;width:{width}px;top:{start}px;height:{width}px;{style}">'+(b?'{[this.renderInner(values)]}':'{'+this.store.getModel().prototype.nameField+'}')+'</div>'+'</tpl>',{renderInner:function(a){return b.apply(a)}})}this.storeListeners={refresh:this.fullRefresh,clear:this.fullRefresh,add:this.onZoneAdd,remove:this.onZoneRemove,update:this.onZoneUpdate,scope:this};this.store.on(this.storeListeners)},destroy:function(){this.store.un(this.storeListeners);this.callParent(arguments)},getViewRecordByZone:function(a){throw 'Abstract method call'},getZoneContainerEl:function(d){var c=this.scheduler.getSchedulingView(),a=this.getViewRecordByZone(d),b=a&&c.getNode(a);return b&&b.querySelector('.'+Ext.baseCSSPrefix+'grid-cell-inner')},onZoneRemove:function(b,a){Ext.Array.forEach(a,function(b){var a=document.getElementById(this.getElementId(b));a&&a.parentElement.removeChild(a)},this)},onZoneAdd:function(b,a){Ext.Array.forEach(a,function(b){var a=this.getZoneContainerEl(b);a&&this.appendZoneElement(b,a)},this)},fullRefresh:function(){var b=this,a=this.scheduler.getSchedulingView();if(a.el){a.el.select('.'+this.uniqueCls).remove();Ext.Array.forEach(a.getNodes(),function(c){b.renderRecordZones(a.getRecord(c),!0)})}},renderer:function(e,d,a,c){var b='';if(a&&(this.scheduler.isHorizontal()||c===0)){b=this.renderRecordZones(a)}return b},getRecordZones:function(a){throw 'Abstract method call'},getTemplateData:function(c){var b=this.scheduler,a=b.getSchedulingView()[b.getMode()].getEventRenderData(c),d,e;if(b.isHorizontal()){d=b.rtl?a.right:a.left;e=a.width}else {d=a.top;e=a.height}return Ext.apply({id:c.internalId,start:d,width:e,Cls:c.getCls()},c.data)},renderRecordZones:function(j,b){var c=this.scheduler,l=c.timeAxis.getStart(),m=c.timeAxis.getEnd(),d=[],i=this.getRecordZones(j),h='',f,g,a;for(var e=0,k=i.length;e<k;e++){a=i[e];f=a.getStartDate();g=a.getEndDate();if(f&&g&&c.timeAxis.isRangeInAxis(a)){d.push(this.getTemplateData(a))}}if(b){if(a){if(Ext.isBoolean(b)){b=this.getZoneContainerEl(a)}this.template.append(b,d)}}else {h=this.template.apply(d)}return h},appendZoneElement:function(a){var e=this.scheduler,f=e.timeAxis.getStart(),g=e.timeAxis.getEnd(),c=this.getZoneContainerEl(a),b=a.getStartDate(),d=a.getEndDate();if(c&&b&&d&&Sch.util.Date.intersectSpans(b,d,f,g)){this.template.append(c,this.getTemplateData(a))}},onZoneUpdate:function(k,c){var a=document.getElementById(this.getElementId(c));if(a){var b=this.scheduler,f=b.timeAxis.getStart(),g=b.timeAxis.getEnd();var h=Sch.util.Date.max(f,c.getStartDate()),j=Sch.util.Date.min(g,c.getEndDate()),i=c.getCls();var d=b.getSchedulingView().getCoordinateFromDate(h);var e=b.getSchedulingView().getCoordinateFromDate(j)-d;a.className=this.cls+' '+this.uniqueCls+' '+(i||'');a.style.left=d+'px';a.style.top=d+'px';a.style.height=e+'px';a.style.width=e+'px'}}});Ext.define('Sch.plugin.ResourceZones',{extend:'Sch.plugin.RowZones',alias:'plugin.scheduler_resourcezones',cls:'sch-resourcezone',init:function(a){this.callParent(arguments);this.store.setResourceStore(a.getResourceStore());a.on('resourcestorechange',this.onResourceStoreChange,this)},onResourceStoreChange:function(b,a){this.store.setResourceStore(a)},getRecordZones:function(a){return a.getEvents(this.store)},getViewRecordByZone:function(a){return a.getResource()},getZoneContainerEl:function(e){var a;if(this.scheduler.isHorizontal()){a=this.callParent(arguments)}else {var b=this.scheduler.getSchedulingView(),c=e.getResource();if(b.el&&c){var d=b.resourceStore.indexOf(c);a=b.getNode(0).querySelector('.'+Ext.baseCSSPrefix+'grid-cell:nth-child('+(d+1)+') .'+Ext.baseCSSPrefix+'grid-cell-inner')}}return a},fullRefresh:function(){var b=this,a=this.scheduler.getSchedulingView();if(b.scheduler.isHorizontal()){this.callParent(arguments)}else {if(a.el){a.el.select('.'+this.uniqueCls).remove();a.resourceStore.each(function(a){b.renderRecordZones(a,!0)})}}}});Ext.define('Sch.mixin.AbstractSchedulerPanel',{requires:['Sch.model.Event','Sch.model.Resource','Sch.data.EventStore','Sch.data.ResourceStore','Sch.util.Date','Sch.plugin.ResourceZones'],eventBarIconClsField:'',enableEventDragDrop:!0,resourceColumnClass:'Sch.column.Resource',resourceColumnWidth:null,allowOverlap:!0,startParamName:'startDate',endParamName:'endDate',passStartEndParameters:!1,eventRenderer:null,eventRendererScope:null,eventStore:null,resourceStore:null,onEventCreated:function(a,b){},resourceZones:null,resourceZonesConfig:null,initStores:function(){var a=this.resourceStore||this.store;if(this.crudManager){if(!Sch.crud.AbstractManager){throw new Error('Sch.crud.AbstractManager not loaded, did you forget to require '+'crudManager class (e.g. Sch.data.CrudManager)?')}if(!(this.crudManager instanceof Sch.crud.AbstractManager)){this.crudManager=Ext.create(this.crudManager.xclass||'Sch.data.CrudManager',Ext.clone(this.crudManager))}}if(!a){if(this.crudManager){a=this.resourceStore=this.crudManager.getResourceStore()}if(!a){if(this.isTree){a=new Sch.data.ResourceTreeStore({proxy:'memory'})}else {a=new Sch.data.ResourceStore()}}}if(!this.dependencyStore){if(this.crudManager){this.dependencyStore=this.crudManager.getDependencyStore()}}if(!this.eventStore){if(this.crudManager){this.eventStore=this.crudManager.getEventStore()}this.eventStore=this.eventStore||new Sch.data.EventStore()}this.store=Ext.StoreManager.lookup(a);this.resourceStore=this.store;this.setEventStore(this.eventStore);if(!this.eventStore||!this.eventStore.isEventStore){Ext.Error.raise('Your eventStore should be a subclass of Sch.data.EventStore (or consume the EventStore mixin)')}this.resourceStore.eventStore=this.getEventStore()},_initializeSchedulerPanel:function(){this.initStores();if(this.eventBodyTemplate&&typeof this.eventBodyTemplate==='string'){this.eventBodyTemplate=new Ext.XTemplate(this.eventBodyTemplate)}this.on('destroy',function(){this.setResourceStore(null);this.setEventStore(null)})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(a){var b=this.getResourceStore();this.resourceStore=a=a&&Ext.StoreManager.lookup(a);var c=this.getEventStore();if(c&&a){c.setResourceStore(a)}var d=this.getSchedulingView();d&&d.setResourceStore(a);if(a){this.fireEvent('resourcestorechange',this,a,b);if(this.isVertical()){this.refreshResourceColumns();this.mun(b,this.verticalListeners);this.mon(a,this.verticalListeners)}if(this.isWeekView()){this.mun(b,this.calendarResourceStoreListeners);this.mon(a,this.calendarResourceStoreListeners)}if(b===this.store){this.reconfigure(a)}else {this.refreshViews(!1)}if(this.allDayNormalHeader){this.allDayNormalHeader.refreshViews(!1)}}},getEventStore:function(){return this.eventStore},setEventStore:function(a){var f=this.getEventStore();a=a&&Ext.StoreManager.lookup(a);if(this.getEventStore()){this.mun(this.getEventStore(),'beforeload',this.applyStartEndParameters,this)}var d=this.getResourceStore();var b=this.getAssignmentStore();var c=this.getDependencyStore();this.eventStore=a;if(d&&a){d.setEventStore(a)}if(b&&a&&!a.getAssignmentStore()){a.setAssignmentStore(b)}if(c&&a&&!a.getDependencyStore()){a.setDependencyStore(c)}var e=this.getSchedulingView();e&&e.setEventStore(a);if(this.allDayNormalHeader){this.allDayNormalHeader.setEventStore(a)}if(a){this.fireEvent('eventstorechange',this,a,f);if(this.passStartEndParameters){this.mon(a,'beforeload',this.applyStartEndParameters,this)}this.refreshViews(!1)}},applyStartEndParameters:function(b,c){var a=b.getProxy();a.setExtraParam(this.startParamName,this.getStart());a.setExtraParam(this.endParamName,this.getEnd())},getAssignmentStore:function(){var b=this,a=b.getEventStore();return a&&a.isStore&&a.getAssignmentStore()||b.assignmentStore},setAssignmentStore:function(a){var b=this.getAssignmentStore();this.getEventStore().setAssignmentStore(a);if(a){this.fireEvent('assignmentstorechange',this,a,b);this.refreshViews(!1)}},getDependencyStore:function(){var b=this,a=b.getEventStore();return a&&a.isStore&&a.getDependencyStore()||b.dependencyStore},setDependencyStore:function(a){var b=this.getDependencyStore();this.getEventStore().setDependencyStore(a);if(a){this.fireEvent('dependencystorechange',this,a,b);this.refreshViews(!1)}},createResourceColumns:function(a){return Ext.Array.map(this.resourceStore.getRange(),function(b){return {xclass:this.resourceColumnClass,renderer:this.mainRenderer,scope:this,width:a||100,text:b.getName(),model:b}},this)},registerEventEditor:function(a){this.getSchedulingView().registerEventEditor(a)}});Ext.define('Sch.template.Event',{extend:'Ext.XTemplate',eventPrefix:null,resizeHandles:null,resizeTpl:'<div class="sch-resizable-handle sch-resizable-handle-DIR"></div>',terminalSides:null,terminalTpl:'<div class="sch-terminal sch-terminal-SIDE"></div>',constructor:function(b){var a=this;Ext.apply(a,b);a.callParent([this.getOuterMarkup()])},getOuterMarkup:function(){var a=this;var b=Ext.Array.map(a.terminalSides||[],function(b){return a.terminalTpl.replace(/SIDE/,b)}).join('');return ['<tpl for=".">','<div unselectable="on" tabindex="-1" id="',a.eventPrefix,'{id}" style="right:{right}px;left:{left}px;top:{top}px;height:{height}px;width:{width}px;{style}" class="sch-event ',Ext.baseCSSPrefix,'unselectable {internalCls} {cls}">',a.resizeHandles==='start'||a.resizeHandles==='both'?a.resizeTpl.replace(/DIR/,'start'):'','<div unselectable="on" class="sch-event-inner">','<tpl if="iconCls"><i class="sch-event-icon {iconCls}"></i></tpl>',this.getInnerMarkup(),'</div>',a.resizeHandles==='end'||a.resizeHandles==='both'?a.resizeTpl.replace(/DIR/,'end'):'',b,'</div>','</tpl>'].join('')},getInnerMarkup:function(){return '{body}'}});Ext.define('Sch.view.Vertical',{requires:['Ext.util.Region','Ext.Element','Ext.Array','Sch.util.Date'],view:null,constructor:function(a){Ext.apply(this,a)},getElementsFromEventRecord:function(e,d,f,c){var b=this.view,a;c=c||!1;if(d){a='[id^='+b.eventPrefix+e.internalId+'-'+d.internalId+'-]'}else {a='[id^='+b.eventPrefix+e.internalId+'-]'}return b.getEl().query(a,c)},translateToScheduleCoordinate:function(b){var a=this.view;return b-a.getViewContainerElementTop()+a.getVerticalScroll()},translateToPageCoordinate:function(c){var a=this.view;var b=a.getVerticalScroll();return c+a.getViewContainerElementTop()-b},getDateFromXY:function(d,b,c){var a=d[1];if(!c){a=this.translateToScheduleCoordinate(a)}return this.view.timeAxisViewModel.getDateFromPosition(a,b)},getEventRenderData:function(f,k){var b=Math,d=f.getStartDate(),e=f.getEndDate(),c=this.view,g=c.timeAxis.getStart(),h=c.timeAxis.getEnd(),i=b.floor(c.getCoordinateFromDate(Sch.util.Date.max(d,g))),j=b.floor(c.getCoordinateFromDate(Sch.util.Date.min(e,h))),a={event:f};a.top=b.max(0,b.min(i,j)-c.eventBorderWidth);a.height=b.max(1,b.abs(i-j));a.start=d;a.end=e;a.startsOutsideView=d<g;a.endsOutsideView=e>h;return a},getScheduleRegion:function(b,i){var a=this.view,c=b?Ext.fly(a.getScheduleCell(a.getNodes()[0],a.getResourceStore().indexOf(b))).getRegion():a.getTableRegion(),e=a.timeAxis.getStart(),g=a.timeAxis.getEnd(),d=a.getDateConstraints(b,i)||{start:e,end:g},f=this.translateToPageCoordinate(a.getCoordinateFromDate(Sch.util.Date.max(e,d.start))),h=this.translateToPageCoordinate(a.getCoordinateFromDate(Sch.util.Date.min(g,d.end))),k=c.left+a.barMargin,j=(b?c.left+this.getResourceColumnWidth(b):c.right)-a.barMargin;return new Ext.util.Region(Math.min(f,h),j,Math.max(f,h),k)},getResourceColumnWidth:function(a){return this.view.timeAxisViewModel.resourceColumnWidth},getResourceColumnLayoutAvailableWidth:function(b){var a=this;return a.getResourceColumnWidth(b)-2*a.view.barMargin-a.view.cellBorderWidth},getResourceRegion:function(b,c,e){var a=this.view,d=a.getResourceStore().indexOf(b)*this.getResourceColumnWidth(b),f=a.timeAxis.getStart(),h=a.timeAxis.getEnd(),k=c?Sch.util.Date.max(f,c):f,m=e?Sch.util.Date.min(h,e):h,g=Math.max(0,a.getCoordinateFromDate(k)-a.cellTopBorderWidth),i=a.getCoordinateFromDate(m)-a.cellTopBorderWidth,l=d+a.cellBorderWidth,j=d+this.getResourceColumnWidth(b)-a.cellBorderWidth;return new Ext.util.Region(Math.min(g,i),j,Math.max(g,i),l)},columnRenderer:function(o,c,f,m,h){var a=this.view;var i='';if(m===0){var p=Sch.util.Date,n=a.timeAxis,b,e,d,l;b=[];e=a.getEventStore().getEventsForResource(f);for(d=0,l=e.length;d<l;d++){var g=e[d],j=g.getStartDate(),k=g.getEndDate();if(j&&k&&n.timeSpanInAxis(j,k)){b.push(a.generateTplData(g,f,h))}}a.eventLayout.vertical.applyLayout(b,this.getResourceColumnLayoutAvailableWidth(f));i='&#160;'+a.eventTpl.apply(b)}if(h%2===1){c.tdCls=(c.tdCls||'')+' '+a.altColCls;c.cellCls=(c.cellCls||'')+' '+a.altColCls}return i},resolveResource:function(a){var f=this,b=f.view,c,e=-1,d;c=Ext.fly(a).is(b.eventSelector)&&a||Ext.fly(a).up(b.eventSelector,null,!0);if(c){d=b.getResourceRecordFromDomId(c.id)}else {a=Ext.fly(a).is(b.timeCellSelector)?a:Ext.fly(a).up(b.timeCellSelector,null,!0);if(a){e=Ext.Array.indexOf(Array.prototype.slice.call(a.parentNode.children),a)}d=e>=0&&b.getResourceStore().getAt(e)||null}return d},onEventUpdate:function(l,a){var c=this;var b=a.previous||{};var g=c.view;var j=g.timeAxis;var d=a.getStartDate();var e=a.getEndDate();var i=b[a.startDateField]||d;var k=b[a.endDateField]||e;var h=i&&k&&j.timeSpanInAxis(i,k);var f;if(a.resourceIdField in b&&h){f=l.getResourceStore().getById(b[a.resourceIdField]);f&&c.relayoutRenderedEvents(f)}if(d&&e&&j.timeSpanInAxis(d,e)||h){c.renderSingle(a);Ext.Array.each(a.getResources(),function(b){c.relayoutRenderedEvents(b);g.getEventSelectionModel().isSelected(a)&&g.onEventBarSelect(a,!0)})}},onEventAdd:function(g,e){var d=this,f=d.view,a,b,c;if(e.length===1){a=e[0];b=a.getStartDate();c=a.getEndDate();if(b&&c&&f.timeAxis.timeSpanInAxis(b,c)){d.renderSingle(a);Ext.Array.each(g.getResourcesForEvent(a),function(a){d.relayoutRenderedEvents(a)})}}else {f.repaintAllEvents()}},onEventRemove:function(j,f){var i=this,g=i.view,e,c,d,b,h,a;for(a=!1,b=0,h=f.length;!a&&b<h;b++){e=f[b];c=e.getStartDate();d=e.getEndDate();a=c&&d&&g.timeAxis.timeSpanInAxis(c,d);a&&Ext.asap(function(){g.repaintAllEvents()})}},getScheduledEventsForResource:function(b){var a=this.view;return a.getEventStore().filterEventsForResource(b,function(b){return a.timeAxis.isRangeInAxis(b)&&b.isScheduled()})},relayoutRenderedEvents:function(b){var c=[],a=this.view,d=this.getScheduledEventsForResource(b);Ext.Array.each(d,function(d){var e=a.getElementsFromEventRecord(d,b);e.length&&c.push({start:d.getStartDate(),end:d.getEndDate(),event:d,node:e[0]})});a.eventLayout.vertical.applyLayout(c,this.getResourceColumnLayoutAvailableWidth(b));Ext.Array.each(c,function(b){b.node.setStyle({left:b.left+'px',width:b.width+'px'});a.fireEvent('eventrepaint',a,b.event,b.node)})},renderSingle:function(b){var a=this.view,c=b.getStartDate(),d=b.getEndDate();Ext.Array.each(a.getElementsFromEventRecord(b),function(a){a.destroy()});if(c&&d&&a.timeAxis.timeSpanInAxis(c,d)){Ext.Array.each(b.getResources(),function(e){var f=a.getResourceStore().indexOf(e),d=Ext.fly(a.getScheduleCell(0,f)),c;if(d){c=a.generateTplData(b,e,f);c&&a.eventTpl.append(d.first(),[c])}})}},getTimeSpanRegion:function(f,d){var a=this.view,c=a.getCoordinateFromDate(f),e=d?a.getCoordinateFromDate(d):c,b=a.getTableRegion(),g=b?b.right-b.left:a.getEl().dom.clientWidth;return new Ext.util.Region(Math.min(c,e),g,Math.max(c,e),0)},getStartEndDatesFromRegion:function(d,a){var c=this.view.getDateFromCoordinate(d.top,a),b=this.view.getDateFromCoordinate(d.bottom,a);if(c&&b){return {start:c,end:b}}else {return null}},setColumnWidth:function(a,c){var b=this.view;b.resourceColumnWidth=a;b.getTimeAxisViewModel().setViewColumnWidth(a,c)},getVisibleDateRange:function(){var a=this.view;if(!a.rendered){return null}var e=a.getScroll(),d=a.getViewContainerHeight(),b=a.getTableRegion(),c=a.timeAxis.getEnd();if(b.bottom-b.top<d){var f=a.timeAxis.getStart();return {startDate:f,endDate:c}}return {startDate:a.getDateFromCoordinate(e.top,null,!0),endDate:a.getDateFromCoordinate(e.top+d,null,!0)||c}},getItemBox:function(a){var b=this;return Ext.Array.map(a.getResources(),function(c){return b.getResourceEventBox(a,c)})},getResourceEventBox:function(d,c){var s=Sch.util.Date,f=this,e=null,a=f.view,q=a.timeAxis.getStart(),r=a.timeAxis.getEnd(),m=d.getStartDate(),n=d.getEndDate(),o,i,b,h,k,l,g,j;if(m&&n&&s.intersectSpans(m,n,q,r)){if(a.managedEventSizing){o=a.eventLayout.vertical;var p=a.getEventStore().filterEventsForResource(c,a.timeAxis.isRangeInAxis,a.timeAxis);i=Ext.Array.map(p,f.getEventRenderData,f);o.applyLayout(i,f.getResourceColumnLayoutAvailableWidth(c));b=Ext.Array.findBy(i,function(a){return a.event==d});if(b){h=a.getResourceStore().indexOf(c)*f.getResourceColumnWidth(c);e={rendered:!0,start:b.left+h,end:b.left+b.width+h,top:b.top,bottom:b.top+b.height}}}else {k=a.getElementsFromEventRecord(d,d!==c&&c);if(k.length){l=k[0];g=l.getOffsetsTo(a.getEl());j=l.getBox();e={rendered:!0,start:g[0],end:g[0]+j.width,top:g[1],bottom:g[1]+j.height}}}if(e){e=f.adjustItemBox(d,e)}}return e},adjustItemBox:function(b,a){return a},getConnectorStartSide:function(a){return 'top'},getConnectorEndSide:function(a){return 'bottom'}});Ext.define('Sch.mixin.AbstractSchedulerView',{requires:['Sch.template.Event','Sch.eventlayout.Horizontal','Sch.view.Vertical','Sch.eventlayout.Vertical'],_cmpCls:'sch-schedulerview',scheduledEventName:'event',eventTemplateClass:'Sch.template.Event',eventTpl:null,barMargin:0,constrainDragToResource:!1,allowOverlap:null,readOnly:null,altColCls:'sch-col-alt',highlightedEventCls:'sch-event-highlighted',highlightDirtyEvents:!1,dynamicRowHeight:!0,managedEventSizing:!0,eventAnimations:!0,horizontalLayoutCls:'Sch.eventlayout.Horizontal',horizontalEventSorterFn:null,verticalLayoutCls:'Sch.eventlayout.Vertical',verticalEventSorterFn:null,eventCls:'sch-event',verticalViewClass:'Sch.view.Vertical',eventStore:null,resourceStore:null,eventLayout:null,terminalSides:null,_initializeSchedulerView:function(){var b=Ext.ClassManager.get(this.horizontalLayoutCls);var a=Ext.ClassManager.get(this.verticalLayoutCls);this.eventSelector='.'+this.eventCls;this.eventLayout={};this.eventTpl=this.eventTpl||Ext.create(this.eventTemplateClass,{eventPrefix:this.eventPrefix,terminalSides:this.terminalSides,resizeHandles:this.eventResizeHandles});if(b){this.eventLayout.horizontal=new b(Ext.apply({timeAxisViewModel:this.timeAxisViewModel},{bandIndexToPxConvertFn:this.horizontal.layoutEventVertically,bandIndexToPxConvertScope:this.horizontal},this.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{}))}if(a){this.eventLayout.vertical=new a(Ext.apply({view:this},this.verticalEventSorterFn?{sortEvents:this.verticalEventSorterFn}:{}))}this.store=this.store||this.resourceStore;this.resourceStore=this.resourceStore||this.store},generateTplData:function(a,d,e){var b=this[this.mode].getEventRenderData(a,d,e),f=a.getStartDate(),h=a.getEndDate(),c=a.getCls()||'';c+=' sch-event-resizable-'+a.getResizable();if(a.dirty){c+=' sch-dirty '}if(b.endsOutsideView){c+=' sch-event-endsoutside '}if(b.startsOutsideView){c+=' sch-event-startsoutside '}if(a.isDraggable()===!1){c+=' sch-event-fixed '}if(h-f===0){c+=' sch-event-milestone '}if(a.dirty){c+=' sch-dirty '}if(this.getEventSelectionModel().isSelected(a)){c+=' '+this.selectedEventCls+' '}if(a.isRecurrableEvent){if(a.isRecurring()){c+=' sch-event-recurring '}if(a.isOccurrence()){c+=' sch-event-occurrence '}}if(a.isHighlighted||(this.highlightDirtyEvents?a.dirty:!1)){c+=' '+this.highlightedEventCls+' '}if(this.isWeekView()){b.id=a.internalId+'-calendar-'+e+'-x'}else {b.id=a.internalId+'-'+d.internalId+'-x'}b.internalCls=c;b.start=f;b.end=h;b.iconCls=a.data[this.eventBarIconClsField]||a.getIconCls&&a.getIconCls()||'';b.event=a;if(this.eventRenderer){var g=this.eventRenderer.call(this.eventRendererScope||this,a,d,b,e);if(this.eventBodyTemplate){b.body=this.eventBodyTemplate.apply(g)}else {b.body=g}}else {if(this.eventBodyTemplate){b.body=this.eventBodyTemplate.apply(a.data)}else {if(this.eventBarTextField){b.body=Ext.htmlEncode(a.data[this.eventBarTextField])||''}}}return b},resolveResource:function(b){var a=this;return a[a.mode].resolveResource(b)},getResourceRegion:function(a,b,c){return this[this.mode].getResourceRegion(a,b,c)},resolveEventRecord:function(a){a=a.dom?a.dom:a;if(!Ext.fly(a).is(this.eventSelector)){a=Ext.fly(a).up(this.eventSelector)}return a&&this.getEventRecordFromDomElement(a)},resolveEventRecordFromResourceRow:function(a){var c=this,d=c.getEventSelectionModel(),b,e;a=a.dom?a.dom:a;b=c.getRecord(a);return d.getFirstSelectedEventForResource(b)},resolveAssignmentRecord:function(f){var c=this,d=c.getEventStore().getAssignmentStore(),e=null,b,a;if(d){b=c.getEventRecordFromDomElement(f);a=c.getResourceRecordFromDomElement(f);if(b&&a){e=d.getAssignmentForEventAndResource(b,a)}}return e},getEventRecordFromDomId:function(a){a=this.getEventIdFromDomNodeId(a);return this.getEventStore().getModelByInternalId(a)},getEventRecordFromDomElement:function(a){return this.getEventRecordFromDomId(a.id)},getResourceRecordFromDomId:function(a){a=this.getResourceIdFromDomNodeId(a);return this.getResourceStore().getByInternalId(a)},getResourceRecordFromDomElement:function(a){return this.getResourceRecordFromDomId(a.id)},isDateRangeAvailable:function(c,d,a,b){return this.getEventStore().isDateRangeAvailable(c,d,a,b)},getEventsInView:function(){var a=this.timeAxis.getStart(),b=this.timeAxis.getEnd();return this.getEventStore().getEventsInTimeSpan(a,b)},getEventNodes:function(){return this.getEl().select(this.eventSelector)},triggerHighlightEvents:function(c,b){var d=this;var a=[];Ext.Array.each([].concat(c),function(b){a.push.apply(a,d.getElementsFromEventRecord(b,null,null,!0))});var e=b!==!1?'addCls':'removeCls';Ext.Array.each(c,function(a){a.isHighlighted=b});Ext.Array.each([].concat(a),function(a){Ext.fly(a)[e](d.highlightedEventCls)})},highlightEvents:function(a){this.triggerHighlightEvents(a,!0)},unhighlightEvents:function(a){this.triggerHighlightEvents(a,!1)},highlightEventsBy:function(c,b){var a=this.getEventsInView();this.highlightEvents(a.filterBy(c,b).getRange())},clearHighlightedEvents:function(){Ext.Array.each(this.getEventStore().getRange(),function(a){a.isHighlighted=!1});this.getEl().select('.'+this.highlightedEventCls).removeCls(this.highlightedEventCls)},onEventCreated:function(a,b){},getEventStore:function(){return this.eventStore},registerEventEditor:function(b){var a=this;a.eventEditor=b;a.mon(b.editor||b,{'beforeeventadd':function(){var b=Ext.Array.toArray(arguments);Ext.Array.splice(b,0,1,a);return a.fireEventArgs.call(a,'beforeeventadd',b)}})},getEventEditor:function(){return this.eventEditor},onEventUpdate:function(c,b,a){this[this.mode].onEventUpdate(c,b,a)},onEventAdd:function(b,a){if(!Ext.isArray(a)){a=[a]}this[this.mode].onEventAdd(b,a)},onAssignmentAdd:function(c,a){var b=this;Ext.Array.each(a,function(c){var a=c.getResource();a&&b.repaintEventsForResource(a)})},onAssignmentUpdate:function(g,a){var b=this,d=a.previous&&a.previous[a.resourceIdField],c=a.getResourceId(),f,e;if(d){f=b.getResourceStore().getModelById(d);b.repaintEventsForResource(f)}if(c){e=b.getResourceStore().getModelById(c);b.repaintEventsForResource(e)}},onAssignmentRemove:function(c,b){var a=this;Ext.Array.each(b,function(d){var b=d.getResourceId();var c=b&&a.getResourceStore().getModelById(b);c&&a.repaintEventsForResource(c)})},onEventRemove:function(b,a){this[this.mode].onEventRemove(b,a)},setEventStore:function(b,g){var a=this;var h=a.getEventStore();var c={scope:a,refresh:a.onEventDataRefresh,addrecords:a.onEventAdd,updaterecord:a.onEventUpdate,removerecords:a.onEventRemove,update:a.onEventUpdate,nodeinsert:a.onEventAdd,nodeappend:a.onEventAdd};if(!(b&&b.isTreeStore)){c.remove=a.onEventRemove;c.add=a.onEventAdd}var d={scope:a,refresh:a.onEventDataRefresh,load:a.onEventDataRefresh,update:a.onAssignmentUpdate,add:a.onAssignmentAdd,remove:a.onAssignmentRemove};if(!Ext.versions.touch){c.clear=a.onEventDataRefresh}if(!g&&a.eventStore){if(b){a.eventStore.setResourceStore(null)}if(b!==a.eventStore&&a.eventStore.autoDestroy){a.eventStore.destroy()}else {if(a.mun){a.mun(a.eventStore,c);var e=a.eventStore.getAssignmentStore();if(e){a.mun(e,d)}}else {a.eventStore.un(c)}}if(!b){a.eventStore=null}}if(b){b=Ext.data.StoreManager.lookup(b);if(a.mon){a.mon(b,c)}else {b.on(c)}a.eventStore=b;b.setResourceStore(a.getResourceStore());var f=b.getAssignmentStore();if(f){a.mon(f,d)}}if(b&&!g){this.getTimeAxisViewModel().setEventStore(b);this.getEventSelectionModel().bindStore(b);this.fireEvent('eventstorechange',this,b,h);a.refreshView()}},onEventDataRefresh:function(){this.refreshKeepingScroll()},onEventBarSelect:function(a){var d=this,c,b;if(a&&a.isAssignmentModel){c=a.getEvent();b=a.getResource()}else {c=a;b=null}Ext.Array.each(d.getElementsFromEventRecord(c,b,null,!0),function(a){Ext.fly(a).addCls(d.selectedEventCls)})},onEventBarDeselect:function(a){var d=this,b,c;if(a&&a.isAssignmentModel){b=a.getEvent();c=a.getResource()}else {b=a;c=null}b&&Ext.Array.each(d.getElementsFromEventRecord(b,c,null,!0),function(a){Ext.fly(a).removeCls(d.selectedEventCls)})},refresh:function(){throw 'Abstract method call'},repaintEventsForResource:function(a){throw 'Abstract method call'},repaintAllEvents:function(){this.refreshKeepingScroll()},scrollEventIntoView:function(b,c,e,d,f){var g=this,a=b.getResources();if(a.length>1){Ext.Error.raise('AbstractSchedulerView::scrollEventIntoView() is not applicable for events with multiple assignments, please use AbstractSchedulerView::scrollResourceEventIntoView() instead.')}a.length&&g.scrollResourceEventIntoView(a[0],b,null,c,e,d,f)},getResourceStore:function(){return this.resourceStore},setResourceStore:function(a){var b=this.resourceStore;this.resourceStore=a;if(a){this.fireEvent('resourcestorechange',this,a,b)}},rowHasDynamicRowHeight:function(a){return this.dynamicRowHeight}});Ext.define('Sch.preset.ViewPreset',{requires:['Sch.util.Date'],name:null,rowHeight:24,timeColumnWidth:50,timeRowHeight:null,timeAxisColumnWidth:null,displayDateFormat:'G:i',shiftUnit:'HOUR',shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:'middle',headers:null,mainHeader:0,ptype:'',constructor:function(a){Ext.apply(this,a);this.normalizeUnits()},normalizeUnits:function(){var a=this.headerConfig;var b=Sch.util.Date;for(var c in a){if(a.hasOwnProperty(c)){if(b[a[c].unit]){a[c].unit=b[a[c].unit.toUpperCase()]}if(b[a[c].splitUnit]){a[c].splitUnit=b[a[c].splitUnit.toUpperCase()]}}}var d=this.timeResolution;if(d&&b[d.unit]){d.unit=b[d.unit.toUpperCase()]}var e=this.shiftUnit;if(e&&b[e]){this.shiftUnit=b[e.toUpperCase()]}},getHeaders:function(){if(this.headers){return this.headers}var a=this.headerConfig;this.mainHeader=a.top?1:0;return this.headers=[].concat(a.top||[],a.middle||[],a.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var a=this.getHeaders();return a[a.length-1]},clone:function(){var a={};var b=this;Ext.Array.each(['rowHeight','timeColumnWidth','timeRowHeight','timeAxisColumnWidth','displayDateFormat','shiftUnit','shiftIncrement','defaultSpan','timeResolution','headerConfig'],function(c){a[c]=b[c]});return new this.self(Ext.clone(a))},isValid:function(){var e=Sch.util.Date,a=!0,b=Sch.util.Date.units,d={};for(var c in this.headerConfig){if(this.headerConfig.hasOwnProperty(c)){d[c]=!0;a=a&&Ext.Array.indexOf(b,this.headerConfig[c].unit)>=0}}if(!(this.columnLinesFor in d)){this.columnLinesFor='middle'}if(this.timeResolution){a=a&&Ext.Array.indexOf(b,this.timeResolution.unit)>=0}if(this.shiftUnit){a=a&&Ext.Array.indexOf(b,this.shiftUnit)>=0}return a}});Ext.define('Sch.preset.Manager',{extend:'Ext.util.MixedCollection',requires:['Sch.util.Date','Sch.preset.ViewPreset'],mixins:['Sch.mixin.Localizable'],singleton:!0,defaultPresets:{secondAndMinute:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'G:i:s',shiftIncrement:10,shiftUnit:'MINUTE',defaultSpan:24,timeResolution:{unit:'SECOND',increment:5},headerConfig:{middle:{unit:'SECOND',increment:10,align:'center',dateFormat:'s'},top:{unit:'MINUTE',align:'center',dateFormat:'D, d g:iA'}}},minuteAndHour:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'G:i',shiftIncrement:1,shiftUnit:'HOUR',defaultSpan:24,timeResolution:{unit:'MINUTE',increment:30},headerConfig:{middle:{unit:'MINUTE',increment:'30',align:'center',dateFormat:'i'},top:{unit:'HOUR',align:'center',dateFormat:'D, gA/d'}}},hourAndDay:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'G:i',shiftIncrement:1,shiftUnit:'DAY',defaultSpan:24,timeResolution:{unit:'MINUTE',increment:30},headerConfig:{middle:{unit:'HOUR',align:'center',dateFormat:'G:i'},top:{unit:'DAY',align:'center',dateFormat:'D d/m'}}},dayAndWeek:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d G:i',shiftUnit:'DAY',shiftIncrement:1,defaultSpan:5,timeResolution:{unit:'HOUR',increment:1},headerConfig:{middle:{unit:'DAY',align:'center',dateFormat:'D d M'},top:{unit:'WEEK',align:'center',renderer:function(a,c,b){return Sch.util.Date.getShortNameOfUnit('WEEK')+'.'+Ext.Date.format(a,'W M Y')}}}},weekAndDay:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d',shiftUnit:'WEEK',shiftIncrement:1,defaultSpan:1,timeResolution:{unit:'DAY',increment:1},headerConfig:{bottom:{unit:'DAY',align:'center',increment:1,dateFormat:'d/m'},middle:{unit:'WEEK',dateFormat:'D d M'}}},weekAndMonth:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d',shiftUnit:'WEEK',shiftIncrement:5,defaultSpan:6,timeResolution:{unit:'DAY',increment:1},headerConfig:{middle:{unit:'WEEK',align:'center',renderer:function(a,c,b){return Ext.Date.format(a,'d M')}},top:{unit:'MONTH',align:'center',dateFormat:'M Y'}}},monthAndYear:{timeColumnWidth:110,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d',shiftIncrement:3,shiftUnit:'MONTH',defaultSpan:12,timeResolution:{unit:'DAY',increment:1},headerConfig:{middle:{unit:'MONTH',align:'center',dateFormat:'M Y'},top:{unit:'YEAR',align:'center',dateFormat:'Y'}}},year:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d',shiftUnit:'YEAR',shiftIncrement:1,defaultSpan:1,timeResolution:{unit:'MONTH',increment:1},headerConfig:{middle:{unit:'QUARTER',align:'center',renderer:function(a,c,b){return Ext.String.format(Sch.util.Date.getShortNameOfUnit('QUARTER').toUpperCase()+'{0}',Math.floor(a.getMonth()/3)+1)}},top:{unit:'YEAR',align:'center',dateFormat:'Y'}}},manyYears:{timeColumnWidth:50,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d',shiftUnit:'YEAR',shiftIncrement:1,defaultSpan:1,timeResolution:{unit:'YEAR',increment:1},headerConfig:{middle:{unit:'YEAR',align:'center',dateFormat:'Y',increment:5},bottom:{unit:'YEAR',align:'center',dateFormat:'y',increment:1}}},weekAndDayLetter:{timeColumnWidth:20,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d',shiftUnit:'WEEK',shiftIncrement:1,defaultSpan:10,timeResolution:{unit:'DAY',increment:1},headerConfig:{bottom:{unit:'DAY',align:'center',renderer:function(a){return Ext.Date.dayNames[a.getDay()].substring(0,1)},verticalColumnWidth:25},middle:{unit:'WEEK',dateFormat:'D d M Y',verticalColumnWidth:115}}},weekDateAndMonth:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:'Y-m-d',shiftUnit:'WEEK',shiftIncrement:1,defaultSpan:10,timeResolution:{unit:'DAY',increment:1},headerConfig:{middle:{unit:'WEEK',align:'center',dateFormat:'d'},top:{unit:'MONTH',dateFormat:'Y F'}}},minute:{timeRowHeight:40,displayDateFormat:'G:i',shiftIncrement:1,shiftUnit:'WEEK',defaultSpan:60,timeResolution:{unit:'MINUTE',increment:15},columnLinesFor:'bottom',headerConfig:{bottom:{unit:'MINUTE',increment:15,align:'center',renderer:function(a){return Ext.String.format('<div class="sch-calendarcolumn-ct">'+'<span class="sch-calendarcolumn-hours">{0}</span>'+'<span class="sch-calendarcolumn-minutes {2}">{1}</span>'+'</div>',a.getMinutes()?'':Ext.Date.format(a,'H'),Ext.Date.format(a,'i'),a.getMinutes()?'sch-calendarcolumn-minutes-non-zero':'')}},middle:{unit:'DAY',align:'center',dateFormat:'D d',splitUnit:'DAY'}}},day:{timeRowHeight:40,displayDateFormat:'G:i',shiftIncrement:1,shiftUnit:'DAY',defaultSpan:1,timeResolution:{unit:'MINUTE',increment:30},columnLinesFor:'bottom',headerConfig:{bottom:{unit:'HOUR',align:'center',renderer:function(a){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span>'+'<span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(a,'H'),Ext.Date.format(a,'i'))}},middle:{unit:'DAY',align:'center',dateFormat:'D d/m',splitUnit:'DAY'}}},week:{timeRowHeight:40,displayDateFormat:'G:i',shiftIncrement:1,shiftUnit:'WEEK',defaultSpan:24,timeResolution:{unit:'MINUTE',increment:30},columnLinesFor:'bottom',headerConfig:{bottom:{unit:'HOUR',align:'center',dateFormat:'H:i',renderer:function(a){return Ext.String.format('<div class="sch-calendarcolumn-ct">'+'<span class="sch-calendarcolumn-hours">{0}</span>'+'<span class="sch-calendarcolumn-minutes">{1}</span>'+'</div>',Ext.Date.format(a,'H'),Ext.Date.format(a,'i'))}},middle:{unit:'WEEK',align:'center',dateFormat:'D d',splitUnit:'DAY'}}}},constructor:function(){this.callParent(arguments);this.registerDefaults()},onLocalized:function(){var a=this;this.eachKey(function(d,c){if(a.l10n[d]){var b=a.L(d);b.displayDateFormat&&(c.displayDateFormat=b.displayDateFormat);b.middleDateFormat&&(c.headerConfig.middle.dateFormat=b.middleDateFormat);b.topDateFormat&&(c.headerConfig.top.dateFormat=b.topDateFormat);b.bottomDateFormat&&(c.headerConfig.bottom.dateFormat=b.bottomDateFormat)}})},registerPreset:function(a,c){c.name=a;var b=new Sch.preset.ViewPreset(c);if(b.isValid()){if(this.containsKey(a)){this.removeAtKey(a)}this.add(a,b)}else {throw 'Invalid preset, please check your configuration'}},getPreset:function(a){return this.get(a)},deletePreset:function(a){this.removeAtKey(a)},registerDefaults:function(){var c=this,a=this.defaultPresets;for(var b in a){c.registerPreset(b,a[b])}}});Ext.define('Sch.view.model.TimeAxis',{extend:'Ext.util.Observable',requires:['Ext.Date','Sch.util.Date','Sch.preset.Manager'],timeAxis:null,availableWidth:0,tickWidth:100,snapToIncrement:!1,forceFit:!1,headerConfig:null,headers:null,mainHeader:0,calendar:null,timeAxisColumnWidth:null,resourceColumnWidth:null,weekViewColumnWidth:null,calendarColumnDates:null,headersDatesCache:null,timeColumnWidth:null,rowHeightHorizontal:null,rowHeightVertical:null,mode:'horizontal',suppressFit:!1,refCount:0,columnConfig:{},viewPreset:null,columnLinesFor:'middle',eventStore:null,originalTickWidth:null,constructor:function(c){var a=this;Ext.apply(this,c);a.headersDatesCache={};if(this.viewPreset){if(this.viewPreset instanceof Sch.preset.ViewPreset){this.consumeViewPreset(this.viewPreset)}else {var b=Sch.preset.Manager.getPreset(this.viewPreset);b&&this.consumeViewPreset(b)}}a.timeAxis.on('reconfigure',a.onTimeAxisReconfigure,a);this.callParent(arguments)},isHorizontal:function(){return this.mode==='horizontal'},isVertical:function(){return this.mode==='vertical'},isWeek:function(){return this.mode==='weekview'},hasTimeZone:function(){return this.timeAxis.hasTimeZone()},toTimeZone:function(a){return this.timeAxis.toTimeZone(a)},destroy:function(){this.timeAxis.un('reconfigure',this.onTimeAxisReconfigure,this)},onTimeAxisReconfigure:function(b,a){if(!a){this.update()}},reconfigure:function(b){this.headers=null;Ext.apply(this,b);var a;if(this.isHorizontal()){a=this.timeColumnWidth}else {a=this.rowHeightVertical}this.setTickWidth(a);this.fireEvent('reconfigure',this)},getColumnConfig:function(){return this.columnConfig},update:function(e,f){var d=this.timeAxis,b=this.headerConfig;this.availableWidth=Math.max(e||this.availableWidth,0);if(!Ext.isNumber(this.availableWidth)){throw new Error('Invalid available width provided to Sch.view.model.TimeAxis')}if(this.forceFit&&this.availableWidth<=0){return}this.columnConfig={};for(var a in b){if(b[a].cellGenerator){this.columnConfig[a]=b[a].cellGenerator.call(this,d.getStart(),d.getEnd())}else {this.columnConfig[a]=this.createHeaderRow(a,b[a])}}var c=this.calculateTickWidth(this.originalTickWidth);if(!Ext.isNumber(c)||c<=0){throw new Error('Invalid column width calculated in Sch.view.model.TimeAxis')}this.updateTickWidth(c);if(!f){this.fireEvent('update',this)}},updateCalendarColumnDates:function(b){this.calendarColumnDates=[];for(var a=0;a<b.length;a++){var c=b[a];this.calendarColumnDates.push([c.start,c.end])}},getCalendarColumnDates:function(){return this.calendarColumnDates},createHeaderRow:function(d,a){var e=[],c=this,h=a.align,i=Ext.Date.clearTime(new Date()),b=this.calendar;if(b){var g=b.model.getField(b.model.prototype.clsField),f=g.getDefaultValue().trim()}c.headersDatesCache[d]={};c.forEachInterval(d,function(g,k,n){var j={align:h,start:g,end:k,headerCls:''};if(c.hasTimeZone()&&!this.timeAxis.isUTCTimeZone()){g=this.toTimeZone(g);k=this.toTimeZone(k)}c.headersDatesCache[d][g.getTime()]=1;if(a.renderer){j.header=a.renderer.call(a.scope||c,g,k,j,n,c.eventStore)}else {if(this.timeAxis.isUTCTimeZone()){j.header=Sch.util.Date.format(g,a.dateFormat,this.timeAxis.timeZone)}else {j.header=Ext.Date.format(g,a.dateFormat)}}if(a.unit===Sch.util.Date.DAY&&(!a.increment||a.increment===1)){j.headerCls+=' sch-dayheadercell-'+g.getDay();if(b){if(!b.isWorkingDay(g)){j.headerCls+=' sch-dayheadercell-nonworking'}var m=b.getCalendarDay(g),l=m.getCls().trim();if(l!=f){j.headerCls+=' '+l}}if(Ext.Date.clearTime(g,!0)-i===0){j.headerCls+=' sch-dayheadercell-today'}}e.push(j)});return e},getDistanceBetweenDates:function(a,b){return Math.round(this.getPositionFromDate(b,!0)-this.getPositionFromDate(a))},getPositionFromDate:function(i,m){var a=-1;if(this.isWeek()){var f=this.rowHeightVertical;var h=this.getHeaders();var g=this.timeAxis.getStart();var j=Sch.util.Date;var l=j.copyTimeValues(Ext.Date.clone(g),i);a=j.getDurationInUnit(g,l,h[1].unit,!0)/(h[1].increment||1)*f;if(a===0&&m){a=this.calendarRowsAmount*f}}else {var b=this.timeAxis.getTickFromDate(i);var c=this.getTickWidth();if(this.hasTimeZone()&&this.timeAxis.isTickLengthVarying()){var e=this.timeAxis.getCount(),d=c*(1-this.timeAxis.timezoneTickStart),k=c*(1-e+this.timeAxis.timezoneTickEnd);if(b<=1){a=b*d}else {if(b===e){a=this.getTotalWidth()}else {if(b>e-1){a=d+(Math.floor(b)-1)*c+b%1*k}else {a=d+(b-1)*c}}}}else {if(b>=0){a=this.getTickWidth()*(b-this.timeAxis.visibleTickStart)}}}return Math.round(a)},getDateFromPosition:function(a,e){if(this.isWeek()){var g=this.getCalendarColumnDates();if(!g){return null}var o=Math.min(Math.floor(Math.max(a[0],0)/this.weekViewColumnWidth),g.length-1),n=g[o][0],k=this.timeAxis.first(),m=(k.get('end')-k.get('start'))/this.rowHeightVertical,l=Sch.util.Date,h=l.add(n,l.MILLI,Math.round(a[1]*m));if(e){h=this.timeAxis[e+'Date'](h)}return h}else {var b;var d=this.getTickWidth();var f=this.timeAxis.getCount();if(this.hasTimeZone()&&this.timeAxis.isTickLengthVarying()){var c=d*(1-this.timeAxis.timezoneTickStart),j=d*(1-f+this.timeAxis.timezoneTickEnd),i=this.getTotalWidth()-c-j;if(a<c){b=a/c}else {if(a-c>=i){b=f-1+(a-c-i)/j}else {b=(a-c)/d+1}}}else {b=a/d+this.timeAxis.visibleTickStart}if(b<0||b>f){return null}return this.timeAxis.getDateFromTick(b,e)}},getSingleUnitInPixels:function(a){return Sch.util.Date.getUnitToBaseUnitRatio(this.timeAxis.getUnit(),a)*this.getTickWidth()/this.timeAxis.increment},getSnapPixelAmount:function(){if(this.snapToIncrement){var a=this.timeAxis.getResolution();return (a.increment||1)*this.getSingleUnitInPixels(a.unit)}else {return 1}},getTickWidth:function(){return this.tickWidth},setTickWidth:function(a,b){this.originalTickWidth=a;this.updateTickWidth(a);this.update(null,b)},updateTickWidth:function(a){this.tickWidth=a;this[this.isHorizontal()?'timeColumnWidth':'rowHeightVertical']=a},getTotalWidth:function(){return Math.round(this.getTickWidth()*this.timeAxis.getVisibleTickTimeSpan())},calculateTickWidth:function(e){var b=this.forceFit;var c=this.timeAxis;var d=0,f=c.getUnit(),a=Number.MAX_VALUE,g=Sch.util.Date;if(this.snapToIncrement){var i=c.getResolution();a=g.getUnitToBaseUnitRatio(f,i.unit)*i.increment}else {var j=g.getMeasuringUnit(f);a=Math.min(a,g.getUnitToBaseUnitRatio(f,j))}if(!this.suppressFit){var l=this.isWeek()?c.endTime-c.startTime:c.getVisibleTickTimeSpan(),h=Math[b?'floor':'round'](this.getAvailableWidth()/l);d=b||e<h?h:e;if(a>0&&(!b||a<1)){var k=Ext.versions.touch&&b?'ceil':b?'floor':'round';d=Math.round(Math.max(1,Math[k](a*d))/a)}}else {d=e}return d},getAvailableWidth:function(){return this.availableWidth},setAvailableWidth:function(b){var c=this.availableWidth;this.availableWidth=Math.max(0,b);var a=this.calculateTickWidth(this.originalTickWidth);var d=a>0&&(c!==b&&this.forceFit||a!==this.getTickWidth());if(d){this.update()}},fitToAvailableWidth:function(b){var a=Math.floor(this.availableWidth/this.timeAxis.getVisibleTickTimeSpan());this.setTickWidth(a,b)},setForceFit:function(a){if(a!==this.forceFit){this.forceFit=a;this.update()}},setSnapToIncrement:function(a){if(a!==this.snapToIncrement){this.snapToIncrement=a;this.update()}},getViewRowHeight:function(){var a=this.isHorizontal()?this.rowHeightHorizontal:this.rowHeightVertical;if(!a){throw new Error('rowHeight info not available')}return a},setViewRowHeight:function(a,b){var c='rowHeight'+Ext.String.capitalize(this.mode);if(this[c]!=a){this[c]=a;if(this.isHorizontal()){if(!b){this.fireEvent('update',this)}}else {this.setTickWidth(a,b)}}},setViewColumnWidth:function(a,b){if(this.isHorizontal()){this.setTickWidth(a,b)}else {if(this.isVertical()){this.resourceColumnWidth=a}else {if(this.isWeek()){this.weekViewColumnWidth=a}}}if(!b){this.fireEvent('columnwidthchange',this,a)}},getHeaders:function(){if(this.headers){return this.headers}var a=this.headerConfig;this.mainHeader=a.top?1:0;return this.headers=[].concat(a.top||[],a.middle||[],a.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var a=this.getHeaders();return a[a.length-1]},getLowestHeader:function(){return 'bottom' in this.headerConfig?'bottom':'middle'},getMajorHeaderName:function(){var a=this.headerConfig;if(a.bottom){return 'middle'}if(a.top){return 'top'}return null},isMajorTick:function(b){var a=this.getMajorHeaderName();if(this.hasTimeZone()&&!this.timeAxis.isUTCTimeZone()){b=Sch.util.Date.toTimeZone(b,this.timeAxis.timeZone)}return a&&this.headersDatesCache[a]&&this.headersDatesCache[a][b.getTime()]||!1},forEachInterval:function(c,d,a){a=a||this;var b=this.headerConfig;if(!b){return}if(c==='top'||c==='middle'&&b.bottom){var e=b[c];this.timeAxis.forEachAuxInterval(e.unit,e.increment,d,a)}else {this.timeAxis.each(function(b,c){return d.call(a,b.data.start,b.data.end,c)})}},forEachMainInterval:function(a,b){this.forEachInterval('middle',a,b)},consumeViewPreset:function(a){this.headers=null;Ext.apply(this,{headerConfig:a.headerConfig,columnLinesFor:a.columnLinesFor||'middle',rowHeightHorizontal:a.rowHeight,tickWidth:this.isHorizontal()?a.timeColumnWidth:a.timeRowHeight||a.timeColumnWidth||60,timeColumnWidth:a.timeColumnWidth,rowHeightVertical:a.timeRowHeight||a.timeColumnWidth||60,timeAxisColumnWidth:a.timeAxisColumnWidth,resourceColumnWidth:a.resourceColumnWidth||100});this.originalTickWidth=this.getTickWidth()},setEventStore:function(a){this.eventStore=a},setCalendar:function(a){if(a!==this.calendar){this.calendar=a;if(a){this.update()}}}});Ext.define('Sch.mixin.Zoomable',{zoomOnMouseWheel:!0,preventScrollZoom:!1,zoomLevels:[{width:40,increment:1,resolution:1,preset:'manyYears',resolutionUnit:'YEAR'},{width:80,increment:1,resolution:1,preset:'manyYears',resolutionUnit:'YEAR'},{width:30,increment:1,resolution:1,preset:'year',resolutionUnit:'MONTH'},{width:50,increment:1,resolution:1,preset:'year',resolutionUnit:'MONTH'},{width:100,increment:1,resolution:1,preset:'year',resolutionUnit:'MONTH'},{width:200,increment:1,resolution:1,preset:'year',resolutionUnit:'MONTH'},{width:100,increment:1,resolution:7,preset:'monthAndYear',resolutionUnit:'DAY'},{width:30,increment:1,resolution:1,preset:'weekDateAndMonth',resolutionUnit:'DAY'},{width:35,increment:1,resolution:1,preset:'weekAndMonth',resolutionUnit:'DAY'},{width:50,increment:1,resolution:1,preset:'weekAndMonth',resolutionUnit:'DAY'},{width:20,increment:1,resolution:1,preset:'weekAndDayLetter'},{width:50,increment:1,resolution:1,preset:'weekAndDay',resolutionUnit:'HOUR'},{width:100,increment:1,resolution:1,preset:'weekAndDay',resolutionUnit:'HOUR'},{width:50,increment:6,resolution:30,preset:'hourAndDay',resolutionUnit:'MINUTE'},{width:100,increment:6,resolution:30,preset:'hourAndDay',resolutionUnit:'MINUTE'},{width:60,increment:2,resolution:30,preset:'hourAndDay',resolutionUnit:'MINUTE'},{width:60,increment:1,resolution:30,preset:'hourAndDay',resolutionUnit:'MINUTE'},{width:30,increment:15,resolution:5,preset:'minuteAndHour'},{width:60,increment:15,resolution:5,preset:'minuteAndHour'},{width:130,increment:15,resolution:5,preset:'minuteAndHour'},{width:60,increment:5,resolution:5,preset:'minuteAndHour'},{width:100,increment:5,resolution:5,preset:'minuteAndHour'},{width:50,increment:2,resolution:1,preset:'minuteAndHour'},{width:30,increment:10,resolution:5,preset:'secondAndMinute'},{width:60,increment:10,resolution:5,preset:'secondAndMinute'},{width:130,increment:5,resolution:5,preset:'secondAndMinute'}],minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:!1,initializeZooming:function(){this.zoomLevels=this.zoomLevels.slice();this.setMinZoomLevel(this.minZoomLevel||0);this.setMaxZoomLevel(this.maxZoomLevel!==null?this.maxZoomLevel:this.zoomLevels.length-1);this.on('viewready',this.onTimelineReady,this)},getZoomLevelUnit:function(a){return Sch.preset.Manager.getPreset(a.preset).getBottomHeader().unit},getMilliSecondsPerPixelForZoomLevel:function(a,b){var c=Sch.util.Date;return Math.round((c.add(new Date(1,0,1),this.getZoomLevelUnit(a),a.increment)-new Date(1,0,1))/(b?a.width:a.actualWidth||a.width))},presetToZoomLevel:function(b){var a=Sch.preset.Manager.getPreset(b);return {preset:b,increment:a.getBottomHeader().increment||1,resolution:a.timeResolution.increment,resolutionUnit:a.timeResolution.unit,width:a.timeColumnWidth}},calculateCurrentZoomLevel:function(){var a=this.presetToZoomLevel(this.viewPreset),g=Number.MAX_VALUE,e=this.timeAxisViewModel,d=e.timeColumnWidth;a.width=d;a.increment=e.getBottomHeader().increment||1;for(var c=0,h=this.zoomLevels.length;c<h;c++){var b=this.zoomLevels[c];if(b.preset!==a.preset){continue}var f=Math.abs(b.width-d);if(f<g){g=f;a.actualWidth=b.actualWidth;a.width=b.width}}return a},getCurrentZoomLevelIndex:function(){var e=this.calculateCurrentZoomLevel();var b=this.getMilliSecondsPerPixelForZoomLevel(e);var c=this.zoomLevels;for(var a=0;a<c.length;a++){var d=this.getMilliSecondsPerPixelForZoomLevel(c[a]);if(d==b){return a}if(a===0&&b>d){return -0.5}if(a==c.length-1&&b<d){return c.length-1+0.5}var f=this.getMilliSecondsPerPixelForZoomLevel(c[a+1]);if(d>b&&b>f){return a+0.5}}throw new Error("Can't find current zoom level index")},setMaxZoomLevel:function(a){if(a<0||a>=this.zoomLevels.length){throw new Error('Invalid range for `setMinZoomLevel`')}this.maxZoomLevel=a},setMinZoomLevel:function(a){if(a<0||a>=this.zoomLevels.length){throw new Error('Invalid range for `setMinZoomLevel`')}this.minZoomLevel=a},zoomToLevel:function(d,b,e){d=Ext.Number.constrain(d,this.minZoomLevel,this.maxZoomLevel);e=e||{};var k=this.calculateCurrentZoomLevel();var l=this.getMilliSecondsPerPixelForZoomLevel(k);var a=this.zoomLevels[d];var m=this.getMilliSecondsPerPixelForZoomLevel(a);if(this.getMode()!=='horizontal'||l==m&&!b){return null}var f=this;f.fireEvent('beforezoomchange',f,d);var j=this.getSchedulingView();if(!this.rendered){this.on('afterlayout',Ext.Function.bind(this.zoomToLevel,this,[d,b,e]),null,{single:!0});return}var o=j.getOuterEl();var i=this.isVertical();var h=e.centerDate||(b?new Date((b.start.getTime()+b.end.getTime())/2):this.getViewportCenterDateCached());var n=i?j.getViewContainerHeight():o.getWidth();var c=Sch.preset.Manager.getPreset(a.preset).clone();c.name=a.preset;var g=c.getBottomHeader();b=this.calculateOptimalDateRange(h,n,a,b);c[i?'timeRowHeight':'timeColumnWidth']=e.customWidth||a.width;g.increment=a.increment;this.isZooming=!0;c.increment=a.increment;c.timeResolution.unit=Sch.util.Date.getUnitByName(a.resolutionUnit||c.timeResolution.unit||g.unit);c.timeResolution.increment=a.resolution;this.setViewPreset(c,b.start||this.getStart(),b.end||this.getEnd(),!1,{centerDate:h});a.actualWidth=this.timeAxisViewModel.getTickWidth();f.isZooming=!1;f.fireEvent('zoomchange',f,d);return d},setZoomLevel:function(){this.zoomToLevel.apply(this,arguments)},zoomToSpan:function(j,a){var u=this.getSchedulingView();a=a||{};if(a.leftMargin||a.rightMargin){a.adjustStart=0;a.adjustEnd=0}Ext.applyIf(a,{leftMargin:0,rightMargin:0});if(!this.rendered){this.on('afterlayout',Ext.Function.bind(this.zoomToSpan,this,[j,a]),null,{single:!0});return}if(j.start&&j.end){var b=j.start,c=j.end,n=a.adjustStart>=0&&a.adjustEnd>=0;if(n){b=Sch.util.Date.add(b,this.timeAxis.mainUnit,-a.adjustStart);c=Sch.util.Date.add(c,this.timeAxis.mainUnit,a.adjustEnd)}if(b<=c){var g=u.getTimeAxisViewModel().getAvailableWidth();var i=Math.floor(this.getCurrentZoomLevelIndex());if(i==-1){i=0}var l=this.zoomLevels;var r=c-b||1,h=this.getMilliSecondsPerPixelForZoomLevel(l[i],!0),k=r/h+a.leftMargin+a.rightMargin>g?-1:1,d=i+k;var f,e=null;while(d>=0&&d<=l.length-1){f=l[d];h=this.getMilliSecondsPerPixelForZoomLevel(f,!0);var q=r/h+a.leftMargin+a.rightMargin;if(k==-1){if(q<=g){e=d;break}}else {if(q<=g){if(i!==d-k){e=d}}else {break}}d+=k}e=e!==null?e:d-k;f=l[e];var t=Sch.preset.Manager.getPreset(f.preset).getBottomHeader().unit;if(a.leftMargin||a.rightMargin){b=new Date(b.getTime()-h*a.leftMargin);c=new Date(c.getTime()+h*a.rightMargin)}var o=Sch.util.Date.getDurationInUnit(b,c,t,!0)/f.increment;if(o===0){return}var s=Math.floor(g/o);var p=new Date((b.getTime()+c.getTime())/2);var m;if(n){m={start:b,end:c}}else {m=this.calculateOptimalDateRange(p,g,f)}return this.zoomToLevel(e,m,{customWidth:s,centerDate:p})}}return null},zoomIn:function(a){a=a||1;var b=this.getCurrentZoomLevelIndex();if(b>=this.zoomLevels.length-1){return null}return this.zoomToLevel(Math.floor(b)+a)},zoomOut:function(a){a=a||1;var b=this.getCurrentZoomLevelIndex();if(b<=0){return null}return this.zoomToLevel(Math.ceil(b)-a)},zoomInFull:function(){return this.zoomToLevel(this.maxZoomLevel)},zoomOutFull:function(){return this.zoomToLevel(this.minZoomLevel)},calculateOptimalDateRange:function(g,j,c,f){if(f){return f}var a=this.timeAxis;if(this.zoomKeepsOriginalTimespan){return {start:a.getStart(),end:a.getEnd()}}var i=Sch.util.Date;var e=this.getZoomLevelUnit(c);var h=Math.ceil(j/c.width*c.increment*this.visibleZoomFactor/2);var b=i.add(g,e,-h);var d=i.add(g,e,h);b=a.floorDate(b,!1,e,c.increment);d=a.ceilDate(d,!1,e,c.increment);if(a.hasTimeZone()){b=a.fromTimeZone(b);d=a.fromTimeZone(d)}return {start:b,end:d}},onTimelineReady:function(){if(this.zoomOnMouseWheel){this.getSchedulingView().getEl().on('wheel',this.onWheel,this,{capture:!0});this.on('destroy',function(){clearTimeout(this.scrollWheelBlockTimeout)})}},onWheel:function(b){var a=this;if(b.ctrlKey){b.preventDefault();if(!a.preventScrollZoom){if(b.browserEvent.deltaY>0){a.zoomOut()}else {if(b.browserEvent.deltaY<0){a.zoomIn()}}a.preventScrollZoom=!0;a.scrollWheelBlockTimeout=setTimeout(function(){a.preventScrollZoom=!1},30)}}}});Ext.define('Sch.mixin.AbstractTimelinePanel',{requires:['Sch.data.TimeAxis','Sch.view.model.TimeAxis','Sch.feature.ColumnLines','Sch.preset.Manager'],mixins:['Sch.mixin.Zoomable'],snapToIncrement:!1,readOnly:!1,forceFit:!1,eventResizeHandles:'both',timeAxis:null,autoAdjustTimeAxis:!0,timeAxisViewModel:null,crudManager:null,viewPreset:'weekAndDay',trackHeaderOver:!0,startDate:null,endDate:null,startTime:0,endTime:24,timeZone:null,columnLines:!0,getDateConstraints:Ext.emptyFn,snapRelativeToEventStartDate:!1,trackMouseOver:!1,readRowHeightFromPreset:!0,eventBorderWidth:1,cachedCenterDate:null,cellBorderWidth:1,cellTopBorderWidth:0,cellBottomBorderWidth:0,renderers:null,getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==='horizontal'},isVertical:function(){return this.getMode()==='vertical'},isWeekView:function(){return this.getMode()==='weekview'},_initializeTimelinePanel:function(){if(this.mode){if(this.mode==='calendar'){this.mode='weekview'}}else {this.mode='horizontal'}this.applyViewPreset(this.viewPreset);if(this.isWeekView()){if(!this.viewPreset.headerConfig.middle.splitUnit){this._oldViewPresetArgs=[this.viewPreset];this.viewPreset=this.calendarViewPreset||'week'}}this.initializeZooming();this.on('viewchange',this.clearCenterDateCache,this);this.on('viewready',this.setupClearCenterDateCache,this);this.renderers=[];if(this.readRowHeightFromPreset){this.readRowHeightFromPreset=!this.rowHeight}if(!(this.timeAxis instanceof Sch.data.TimeAxis)){this.timeAxis=Ext.create(Ext.applyIf(this.timeAxis||{},{xclass:'Sch.data.TimeAxis',autoAdjust:this.autoAdjustTimeAxis,mode:this.isWeekView()?'week':'plain'}))}if(!(this.timeAxisViewModel instanceof Sch.view.model.TimeAxis)){this.timeAxisViewModel=Ext.create(Ext.applyIf(this.timeAxisViewModel||{},{xclass:'Sch.view.model.TimeAxis',mode:this.mode,snapToIncrement:this.snapToIncrement,forceFit:this.forceFit,timeAxis:this.timeAxis,eventStore:this.getEventStore(),viewPreset:this.viewPreset}))}if(this.rowHeight){this.setRowHeight(this.rowHeight,!0);this.rowHeight=null}this.timeAxisViewModel.on('update',this.onTimeAxisViewModelUpdate,this);this.timeAxisViewModel.refCount++;this.on('destroy',this.onPanelDestroyed,this);var a;if(this.isHorizontal()){a=['sch-horizontal']}else {if(this.isVertical()){a=['sch-vertical','sch-vertical-resource']}else {if(this.isWeekView()){a=['sch-vertical','sch-calendar']}}}this.addCls([].concat.apply(['sch-timelinepanel'],a))},applyViewPreset:function(a){var b;if(Ext.isString(a)){b=Sch.preset.Manager.getPreset(a);if(!b){throw 'You must define a valid view preset object. See Sch.preset.Manager class for reference'}}else {if(Ext.isObject(a)){var c=a.name&&Sch.preset.Manager.getPreset(a.name);if(c){b=new Sch.preset.ViewPreset(Ext.applyIf(a,c))}else {var d=a.name||'preset'+Sch.preset.Manager.getCount();Sch.preset.Manager.registerPreset(d,a);b=Sch.preset.Manager.getPreset(d)}}}this.viewPreset=b},onTimeAxisViewModelUpdate:function(){var a=this.getSchedulingView();if(a&&a.viewReady){a.refreshKeepingScroll()}this.fireEvent('viewchange',this)},onPanelDestroyed:function(){var a=this.timeAxisViewModel;a.un('update',this.onTimeAxisViewModelUpdate,this);a.refCount--;if(a.refCount<=0){a.destroy()}},getSchedulingView:function(){throw 'Abstract method call'},setReadOnly:function(b){var a=this;a.getSchedulingView().setReadOnly(b);if(a.allDayNormalHeader){a.allDayNormalHeader.setReadOnly(b)}},isReadOnly:function(){return this.getSchedulingView().isReadOnly()},setupClearCenterDateCache:function(){this.mon(this.getSchedulingView().getScrollable(),'scroll',this.clearCenterDateCache,this)},getViewportCenterDateCached:function(){if(this.cachedCenterDate){return this.cachedCenterDate}return this.cachedCenterDate=this.getViewportCenterDate()},clearCenterDateCache:function(f,d,e){var c=this.isHorizontal(),a=this.viewPresetActiveScroll;var b=a&&(c?d===a.left:e==a.top);if(!b){this.cachedCenterDate=null;this.viewPresetActiveScroll=null}},switchViewPreset:function(){this.setViewPreset.apply(this,arguments)},setViewPreset:function(a,e,g,n,i){i=i||{};var c=i.centerDate,f=this.timeAxis,b=this.getSchedulingView();if(typeof a==='string'){a=Sch.preset.Manager.getPreset(a)}if(!a){throw new Error('View preset not found')}if(this.fireEvent('beforeviewchange',this,a,e,g)!==!1){this.viewPreset=a.name;var l=this.isHorizontal(),m=this.isVertical();b.setDisplayDateFormat(a.displayDateFormat);if(!(n&&f.isConfigured)){var d={weekStartDay:this.weekStartDay!==undefined?this.weekStartDay:this.L?this.L('weekStartDay'):1,startTime:this.startTime,endTime:this.endTime,timeZone:this.timeZone};if(n||!this.rendered){if(f.getCount()===0||e){d.start=e||new Date();d.end=g}}else {if(e){d.start=e;d.end=g;if(!c&&g){if(this.infiniteScroll&&b.cachedScrollDate&&b.cachedScrollDateIsCentered){c=b.cachedScrollDate}else {c=new Date((e.getTime()+g.getTime())/2)}}}else {d.start=f.getStart();d.end=g||f.getEnd();if(!c){if(this.infiniteScroll&&b.cachedScrollDate&&b.cachedScrollDateIsCentered){c=b.cachedScrollDate}else {c=this.getViewportCenterDateCached()}}}}f.consumeViewPreset(a);f.reconfigure(d,!0);this.timeAxisViewModel.reconfigure({viewPreset:this.viewPreset,headerConfig:a.headerConfig,columnLinesFor:a.columnLinesFor||'middle',rowHeightHorizontal:this.readRowHeightFromPreset?a.rowHeight:this.timeAxisViewModel.getViewRowHeight(),tickWidth:l?a.timeColumnWidth:a.timeRowHeight||a.timeColumnWidth||60,timeColumnWidth:a.timeColumnWidth,rowHeightVertical:a.timeRowHeight||a.timeColumnWidth||60,timeAxisColumnWidth:a.timeAxisColumnWidth,resourceColumnWidth:this.resourceColumnWidth||a.resourceColumnWidth||100})}if(m){b.setColumnWidth(this.resourceColumnWidth||a.resourceColumnWidth||100,!0)}var o=b.getOuterEl();if(!i.notScroll&&o&&this.getView().el){if(c){this.cachedCenterDate=c;var h=null,j=null;if(m){j=Math.max(Math.floor(b.getCoordinateFromDate(c,!0)-b.getViewContainerHeight()/2),0);this.viewPresetActiveScroll={top:j};b.scrollVerticallyTo(j)}else {h=Math.max(Math.floor(b.getCoordinateFromDate(c,!0)-o.getWidth()/2),0);this.viewPresetActiveScroll={left:h};if(Ext.getVersion().isGreaterThan('6.2.0')){var k=b.up('timelinegrid,timelinetree').normalScrollbarScroller;k&&k.scrollTo(h)}b.headerCt.scrollTo(h);b.scrollTo(h)}}else {if(l){b.scrollHorizontallyTo(0)}else {b.scrollVerticallyTo(0)}}}}},getViewPreset:function(){return this.viewPreset},getStart:function(){return this.getStartDate()},getStartDate:function(){return this.timeAxis.getStart()},getEnd:function(){return this.getEndDate()},getEndDate:function(){return this.timeAxis.getEnd()},setTimeColumnWidth:function(b,a){this.timeAxisViewModel.setTickWidth(b,a)},getTimeColumnWidth:function(){return this.timeAxisViewModel.getTickWidth()},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},shiftNext:function(a){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftNext(a);this.suspendLayouts&&this.resumeLayouts(!0)},shiftPrevious:function(a){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftPrevious(a);this.suspendLayouts&&this.resumeLayouts(!0)},goToNow:function(){this.setTimeSpan(new Date())},getTimezone:function(){return this.timeAxis.timeZone},setTimeZone:function(a){this.timeZone=a;this.setTimeSpan(this.getStart(),this.getEnd(),a)},setTimeSpan:function(b,c,a){if(this.timeAxis){this.timeAxis.setTimeSpan(b,c,a)}},setStart:function(a){this.setStartDate(a)},setEnd:function(a){this.setEndDate(a)},setStartDate:function(a){this.setTimeSpan(a)},setEndDate:function(a){this.setTimeSpan(null,a)},getTimeAxis:function(){return this.timeAxis},scrollToDate:function(a,c,d){var e=this.getSchedulingView();var b=e.getCoordinateFromDate(a,!0);this.scrollToCoordinate(b,a,c,!1,d)},scrollToDateCentered:function(c,e){var a=this.getSchedulingView();var b=0;if(a.isHorizontal()){b=a.getBox().width/2}else {b=a.getBox().height/2}var d=Math.round(a.getCoordinateFromDate(c,!0)-b);this.scrollToCoordinate(d,c,e,!0)},scrollToCoordinate:function(e,b,c,i,a){var d=this.getSchedulingView();var j=this;a=a||0;if(e<0&&!d.isWeekView()){if(this.infiniteScroll){d.shiftToDate(b,i)}else {var f=(this.timeAxis.getEnd()-this.timeAxis.getStart())/2;var g=new Date(b.getTime()-f);var h=new Date(b.getTime()+f);if(g-this.getStart()!==0&&h-this.getEnd()!==0){this.setTimeSpan(g,h);if(i){j.scrollToDateCentered(b,c)}else {j.scrollToDate(b,c,a)}}}return}if(this.isHorizontal()){d.scrollHorizontallyTo(e-a,c)}else {d.scrollVerticallyTo(e-a,c)}},getViewportCenterDate:function(){return this.getSchedulingView().getViewportCenterDate()},addCls:function(){throw 'Abstract method call'},removeCls:function(){throw 'Abstract method call'},registerRenderer:function(b,a){this.renderers.push({fn:b,scope:a})},deregisterRenderer:function(a,b){Ext.each(this.renderers,function(b,c){if(a===b){Ext.Array.removeAt(this.renderers,c);return !1}})},getCrudManager:function(){return this.crudManager},setCrudManager:function(a){this.crudManager=a}});Ext.define('Sch.view.Horizontal',{requires:['Ext.util.Region','Ext.Element','Ext.Array','Sch.util.Date'],fadeOutRemoval:!0,view:null,constructor:function(a){Ext.apply(this,a)},getElementsFromEventRecord:function(e,d,f,c){var b=this.view,a;c=c||!1;if(d){a='[id^='+b.eventPrefix+e.internalId+'-'+d.internalId+'-]'}else {a='[id^='+b.eventPrefix+e.internalId+'-]'}return b.getEl().query(a,c)},translateToScheduleCoordinate:function(c){var a=this.view;var b;if(a.shouldAdjustForRtl()){b=a.getEl().getRight()-c}else {b=c-a.getEl().getX()}return b+a.getScroll().left},translateToPageCoordinate:function(b){var a=this.view;return b+a.getEl().getX()-a.getScroll().left},getDateFromXY:function(d,b,c){var a=d[0];if(!c){a=this.translateToScheduleCoordinate(a)}return this.view.timeAxisViewModel.getDateFromPosition(a,b)},getEventRenderData:function(g){var d=g.getStartDate(),e=g.getEndDate()||d,a=this.view,i=a.timeAxis.getStart(),j=a.timeAxis.getEnd(),c=Math,f=a.getCoordinateFromDate(Sch.util.Date.max(d,i)),h=a.getCoordinateFromDate(Sch.util.Date.min(e,j)),b={event:g};if(this.view.rtl){b.right=c.min(f,h)}else {b.left=c.min(f,h)}b.width=c.max(1,c.abs(h-f))-a.eventBorderWidth;if(a.managedEventSizing){b.top=c.max(0,a.barMargin-a.eventBorderWidth+a.cellTopBorderWidth);b.height=a.timeAxisViewModel.rowHeightHorizontal-2*a.barMargin-a.eventBorderWidth}b.start=d;b.end=e;b.startsOutsideView=d<i;b.endsOutsideView=e>j;return b},getScheduleRegion:function(c,d){var b=this.view,a;if(c){var g=d&&b.getElementsFromEventRecord(d,c)[0];a=Ext.fly(b.getRowNode(c)).getRegion();if(g){var f=g.getRegion();a.top=f.top;a.bottom=f.bottom}else {a.top=a.top+b.barMargin;a.bottom=a.bottom-b.barMargin-b.eventBorderWidth}}else {a=b.getTableRegion();a.top=a.top+b.barMargin;a.bottom=a.bottom-b.barMargin-b.eventBorderWidth}var h=b.timeAxis.getStart(),j=b.timeAxis.getEnd(),e=b.getDateConstraints(c,d)||{start:h,end:j},i=this.translateToPageCoordinate(b.getCoordinateFromDate(Sch.util.Date.max(h,e.start))),k=this.translateToPageCoordinate(b.getCoordinateFromDate(Sch.util.Date.min(j,e.end))),m=a.top,l=a.bottom;return new Ext.util.Region(m,Math.max(i,k),l,Math.min(i,k))},getResourceRegion:function(m,c,d){var a=this.view,f=a.getRowNode(m),e=Ext.fly(f).getOffsetsTo(a.getEl()),g=a.timeAxis.getStart(),j=a.timeAxis.getEnd(),n=c?Sch.util.Date.max(g,c):g,o=d?Sch.util.Date.min(j,d):j,i=a.getCoordinateFromDate(n),k=a.getCoordinateFromDate(o),l=e[1]+a.cellTopBorderWidth,h=e[1]+Ext.fly(f).getHeight()-a.cellBottomBorderWidth;if(!Ext.versions.touch){var b=a.getScroll();l+=b.top;h+=b.top}return new Ext.util.Region(l,Math.max(i,k),h,Math.min(i,k))},getScheduledEventsForResource:function(b){var a=this.view;return a.getEventStore().filterEventsForResource(b,function(b){return a.timeAxis.isRangeInAxis(b)&&b.isScheduled()})},columnRenderer:function(j,h,b,f,i){var a=this.view,d=this.getScheduledEventsForResource(b);if(d.length===0){return}var e=d.map(function(c){return a.generateTplData(c,b,f)});if(a.rowHasDynamicRowHeight(b)){var g=a.eventLayout.horizontal;var c=g.applyLayout(e,b,this.layoutEventVertically,this);h.rowHeight=c*a.timeAxisViewModel.rowHeightHorizontal-(c-1)*a.barMargin}return a.eventTpl.apply(e)},layoutEventVertically:function(b,d){var a=this.view;var c=b===0?a.barMargin:b*a.timeAxisViewModel.rowHeightHorizontal-(b-1)*a.barMargin;c+=a.cellTopBorderWidth;return c},resolveResource:function(a){var e=this,b=e.view,c,d;c=Ext.fly(a).is(b.eventSelector)&&a||Ext.fly(a).up(b.eventSelector,null,!0);if(c){d=b.getResourceRecordFromDomId(c.id)}else {a=b.findRowByChild(a);d=a&&b.getRecordForRowNode(a)||null}return d},getTimeSpanRegion:function(h,e,g){var b=this.view,d=b.getCoordinateFromDate(h),f=e?b.getCoordinateFromDate(e):d,c,a;a=b.getTableRegion();if(g){c=Math.max(a?a.bottom-a.top:0,b.getEl().dom.clientHeight)}else {c=a?a.bottom-a.top:0}return new Ext.util.Region(0,Math.max(d,f),c,Math.min(d,f))},getStartEndDatesFromRegion:function(b,a){var c=this.view,e=c.getDateFromCoordinate(b.left,a),d=c.getDateFromCoordinate(b.right,a);return {start:e,end:d}},onEventAdd:function(m,g){var i=this.view,j={},h,d,f,c,e,a,l,b,k;for(a=0,l=g.length;a<l;a++){h=g[a];d=h.getStartDate();f=h.getEndDate();if(d&&f&&i.timeAxis.timeSpanInAxis(d,f)){c=g[a].getResources(i.getEventStore());for(b=0,k=c.length;b<k;b++){e=c[b];j[e.getId()]=e}}}Ext.Object.each(j,function(b,a){i.repaintEventsForResource(a)})},repaintEventsForResources:function(b){var c=this,a=c.view;b.forEach(function(b){if(a&&!a.isDestroyed){a.store.indexOf(b)>=0&&a.repaintEventsForResource(b)}})},onEventRemove:function(g,d){if(g.ignoreCollectionAdd){return}var b=this,e=b.view,f=e.getEventStore(),c,a;c=Ext.Array.unique(Ext.Array.reduce(d,function(a,b){return a.concat(f.getResourcesForEvent(b))},[]));a=Ext.Array.reduce(d,function(a,b){return a.concat(e.getElementsFromEventRecord(b,null,null,!0))},[]);a=new Ext.CompositeElementLite(a);if(b.fadeOutRemoval){a.fadeOut({callback:function(){b.repaintEventsForResources(c)}})}else {a.hide();b.repaintEventsForResources(c)}},onEventUpdate:function(k,a){var b=a.previous||{};var f=this.view;var i=f.timeAxis;var c=a.getStartDate();var d=a.getEndDate();var h=b[a.startDateField]||c;var j=b[a.endDateField]||d;var g=h&&j&&i.timeSpanInAxis(h,j);var e;if(a.resourceIdField in b&&g){e=k.getResourceStore().getById(b[a.resourceIdField]);e&&f.repaintEventsForResource(e,!0)}if(c&&d&&i.timeSpanInAxis(c,d)||g){a.getResources().forEach(function(a){f.repaintEventsForResource(a,!0)})}},setColumnWidth:function(b,a){var c=this.view;c.getTimeAxisViewModel().setViewColumnWidth(b,a)},getVisibleDateRange:function(){var a=this.view;if(!a.getEl()){return null}var d=a.getTableRegion(),g=a.timeAxis.getStart(),b=a.timeAxis.getEnd(),f=a.getWidth();if(d.right-d.left<f){return {startDate:g,endDate:b}}var e=a.getScroll();var c={startDate:a.getDateFromCoordinate(e.left,null,!0),endDate:a.getDateFromCoordinate(e.left+f,null,!0)||b};if(!c.endDate){c.endDate=b}return c},getItemBox:function(a){var b=this;return a.getResources().map(function(c){return b.getResourceEventBox(a,c)})},isRowVisible:function(a){var b=Ext.isFunction(a.isVisible)&&!a.isVisible();if(!b&&this.view.groupingFeature&&!this.view.groupingFeature.disabled){var c=this.view.resourceStore.getGroups();if(c){var d=c.getByKey(a.get(this.view.resourceStore.groupField));b=d&&!this.view.lockingPartner.groupingFeature.isExpanded(d)}}return !b},isElementRenderedAndDisplayed:function(a){if(a&&a.isResourceModel){a=this.view.getRowNode(a)}return !!(a&&Ext.fly(a).getHeight())},getResultEventBox:function(a,b){return {rendered:!0,start:a.hasOwnProperty('left')?a.left:a.right,end:(a.hasOwnProperty('left')?a.left:a.right)+a.width,top:b+a.top,bottom:b+a.top+a.height}},getResourceEventBox:function(f,c){var s=Sch.util.Date,e=this,b=null,a=e.view,v=a.timeAxis.getStart(),x=a.timeAxis.getEnd(),m=f.getStartDate(),o=f.getEndDate(),w,k,l,j,y,z,d,B,q,r,g,p,u,t,h,n,i;if(m&&o&&s.intersectSpans(m,o,v,x)&&e.isRowVisible(c)){j=a.getRowNode(c);if(j&&e.isElementRenderedAndDisplayed(j)){if(a.managedEventSizing){w=a.eventLayout.horizontal;var A=a.getEventStore().filterEventsForResource(c,a.timeAxis.isRangeInAxis,a.timeAxis);k=A.map(e.getEventRenderData,e);w.applyLayout(k,c);l=Ext.Array.findBy(k,function(a){return a.event==f});if(l){z=Ext.fly(j).getOffsetsTo(a.getNodeContainer())[1];b=this.getResultEventBox(l,z)}}else {q=a.getElementsFromEventRecord(f,f!==c&&c);if(q.length){r=q[0];g=r.getOffsetsTo(a.getEl());p=r.getBox();b={rendered:!0,start:g[0],end:g[0]+p.width,top:g[1],bottom:g[1]+p.height}}}}else {b={rendered:!1,start:a.getCoordinateFromDate(s.max(m,v)),end:a.getCoordinateFromDate(s.min(o,x))};u=a.all.startIndex;t=a.getRecord(u);h=a.all.endIndex;n=a.getRecord(h);d=a.getRowHeight();if(c.isAbove(t)){b.top=-d;b.bottom=b.top+d;b.relPos='before'}else {if(c==n||c.isAbove(n)){y=a.indexOf(c);b.top=y*d;b.bottom=b.top+d}else {i=a.getNode(h);if(e.isElementRenderedAndDisplayed(i)){b.top=Ext.fly(i).getOffsetsTo(a.getNodeContainer())[1]+Ext.fly(i).getHeight()}else {b.top=(h+1)*d}b.bottom=b.top+d;b.relPos='after'}}}if(b){b=e.adjustItemBox(f,b)}}return b},adjustItemBox:function(b,a){return a},getConnectorStartSide:function(a){return 'left'},getConnectorEndSide:function(a){return 'right'}});Ext.define('Sch.mixin.AbstractTimelineView',{requires:['Sch.data.TimeAxis','Sch.template.Event','Sch.view.Horizontal'],uses:['Ext.dom.Query'],selectedEventCls:'sch-event-selected',showAllDayHeader:!1,readOnly:!1,horizontalViewClass:'Sch.view.Horizontal',timeCellCls:'sch-timetd',timeCellSelector:'.sch-timetd',eventBorderWidth:1,timeAxis:null,timeAxisViewModel:null,eventPrefix:null,rowHeight:null,mode:'horizontal',horizontal:null,vertical:null,weekview:null,horizontalViewCls:['sch-horizontal-view'],verticalViewCls:['sch-vertical-view'],weekviewViewCls:['sch-calendar-view','sch-vertical-view'],panel:null,displayDateFormat:null,el:null,_initializeTimelineView:function(){if(this.horizontalViewClass){this.horizontal=Ext.create(this.horizontalViewClass,{view:this})}if(this.verticalViewClass){this.vertical=Ext.create(this.verticalViewClass,{view:this})}if(this.weekViewClass){this.weekview=Ext.create(this.weekViewClass,{view:this,showAllDayHeader:this.showAllDayHeader})}this.eventPrefix=(this.eventPrefix||this.getId())+'-'},getTimeAxisViewModel:function(){return this.timeAxisViewModel},getFormattedDate:function(a){return Ext.Date.format(a,this.getDisplayDateFormat())},getTimeZoneFormattedDate:function(a){return Sch.util.Date.format(a,this.getDisplayDateFormat(),this.timeAxis.timeZone)},convertDateToTimeZone:function(a){return this.timeAxis.toTimeZone(a)},convertDateFromTimeZone:function(a){return this.timeAxis.fromTimeZone(a)},roundDateInTimeZone:function(b,a){return this.timeAxis.roundDateInTimeZone(b,a)},getFormattedEndDate:function(a,b){var c=this.getDisplayDateFormat();if(a.getHours()===0&&a.getMinutes()===0&&(!b||!(a.getYear()===b.getYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()))&&!Sch.util.Date.hourInfoRe.test(c.replace(Sch.util.Date.stripEscapeRe,''))){a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1)}return Ext.Date.format(a,c)},getTimeZoneFormattedEndDate:function(a,b){var c=this.getDisplayDateFormat();if(a.getUTCHours()===0&&a.getUTCMinutes()===0&&(!b||!(a.getUTCYear()===b.getUTCYear()&&a.getUTCMonth()===b.getUTCMonth()&&a.getUTCDate()===b.getUTCDate()))&&!Sch.util.Date.hourInfoRe.test(c.replace(Sch.util.Date.stripEscapeRe,''))){a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1)}return Sch.util.Date.format(a,c,this.timeAxis.timeZone)},getDisplayDateFormat:function(){return this.displayDateFormat},setDisplayDateFormat:function(a){this.displayDateFormat=a},fitColumns:function(a){if(this.isHorizontal()){this.getTimeAxisViewModel().fitToAvailableWidth(a)}else {var b=Math.floor((this.panel.getWidth()-Ext.getScrollbarSize().width-1)/this.headerCt.getColumnCount());this.setColumnWidth(b,a)}},getElementsFromEventRecord:function(b,a,c,d){return this[this.mode].getElementsFromEventRecord(b,a,c,d)},getStartEndDatesFromRegion:function(b,a){return this[this.mode].getStartEndDatesFromRegion(b,a)},getTimeZoneStartEndDatesFromRegion:function(b,a){if(Sch.util.Date.compareUnits(Sch.util.Date.DAY,this.timeAxis.resolutionUnit)<=0){var c=this[this.mode].getStartEndDatesFromRegion(b,null);return {start:this.roundDateInTimeZone(c.start,a),end:this.roundDateInTimeZone(c.end,a)}}else {return this[this.mode].getStartEndDatesFromRegion(b,a)}},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(b,a){this.timeAxis.setResolution(b,a);if(this.getTimeAxisViewModel().snapToIncrement){this.refreshKeepingScroll()}},getEventIdFromDomNodeId:function(a){return a.substring(this.eventPrefix.length).split('-')[0]},getResourceIdFromDomNodeId:function(a){return a.substring(this.eventPrefix.length).split('-')[1]},getDateFromDomEvent:function(b,a){return this.getDateFromXY(b.getXY(),a)},getTimeZoneDateFromDomEvent:function(b,a){return this.getTimeZoneDateFromXY(b.getXY(),a,null,!0)},getSnapPixelAmount:function(){return this.getTimeAxisViewModel().getSnapPixelAmount()},setSnapEnabled:function(a){this.getTimeAxisViewModel().setSnapToIncrement(a)},setReadOnly:function(a){this.readOnly=a;this[a?'addCls':'removeCls'](this._cmpCls+'-readonly')},isReadOnly:function(){return this.readOnly},setMode:function(b){var a=this;a.mode=b;a.timeAxisViewModel.mode=b;a.removeCls(a.verticalViewCls.concat(a.weekviewViewCls).concat(a.horizontalViewCls));a.addCls(a[b+'ViewCls'])},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==='horizontal'},isVertical:function(){return this.getMode()==='vertical'},isWeekView:function(){return this.getMode()==='weekview'},getDateFromXY:function(c,a,b){return this[this.mode].getDateFromXY(c,a,b)},getTimeZoneDateFromXY:function(c,a,e,d){var b=this[this.mode].getDateFromXY(c,null,e);if(b&&(Sch.util.Date.compareUnits(Sch.util.Date.DAY,this.timeAxis.resolutionUnit)<=0||d)){return this.roundDateInTimeZone(b,a)}else {return this.getDateFromXY(c,a)}},getDateFromCoordinate:function(a,b,c){if(!c){a=this[this.mode].translateToScheduleCoordinate(a)}return this.timeAxisViewModel.getDateFromPosition(a,b)},getDateFromX:function(b,a){return this.getDateFromCoordinate(b,a)},getDateFromY:function(b,a){return this.getDateFromCoordinate(b,a)},getCoordinateFromDate:function(c,b){var a=this.timeAxisViewModel.getPositionFromDate(c);if(b===!1){a=this[this.mode].translateToPageCoordinate(a)}return a},getTimeSpanDistance:function(a,b){return this.timeAxisViewModel.getDistanceBetweenDates(a,b)},getTimeSpanRegion:function(a,b){return this[this.mode].getTimeSpanRegion(a,b)},getScheduleRegion:function(a,b){return this[this.mode].getScheduleRegion(a,b)},getTableRegion:function(){throw 'Abstract method call'},getRowNode:function(a){throw 'Abstract method call'},getRecordForRowNode:function(a){throw 'Abstract method call'},getVisibleDateRange:function(){return this[this.mode].getVisibleDateRange()},setColumnWidth:function(b,a){this[this.mode].setColumnWidth(b,a)},findRowByChild:function(a){throw 'Abstract method call'},setBarMargin:function(b,a){this.barMargin=b;if(!a){this.refreshKeepingScroll()}},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},setRowHeight:function(b,a){this.timeAxisViewModel.setViewRowHeight(b,a)},refreshKeepingScroll:function(){throw 'Abstract method call'},scrollVerticallyTo:function(b,a){throw 'Abstract method call'},scrollHorizontallyTo:function(b,a){throw 'Abstract method call'},getVerticalScroll:function(){throw 'Abstract method call'},getHorizontalScroll:function(){throw 'Abstract method call'},getEl:Ext.emptyFn,getScroll:function(){throw 'Abstract method call'},getOuterEl:function(){return this.getEl()},getRowContainerEl:function(){return this.getEl()},getScheduleCell:function(b,a){return this.getCellByPosition({row:b,column:a})},getScrollEventSource:function(){return this.getEl()},getViewportHeight:function(){return this.getEl().getHeight()},getViewportWidth:function(){return this.getEl().getWidth()},getViewportCenterDate:function(){var b=this.getScroll(),a;if(this.isVertical()){a=[0,b.top+this.getViewportHeight()/2]}else {a=[b.left+this.getViewportWidth()/2,0]}return this.getDateFromXY(a,null,!0)},getDateConstraints:Ext.emptyFn,getItemBox:function(a){return this[this.mode].getItemBox(a)},getConnectorStartSide:function(a){return this[this.mode].getConnectorStartSide(a)},getConnectorEndSide:function(a){return this[this.mode].getConnectorEndSide(a)},getViewStartDate:function(){return this.timeAxis.getStart()},getViewEndDate:function(){return this.timeAxis.getEnd()}});Ext.apply(Sch,{VERSION:'6.1.17',LICENSE:'%LICENSE%'});Ext.define('Sch.mixin.FilterableTreeView',{prevBlockRefresh:null,initTreeFiltering:function(){var a=function(){var a=this.store;this.mon(a,'nodestore-datachange-start',this.onFilterChangeStart,this);this.mon(a,'nodestore-datachange-end',this.onFilterChangeEnd,this);if(!a.allowExpandCollapseWhileFiltered){this.mon(a,'filter-clear',this.onFilterCleared,this);this.mon(a,'filter-set',this.onFilterSet,this)}};if(this.rendered){a.call(this)}else {this.on('beforerender',a,this,{single:!0})}},onFilterChangeStart:function(){this.prevBlockRefresh=this.blockRefresh;this.blockRefresh=!0;Ext.suspendLayouts()},onFilterChangeEnd:function(){Ext.resumeLayouts(!0);this.blockRefresh=this.prevBlockRefresh},onFilterCleared:function(){delete this.toggle;var a=this.getEl();if(a){a.removeCls('sch-tree-filtered')}},onFilterSet:function(){this.toggle=function(){};var a=this.getEl();if(a){a.addCls('sch-tree-filtered')}}});Ext.define('Sch.mixin.GridViewCanvas',{extend:'Ext.Mixin',mixinConfig:{after:{'onRender':'afterOnRender'}},secondaryCanvasCls:'sch-secondary-canvas',secondaryCanvasLayerCls:'sch-secondary-canvas-layer',itemsCanvasEl:null,itemsCanvasCls:'sch-item-canvas',itemsCanvasLayerCls:'sch-item-canvas-layer',getSecondaryCanvasEl:function(){var a=null;if(this.isItemCanvasAvailable()){a=this.getItemCanvasEl(-1,{tag:'div',role:'presentation',cls:this.secondaryCanvasCls})}return a},isItemCanvasAvailable:function(b){var a=this;return !!(a.rendered&&!a.destroyed&&(a.getNodeContainer()||a.itemsCanvasEl&&(a.itemsCanvasEl._underMixinControl||!Ext.isGarbage(a.itemsCanvasEl.dom))))},isItemCanvasPresent:function(b){var a=this;return !!(a.rendered&&!a.destroyed&&a.itemsCanvasEl&&(b===undefined||a.itemsCanvasEl[b]&&(a.itemsCanvasEl._underMixinControl||!Ext.isGarbage(a.itemsCanvasEl[b].dom))))},getItemCanvasEl:function(c,e){var d=this,a=d.itemsCanvasEl,b=a;if(!a||!a.dom||!a._underMixinControl&&Ext.isGarbage(a.dom)){b=a=d.itemsCanvasEl=Ext.fly(d.getNodeContainer()).insertFirst({cls:d.itemsCanvasCls})}if(arguments.length>0){c=c||0;b=a[c]||Ext.dom.Query.selectNode('[data-sch-secondary-canvas-layer="'+c+'"]',a.dom);if(!b||!b.dom||!a._underMixinControl&&Ext.isGarbage(b.dom)){b=a.createChild((Ext.isFunction(e)?e():e)||{tag:'div'});b.set({'data-sch-secondary-canvas-layer':c});b.setStyle('zIndex',c);b.addCls(d.itemsCanvasLayerCls);a[c]=b}}return b},afterOnRender:function(){if(this.bufferedRenderer){this.on('viewready',this.onBufferedRendererViewReady,this)}},onBufferedRendererViewReady:function(){var a=this,b=Ext.getVersion().isGreaterThan('6.5.3')?this.grid.up('tablepanel').lockedGrid.bufferedRenderer:a.bufferedRenderer,c=b.onRangeFetched;b.onRangeFetched=function(){var b=a.getItemCanvasEl(),d=a.getNodeContainer(),e;b._underMixinControl=!0;b.dom.parentNode&&b.dom.parentNode.removeChild(b.dom);e=c.apply(this,arguments);d.insertBefore(b.dom,d.firstChild);delete b._underMixinControl;return e}}});Ext.define('Sch.mixin.PartnerTimelinePanel',{extend:'Ext.Mixin',setupPartnerTimelinePanel:function(e){var b=this.partnerTimelinePanel;var c=b.lockedGrid;var a=this.lockedGrid;c.mon(a,'resize',this.onLockedGridResize,c);a.mon(c,'resize',this.onLockedGridResize,a);var d=b.isVisible()?b.lockedGrid.getWidth():b.lockedGrid.width;if(c.getCollapsed()){this.mon(c,'viewready',function(b){a.setWidth(b.getWidth())})}else {a.setWidth(d)}this.on('afterlayout',function(){if(c.getCollapsed()){a.collapse()}else {a.expand();a.setWidth(d)}},this,{single:!0});c.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:this});a.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:b});this.setupScrollSync();b.mon(this,'beforezoomchange',this.onBeforeZoomChange,this);b.mon(this,'viewchange',this.onViewChange,this);this.mon(b,'beforezoomchange',this.onBeforeZoomChange,this);this.mon(b,'viewchange',this.onViewChange,this)},onLockedGridResize:function(b,a){this.setWidth(a)},onPartnerCollapseExpand:function(a){if(a.getCollapsed()){this.lockedGrid.collapse()}else {this.lockedGrid.expand()}},setupScrollSync:function(){var e=this.partnerTimelinePanel.getSchedulingView(),b=this.partnerTimelinePanel.getMode()==='horizontal'?e.getScrollable():this.partnerTimelinePanel.getScrollable(),d=this.getSchedulingView(),a=this.getMode()==='horizontal'?d.getScrollable():this.getScrollable(),c;function onSyncScrollStart(e){var d=e===a?a:b,f=e===a?b:a;if(!c){d.component.mun(f,'scrollstart',onSyncScrollStart);f.component.mun(d,'scrollstart',onSyncScrollStart);d.component.mon(d,'scroll',doScrollSync);d.component.mon(d,'scrollend',onSyncScrollEnd)}}function doScrollSync(h,g,i){var j=h===a?a:b,e=h===a?b:a;var f=e.component.headerCt.getScrollable();c=Ext.asap(function(){var b,a;a=e.getPosition();if(a&&d.getMode()==='horizontal'){b=Math.abs(a.x-g);if(b){f&&!f.destroyed&&f.scrollTo(g,null);!e.destroyed&&e.scrollTo(g);c=!1}else {c=!1}}else {if(a){b=Math.abs(a.y!=i);if(b){!e.destroyed&&e.scrollTo(null,i)}c=!1}}})}function onSyncScrollEnd(d){var c=d===a?a:b,e=d===a?b:a;c.component.mun(c,'scroll',doScrollSync);c.component.mun(c,'scrollend',onSyncScrollEnd);c.component.mon(e,'scrollstart',onSyncScrollStart);e.component.mon(c,'scrollstart',onSyncScrollStart)}function startScrollMonitoring(){b.component.mon(a,'scrollstart',onSyncScrollStart);a.component.mon(b,'scrollstart',onSyncScrollStart)}function stopScrollMonitoring(){b.component.mun(a,'scrollstart',onSyncScrollStart);a.component.mun(b,'scrollstart',onSyncScrollStart)}this.partnerTimelinePanel.mon(this,{'show':function(){doScrollSync(b,b.getPosition().x,b.getPosition().y)}});this.mon(this.partnerTimelinePanel,{'show':function(){doScrollSync(a,a.getPosition().x,a.getPosition().y)}});startScrollMonitoring()},onViewChange:function(a){if(a===this){this.partnerTimelinePanel.viewPreset=this.viewPreset=this.timeAxisViewModel.viewPreset}},onBeforeZoomChange:function(){var b=this.partnerTimelinePanel;var a=b.getSchedulingView().getScrollable(),c=a.suspendPartnerSync;a.suspendPartnerSync=Ext.emptyFn;a.on('scrollend',function(){a.suspendPartnerSync=c},null,{single:!0})}});Ext.define('Sch.patches.Element_6_7',{extend:'Sch.util.Patch',target:['Ext.dom.Element'],minVersion:'6.7.0',applyFn:function(){Ext.override(Ext.dom.Element,{synchronize:function(){var i=this.callParent(arguments),h=this,j=h.dom,e={},a=j.className,b,f,c,g,d=h.getData(!1);if(window.SVGAnimatedString&&a instanceof window.SVGAnimatedString){a=a.animVal;if(a&&a.length>0){b=a.split(/[\s]+/);for(c=0,g=b.length;c<g;c++){f=b[c];e[f]=!0}}d.classList=b;d.classMap=e;d.isSynchronized=!0}return i}})}});Ext.define('Sch.patches.NavigationModel6_0_2',{extend:'Sch.util.Patch',target:'Ext.grid.NavigationModel',minVersion:'6.0.2',applyFn:function(){Ext.ClassManager.get(this.target).override({focusPosition:function(a){var e=this;if(a&&a.record&&a.column&&a.view&&a.view._initializeTimelineView){var b=a.view.getScrollable();if(b&&b.scrollIntoView){var d=b.ensureVisible;b.ensureVisible=Ext.emptyFn;var c=this.callParent(arguments);b.ensureVisible=d;return c}}return this.callParent(arguments)}})}});Ext.define('Sch.patches.View',{extend:'Sch.util.Patch',target:'Ext.view.View',minVersion:'5.1.0',overrides:{handleEvent:function(a){var b=this,c=b.keyEventRe.test(a.type),e=b.getNavigationModel();a.view=b;if(c){a.item=a.getTarget(b.itemSelector);a.record=e.getRecord(a.item)}if(!a.item){var d=b.editingPlugin&&b.editingPlugin.getActiveEditor&&b.editingPlugin.getActiveEditor();if(!(d&&d.getEl().contains(a.getTarget()))){a.item=a.getTarget(b.itemSelector)}}if(a.item&&!a.record){a.record=b.getRecord(a.item)}if(b.processUIEvent(a)!==!1){b.processSpecialEvent(a)}if(c&&!Ext.fly(a.target).isInputField()){if(a.getKey()===a.SPACE||a.isNavKeyPress(!0)){a.preventDefault()}}a.view=null}}});Ext.define('Sch.patches.Scroller_6_5',{extend:'Sch.util.Patch',target:'Ext.scroll.Scroller',minVersion:'6.5.0',maxVersion:'6.5.1.9999',overrides:{privates:{updateDomScrollPosition:function(g){var a=this,b=a.position,h=b.x,i=b.y,c,d,e,f;a.readPosition(b);c=b.x;d=b.y;a.positionDirty=!1;if(!g){e=c-h;f=d-i;if(!a.isScrolling){a.isScrolling=Ext.isScrolling=!0;a.fireScrollStart(c,d,e,f)}a.fireScroll(c,d,e,f);a.bufferedOnDomScrollEnd(c,d,e,f)}return b}},getPosition:function(){var a=this;if(a.positionDirty){a.updateDomScrollPosition(!0)}return a.position}}});Ext.define('Sch.patches.Scroller_7_3',{extend:'Sch.util.Patch',target:'Ext.scroll.Scroller',minVersion:'7.3.1',overrides:{ensureVisible:function(d,c){var a=this;var b=a.getLockingScroller&&a.getLockingScroller();if(b&&b.isScrolling){return null}else {return a.callParent(arguments)}}}});Ext.define('Sch.patches.LayoutContext_6_5',{extend:'Sch.util.Patch',target:'Ext.layout.Context',minVersion:'6.5.0',overrides:{callLayout:function(a,b){this.currentLayout=a;if(!a.destroyed){a[b](this.getCmp(a.owner))}}}});Ext.define('Sch.patches.ToolTip',{extend:'Sch.util.Patch',target:'Ext.tip.ToolTip',minVersion:'6.0.0',applyFn:function(){var a={setTarget:function(c){var a=this;if(a.target){var b=Ext.get(a.target);if(b){a.mun(b,{mouseover:a.onTargetOver,tap:a.onTargetOver,mouseout:a.onTargetOut,mousemove:a.onMouseMove,scope:a})}}a.target=Ext.get(c);if(a.target){a.mon(a.target,{mouseover:a.onTargetOver,tap:a.onTargetOver,mouseout:a.onTargetOut,mousemove:a.onMouseMove,scope:a})}if(a.anchor){a.anchorTarget=a.target}}};if(Ext.getVersion().isLessThan('6.0.2')){a.afterSetPosition=function(b,c){var a=this;a.callParent(arguments);if(a.anchor){if(!a.anchorEl.isVisible()){a.anchorEl.show()}a.syncAnchor()}else {a.anchorEl.hide()}}}Ext.ClassManager.get(this.target).override(a)}});Ext.define('Sch.patches.AbstractView',{extend:'Sch.util.Patch',target:'Ext.view.AbstractView',minVersion:'6.2.0',obsoleteTestName:'patches/002_abstract_view.t.js',overrides:{setItemsDraggable:function(b){var a=this,c;c=a.callParent([b]);if(!b&&a.viewStyleSheet&&a.viewStyleSheet.cssRules.length===0){a.viewStyleSheet.ownerNode.parentNode.removeChild(a.viewStyleSheet.ownerNode);a.viewStyleSheet=Ext.view.AbstractView.prototype.viewStyleSheet=null}return c}}});Ext.define('Sch.patches.SpreadsheetModel',{extend:'Sch.util.Patch',requires:['Ext.grid.selection.SpreadsheetModel'],target:'Ext.grid.selection.SpreadsheetModel',minVersion:'6.6.0',overrides:{privates:{onMouseMove:function(e,i,g){var a=this,b=g.view,d=e.getTarget(b.cellSelector),f=g.view.getHeaderByCell(d),h=a.selected;var c;if(b.getSchedulingView){c=b.getSchedulingView()}else {if(b.ownerGrid.getSchedulingView){c=b.ownerGrid.getSchedulingView()}}if(c&&c._cmpCls&&Ext.fly(i).up('.'+c._cmpCls)){return}if(a.checkCellClicked){if(d===a.checkCellClicked){if(!a.lastOverRecord){a.lastOverRecord=b.getRecord(d.parentNode)}return}else {a.checkCellClicked=null;if(a.lastOverRecord){a.select(a.lastOverRecord);h.setRangeStart(a.store.indexOf(a.lastOverRecord))}}}a.isDragging=!0;if(a.extensible){a.extensible.disable()}if(f){a.changeSelectionRange(b,d,f,e)}else {var j=b.body?b.body.el:b.ownerGrid.body.el;if(!e.within(j)){a.scrollTowardsPointer(e,b)}}}}}});Ext.define('Sch.patches.CellEditingPlugin',{extend:'Sch.util.Patch',requires:['Ext.grid.plugin.CellEditing'],target:'Ext.grid.plugin.CellEditing',minVersion:'6.7.0',maxVersion:'8.0.1',overrides:{disableBufferedRenderingSupport:!0,deactivate:function(){var a=this;if(a.disableBufferedRenderingSupport){var e=a.context,d=a.editors.items,f=d.length,c,b;for(b=0;b<f;b++){c=d[b];if(e.view.renderingRows){if(c.editing){a.cancelEdit()}c.cacheElement()}}}else {a.callParent(arguments)}}}});Ext.define('Sch.patches.TableScroller',{extend:'Sch.util.Patch',minVersion:'6.2.1',maxVersion:'6.5.0',target:'Ext.scroll.TableScroller',overrides:{privates:{onDomScroll:function(){var a=this,b=a.position,g=b.x,h=b.y,c,d,e,f;b=a.updateDomScrollPosition();if(a.restoreTimer){clearTimeout(a.onDomScrollEnd.timer);return}c=b.x;d=b.y;e=c-g;f=d-h;if(!a.isScrolling){a.isScrolling=Ext.isScrolling=!0;a.fireScrollStart(c,d,e,f)}a.fireScroll(c,d,e,f);a.bufferedOnDomScrollEnd(c,d,e,f)},invokePartners:function(f,i,j,g,h){var a=this,b=a._partners,c,e,d;if(!a.suspendSync){a.invokingPartners=!0;for(e in b){d=b[e].axes;c=b[e].scroller;if(!c.invokingPartners){c[f](a,d.x?i:null,d.y?j:null,g,h)}}a.invokingPartners=!1}}}}});Ext.define('Sch.tooltip.EventTip',{extend:'Ext.tip.ToolTip',alias:'widget.scheduler_eventtip',uses:['Ext.Number','Ext.util.Format','Ext.util.Region','Ext.util.Point'],config:{view:null},componentCls:'sch-tooltip-eventtip',anchor:'t',constraintInsets:'7 -7 -7 7',allowOver:!0,initComponent:function(){var a=this;a.callParent(arguments);a.on('beforeshow',a.onTipBeforeShow,a)},getAlignRegion:function(){var a=this,f=a.anchorEl,g=a.getAnchorAlign(),i,h,c,e=a.mouseOffset,d,b;if(!a.anchorSize){f.addCls(Ext.baseCSSPrefix+'tip-anchor-top');f.show();a.anchorSize=new Ext.util.Offset(f.getWidth(),f.getHeight());f.removeCls(Ext.baseCSSPrefix+'tip-anchor-top');f.hide()}if((a.anchor||a.align)&&a.anchorToTarget&&!a.trackMouse){c=a.currentTarget.getRegion();if(!Ext.isGarbage(a.currentTarget.dom)&&a.getView().getMode()==='horizontal'&&a.pointerEvent){c=c.intersect(new Ext.util.Region(c.top,a.pointerEvent.getPoint().x+a.getRegion().width/2,c.bottom,a.pointerEvent.getPoint().x+-a.getRegion().width/2))||c}}else {c=a.pointerEvent?a.pointerEvent.getPoint().adjust(-Math.abs(e[1]),Math.abs(e[0]),Math.abs(e[1]),-Math.abs(e[0])):new Ext.util.Point();if(!a.anchor){i=!0;if(e[0]>0){if(e[1]>0){g='tl-br'}else {g='bl-tr'}}else {if(e[1]>0){g='tr-bl'}else {g='br-tl'}}}}h={align:a.convertPositionSpec(g),axisLock:a.axisLock,target:c,overlap:i,offset:a.targetOffset};if(a.anchor){h.anchorSize=a.anchorSize}if(a.constrainPosition){d=a.constrainTo||Ext.getBody();if(!d.isRegion){d=Ext.util.Region.getRegion(d)}if(a.constraintInsets){b=a.constraintInsets;if(!Ext.isObject(b)){b=Ext.util.Format.parseBox(b)}d=d.copy().adjust(b.top,b.right,b.bottom,b.left)}h.inside=d}return a.getRegion().alignTo(h)},onTipBeforeShow:function(b){if(!b.triggerElement||!b.triggerElement.id){return !1}var a=b.getView();var f=Ext.all('window[modal=true]{isVisible()}');var g=Ext.Array.findBy(f,function(b){return a!==b&&!a.isDescendantOf(b)&&Ext.WindowManager.getActive()===b});if(g){return !1}var d=a.resolveEventRecord(b.triggerElement);if(!d||a.fireEvent('beforetooltipshow',a,d)===!1){return !1}var e=a.getDataForTooltipTpl(d,b.triggerElement),c;if(!e){return !1}c=a.tooltipTpl.apply(e);if(!c){return !1}b.update(c)},onTargetOut:function(a){if(this.rendered&&this.allowOver&&this.el.contains(a.relatedTarget)){return}return this.callParent(arguments)}});Ext.define('Sch.mixin.TimelineView',{extend:'Sch.mixin.AbstractTimelineView',requires:['Ext.tip.ToolTip','Sch.patches.Element_6_7','Sch.patches.NavigationModel6_0_2','Sch.patches.View','Sch.patches.Scroller_6_5','Sch.patches.Scroller_7_3','Sch.patches.LayoutContext_6_5','Sch.patches.ToolTip','Sch.patches.AbstractView','Sch.patches.SpreadsheetModel','Sch.patches.CellEditingPlugin','Sch.patches.TableScroller','Sch.tooltip.EventTip'],tip:null,overScheduledEventClass:'sch-event-hover',ScheduleBarEvents:['mousedown','mouseup','click','dblclick','longpress','contextmenu'],ResourceRowEvents:['keydown','keyup'],preventOverCls:!1,hoveredEventNode:null,_initializeTimelineView:function(){this.callParent(arguments);this.on('destroy',this._onDestroy,this);this.on('afterrender',this._onAfterRender,this);this.setMode(this.mode);this.enableBubble('columnwidthchange');this.addCls('sch-timelineview');if(this.readOnly){this.addCls(this._cmpCls+'-readonly')}this.addCls(this._cmpCls);if(this.eventAnimations){this.addCls('sch-animations-enabled')}},handleScheduleBarEvent:function(a,b){this.fireEvent(this.scheduledEventName+a.type,this,this.resolveEventRecord(b),a)},handleResourceRowEvent:function(a,b){this.fireEvent(this.scheduledEventName+a.type,this,this.resolveEventRecordFromResourceRow(b),a)},_onDestroy:function(){if(this.tip){this.tip.destroy()}},_onAfterRender:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(!0)}if(this.tooltipTpl){if(typeof this.tooltipTpl==='string'){this.tooltipTpl=new Ext.XTemplate(this.tooltipTpl)}this.el.on(Ext.supports.Touch?'touchstart':'mousemove',this.setupTooltip,this,{single:!0})}this.setupTimeCellEvents();var b={delegate:this.eventSelector,scope:this};var a={delegate:this.rowSelector,scope:this};Ext.Array.each(this.ScheduleBarEvents,function(a){b[a]=this.handleScheduleBarEvent},this);Ext.Array.each(this.ResourceRowEvents,function(b){a[b]=this.handleResourceRowEvent},this);this.el.on(b);this.el.on(a)},setMouseOverEnabled:function(a){this[a?'mon':'mun'](this.el,{mouseover:this.onEventMouseOver,mouseout:this.onEventMouseOut,delegate:this.eventSelector,scope:this});if(!a){this.getEl().select('.'+this.overScheduledEventClass).removeCls(this.overScheduledEventClass)}},onEventMouseOver:function(c,a){if(a!==this.hoveredEventNode&&!this.preventOverCls){this.hoveredEventNode=a;Ext.fly(a).addCls(this.overScheduledEventClass);var b=this.resolveEventRecord(a);if(b){this.fireEvent('eventmouseenter',this,b,c)}}},onEventMouseOut:function(a,b){if(this.hoveredEventNode){if(!a.within(this.hoveredEventNode,!0,!0)){Ext.fly(this.hoveredEventNode).removeCls(this.overScheduledEventClass);this.fireEvent('eventmouseleave',this,this.resolveEventRecord(this.hoveredEventNode),a);this.hoveredEventNode=null}}},highlightItem:function(a){if(a){var b=this;b.clearHighlight();b.highlightedItem=a;Ext.fly(a).addCls(b.overItemCls)}},setupTooltip:function(){var a=this,b=a.getEl();a.tip=new Sch.tooltip.EventTip(Ext.apply({view:a,delegate:a.eventSelector,target:b,showOnTap:!0,dismissDelay:0,rtl:a.rtl},a.tipCfg))},getHorizontalTimeAxisColumn:function(){if(!this.timeAxisColumn){this.timeAxisColumn=this.headerCt.down('timeaxiscolumn');if(this.timeAxisColumn){this.timeAxisColumn.on('destroy',function(){this.timeAxisColumn=null},this)}}return this.timeAxisColumn},getDataForTooltipTpl:function(a,b){return Ext.apply({_record:a},a.data)},refreshKeepingScroll:function(){Ext.suspendLayouts();this.blockRestoringInfiniteScrollDate();this.refreshView();Ext.resumeLayouts(!0);this.resumeRestoringInfiniteScrollDate()},setupTimeCellEvents:function(){this.mon(this.el,{click:this.handleScheduleEvent,dblclick:this.handleScheduleEvent,contextmenu:this.handleScheduleEvent,longpress:this.handleScheduleEvent,pinch:this.handleScheduleEvent,pinchstart:this.handleScheduleEvent,pinchend:this.handleScheduleEvent,scope:this})},getTableRegion:function(){var a=this.el.down('.'+Ext.baseCSSPrefix+'grid-item-container');return (a||this.el).getRegion()},getRowNode:function(a){return this.getNodeByRecord(a)},findRowByChild:function(a){return this.findItemByChild(a)},getRecordForRowNode:function(a){return this.getRecord(a)},refreshKeepingResourceScroll:function(){var a=this.getScroll();this.refreshView();if(this.isHorizontal()){this.scrollVerticallyTo(a.top)}else {this.scrollHorizontallyTo(a.left)}},scrollHorizontallyTo:function(b,a){if(this.rendered){this.scrollTo(b,null,a)}},scrollVerticallyTo:function(b,a){if(this.rendered){this.scrollTo(null,b,a)}},getVerticalScroll:function(){return this.getScrollY()},getHorizontalScroll:function(){return this.getScrollX()},getScroll:function(){var a=this;return {top:a.getVerticalScroll(),left:a.getHorizontalScroll()}},handleScheduleEvent:function(){},disableViewScroller:function(a){var b=this.getScrollable();if(b){if(b.setDisabled){b.setDisabled(a)}else {var c=this.up('timelinetree,timelinegrid').getScrollable();b.setConfig({x:!a,y:!a});c.setConfig({x:!a,y:!a})}}},shouldAdjustForRtl:function(){return this.rtl&&!Ext.rootInheritedState.rtl},getHorizontalPositionSide:function(){return this.rtl?'right':'left'},getViewContainerElementTop:function(){var a=this.up('timelinegrid,timelinetree').getView().el;return a.getY()},getViewContainerHeight:function(){return this.up('timelinegrid,timelinetree').getView().el.getHeight()},getScrollableMaxPosition:function(){return {x:this.getScrollable().getMaxPosition().x,y:this.getVerticalScrollableMaxHeight()}},getVerticalScroller:function(){return this.up('timelinegrid,timelinetree').getScrollable()},getVerticalScrollableMaxHeight:function(){return this.getVerticalScroller().getMaxPosition().y},getScrollableContainerRegion:function(){var a=this.getEl().getRegion();a.top=this.up('timelinegrid, timelinetree').getScrollable().getElement().getY();return new Ext.util.Region(a.top,a.right,a.top+this.getViewContainerHeight(),a.left)},scrollHorizontallyBy:function(b,a){this.scrollBy(b,null,a)},scrollVerticallyBy:function(c,b){var a=this.up('timelinegrid, timelinetree').getScrollable();a.scrollBy(0,c,b)},scrollElementIntoView:function(a,p,o,g,l,c,k){var b=this,q=a.dom,j=b.getScroll(),d=j.left,i=j.top,h=b.getScrollIntoViewXY(a,d,i,l),m=h.x,n=h.y,e,f;e=p!==!1?m:d;f=n;if(e!==d||f!==i){b.on({scrollend:{fn:function(){g&&a.dom&&a.highlight();c&&c.call(k)},scope:b,single:!0}});b.scrollTo(e,f,o)}else {g&&a.dom&&a.highlight();c&&c.call(k)}return b},getScrollIntoViewXY:function(d,a,b,c){c=Ext.isEmpty(c)?20:c;var m=this.ownerCt.getEl(),i=this.getVerticalScroller().getElement(),r=d.getOffsetsTo(m),q=d.getOffsetsTo(i),u=r[0],v=q[1],p=d.dom.offsetWidth,n=d.dom.offsetHeight,g=u+a,h=v+b,o=g+p,l=h+n,f=m.getWidth(),e=i.getHeight(),j=a,k=b,t=j+f,s=k+e;if(n>e||h<k){b=h-c}else {if(l>s){b=l-e+c}}if(p>f||g<j){a=g-c}else {if(o>t){a=o-f+c}}a=a<0?0:a;b=b<0?0:b;return {x:a,y:b}}});Ext.define('Sch.view.TimelineGridView',{extend:'Ext.grid.View',mixins:['Sch.mixin.TimelineView'],infiniteScroll:!1,bufferCoef:5,bufferThreshold:0.2,cachedScrollDate:null,boxIsReady:!1,ignoreNextHorizontalScroll:!1,constructor:function(a){this.callParent(arguments);if(this.infiniteScroll){this.on('boxready',this.setupInfiniteScroll,this)}if(this.timeAxisViewModel){this.relayEvents(this.timeAxisViewModel,['columnwidthchange'])}},setupInfiniteScroll:function(){var c=this.panel.ownerCt;this.cachedScrollDate=c.startDate||this.timeAxis.getStart();if(Ext.getVersion().isLessThan('6.0.1')&&Ext.supports.Touch&&Ext.os.is.Windows){var a=this.panel.headerCt.getScrollable();var b=this.getScrollable();a.onIdle&&Ext.GlobalEvents.un('idle',a.onIdle,a);b.onIdle&&Ext.GlobalEvents.un('idle',b.onIdle,b)}var d=this;c.calculateOptimalDateRange=function(c,f,a,b){if(b){return b}var e=Sch.preset.Manager.getPreset(a.preset);return d.calculateInfiniteScrollingDateRange(c,e.getBottomHeader().unit,a.increment,a.width,!0)};this.bindInfiniteScrollListeners()},bindInfiniteScrollListeners:function(){this.getScrollable().on('scroll',this.onHorizontalScroll,this);this.infiniteScroll=!0},unbindInfiniteScrollListeners:function(){this.getScrollable().un('scroll',this.onHorizontalScroll,this);this.infiniteScroll=!1},onHorizontalScroll:function(g,a,h){if(this.ignoreNextHorizontalScroll||this.cachedScrollDate){this.ignoreNextHorizontalScroll=!1;return}var e=Ext.getScrollbarSize(),f=this.getWidth(),d=f*this.bufferThreshold*this.bufferCoef,c=this.getScrollable().getMaxPosition().x;c-=e.width;if(c-a<d||a<d){this.shiftToDate(this.getDateFromCoordinate(a,null,!0));if(Ext.getVersion().isGreaterThan('6.2.0')){var b=this.getScrollable()._translatable||this.getScrollable().translatable;b&&b.stopAnimation()}else {this.el.stopAnimation()}}},refresh:function(){this.callParent(arguments);if(this.infiniteScroll&&!this.scrollStateSaved&&this.boxIsReady){this.restoreScrollToCachedDate()}},onResize:function(a,d,b,c){this.boxIsReady=!0;this.callParent(arguments);if(this.infiniteScroll&&a>0&&a!==b){this.shiftToDate(this.cachedScrollDate||this.getVisibleDateRange().startDate,this.cachedScrollDateIsCentered)}},restoreScrollToCachedDate:function(){if(this.cachedScrollDate&&this.boxIsReady){this.ignoreNextHorizontalScroll=!0;this.scrollToDate(this.cachedScrollDate);this.cachedScrollDate=null}},scrollToDate:function(b){this.cachedScrollDate=b;if(this.cachedScrollDateIsCentered){this.panel.ownerCt.scrollToDateCentered(b)}else {this.panel.ownerCt.scrollToDate(b)}var a=this.getScrollX();this.panel.scrollLeftPos=a;this.headerCt.setScrollX(a);if(Ext.getVersion().isGreaterThan('6.2.0')){this.up('timelinegrid,timelinetree').lastScrollPos.x=a}},blockRestoringInfiniteScrollDate:function(){this.scrollStateSaved=this.boxIsReady},resumeRestoringInfiniteScrollDate:function(){this.scrollStateSaved=!1;if(this.infiniteScroll&&this.cachedScrollDate){this.restoreScrollToCachedDate()}},calculateInfiniteScrollingDateRange:function(f,a,b,d,k){var c=this.timeAxis,g=this.getWidth(),h;d=d||this.timeAxisViewModel.getTickWidth();b=b||c.increment||1;a=a||c.unit;var e=Sch.util.Date;var i=Math.ceil(g*this.bufferCoef/d);if(k){var j=Math.ceil(g*(1+this.bufferCoef)/(2*d))*b;h={start:c.floorDate(e.add(f,a,-j),!1,a,b),end:c.ceilDate(e.add(f,a,j),!1,a,b)}}else {h={start:c.floorDate(e.add(f,a,-i*b),!1,a,b),end:c.ceilDate(e.add(f,a,Math.ceil((g/d+i)*b)),!1,a,b)}}return h},shiftToDate:function(c,a){var b=this.calculateInfiniteScrollingDateRange(c,null,null,null,a);this.cachedScrollDate=c;this.cachedScrollDateIsCentered=a;this.timeAxis.setTimeSpan(b.start,b.end)},clearViewEl:function(){var c=this,b=c.getSecondaryCanvasEl(),a=b&&b.dom.querySelector('.'+Ext.baseCSSPrefix+'dd-drag-proxy');a&&b.dom.removeChild(a);this.callParent(arguments);if(a){c.getSecondaryCanvasEl().dom.appendChild(a)}},destroy:function(){if(this.infiniteScroll&&this.rendered){this.unbindInfiniteScrollListeners()}this.callParent(arguments)}});Ext.define('Sch.patches.BoundList',{extend:'Sch.util.Patch',requires:['Ext.view.BoundList'],target:'Ext.view.BoundList',overrides:{getInnerTpl:function(a){return this.htmlEncode?'{'+a+':htmlEncode}':this.callParent(arguments)}}});Ext.define('Sch.patches.DragDropManager',{extend:'Sch.util.Patch',requires:['Ext.dd.ScrollManager'],target:'Ext.dd.DragDropManager',minVersion:'6.0.0',applyFn:function(){Ext.override(Ext.dd.DragDropManager,{handleMouseMove:function(c){var a=this,b=a.dragCurrent,d=c.getXY(),g=d[0],h=d[1],e,f;a.offsetX=g-a.startX;a.offsetY=h-a.startY;a.currentPoint.setPosition(d);if(!b){return !0}if(!a.dragThreshMet){e=Math.abs(a.offsetX);f=Math.abs(a.offsetY);if(e>a.clickPixelThresh||f>a.clickPixelThresh){c.claimGesture();a.startDrag(a.startX,a.startY)}}if(a.dragThreshMet&&(!b.checkDraggingFlag||b.dragging)){b.b4Drag(c);b.onDrag(c);if(!b.moveOnly){a.fireEvents(c,!1)}}a.stopEvent(c);return !0},fireEvents:function(e,u){var d=this,t=Ext.supports.Touch,c=d.dragCurrent,l=d.currentPoint,w=l.x,x=l.y,k=[],s=[],h=[],i=[],g=[],j=[],v=t?document.documentElement.clientWidth/window.innerWidth:1,p,b,o,r,a,f,n,m;if(!c||c.isLocked()){return}m=!(c.deltaX<0||c.deltaY<0);if(t||!d.notifyOccluded&&(!Ext.supports.CSSPointerEvents||Ext.isOpera)&&m){p=c.getDragEl();if(m){p.style.visibility='hidden'}var q=Ext.getBody().getScroll();e.target=document.elementFromPoint(e.clientX-q.left/v,e.clientY-q.top/v);if(m){p.style.visibility='visible'}}for(a in d.dragOvers){b=d.dragOvers[a];delete d.dragOvers[a];if(!d.isTypeOfDD(b)||b.destroyed){continue}if(d.notifyOccluded){if(!this.isOverTarget(l,b,d.mode)){h.push(b)}}else {if(!e.within(b.getEl())){h.push(b)}}s[a]=!0}for(n in c.groups){if('string'!==typeof n){continue}for(a in d.ids[n]){b=d.ids[n][a];if(d.isTypeOfDD(b)&&(o=b.getEl())&&b.isTarget&&!b.isLocked()&&Ext.fly(o).isVisible(!0)&&(b!==c||c.ignoreSelf===!1)){if(d.notifyOccluded){if((b.zIndex=d.getZIndex(o))!==-1){r=!0}k.push(b)}else {if(e.within(b.getEl())){k.push(b);break}}}}}if(r){Ext.Array.sort(k,d.byZIndex)}for(a=0,f=k.length;a<f;a++){b=k[a];if(d.isOverTarget(l,b,d.mode)){if(u){g.push(b)}else {if(!s[b.id]){j.push(b)}else {i.push(b)}d.dragOvers[b.id]=b}if(!d.notifyOccluded){break}}}if(d.mode){if(h.length){c.b4DragOut(e,h);c.onDragOut(e,h)}if(j.length){c.onDragEnter(e,j)}if(i.length){c.b4DragOver(e,i);c.onDragOver(e,i)}if(g.length){c.b4DragDrop(e,g);c.onDragDrop(e,g)}}else {for(a=0,f=h.length;a<f;++a){c.b4DragOut(e,h[a].id);c.onDragOut(e,h[a].id)}for(a=0,f=j.length;a<f;++a){c.onDragEnter(e,j[a].id,j[a])}for(a=0,f=i.length;a<f;++a){c.b4DragOver(e,i[a].id);c.onDragOver(e,i[a].id)}for(a=0,f=g.length;a<f;++a){c.b4DragDrop(e,g[a].id);c.onDragDrop(e,g[a].id)}}if(u&&!g.length){c.onInvalidDrop(e)}}});Ext.override(Ext.dd.DragSource,{onDragEnter:function(c,b,a){this.forceCachedTarget=a;return this.callParent([c,b])},beforeDragEnter:function(a,c,b){if(this.forceCachedTarget){a=this.cachedTarget=this.forceCachedTarget;delete this.forceCachedTarget}return this.callParent([a,c,b])}});var b=Ext.dd.ScrollManager;var a=Ext.dd.DragDropManager;a.fireEvents=Ext.Function.createSequence(a.fireEvents,b.onFire,b);a.stopDrag=Ext.Function.createSequence(a.stopDrag,b.onStop,b)}});Ext.define('Sch.patches.NavigationModel',{extend:'Sch.util.Patch',target:'Ext.grid.NavigationModel',minVersion:'6.0.0',overrides:{setPosition:function(g,f,a,e,d){var c=this;if(Ext.isIE&&a&&(a.getKey()===a.PAGE_DOWN||a.getKey()===a.PAGE_UP)){var b=c.lastFocused;if(a.view.isLockedView&&b&&a.view.getVisibleColumnManager().indexOf(b.column)===-1){a.view=a.view.lockingPartner}}return c.callParent(arguments)},onCellClick:function(a,f,d,e,g,c,b){this.callParent(arguments);if(b.position.column.cellFocusable===!1){if(a.isNormalView){if(Ext.isIE11m){a.ownerCt.el.focus()}else {if(!this.lastFocused){a.el.focus()}}}}}}});Ext.define('Sch.view.WeekView',{requires:['Ext.util.Region'],view:null,showAllDayHeader:!1,constructor:function(a){Ext.apply(this,a)},getElementsFromEventRecord:function(a,h,b,c){var g=this,f=g.view,e,d;c=c||!1;if(b!==null&&b!==undefined){e='[id^='+f.eventPrefix+a.internalId+'-calendar-'+b+'-]'}else {e='[id^='+f.eventPrefix+a.internalId+'-calendar-]'}d=f.getEl().query(e,c);if(g.showAllDayHeader&&a.getAllDay()){[].push.apply(d,g.view.ownerGrid.allDayNormalHeader.getSchedulingView().getElementsFromEventRecord(a,h,b,c))}return d},getColumnsBy:function(e,d){var b=this.view.panel.headerCt.getGridColumns();var c=[];for(var a=0;a<b.length;a++){if(e.call(this,b[a])){if(d!==!0){c.push(b[a])}else {c.push({column:b[a],index:a})}}}return c},getColumnsForDateRange:function(a,b){return this.getColumnsBy(function(b){return !(a.getEndDate()<=b.start||a.getStartDate()>=b.end)},b)},getColumnEvents:function(a){var c=this,b=[];this.view.getEventStore().each(function(d){if(!(c.showAllDayHeader&&d.getAllDay())&&!(d.getEndDate()<=a.start||d.getStartDate()>=a.end)){b.push(d)}});return b},getColumnsByResource:function(b,a){return this.getColumnsBy(function(a){return a.start==b.start},a)[0]},translateToScheduleCoordinate:function(b){var a=this.view;if(Ext.isArray(b)){return [b[0]-a.getEl().getX()+a.getHorizontalScroll(),b[1]-a.getViewContainerElementTop()+a.getVerticalScroll()]}else {return b-a.getViewContainerElementTop()+a.getVerticalScroll()}},translateToPageCoordinate:function(b){var a=this.view;var c=a.getEl();if(Ext.isArray(b)){return [b[0]+c.getX()-a.getHorizontalScroll(),b[1]+a.getViewContainerElementTop()-a.getVerticalScroll()]}else {return b+a.getViewContainerElementTop()-a.getVerticalScroll()}},getDateFromXY:function(d,b,c){var a=d;if(!c){a=this.translateToScheduleCoordinate(a)}return this.view.timeAxisViewModel.getDateFromPosition(a,b)},getEventRenderData:function(l,m,g){var e=l.getStartDate(),f=l.getEndDate(),b=this.view,i=b.panel.headerCt.getGridColumns(),h=i[g].start,j=i[g].end,d=Math;var k=Math.floor(b.getCoordinateFromDate(Sch.util.Date.max(e,h)));var c=Math.floor(b.timeAxisViewModel.getPositionFromDate(Sch.util.Date.min(f,j),!0));var a;if(c===0){c=b.getStore().getCount()*b.getRowHeight()}a={top:d.max(0,d.min(k,c)-b.eventBorderWidth),height:d.max(1,d.abs(k-c))};a.start=e;a.end=f;a.startsOutsideView=e<h;a.endsOutsideView=f>j;return a},getScheduleRegion:function(b,h){var a=this.view,c=b?this.getColumnsByResource(b).getRegion():a.getTableRegion(),d=this.translateToPageCoordinate(0),e=this.translateToPageCoordinate(a.getStore().getCount()*a.getRowHeight()),g=c.left+a.barMargin,f=c.right-a.barMargin;return new Ext.util.Region(Math.min(d,e),f,Math.max(d,e),g)},getWeekViewColumnWidth:function(){return this.view.timeAxisViewModel.weekViewColumnWidth},getResourceRegion:function(i,b,d){var a=this.view,c=a.getResourceStore().indexOf(i)*this.getWeekViewColumnWidth(),e=a.timeAxis.getStart(),g=a.timeAxis.getEnd(),k=b?Sch.util.Date.max(e,b):e,m=d?Sch.util.Date.min(g,d):g,f=Math.max(0,a.getCoordinateFromDate(k)-a.cellTopBorderWidth),h=a.getCoordinateFromDate(m)-a.cellTopBorderWidth,l=c+a.cellBorderWidth,j=c+this.getWeekViewColumnWidth()-a.cellBorderWidth;return new Ext.util.Region(Math.min(f,h),j,Math.max(f,h),l)},columnRenderer:function(m,a,l,k,f){var b=this.view;var g='';if(k===0){var c,e,d,j;c=[];e=this.getColumnEvents(a.column);for(d=0,j=e.length;d<j;d++){var h=e[d],i=b.generateTplData(h,h.getResources()[0],f);i&&c.push(i)}if(a.column.rendered&&this.getWeekViewColumnWidth()!==a.column.getWidth()){this.setColumnWidth(a.column.getWidth(),!0)}b.eventLayout.vertical.applyLayout(c,this.getWeekViewColumnWidth()-2*b.barMargin-b.cellBorderWidth);g='&#160;'+b.eventTpl.apply(c)}if(f%2===1){a.tdCls=(a.tdCls||'')+' '+b.altColCls;a.cellCls=(a.cellCls||'')+' '+b.altColCls}return g},resolveResource:function(a){var c=this.view;a=Ext.fly(a).is(c.timeCellSelector)?a:Ext.fly(a).up(c.timeCellSelector);if(a){var e=a.dom?a.dom:a;var b=0;b=Ext.Array.indexOf(Array.prototype.slice.call(e.parentNode.children),e);if(b>=0){var d=c.panel.headerCt.getGridColumns()[b];return {start:d.start,end:d.end}}}},onEventUpdate:function(d,a){if(!this.view.rendered||!this.view.headerCt.items.get(0).rendered){return}this.renderSingle(a);var b=this.view;var c=b.getEventSelectionModel();c.forEachEventRelatedSelection(a,function(a){b.onEventBarSelect(a)})},onEventAdd:function(c,a){if(!this.view.rendered||!this.view.headerCt.items.get(0).rendered){return}var b=this.view;if(a.length===1){this.renderSingle(a[0])}else {b.repaintAllEvents()}},onEventRemove:function(c,a){if(!this.view.rendered||!this.view.headerCt.items.get(0).rendered){return}var b=this.view;if(a.length===1){Ext.Array.each(b.getElementsFromEventRecord(a[0],undefined,undefined,!0),function(a){Ext.fly(a).destroy()});this.relayoutRenderedEvents(a[0])}else {b.repaintAllEvents()}},relayoutRenderedEvents:function(b){var a=this,c=a.getColumnsForDateRange(b,!0);Ext.Array.each(c,function(b){a.repaintEventsForColumn(b.column,b.index)})},renderSingle:function(a){var b=this.view;Ext.Array.each(this.getElementsFromEventRecord(a,undefined,undefined,!0),function(a){if(b.el.isAncestor(a)){Ext.fly(a).destroy()}});var c=a.previous||{};var d=Sch.util.Date;var e=new Sch.model.Range({StartDate:d.min(c[a.startDateField]||a.getStartDate(),a.getStartDate()),EndDate:d.max(c[a.endDateField]||a.getEndDate(),a.getEndDate())});var f=this.getColumnsForDateRange(e);Ext.Array.each(f,function(c){var d=c.getIndex();var f=this.getColumnEvents(c);var e=Ext.Array.map(f,function(e){if(e===a){return b.generateTplData(a,a.getResources()[0],d)}else {return {start:e.getStartDate()<c.start?c.start:e.getStartDate(),end:e.getEndDate()>c.end?c.end:e.getEndDate(),event:e}}});b.eventLayout.vertical.applyLayout(e,c.getWidth()-2*b.barMargin-b.cellBorderWidth);Ext.Array.each(e,function(c){if(c.event===a){var e=b.getScheduleCell(0,d);if(e){if(!Ext.versions.touch){e=Ext.fly(e).first()}b.eventTpl.append(e,[c])}}else {var f=b.getElementsFromEventRecord(c.event,null,d)[0];if(f){f.setStyle({left:c.left+'px',width:Math.max(c.width,0)+'px'})}}})},this)},repaintEventsForColumn:function(c,o){var k=this;var j=k.getColumnEvents(c);var e=k.view;var f=[],b,l,a,d,g,h;for(b=0,l=j.length;b<l;b++){a=j[b];d=e.getElementsFromEventRecord(a,undefined,undefined,!0)[0];if(!d){return}var i=d.id.split('-');i.pop();g=a.getStartDate();h=a.getEndDate();f.push({start:g<c.start?c.start:g,end:h>c.end?c.end:h,event:a,id:i.join('-')})}e.eventLayout.vertical.applyLayout(f,c.getWidth()-2*e.barMargin-e.cellBorderWidth);var n=e.getNode(0);for(b=0;b<f.length;b++){a=f[b];var m='td:nth-child('+(o+1)+') [id^='+a.id+'-]';d=Ext.dom.Query.selectNode(m,n);d&&Ext.fly(d).setStyle({left:a.left+'px',width:Math.max(a.width,0)+'px'})}},getTimeSpanRegion:function(d,c){var h=this.view,e=h.getCoordinateFromDate(d),g=c?h.timeAxisViewModel.getPositionFromDate(c,!0):e;var a=this.getColumnsBy(function(a){return a.start<=d&&a.end>d})[0];var b=this.getColumnsBy(function(a){return a.start<c&&a.end>=c})[0];if(!a||!b||!a.rendered||!b.rendered){return new Ext.util.Region(-1,0,-1,0)}var f=this.translateToScheduleCoordinate([a.getX(),0]);var i=this.translateToScheduleCoordinate([b?b.getRegion().right:a.getWidth()+f[0],0]);return new Ext.util.Region(Math.min(e,g),i[0],Math.max(e,g),f[0])},getStartEndDatesFromRegion:function(a,b){var d=this.view.getDateFromCoordinate([a.left,a.top],b),c=this.view.getDateFromCoordinate([a.left,a.bottom],b);if(d&&c){return {start:d,end:c}}else {return null}},setColumnWidth:function(a,c){var b=this.view;b.weekViewColumnWidth=a;b.getTimeAxisViewModel().setViewColumnWidth(a,c)},getVisibleDateRange:function(){var a=this.view;if(!a.rendered){return null}var e=a.getScroll(),d=a.getViewContainerHeight(),b=a.getTableRegion(),c=a.timeAxis.getEnd();if(b.bottom-b.top<d){var f=a.timeAxis.getStart();return {startDate:f,endDate:c}}return {startDate:a.getDateFromCoordinate(e.top,null,!0),endDate:a.getDateFromCoordinate(e.top+d,null,!0)||c}},getItemBox:function(a){return null},getConnectorStartSide:function(a){return 'top'},getConnectorEndSide:function(a){return 'bottom'}});Ext.define('Sch.mixin.SchedulerView',{extend:'Sch.mixin.AbstractSchedulerView',mixins:['Sch.mixin.Localizable'],requires:['Sch.patches.BoundList','Sch.patches.DragDropManager','Sch.patches.NavigationModel','Sch.patches.NavigationModel6_0_2','Sch.feature.DragCreator','Sch.feature.DragDrop','Sch.feature.ResizeZone','Sch.column.Resource','Sch.column.Day','Sch.view.WeekView','Ext.Factory','Ext.XTemplate'],eventResizeHandles:'end',dndValidatorFn:Ext.emptyFn,resizeValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,weekViewClass:'Sch.view.WeekView',lockedGridDependsOnSchedule:null,_initializeSchedulerView:function(){var a=this;a.callParent(arguments);if(!a.eventPrefix){throw 'eventPrefix missing'}a.on({destroy:a._destroy,afterrender:a._afterRender,itemupdate:a.onRowUpdated,scope:a});a.timeAxis.on('beginreconfigure',a.clearRowHeightCache,a);a.on({resourcestorechange:a.clearRowHeightCache,assignmentstorechange:a.clearRowHeightCache,eventstorechange:a.clearRowHeightCache,scope:a})},inheritables:function(){return {loadingText:this.L('loadingText'),overItemCls:'',trackOver:!1,selectedItemCls:'',setReadOnly:function(b){var a=this;if(a.dragCreator){a.dragCreator.setDisabled(b)}a.callParent(arguments)},repaintEventsForResource:function(b,e){var a=this,c=a.isHorizontal(),d=c?a.indexOf(b):0;if(c){a.eventLayout.horizontal.clearCache(b)}if(d>=0){Ext.suspendLayouts();if(c){a.refreshNode(b);if(a.lockedGridDependsOnSchedule){a.lockingPartner.refreshNode(b)}}else {a.refreshNode(d)}Ext.resumeLayouts();if(e){var g=a.getEventSelectionModel();var f=a.getEventStore().getEventsForResource(b);Ext.Array.each(f,function(b){g.forEachEventRelatedSelection(b,function(b){a.onEventBarSelect(b,!0)})})}}},repaintAllEvents:function(){if(this.isHorizontal()){this.refreshView()}else {this.refreshNode(0)}},handleScheduleEvent:function(a){var j=a.getTarget('.'+this.eventCls,3),f=!j&&a.getTarget('.'+this.timeCellCls,3);if(f){var g=this.getDateFromDomEvent(a,'floor');var d=this.findRowByChild(f);var i=this.indexOf(d);var c=null;if(!this.allDay){if(this.isHorizontal()){c=this.getRecordForRowNode(d)}else {var b=a.getTarget(this.timeCellSelector,5);if(b){var h=typeof b.cellIndex=='number'?b.cellIndex:b.getAttribute('data-cellIndex');var e=this.headerCt.getGridColumns()[h];c=e&&e.model}}}if(a.type.indexOf('pinch')>=0){this.fireEvent('schedule'+a.type,this,a)}else {this.fireEvent('schedule'+a.type,this,g,i,c,a)}}},onEventDataRefresh:function(){this.clearRowHeightCache();this.callParent(arguments)},onUnbindStore:function(a){a.un({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},bindStore:function(a){a&&a.on({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},refreshKeepingScroll:function(){if(this.rendered){this.lockingPartner.refreshView();this.callParent(arguments)}}}},getEventSelectionModel:function(){var a=this,b;if(a.eventSelModel&&a.eventSelModel.isSelectionModel){return a.eventSelModel}if(typeof a.eventSelModel==='string'){a.eventSelModel={type:a.eventSelModel}}if(a.simpleSelect){b='SIMPLE'}else {if(a.multiSelect){b='MULTI'}else {b='SINGLE'}}a.eventSelModel=Ext.Factory.selection(Ext.apply({type:a.eventSelModelType||(a.getEventStore().getAssignmentStore()?'assignmentmodel':'eventmodel'),mode:b,allowDeselect:a.allowDeselect||a.multiSelect,locked:a.disableSelection},a.eventSelModel));return a.eventSelModel},_afterRender:function(){this.setEventStore(this.eventStore,!0);this.getEventSelectionModel().bindToView(this);this.setupEventListeners();this.configureFunctionality();var a=this.headerCt.resizer;if(a){a.doResize=Ext.Function.createSequence(a.doResize,this.afterHeaderResized,this)}this.on('itemupdate',function(){this.hoveredEventNode=null})},_destroy:function(){this.setEventStore(null)},clearRowHeightCache:function(){if(this.isHorizontal()){this.eventLayout.horizontal.clearCache()}},configureFunctionality:function(){var a=this,b=a.validatorFnScope||a;if(a.eventResizeHandles!=='none'&&Sch.feature.ResizeZone){a.resizePlug=new Sch.feature.ResizeZone(Ext.applyIf({schedulerView:a,validatorFn:function(c,d,e,f){if(!(c instanceof Sch.model.Resource)){c=null}return (a.allowOverlap||a.isDateRangeAvailable(e,f,d,c))&&a.resizeValidatorFn.apply(b,arguments)},validatorFnScope:a},a.resizeConfig||{}))}if(a.enableEventDragDrop!==!1&&Sch.feature.DragDrop){var c=this.ownerGrid.findPlugin('scheduler_split');a.dragdropPlug=new Sch.feature.DragDrop(a,{validatorFn:function(e,c,d,f){if(!(c instanceof Sch.model.Resource)){c=null}return (a.allowOverlap||a.isDateRangeAvailable(d,Sch.util.Date.add(d,Sch.util.Date.MILLI,f),e[0],c))&&a.dndValidatorFn.apply(b,arguments)},validatorFnScope:a,targetEl:c?a.getEl():a.ownerGrid.el,dragConfig:a.dragConfig||{}})}if(a.enableDragCreation!==!1){a.dragCreator=Ext.create(Ext.apply({xclass:'Sch.feature.DragCreator'},{schedulerView:a,disabled:a.readOnly,validatorFn:function(c,d,e){if(!(c instanceof Sch.model.Resource)){c=null}return (a.allowOverlap||a.isDateRangeAvailable(d,e,null,c))&&a.createValidatorFn.apply(b,arguments)},validatorFnScope:a},a.createConfig))}if(a.createEventOnDblClick!==!1){a.on({scheduledblclick:a.doCreateEventOnDblClick,schedulelongpress:a.doCreateEventOnDblClick,scope:a})}},doCreateEventOnDblClick:function(c,i,k,d){if(this.readOnly){return}var j=this,f=c.allDay&&c.ownerGrid.mainScheduler.getSchedulingView(),h=f?f.getEventEditor():j.getEventEditor(),g=c.getEventStore(),a=g.getModel(),b={};b[a.prototype.startDateField]=i;b[a.prototype.endDateField]=Sch.util.Date.add(i,c.timeAxis.unit,1);b[a.prototype.allDayField]=Boolean(c.allDay);b[a.prototype.resourceIdField]=d&&d.getId()||null;var e=Ext.create(a,b);j.onEventCreated(e,d);if(h){h.showRecord(e)}else {g.add(e)}},onDragDropStart:function(){if(this.dragCreator){this.dragCreator.setDisabled(!0)}if(this.tip){this.tip.hide();this.tip.disable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(!1)}this.disableViewScroller(!0);this.hoveredEventNode=null},onDragDropEnd:function(){if(this.dragCreator){this.dragCreator.setDisabled(!1)}if(this.tip){this.tip.enable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(!0)}this.disableViewScroller(!1)},onBeforeDragCreate:function(d,b,c,a){return !this.readOnly&&!a.ctrlKey},onDragCreateStart:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(!1)}if(this.tip){this.tip.hide();this.tip.disable()}this.disableViewScroller(!0)},onDragCreateEnd:function(f,a,c){if(!this.getEventEditor()){var e=c?[c]:[];if(this.fireEvent('beforeeventadd',this,a,e)!==!1){var b=this.getEventStore(),d=b.getAutoSync();if(d){b.suspendAutoSync()}b.append(a);if(!this.isWeekView()){a.assign(c)}this.onEventCreated(a,e);if(d){b.resumeAutoSync(!0)}}}if(this.overScheduledEventClass){this.setMouseOverEnabled(!0)}},onEventCreated:function(a,b){},onAfterDragCreate:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(!0)}if(this.tip){this.tip.enable()}this.disableViewScroller(!1)},onBeforeResize:function(){return !this.readOnly},onResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}if(this.dragCreator){this.dragCreator.setDisabled(!0)}this.disableViewScroller(!0)},onResizeEnd:function(){if(this.tip){this.tip.enable()}if(this.dragCreator){this.dragCreator.setDisabled(!1)}this.disableViewScroller(!1)},setupEventListeners:function(){this.on({eventdragstart:this.onDragDropStart,aftereventdrop:this.onDragDropEnd,beforedragcreate:this.onBeforeDragCreate,dragcreatestart:this.onDragCreateStart,dragcreateend:this.onDragCreateEnd,afterdragcreate:this.onAfterDragCreate,beforeeventresize:this.onBeforeResize,eventresizestart:this.onResizeStart,aftereventresize:this.onResizeEnd,scope:this})},afterHeaderResized:function(){var a=this.headerCt.resizer;if(a&&!this.isHorizontal()){if(this.panel.forceFit){this.setColumnWidth(a.origWidth)}else {var b=a.dragHd.getWidth();this.setColumnWidth(b)}}},columnRenderer:function(e,b,a,d,c){return this[this.mode].columnRenderer(e,b,a,d,c)},onRowUpdated:function(b){var a=this,c;if(a.isHorizontal()&&a.hasListener('eventrepaint')){Ext.Array.each(b.getEvents(),function(d){c=a.getElementsFromEventRecord(d,b,null,!0);Ext.Array.each(c,function(b){a.fireEvent('eventrepaint',a,d,b)})})}},scrollResourceEventIntoView:function(g,b,p,l,n,m,q){if(this.allDay){return}var c=this,e=c.up('timelinegrid,timelinetree'),i=b.getStartDate(),k=b.getEndDate(),f,a;var j=function(){a=c.getElementsFromEventRecord(b,g,p);a=a.length&&a[0]||null;if(a){c.scrollElementIntoView(a,!0,n,l,null,m,q)}};var d=c.timeAxis,h=b.getAllDay&&b.getAllDay()&&e.allDayNormalHeader?e.allDayNormalHeader.getSchedulingView().timeAxis:d;if(!h.dateInAxis(i)||!h.dateInAxis(k,!0)){f=d.getEnd()-d.getStart();d.setTimeSpan(new Date(i.getTime()-f/2),new Date(k.getTime()+f/2));c.up('panel').scrollTask.cancel()}if(this.isHorizontal()){var o=e.store.isTreeStore;e.ensureVisible(o?g.getPath():g,{callback:function(){j()}})}else {j()}}});Ext.define('Sch.view.SchedulerGridView',{extend:'Sch.view.TimelineGridView',mixins:['Sch.mixin.SchedulerView','Sch.mixin.GridViewCanvas','Sch.mixin.Localizable'],alias:'widget.schedulergridview'},function(){this.override(Sch.mixin.SchedulerView.prototype.inheritables()||{})});Ext.define('Sch.selection.EventModel',{extend:'Ext.selection.Model',alias:'selection.eventmodel',requires:['Ext.util.KeyNav'],deselectOnContainerClick:!0,selectedOnMouseDown:null,bindComponent:Ext.emptyFn,onEditorKey:Ext.emptyFn,onStoreLoad:Ext.emptyFn,bindToView:function(b){var a=this;a.view=b;a.bindStore(a.getSelectionStore(b));b.on({eventclick:a.onEventClick,eventmousedown:a.onEventMouseDown,itemmousedown:a.onItemMouseDown,refresh:function(){a.refresh()},destroy:function(){a.bindStore(null)},scope:a})},getSelectionStore:function(a){return a.getEventStore()},bindStore:function(a){if(this.getStore()){this.mun(this.getStore(),'load',this.onSelectionStoreLoad,this)}if(a){this.mon(a,'load',this.onSelectionStoreLoad,this)}this.callParent(arguments)},onSelectionStoreLoad:function(){this.deselectAll()},onEventMouseDown:function(c,a,b){this.selectedOnMouseDown=null;if((!this.ignoreRightMouseSelection||b.button!==2)&&!this.isSelected(a)){this.selectedOnMouseDown=a;this.selectWithEvent(a,b)}},onEventClick:function(c,b,a){if((!this.ignoreRightMouseSelection||a.button!==2)&&!this.selectedOnMouseDown){this.selectWithEvent(b,a)}},onItemMouseDown:function(b,c,d,e,a){if(this.deselectOnContainerClick&&!a.getTarget(this.view.eventSelector)){this.deselectAll()}},onSelectChange:function(c,e,b,g){var a=this,d=a.view,h=a.store,f=e?'select':'deselect',i=0;if(d&&(b||a.fireEvent('before'+f,a,c))!==!1&&g()!==!1){if(e){d.onEventBarSelect(c,b)}else {d.onEventBarDeselect(c,b)}if(!b){a.fireEvent(f,a,c)}}},selectRange:Ext.emptyFn,selectNode:function(d,c,b){var a=this.view.resolveEventRecord(d);if(a){this.select(a,c,b)}},deselectNode:function(c,d,b){var a=this.view.resolveEventRecord(c);if(a){this.deselect(a,b)}},getFirstSelectedEventForResource:function(f){var d=this.getSelection(),b=null,a,e,c;for(a=0,e=d.length;!b&&a<e;++a){c=d[a];if(c.isAssignedTo(f)){b=c}}return b},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(a){return a.isDraggable()})},forEachEventRelatedSelection:function(a,b){this.isSelected(a)&&b(a)},refresh:function(){var a=this,l=a.store,e=[],c=[],k=a.getSelection(),m=k.length,b=a.getSelected(),h,j,d,g,i,f;if(!l||!(b.isCollection||b.isBag||b.isRows)||!b.getCount()){return}d=l.getData();if(d.getSource){j=d.getSource();if(j){d=j}}a.refreshing=!0;b.beginUpdate();a.suspendChanges();for(f=0;f<m;f++){g=k[f];i=d.get(g.getId());if(i){e.push(i)}else {if(!a.pruneRemoved){c.push(g)}}if(a.mode==='SINGLE'&&c.length){break}}if(b.getCount()!==e.length+c.length){h=!0}a.clearSelections();if(e.length){a.doSelect(e,!1,!0)}if(c.length){b.add(c);if(!a.lastSelected){a.lastSelected=c[c.length-1]}}a.resumeChanges();if(h){b.endUpdate()}else {b.updating--}a.refreshing=!1;a.maybeFireSelectionChange(h)}});Ext.define('Sch.selection.AssignmentModel',{extend:'Sch.selection.EventModel',alias:'selection.assignmentmodel',assignmentStoreDetacher:null,getSelectionStore:function(a){return a.getEventStore().assignmentStore},onBindStore:function(b){this.callParent(arguments);if(b){var a=this;a.assignmentStoreDetacher&&a.assignmentStoreDetacher.destroy();a.assignmentStoreDetacher=b.on({remove:a.onAssignmentStoreRemove,clear:a.onAssignmentStoreClear,refresh:a.onAssignmentStoreRefresh,scope:a,destroyable:!0})}},onEventMouseDown:function(d,c,b){this.selectedOnMouseDown=null;var a=this.resolveAssignmentRecordFromEventNode(b.getTarget());if(a&&(!this.ignoreRightMouseSelection||b.button!==2)&&!this.isSelected(a)){this.selectedOnMouseDown=a;this.selectWithEvent(a,b)}},onEventClick:function(d,c,a){var b=this.resolveAssignmentRecordFromEventNode(a.getTarget());if(b&&(!this.ignoreRightMouseSelection||a.button!==2)&&!this.selectedOnMouseDown){this.selectWithEvent(b,a)}},resolveAssignmentRecordFromEventNode:function(d){var a=this.view,c=a.resolveEventRecord(d),b=a.resolveResource(d);if(c&&b){var e=a.getEventStore().getAssignmentStore();return e.getAssignmentForEventAndResource(c,b)}},selectNode:function(d,c,b){var a=this.resolveAssignmentRecordFromEventNode(d);if(a){this.select(a,c,b)}},deselectNode:function(c,d,b){var a=this.resolveAssignmentRecordFromEventNode(c);if(a){this.deselect(a,b)}},getFirstSelectedEventForResource:function(f){var d=this.getSelection(),b=null,a,e,c;for(a=0,e=d.length;!b&&a<e;++a){c=d[a];if(c.getEvent().isAssignedTo(f)){b=c;break}}return b},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(a){return a.getEvent().isDraggable()})},forEachEventRelatedSelection:function(a,b){Ext.Array.each(this.getSelection(),function(c){c.getEvent()===a&&b(c)})},onAssignmentStoreRemove:function(b,a){this.deselect(a,!0)},onAssignmentStoreClear:function(a){this.clearSelections()},onAssignmentStoreRefresh:function(a){this.clearSelections()},destroy:function(){var a=this;Ext.destroyMembers(a,'assignmentStoreDetacher');a.callParent()}});Ext.define('Sch.mixin.SchedulerPanel',{extend:'Sch.mixin.AbstractSchedulerPanel',requires:['Sch.view.SchedulerGridView','Sch.feature.RecurringEvents','Sch.selection.EventModel','Sch.selection.AssignmentModel','Sch.column.Resource','Sch.column.timeAxis.Vertical','Sch.column.ResourceName'],uses:['Sch.panel.AllDayHeader'],eventSelModelType:null,eventSelModel:null,enableEventDragDrop:!0,enableDragCreation:!0,createEventOnDblClick:!1,dragConfig:null,weekViewColumnClass:'Sch.column.Day',componentCls:'sch-schedulerpanel',lockedGridDependsOnSchedule:!0,showAllDayHeader:!0,verticalListeners:null,horizontalLockedWidth:null,verticalColumns:null,calendarColumns:null,recurringEvents:!0,horizontalCls:['sch-horizontal'],verticalCls:['sch-vertical-resource','sch-vertical'],weekviewCls:['sch-calendar','sch-vertical'],_oldViewPresetArgs:null,relayedViewEvents:['eventclick','eventlongpress','eventmousedown','eventmouseup','eventdblclick','eventcontextmenu','eventmouseenter','eventmouseleave','eventkeydown','eventkeyup','beforeeventresize','eventresizestart','eventpartialresize','beforeeventresizefinalize','eventresizeend','aftereventresize','beforeeventdrag','eventdragstart','eventdrag','beforeeventdropfinalize','eventdrop','aftereventdrop','beforedragcreate','dragcreatestart','beforedragcreatefinalize','dragcreateend','afterdragcreate','beforeeventadd'],inheritables:function(){return {variableRowHeight:!0,initComponent:function(){var a=this,f=a.normalViewConfig=a.normalViewConfig||{},c=a.getDependencyViewConfig&&a.getDependencyViewConfig()||{};a._initializeSchedulerPanel();a.verticalListeners={clear:a.refreshResourceColumns,datachanged:a.refreshResourceColumns,update:a.refreshResourceColumns,load:a.refreshResourceColumns,scope:a};a.calendarListeners={reconfigure:a.refreshCalendarColumns,priority:1,scope:a};a.calendarNormalGridListeners={columnresize:a.onCalendarColumnResize,scope:a};a.calendarResourceStoreListeners={load:a.onCalendarResourceStoreChange,add:a.onCalendarResourceStoreChange,remove:a.onCalendarResourceStoreChange,scope:a};a.normalViewConfig=a.normalViewConfig||{};Ext.apply(a.normalViewConfig,{eventStore:a.eventStore,resourceStore:a.resourceStore,dependencyStore:a.dependencyStore,eventBarTextField:a.eventBarTextField||this.getEventStore().getModel().prototype.nameField});if(a.getDependencyStore()&&c.enableDependencyDragDrop!==!1){f.terminalSides=c.terminalSides||['left','right','top','bottom']}Ext.copy(a.normalViewConfig,a,['barMargin','eventBodyTemplate','eventTpl','allowOverlap','dragConfig','eventBarIconClsField','onEventCreated','constrainDragToResource','snapRelativeToEventStartDate','eventSelModelType','eventSelModel','simpleSelect','multiSelect','allowDeselect','lockedGridDependsOnSchedule','showAllDayHeader'],!0);a.callParent(arguments);if(a.recurringEvents!==!1&&(!a.recurringEvents||!a.recurringEvents.isInstance)){a.recurringEvents=Ext.create(Ext.apply({xclass:'Sch.feature.RecurringEvents',panel:a},a.recurringEvents))}if(!a.isHorizontal()){a.setGroupingFeatureDisabled(!0)}if(a.isVertical()){a.mon(a.resourceStore,a.verticalListeners)}else {if(a.isWeekView()&&a.showAllDayHeader){a.addDockedAllDayHeader()}}var d=a.lockedGrid.getView();var b=a.getSchedulingView();d.on('resize',a.onLockedViewResize,a);a.registerRenderer(b.columnRenderer,b);if(a.resourceZones){var e=Ext.StoreManager.lookup(a.resourceZones);a.resourceZonesPlug=new Sch.plugin.ResourceZones(Ext.apply({store:e},a.resourceZonesConfig));a.resourceZonesPlug.init(a)}b.on('columnwidthchange',a.onColWidthChange,a);a.relayEvents(b,a.relayedViewEvents);if(!a.syncRowHeight){a.enableRowHeightInjection(d,b)}if(a.getDependencyStore()){a.addCls('sch-scheduler-with-dependencies')}},configureColumns:function(b){var a=this;b=b||[{xtype:'scheduler_resourcenamecolumn'}];a.callParent(arguments);a.verticalColumns=a.verticalColumns||[Ext.apply({xtype:'verticaltimeaxis'},a.timeAxisColumnCfg||{})];Ext.Array.each(a.verticalColumns,function(b){Ext.apply(b,{timeAxis:a.timeAxis,timeAxisViewModel:a.timeAxisViewModel,cellTopBorderWidth:a.cellTopBorderWidth,cellBottomBorderWidth:a.cellBottomBorderWidth})});a.calendarColumns=[Ext.apply({xtype:'verticaltimeaxis',width:60,timeAxis:a.timeAxis,timeAxisViewModel:a.timeAxisViewModel,cellTopBorderWidth:a.cellTopBorderWidth,cellBottomBorderWidth:a.cellBottomBorderWidth},a.calendarTimeAxisCfg||a.weekViewTimeAxisCfg||{})];if(a.isVertical()){a.columns=a.verticalColumns.concat(a.createResourceColumns(a.resourceColumnWidth||a.timeAxisViewModel.resourceColumnWidth));a.store=a.timeAxis;if(a.resourceStore.isGrouped()){a.timeAxis.group(a.resourceStore.groupField);a.bindGroupingFeatureListener()}}else {if(a.isWeekView()){a.columns=[];a.store=null;a.on('beforerender',a.refreshCalendarColumns,a)}}},applyViewSettings:function(c,d){this.callParent(arguments);var a=this.getSchedulingView(),b;if(this.orientation==='vertical'){b=c.timeColumnWidth||60;a.setColumnWidth(c.resourceColumnWidth||100,!0);a.setRowHeight(b,!0)}},onRender:function(){if(!this.isHorizontal()){this.reconfigureBufferedRendering(!0)}this.callParent(arguments)},afterRender:function(){var a=this;var b=this.getSchedulingView();this.callParent(arguments);if(this.isVertical()){this.onLockedViewResize(null,null,this.lockedGrid.getView().getHeight())}else {if(this.isWeekView()){this.mon(this.timeAxis,this.calendarListeners);this.mon(this.resourceStore,this.calendarResourceStoreListeners);this.normalGrid.on(this.calendarNormalGridListeners)}}if(this.infiniteScroll){b.on({eventdragstart:this.doSuspendLayouts,aftereventdrop:this.doResumeLayouts,eventresizestart:this.doSuspendLayouts,aftereventresize:this.doResumeLayouts,scope:this})}if(this.lockedGridDependsOnSchedule){b.on('itemupdate',this.onNormalViewItemUpdate,this)}this.relayEvents(this.getEventSelectionModel(),['selectionchange','deselect','select'],'event');this.getView().on('refresh',function(){if(!a.isHorizontal()){a.reconfigureBufferedRendering()}});var c={keydown:a.handleTimelineKeyEvent,keypress:a.handleTimelineKeyEvent,keyup:a.handleTimelineKeyEvent,scope:a};if(Ext.isIE11){a.normalGrid.el.on(c)}else {b.el.on(c)}b.on({eventclick:a.handleTimelineEventClick,scope:a})},getTimeSpanDefiningStore:function(){return this.eventStore},destroy:function(){var a=this;if(a.destroyStores){a.getDependencyStore()&&a.getDependencyStore().destroy();a.getAssignmentStore()&&a.getAssignmentStore().destroy();a.getEventStore()&&a.getEventStore().destroy();a.getResourceStore()&&a.getResourceStore().destroy()}a.destroyDockedAllDayHeader();Ext.destroyMembers(a,'resourceZonesPlug');a.callParent(arguments)},scrollToDateCentered:function(b,f){var a=this.getSchedulingView();if(a.isWeekView()){var c=a.weekview.getColumnsBy(function(a){return a.start<=b&&a.end>b})[0];if(c){var d=a.getWidth()/2;var e=a.getViewContainerHeight()/2;a.scrollHorizontallyTo(Math.max(c.getLocalX()-d,0));a.scrollVerticallyTo(Math.max(a.getCoordinateFromDate(b,!0)-e,0))}}else {return this.callParent(arguments)}}}},doSuspendLayouts:function(){this.timeAxis.on({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.suspendLayouts();this.normalGrid.suspendLayouts()},doResumeLayouts:function(){this.timeAxis.un({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.resumeLayouts();this.normalGrid.resumeLayouts()},onBeginReconfigure:function(){this.normalGrid.resumeLayouts()},onEndReconfigure:function(){this.normalGrid.suspendLayouts()},onColWidthChange:function(b,a){if(this.isVertical()){this.resourceColumnWidth=a;this.refreshResourceColumns()}else {if(this.isWeekView()){this.weekViewColumnWidth=a;this.refreshCalendarColumns()}}},enableRowHeightInjection:function(b){var a=this;var c=new Ext.XTemplate('{%','this.processCellValues(values);','this.nextTpl.applyOut(values, out, parent);','%}',{priority:1,processCellValues:Ext.Function.bind(a.embedRowHeight,a)});b.addCellTpl(c);Ext.Array.each(this.columns,function(a){a.hasCustomRenderer=!0});Ext.Array.each(this.horizontalColumns,function(a){a.hasCustomRenderer=!0})},embedRowHeight:function(b){var e=this,a=e.getSchedulingView();if(a.isHorizontal()){var c=1;if(a.rowHasDynamicRowHeight(b.record)){var d=b.record;var g=a.eventLayout.horizontal;c=g.getNumberOfBands(d,function(){return a.getEventStore().filterEventsForResource(d,a.timeAxis.isRangeInAxis,a.timeAxis)})}var f=c*e.getRowHeight()-(c-1)*a.barMargin+a.cellTopBorderWidth+a.cellBottomBorderWidth-1;b.style=(b.style||'')+';height:'+f+'px;'}},getEventSelectionModel:function(){return this.getSchedulingView().getEventSelectionModel()},refreshResourceColumns:function(){var a=this.resourceColumnWidth||this.timeAxisViewModel.resourceColumnWidth;this.reconfigure(this.verticalColumns.concat(this.createResourceColumns(a)))},onCalendarColumnResize:function(c,a,b){if(b!==this.timeAxisViewModel.weekViewColumnWidth){this.timeAxisViewModel.setViewColumnWidth(b,!0)}this.getSchedulingView().weekview.repaintEventsForColumn(a,c.columnManager.indexOf(a))},onCalendarResourceStoreChange:function(){this.getSchedulingView().refreshView()},refreshCalendarColumns:function(){var b=this.createCalendarRows();var a=this.createCalendarColumns();this.reconfigure(b,this.calendarColumns.concat(a))},setGroupingFeatureDisabled:function(b){var c=this,a=c.normalGrid.view;if(!a.groupingFeature||a.groupingFeature.disabled===b){return}a.groupingFeature[b?'disable':'enable']();a=c.lockedGrid.view;a.groupingFeature[b?'disable':'enable']()},refreshGroupingStore:function(){var a=this.normalGrid.view.groupingFeature;if(a){a.dataSource.processStore(this.timeAxis)}},bindGroupingFeatureListener:function(){this.mon(this.timeAxis,'reconfigure',this.refreshGroupingStore,this,{priority:10})},unbindGroupingFeatureListener:function(){this.mun(this.timeAxis,'reconfigure',this.refreshGroupingStore)},setMode:function(b,k){var a=this;if(!a.normalGrid){a.on('afterrender',function(){a.setMode(b,!0)});return}var c=typeof b==='string'?b:b.mode;if(!c){throw new Error('Mode is undefined')}if(c==='calendar'){c='weekview'}var d;if(b.viewPreset){d=[b.viewPreset,b.startDate||null,b.endDate||null]}if(c===a.mode&&!k){d&&a.setViewPreset.apply(a,d);return}if(a.fireEvent('beforemodechange',a,b)!==!1){a.mode=c;var j=a.normalGrid,f=a.getSchedulingView(),i=j.headerCt;a.suspendRefresh();Ext.suspendLayouts();a.destroyDockedAllDayHeader();a.unbindGroupingFeatureListener();var e=a.isWeekView();var g=f.isWeekView();if(g&&!e||!g&&e){d=d||a._oldViewPresetArgs||[e?'week':'weekAndDay'];a._oldViewPresetArgs=[a.viewPreset,a.timeAxis.getStart(),a.timeAxis.getEnd()]}f.setMode(c);i.removeAll(!0);a.reconfigureBufferedRendering();switch(c){case 'horizontal':a.configureHorizontalMode();break;case 'vertical':a.configureVerticalMode();break;case 'weekview':a.configureWeekViewMode();break;}d&&a.setViewPreset.apply(a,d);a.resumeRefresh(!1);var h=a.getSplitter();if(h){h.setVisible(c==='horizontal')}a.refreshViews(!1);Ext.resumeLayouts(!0);a.fireEvent('modechange',a,b)}},configureHorizontalMode:function(){var a=this;var c=a.getSchedulingView();a.timeAxis.setMode('plain');a.removeCls(a.verticalCls).removeCls(a.weekviewCls).addCls(a.horizontalCls);a.setGroupingFeatureDisabled(!1);a.mun(a.resourceStore,a.verticalListeners);a.mun(a.resourceStore,a.calendarResourceStoreListeners);a.normalGrid.un(a.calendarNormalGridListeners);c.setRowHeight(a.getRowHeight(),!0);a.reconfigure(a.resourceStore,a.horizontalColumns);if(a.horizontalLockedWidth!==null){a.lockedGrid.setWidth(a.horizontalLockedWidth)}var b=a.resourceStore.groupField;if(b){a.store.group(b)}a.mun(a.timeAxis,a.calendarListeners)},configureVerticalMode:function(){var a=this;var c=a.getSchedulingView();a.removeCls(a.horizontalCls).removeCls(a.weekviewCls).addCls(a.verticalCls);a.setGroupingFeatureDisabled(!0);a.normalGrid.un(a.calendarNormalGridListeners);a.mun(a.resourceStore,a.calendarResourceStoreListeners);var b=0;if(a.rendered){a.horizontalLockedWidth=a.lockedGrid.getWidth()}a.mon(a.resourceStore,a.verticalListeners);a.bindGroupingFeatureListener();a.reconfigure(a.timeAxis,a.verticalColumns.concat(a.createResourceColumns(a.resourceColumnWidth||a.timeAxisViewModel.resourceColumnWidth)));Ext.Array.each(a.lockedGrid.query('gridcolumn'),function(a){b+=a.rendered?a.getWidth():a.width||100});c.setColumnWidth(a.timeAxisViewModel.resourceColumnWidth||100,!0);a.lockedGrid.setWidth(b)},configureWeekViewMode:function(){var a=this;var c=a.normalGrid,b=a.getSchedulingView();a.removeCls(a.horizontalCls).removeCls(a.verticalCls).addCls(a.weekviewCls);a.setGroupingFeatureDisabled(!0);a.timeAxis.setMode('week');a.mun(a.resourceStore,a.verticalListeners);a.mon(a.resourceStore,a.calendarResourceStoreListeners);a.normalGrid.on(a.calendarNormalGridListeners);a.bindGroupingFeatureListener();a.refreshCalendarColumns();b.setRowHeight(a.getRowHeight(),!0);b.setColumnWidth(a.timeAxisViewModel.weekViewColumnWidth||100,!0);a.mon(a.timeAxis,a.calendarListeners)},addDockedAllDayHeader:function(){var a=this;if(a.showAllDayHeader){a.allDayLockedHeader=a.lockedGrid.addDocked({xtype:'component',dock:'top',cls:['sch-all-day-locked-header',Ext.baseCSSPrefix+'unselectable'],height:24,weight:100,html:a.L('All day')})[0];a.allDayNormalHeader=a.normalGrid.addDocked({xtype:'alldayheader',height:24,weight:100,lockedHeaderPartner:a.allDayLockedHeader,eventSelModel:a.eventSelModel&&!a.eventSelModel.isSelectionModel?a.eventSelModel:null,mainScheduler:a})[0]}},destroyDockedAllDayHeader:function(){var a=this;if(a.allDayLockedHeader){a.allDayLockedHeader.destroy();a.allDayNormalHeader.destroy();a.allDayLockedHeader=a.allDayNormalHeader=null}},reconfigureBufferedRendering:function(f){var a=this;if(a.bufferedRenderer&&a.rendered){var b=a.lockedGrid.bufferedRenderer,d=a.normalGrid.bufferedRenderer,c;if(!a.isHorizontal()){c=a.timeAxis.getCount();a.__oldLeadingBufferZone=b.leadingBufferZone}else {if(a.__oldLeadingBufferZone){c=a.__oldLeadingBufferZone;a.__oldLeadingBufferZone=null}}if(!f&&b.scroller&&b.scroller.getLockedScroller()){var g=a.lockedGrid.view.getHeight(),e=Math.ceil(g/b.rowHeight)+b.trailingBufferZone+c;b.setViewSize(e,!0);d.setViewSize(e,!0)}b.leadingBufferZone=d.leadingBufferZone=c}},createCalendarRows:function(){var b=this,a=b.timeAxis.getRowTicks();b.timeAxisViewModel.calendarRowsAmount=a.length;return new Ext.data.Store({model:'Sch.model.TimeAxisTick',data:a})},createCalendarColumns:function(){var a=this,c=a.timeAxis,b=c.headerConfig.middle,d=[],e;var f=a.startTime=c.startTime;var g=a.endTime=c.endTime;c.each(function(j){var c=j.getStartDate();if(e!==c.getDay()){e=c.getDay();c.setHours(f);var i=new Date(c);i.setHours(g);var h={xclass:a.weekViewColumnClass,renderer:a.mainRenderer,scope:a,start:c,end:i};if(b.renderer){h.text=b.renderer.call(b.scope||a,c,i,h,d.length,a.getEventStore())}else {h.text=Ext.Date.format(c,b.dateFormat)}d.push(h)}});a.timeAxisViewModel.updateCalendarColumnDates(d);return d},onNormalViewItemUpdate:function(b){if(this.lockedGridDependsOnSchedule){var a=this.lockedGrid.getView();a.suspendEvents();a.refreshNode(a.indexOf(b));if(this.syncRowHeight){this.syncRowHeights()}a.resumeEvents()}},onLockedViewResize:function(e,d,a,c,b){if(!this.isHorizontal()&&a!==b){this.timeAxisViewModel.update(a-21)}},setRowHeight:function(b,a){a=a||!this.lockedGrid;this.readRowHeightFromPreset=!1;this.timeAxisViewModel.setViewRowHeight(b,a)},handleTimelineKeyEvent:function(c){var d=this,a=d.getSchedulingView(),e=a.getEventSelectionModel(),b=e.getSelection();if(b.length){a.fireEvent(a.scheduledEventName+c.type,a,b.pop(),c)}},handleTimelineEventClick:function(a,c,b){if(Ext.isIE11){this.normalGrid.el.focus()}else {a.getNavigationModel().setPosition(a.getRecord(b.getTarget(a.itemSelector)),0);a.el.focus()}}});Ext.define('Sch.plugin.CurrentTimeLine',{extend:'Sch.plugin.Lines',alias:'plugin.scheduler_currenttimeline',mixins:['Sch.mixin.Localizable'],requires:['Ext.data.JsonStore'],updateInterval:60000,showHeaderElements:!0,autoUpdate:!0,expandToFitView:!0,timer:null,init:function(b){var a=this;if(Ext.getVersion('touch')){a.showHeaderElements=!1}a.store=new Ext.data.JsonStore({autoDestroy:!0,fields:['Date','Cls','Text'],data:[{Date:new Date(),Cls:'sch-todayLine',Text:a.L('tooltipText')}]});if(a.autoUpdate){a.timer=setInterval(function(){a.updateDate()},a.updateInterval)}a.updateDate();a.callParent(arguments)},updateDate:function(){var b=this,a=b.store.first();a.set('Date',new Date())},destroy:function(){var a=this;clearInterval(a.timer);a.timer=null;if(a.store.autoDestroy){a.store.destroy()}a.callParent(arguments)}});Ext.define('Sch.patches.LockingScroller',{extend:'Sch.util.Patch',target:'Ext.scroll.Scroller',minVersion:'6.2.0',overrides:{scrollTo:function(){if(this.getNormalScroller&&!this.getNormalScroller()){if(Sch.panel.TimelineGridPanel&&this.component instanceof Sch.panel.TimelineGridPanel||Sch.panel.TimelineTreePanel&&this.component instanceof Sch.panel.TimelineTreePanel){return}}return this.callParent(arguments)}}});Ext.define('Sch.plugin.NonWorkingTime',{extend:'Sch.plugin.Zones',alias:'plugin.scheduler_nonworkingtime',alternateClassName:'Gnt.feature.WorkingTime',requires:['Ext.data.Store','Sch.model.Range'],expandToFitView:!0,calendar:{type:'calendar'},timeAxis:null,init:function(a){this.calendar=this.calendar&&Ext.StoreMgr.lookup(this.calendar);if(!this.calendar){Ext.Error.raise("Required attribute 'calendar' missed during initialization of 'Sch.plugin.NonWorkingTime'")}this.store=new Ext.data.Store({model:'Sch.model.Range',autoDestroy:!0});this.timeAxis=a.getTimeAxis();this.callParent(arguments);if(a.isWeekView()){a.normalGrid.headerCt.on('afterlayout',this.onViewChange,this)}else {a.on('viewchange',this.onViewChange,this)}this.bindCalendar(this.calendar)},bindCalendar:function(a){var b={datachanged:this.refresh,update:this.refresh,scope:this,delay:1};if(this.calendar){this.calendar.un(b)}if(a){a.on(b)}this.calendar=a;this.refresh()},onViewReady:function(){this.callParent(arguments);if(this.schedulerView.isWeekView()){this.onTimelinePanelBeforeModeChange();this.headerListeners={}}},onViewChange:function(){var b=Sch.util.Date;var a=b.isUnitGreater(this.timeAxis.unit,b.WEEK);this.setDisabled(a);if(!a){this.refresh()}},setDisabled:function(b){var a=this.disabled;this.callParent(arguments);if(a&&!b){this.refresh()}},refresh:function(){if(this.store&&!this.store.destroyed){this.store.removeAll(!0);if(this.calendar){this.store.add(this.calendar.getHolidaysRanges(this.timeAxis.getStart(),this.timeAxis.getEnd(),!0,this.timeAxis.timeZone))}}},destroy:function(){this.bindCalendar(null);this.callParent(arguments)}});Ext.define('Sch.mixin.TimelinePanel',{extend:'Sch.mixin.AbstractTimelinePanel',requires:['Sch.column.timeAxis.Horizontal','Sch.preset.Manager','Sch.data.Calendar','Sch.plugin.CurrentTimeLine','Sch.layout.TableLayout','Sch.patches.LockingScroller','Sch.plugin.NonWorkingTime','Ext.grid.plugin.BufferedRenderer'],uses:['Ext.layout.container.Border','Sch.patches.TablePanel_6_2_1','Sch.patches.TableView','Sch.patches.BufferedRenderer','Sch.patches.BufferedRenderer_6_2_1','Sch.patches.BufferedRendererResize','Sch.patches.CellContext','Sch.patches.TimelineGridView','Sch.patches.TimelineGridViewScroll6_2','Sch.patches.TimelinePanel','Sch.patches.TouchAction','Sch.plugin.NonWorkingTime'],mixins:['Sch.mixin.Zoomable','Sch.mixin.PartnerTimelinePanel'],destroyStores:!1,bufferCoef:5,bufferThreshold:0.2,infiniteScroll:!1,showCrudManagerMask:!0,highlightWeekends:!1,zoomOnTimeAxisDoubleClick:!0,switchToDayViewOnWeekDayHeaderDblClick:!0,waitingForAutoTimeSpan:!1,showTodayLine:!1,calendar:null,horizontalTimeAxisColumnCfg:null,columnLinesFeature:null,renderWaitListener:null,enablePinchZoom:!0,schedulePinchThreshold:30,pinchStartDistanceX:null,pinchStartDistanceY:null,pinchDistanceX:null,pinchDistanceY:null,horizontalColumns:null,forceDefineTimeSpanByStore:!1,workingTimePlugin:null,split:!0,refreshSuspensionCount:0,tipCfg:{cls:'sch-tip',showDelay:400,hideDelay:0,constrain:!0,autoHide:!0,anchor:'t'},inheritables:function(){return {columnLines:!0,enableLocking:!0,lockable:!0,stateEvents:['viewchange'],syncRowHeight:!1,layout:'border',initComponent:function(){if(this.partnerTimelinePanel){if(typeof this.partnerTimelinePanel==='string'){this.partnerTimelinePanel=Ext.getCmp(this.partnerTimelinePanel)}this.timeAxisViewModel=this.partnerTimelinePanel.timeAxisViewModel;this.timeAxis=this.partnerTimelinePanel.getTimeAxis();this.startDate=this.timeAxis.getStart();this.endDate=this.timeAxis.getEnd()}this._initializeTimelinePanel();this.configureChildGrids();this.forceFit=!1;this.configureColumns(this.columns);if(Ext.getVersion().equals('6.0.2.437')){this.viewConfig=Ext.apply(this.viewConfig||{},{componentLayout:'timeline_tablelayout'})}var g=this.normalViewConfig=this.normalViewConfig||{};var f=this.getId();Ext.apply(this.normalViewConfig,{id:f+'-timelineview',eventPrefix:this.normalViewConfig.eventPrefix||(this.autoGenId?null:f),timeAxisViewModel:this.timeAxisViewModel,eventBorderWidth:this.eventBorderWidth,timeAxis:this.timeAxis,readOnly:this.readOnly,mode:this.mode,rtl:this.rtl,cellBorderWidth:this.cellBorderWidth,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth,infiniteScroll:this.infiniteScroll,bufferCoef:this.bufferCoef,bufferThreshold:this.bufferThreshold});Ext.copy(g,this,['eventRendererScope','eventRenderer','dndValidatorFn','resizeValidatorFn','createValidatorFn','tooltipTpl','validatorFnScope','eventResizeHandles','enableEventDragDrop','enableDragCreation','createEventOnDblClick','resizeConfig','createConfig','tipCfg','getDateConstraints'],!0);this.callParent(arguments);this.lockedGrid.view.addCls('sch-lockedview');if(this.rtl){this.lockedGrid.view.addCls('sch-locked-column-fixer');this.addCls('sch-rtl')}else {this.addCls('sch-ltr')}var d=this.plugins=[].concat(this.plugins||[]);if(this.highlightWeekends){var a=this.getCalendar();a=a&&Ext.StoreMgr.lookup(a)||new Sch.data.Calendar();this.workingTimePlugin=new Sch.plugin.NonWorkingTime({calendar:a});this.timeAxisViewModel.setCalendar(a);d.push(this.workingTimePlugin);this.addCls('sch-timelinepanel-highlightweekends')}if(this.showTodayLine){this.todayLinePlugin=new Sch.plugin.CurrentTimeLine();d.push(this.todayLinePlugin)}this.patchNavigationModel(this);if(Ext.supports.Touch){this.timeAxisViewModel.on('update',this.refreshHeaderContainerScrollable,this)}this.setViewPreset(this.viewPreset,this.startDate||this.timeAxis.getStart(),this.endDate||this.timeAxis.getEnd(),!0);if(!this.startDate){var e=this.crudManager;if(e&&!e.loaded){this.bindAutoTimeSpanListeners()}else {var b=this.getTimeSpanDefiningStore();if(b.isTreeStore?b.getRoot()&&b.getRoot().childNodes.length:b.getCount()){this.applyStartEndDatesFromStore()}else {if(b.isLoading()||this.forceDefineTimeSpanByStore){this.bindAutoTimeSpanListeners()}}}}var c=this.columnLines;if(c){this.columnLinesFeature=new Sch.feature.ColumnLines(Ext.isObject(c)?c:undefined);this.columnLinesFeature.init(this);this.columnLines=!0}this.relayEvents(this.getSchedulingView(),['beforetooltipshow','scheduleclick','scheduledblclick','schedulecontextmenu','schedulelongpress','schedulepinch','schedulepinchstart','schedulepinchend']);this.on('zoomchange',function(){this.normalGrid.scrollTask.cancel()});if(this.crudManager){if(!this.crudManager.autoSync&&this.showCrudManagerMask){this.mon(this.crudManager,{beforesend:this.beforeCrudOperationStart,responseapplycancelled:this.onCrudOperationComplete,synccanceled:this.onCrudOperationComplete,loadcanceled:this.onCrudOperationComplete,load:this.onCrudOperationComplete,sync:this.onCrudOperationComplete,requestfail:this.onCrudOperationComplete,scope:this});if(this.crudManager.isLoading()){this.beforeCrudOperationStart(this.crudManager,null,'load')}}this.mon(this.crudManager,{beforeloadapply:this.onCrudBeforeLoad,load:this.onCrudLoad,scope:this})}if(Ext.isMac){this.patchHeaderScrollSync(this)}this.afterInitComponent()},refreshHeaderContainerScrollable:function(){var a=this.getSchedulingView().headerCt.getScrollable();if(!a){return}if(Ext.getVersion().isLessThan('6.0.1')){var b=a.isConfiguring;a.isConfiguring=!0;a.refresh();a.refreshAxes();a.isConfiguring=b}else {a.refresh()}},getState:function(){var a=this,b=a.callParent(arguments);Ext.apply(b,{viewPreset:a.viewPreset,startDate:a.getStart(),endDate:a.getEnd(),zoomMinLevel:a.zoomMinLevel,zoomMaxLevel:a.zoomMaxLevel,currentZoomLevel:a.currentZoomLevel});return b},applyState:function(a){var b=this;b.callParent(arguments);if(a&&a.viewPreset){b.setViewPreset(a.viewPreset,a.startDate,a.endDate)}if(a&&a.currentZoomLevel){b.zoomToLevel(a.currentZoomLevel)}},setTimeSpan:function(){this.callParent(arguments);if(this.waitingForAutoTimeSpan){this.unbindAutoTimeSpanListeners(!1);this.getView().refresh()}if(!this.normalGrid.getView().viewReady){this.getView().refresh()}},onBoxReady:function(){var a=this;a.callParent(arguments);if(a.partnerTimelinePanel){if(a.partnerTimelinePanel.rendered){a.setupPartnerTimelinePanel(a.partnerTimelinePanel)}else {a.partnerTimelinePanel.on('boxready',a.setupPartnerTimelinePanel,a)}}a.normalGrid.on({collapse:a.onNormalGridCollapse,expand:a.onNormalGridExpand,scope:a});a.normalGrid.headerCt.el.on({click:a.onHeaderClick,dblclick:a.onHeaderClick,contextmenu:a.onHeaderClick,delegate:'.sch-daycolumn-header',scope:a});a.lockedGrid.on({collapse:a.onLockedGridCollapse,expand:a.onLockedGridExpand,scope:a});a.lockedGrid.on({itemdblclick:a.onLockedGridItemDblClick,scope:a});if(a.enablePinchZoom&&Ext.supports.Touch){this.getSchedulingView().on({schedulepinchstart:this.onSchedulePinchStart,schedulepinch:this.onSchedulePinch,schedulepinchend:this.onSchedulePinchEnd,scope:this})}}}},scrollToDate:function(b,d){var a=this.getSchedulingView();if(a.isWeekView()){var c=a.weekview.getColumnsBy(function(a){return a.start<=b&&a.end>b})[0];if(c){a.scrollHorizontallyTo(c.getLocalX());a.scrollVerticallyTo(a.getCoordinateFromDate(b,!0))}}else {return this.callParent(arguments)}},bindAutoTimeSpanListeners:function(){var a=this.getTimeSpanDefiningStore();this.waitingForAutoTimeSpan=!0;this.suspendRefresh();this.mon(a,'load',this.applyStartEndDatesFromStore,this);if(a.isTreeStore){this.mon(a,'rootchange',this.applyStartEndDatesFromStore,this);this.mon(a,'nodeappend',this.applyStartEndDatesAfterTreeAppend,this)}else {this.mon(a,'add',this.applyStartEndDatesFromStore,this)}},getTimeSpanDefiningStore:function(){throw 'Abstract method called'},unbindAutoTimeSpanListeners:function(b){this.waitingForAutoTimeSpan=!1;var a=this.getTimeSpanDefiningStore();this.resumeRefresh(b);a.un('load',this.applyStartEndDatesFromStore,this);if(a.isTreeStore){a.un('rootchange',this.applyStartEndDatesFromStore,this);a.un('nodeappend',this.applyStartEndDatesAfterTreeAppend,this)}else {a.un('add',this.applyStartEndDatesFromStore,this)}},applyStartEndDatesAfterTreeAppend:function(){var a=this.getTimeSpanDefiningStore();if(!a.isSettingRoot&&!a.__loading){this.applyStartEndDatesFromStore()}},applyStartEndDatesFromStore:function(){var b=this.getTimeSpanDefiningStore();var a=b.getTotalTimeSpan();if(a.end&&a.start&&a.end-a.start===0){a.start=Sch.util.Date.add(a.start,this.timeAxis.mainUnit,-1);a.end=Sch.util.Date.add(a.end,this.timeAxis.mainUnit,1)}this.setTimeSpan(a.start||new Date(),a.end)},onLockedGridItemDblClick:function(d,a,e,b,c){if(this.isVertical()&&a){this.fireEvent('timeheaderdblclick',this,a.get('start'),a.get('end'),b,c)}},onHeaderClick:function(a,g){var c=a.getTarget('.'+Ext.baseCSSPrefix+'column-header');var e=[].indexOf.call(c.parentElement.childNodes,c);var b=this.normalGrid.getColumns()[e];if(Sch.column.Day&&b instanceof Sch.column.Day){var d=b.start;var f=b.end;this.fireEvent('timeheader'+a.type,this,d,f,a);if(a.type==='dblclick'&&this.switchToDayViewOnWeekDayHeaderDblClick){this.setViewPreset('day',d)}}},getSchedulingView:function(){return this.normalGrid&&this.normalGrid.view},getHorizontalTimeAxisColumn:function(){var a=this.getSchedulingView();return a&&a.getHorizontalTimeAxisColumn()},configureColumns:function(a){var b=[];var c=[];a=a||[];if(a.items){this.columns=Ext.apply({},this.columns);a=this.columns.items=a.items.slice()}else {a=this.columns=a.slice()}Ext.Array.each(a,function(a){if(a.position==='right'||a.locked===!1){if(!Ext.isNumber(a.width)){Ext.Error.raise('"Right" columns must have a fixed width')}a.locked=!1;c.push(a)}else {a.locked=!0;b.push(a)}a.lockable=!1});if(a.length===0){this.split=!1}Ext.Array.erase(a,0,a.length);Ext.Array.insert(a,0,b.concat(Ext.apply({xtype:'timeaxiscolumn',timeAxisViewModel:this.timeAxisViewModel,trackHeaderOver:this.trackHeaderOver,renderer:this.mainRenderer,variableRowHeight:this.variableRowHeight,scope:this},this.horizontalTimeAxisColumnCfg||{})).concat(c));this.horizontalColumns=a.slice()},mainRenderer:function(k,a,h,j,f){var d=this.renderers,i=this.isVertical()?this.getResourceStore().getAt(f):h,g='&nbsp;';a.rowHeight=null;for(var c=0;c<d.length;c++){g+=d[c].fn.call(d[c].scope||this,k,a,i,j,f)||''}if(this.variableRowHeight){var b=this.getSchedulingView();var e=a.rowHeight||this.getRowHeight();if(b.isHorizontal()){e+=b.cellTopBorderWidth+b.cellBottomBorderWidth-(b.allDay?0:1)}else {e-=1}a.style='height:'+e+'px'}return g},onNormalGridCollapse:function(){var a=this;if(!a.normalGrid.reExpander){a.normalGrid.reExpander=a.normalGrid.placeholder}if(!a.lockedGrid.rendered){a.lockedGrid.on('render',a.onNormalGridCollapse,a,{delay:1})}else {a.lockedGrid.savedWidth=a.lockedGrid.getWidth();if(a.lockedGrid.collapsed){a.lockedGrid.expand()}a.lockedGrid.setWidth(a.getWidth()-a.normalGrid.getPlaceholder().getWidth());a.addCls('sch-normalgrid-collapsed')}},onNormalGridExpand:function(){this.removeCls('sch-normalgrid-collapsed')},onLockedGridCollapse:function(){var a=this;if(a.normalGrid.collapsed){a.normalGrid.expand()}},onLockedGridExpand:function(){if(this.lockedGrid.savedWidth){this.lockedGrid.setWidth(this.lockedGrid.savedWidth)}},beforeCrudOperationStart:function(b,c,a){if(this.rendered){this.setLoading({msg:a==='load'?this.L('loadingText'):this.L('savingText')})}else {Ext.destroy(this.renderWaitListener);this.renderWaitListener=this.on('render',Ext.Function.bind(this.beforeCrudOperationStart,this,Array.prototype.slice.apply(arguments)),this,{delay:1,destroyable:!0})}},onCrudBeforeLoad:function(){this.suspendRefresh()},onCrudLoad:function(){this.resumeRefresh(!0)},onCrudOperationComplete:function(){Ext.destroy(this.renderWaitListener);this.setLoading(!1)},onSchedulePinchStart:function(b,a){this.pinchStartDistanceX=Math.abs(a.touches[0].pageX-a.touches[1].pageX);this.pinchStartDistanceY=Math.abs(a.touches[0].pageY-a.touches[1].pageY)},onSchedulePinch:function(b,a){this.pinchDistanceX=Math.abs(a.touches[0].pageX-a.touches[1].pageX);this.pinchDistanceY=Math.abs(a.touches[0].pageY-a.touches[1].pageY)},onSchedulePinchEnd:function(d){var a=this.pinchDistanceX;var b=this.pinchDistanceY;var e=this.isHorizontal();if(Math.abs(a-this.pinchStartDistanceX)>this.schedulePinchThreshold){var c=Math.abs(a/this.pinchStartDistanceX);if(e){c>1?this.zoomIn():this.zoomOut()}else {this.timeAxisViewModel.setViewColumnWidth(c*this.timeAxisViewModel.resourceColumnWidth)}}if(Math.abs(b-this.pinchStartDistanceY)>this.schedulePinchThreshold){var f=Math.abs(b/this.pinchStartDistanceY);d.setRowHeight(d.getRowHeight()*f)}this.pinchStartDistanceX=this.pinchStartDistanceY=this.pinchDistanceX=this.pinchDistanceY=null},patchNavigationModel:function(c){c.getView().getNavigationModel().focusItem=function(a){var b=this.view.getScrollable();var d=b.getLockingScroller&&b.getLockingScroller();if(d&&d.isScrolling){return null}else {a.addCls(this.focusCls);if((Ext.isIE||Ext.isEdge)&&!a.hasCls('sch-timetd')||!(Ext.isIE||Ext.isEdge)&&c.isHorizontal()){a.focus()}}};var a=c.lockedGrid.getView();var b=c.normalGrid.getView();a.on('rowclick',function(d,c,e,a){if(b.lastFocused){b.lastFocused.rowIdx=a;b.lastFocused.record=c}else {if(Ext.isIE){b.lastFocused=this.lastFocused}}});b.on('rowclick',function(d,c,e,b){if(a.lastFocused){a.lastFocused.rowIdx=b;a.lastFocused.record=c}else {if(Ext.isIE){a.lastFocused=this.lastFocused}}})},patchHeaderScrollSync:function(a){function sync(){var c=a.normalGrid||a,b=c.getHeaderContainer();if(a.rendered&&b&&b.getScrollable()){b.getScrollable().syncWithPartners()}}function patch(){a.patchHeaderScrollSyncDetacher&&Ext.destroy(a.patchHeaderScrollSyncDetacher);a.patchHeaderScrollSyncDetacher=a.store&&a.mon(a.store,{'nodeexpand':sync,'nodecollapse':sync,buffer:1,destroyable:!0})}patch();a.on('storechange',patch)},configureChildGrids:function(){var a=this;a.lockedGridConfig=Ext.apply({},a.lockedGridConfig||{});a.normalGridConfig=Ext.apply({},a.schedulerConfig||a.normalGridConfig||{});var b=a.lockedGridConfig,c=a.normalGridConfig;if(a.lockedXType){b.xtype=a.lockedXType}if(a.normalXType){c.xtype=a.normalXType}Ext.applyIf(b,{useArrows:!0,animCollapse:!1,collapseDirection:'left',trackMouseOver:!1});Ext.applyIf(c,{viewType:a.viewType,enableColumnMove:!1,enableColumnResize:!1,enableColumnHide:!1,trackMouseOver:!1,collapseDirection:'right',collapseMode:'placeholder',animCollapse:!1});if(a.isVertical()){b.store=c.store=a.timeAxis}if(b.width){a.syncLockedWidth=Ext.emptyFn;b.scroll=Ext.supports.Touch?'both':'horizontal';b.scrollerOwner=!0}},afterInitComponent:function(){var a=this;var b=a.lockedGrid.getView();var d=a.normalGrid.getView();var e=a.store&&a.store.isTreeStore;if(a.normalGrid.collapsed){a.normalGrid.collapsed=!1;d.on('boxready',function(){a.normalGrid.collapse()},a,{delay:10})}if(a.lockedGrid.collapsed){a.lockedGrid.collapsed=!1;b.on('boxready',function(){a.lockedGrid.collapse()},a,{delay:10});if(b.bufferedRenderer){b.bufferedRenderer.disabled=!0}}if(e){this.setupLockableFilterableTree()}var c=this.getSplitter();if(c){c.addCls('sch-timelinepanel-splitter');c.setVisible(this.isHorizontal())}if(Ext.versions.extjs.isGreaterThan('6.2.0')){this.normalGrid.on('cellclick',this.onNormalGridCellClick,this)}if(this.zoomOnTimeAxisDoubleClick){this.on('timeheaderdblclick',function(c,a,b){if(this.isHorizontal()){this.zoomToSpan({start:a,end:b})}})}},onNormalGridCellClick:function(h,e,f,b,i,g,c){if(e.className.match('sch-timetd')){var a=this.getSelectionModel();var d=c.ctrlKey&&a.isSelected(b);if(d){a.deselect(b)}else {a.select(b,c.ctrlKey)}}},getSplitter:function(){return this.child('splitter')},setupLockableFilterableTree:function(){var c=this;var a=c.lockedGrid.getView();var b=Sch.mixin.FilterableTreeView.prototype;a.initTreeFiltering=b.initTreeFiltering;a.onFilterChangeStart=b.onFilterChangeStart;a.onFilterChangeEnd=b.onFilterChangeEnd;a.onFilterCleared=b.onFilterCleared;a.onFilterSet=b.onFilterSet;a.initTreeFiltering()},showMenuBy:function(f,e){var b=this.getMenu(),a=b.down('#unlockItem'),c=b.down('#lockItem'),d=a.prev();d.hide();a.hide();c.hide()},zoomToFit:function(a){a=Ext.apply({adjustStart:1,adjustEnd:1},a);var c=this.getEventStore();var b=this.getEventStore().getTotalTimeSpan();if(this.zoomToSpan(b,a)===null){this.getSchedulingView().fitColumns()}},refreshViews:function(f){if(!this.rendered){return}var c=!1;var d=function(){c=!0};var b=this.normalGrid.getView();var a=this.lockedGrid.getView(),e={left:a.getScrollX(),top:b.getVerticalScroll()};b.on('refresh',d);a.refreshView();b.un('refresh',d);if(f!==!1){!c&&this.getSchedulingView().refreshKeepingScroll();a.setScrollX(e.left);a.setScrollY(e.top)}else {if(!c){this.getSchedulingView().refreshView()}}},getCalendar:function(){return this.calendar},disableWeekendHighlighting:function(a){this.workingTimePlugin.setDisabled(a);if(a){this.removeCls('sch-timelinepanel-highlightweekends')}else {this.addCls('sch-timelinepanel-highlightweekends')}},preventRefresh:function(){return !1},suspendRefresh:function(){var a=this;if(a.refreshSuspensionCount++===0){a.getView().on('beforerefresh',a.preventRefresh,a);a.normalGrid.view.blockRefresh=!0;a.lockedGrid.view.blockRefresh=!0}},resumeRefresh:function(b){var a=this;if(a.refreshSuspensionCount&&!--a.refreshSuspensionCount){a.getView().un('beforerefresh',a.preventRefresh,a);a.normalGrid.view.blockRefresh=!1;a.lockedGrid.view.blockRefresh=!1;if(b){a.refreshViews()}}}},function(){var a='6.0.0';Ext.apply(Sch,{VERSION:'6.1.17'});if(Ext.versions.extjs.isLessThan(a)){var b=console;b&&b.log('The Ext JS version you are using needs to be updated to at least '+a)}if(Ext.getVersion().isGreaterThan('6.0.2')){Ext.define(null,{override:'Ext.grid.plugin.BufferedRenderer',doRefreshView:function(){if(this.view.ownerGrid.is('timelinegrid,timelinetree')){var a=Ext.Error.ignore;Ext.Error.ignore=!0;this.callParent(arguments);Ext.Error.ignore=a}else {this.callParent(arguments)}}})}});Ext.define('Sch.panel.TimelineGridPanel',{extend:'Ext.grid.Panel',mixins:['Sch.mixin.Localizable','Sch.mixin.TimelinePanel'],alias:['widget.timelinegrid'],subGridXType:'gridpanel',isTimelineGridPanel:!0,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define('Sch.template.DependencyInfo',{extend:'Ext.XTemplate',mixins:['Sch.mixin.Localizable'],text:'<dl class="sch-dep-tip">'+'<tpl if="!values.dependency">'+'<div class="'+Ext.baseCSSPrefix+"fa {[values.valid ? 'fa-check-circle sch-dep-tip-valid' : 'fa-times-circle sch-dep-tip-invalid']}\"></div>"+'</tpl>'+'<dt class="sch-dep-tip-from-title">__FROM__:</dt>'+'<dd class="sch-dep-tip-from-value">{[Ext.htmlEncode(values.fromTask.getName()) || "&nbsp;"]}</dd>'+'<dt class="sch-dep-tip-to-title">__TO__:</dt>'+'<dd class="sch-dep-tip-to-value">{[values.toTask && Ext.htmlEncode(values.toTask.getName()) || "&nbsp;"]}</dd>'+'</dl>',constructor:function(){var a=this;a.text=a.text.replace(/__FROM__/,a.L('fromText')).replace(/__TO__/,a.L('toText'));a.callParent([a.text])}});Ext.define('Sch.view.dependency.Tooltip',{extend:'Ext.tip.ToolTip',requires:['Sch.template.DependencyInfo'],cls:'sch-dependency-tip',delegate:'.sch-dependency',showDelay:0,anchor:'bottom',mouseOffset:[15,5],trackMouse:!0,dependencyView:null,tpl:null,initComponent:function(){this.target=this.dependencyView.getPrimaryView().getEl();this.tpl=this.tpl||new Sch.template.DependencyInfo();this.callParent(arguments)},show:function(){this.callParent(arguments);var a=this.dependencyView.getDependencyForElement(this.triggerElement);this.setData({dependency:a,fromTask:a.getSourceEvent(),toTask:a.getTargetEvent()})}});Ext.define('Sch.view.dependency.DropZone',{extend:'Ext.dd.DropZone',mixins:{observable:'Ext.util.Observable'},terminalSelector:null,dependencyStore:null,toText:null,startText:null,endText:null,view:null,tipTpl:null,tip:null,constructor:function(b,a){this.mixins.observable.constructor.call(this,a);this.callParent(arguments)},getTargetFromEvent:function(a){return a.getTarget(this.terminalSelector)},onNodeEnter:function(b,h,i,c){var a=this,d=a.view.resolveEventRecord(b),f=b.className.match(/sch-terminal-(\w+)/)[1],g=d.getId()||d.internalId,e=Ext.apply({toTask:d,toSide:f},c.tplData);if(!a.tip){a.tip=a.createTooltip()}c.valid=e.valid=a.isValidLink(c.fromId,g,h.dragData.fromSide,f);a.tip.setData(e);a.tip.showBy(b);Ext.fly(b).addCls('sch-terminal-'+(c.valid?'valid':'invalid')+'-drop')},createTooltip:function(){var a=this;return new Ext.tip.ToolTip({tpl:a.tipTpl,view:a.view,cls:'sch-dependency-tip sch-create-dependency-tip',constrain:!0,anchor:'t',trackMouse:!1,hideDelay:0,dismissDelay:0,delegate:a.terminalSelector,target:a.view.getEl(),constraintInsets:'7 -7 -7 7'})},onNodeOut:function(a,c,d,b){b.valid=!1;Ext.fly(a).removeCls(['sch-terminal-valid-drop','sch-terminal-invalid-drop'])},onNodeOver:function(b,c,d,a){return a.valid?this.dropAllowed:this.dropNotAllowed},onNodeDrop:function(c,i,j,e){var a=this,b=a.view.resolveEventRecord(c),h=c.className.match(/sch-terminal-(\w+)/)[1],g=b.getId()||b.internalId,d=e.valid,f=a.createDependencyModel(i.dragData.fromId,g,e.fromSide,h);a.fireEvent('drop',a,f,d);a.fireEvent('afterdrop',a);return d},createDependencyModel:function(e,f,b,c){var d=this.dependencyStore,a=new (d.getModel())();a.setSourceId(e);a.setTargetId(f);a instanceof Sch.model.Dependency&&a.setFromSide(b);a instanceof Sch.model.Dependency&&a.setToSide(c);a.setType(a.getTypeFromSides(b,c,this.view.rtl));return a},isValidLink:function(c,e,b,d){var a=this.createDependencyModel(c,e,b,d);return this.dependencyStore.isValidDependency(a)},destroyTip:function(){var a=this;a.tip&&a.tip.destroy();a.tip=null},destroy:function(){var a=this;a.destroyTip();a.callParent(arguments)}});Ext.define('Sch.view.dependency.DragZone',{extend:'Ext.dd.DragZone',alias:'schdependencydragzone.default',requires:['Sch.template.DependencyInfo','Sch.view.dependency.DropZone','Sch.util.ScrollManager'],mixins:{factoryable:'Ext.mixin.Factoryable',observable:'Ext.util.Observable'},terminalSelector:null,view:null,fromText:null,toText:null,startText:null,endText:null,rtl:!1,useLineProxy:!0,dependencyStore:null,tipTpl:null,animationDuration:400,checkDraggingFlag:!0,constructor:function(b){var a=this;a.mixins.observable.constructor.call(this,b);a.callParent([b.view.getEl(),b]);a.tipTpl=a.tipTpl||new Sch.template.DependencyInfo();if(!(a.tipTpl instanceof Ext.Template)){a.tipTpl=new Ext.XTemplate(a.tipTpl)}a.dropZone=a.createDropZone();a.relayEvents(a.dropZone,['drop','afterdrop']);a.on({dragstart:a.onDependencyDragStart,afterdrop:a.onDependencyAfterDrop,scope:a})},onDependencyDragStart:function(){Sch.util.ScrollManager.activate(this.view)},onDependencyAfterDrop:function(){Sch.util.ScrollManager.deactivate();this.dropZone.destroyTip()},createDropZone:function(){return new Sch.view.dependency.DropZone(this.el,this.getDropZoneConfig())},getDropZoneConfig:function(){return {rtl:this.rtl,terminalSelector:this.terminalSelector,ddGroup:this.ddGroup,view:this.view,dependencyStore:this.dependencyStore,tipTpl:this.tipTpl}},initLineProxy:function(f){var a=this,d=a.view.getScroll(),g=Ext.fly(f).getOffsetsTo(a.view.el),e=Ext.fly(f).getWidth()/2,b=g[0]+e,c=g[1]+e,h=a.rtl?'right':'left';b=b+d.left;c=c;a.lineProxyEl=a.el.createChild({cls:'sch-dependency-connector-proxy',style:'top:'+c+'px;'+h+':'+b+'px'});Ext.apply(a,{startXY:[b,c],startScrollLeft:d.left,startScrollTop:d.top})},updateLineProxy:function(d){var a=this,b=document.scrollingElement||document.documentElement||document.body,e=a.view.getScroll(),h=a.view.el.dom.getBoundingClientRect(),c=d[0]-a.view.getX(),f=(a.rtl?a.startXY[0]-c-e.left:c-a.startXY[0]+e.left)-b.scrollLeft,g=d[1]-h.top-a.startXY[1]-b.scrollTop,i=Math.max(1,Math.sqrt(Math.pow(f,2)+Math.pow(g,2))-2),j=Math.atan2(g,f)-Math.PI/2;a.lineProxyEl.setStyle({'height':i+'px','transform':'rotate('+j+'rad)'})},getDragData:function(e){var c=this,a=e.getTarget(c.terminalSelector);if(e.button===0&&a){var b=c.view.resolveEventRecord(a);if(c.fireEvent('beforedrag',c,b)===!1){return null}var d=a.className.match(/sch-terminal-(\w+)/)[1],f={fromTask:b,fromSide:d},g=document.createElement('div');a.style.display='block';return {fromId:b.getId()||b.internalId,fromSide:d,tplData:f,repairXY:Ext.fly(a).getXY(),ddel:g,valid:!1,sourceTerminal:a}}return !1},onStartDrag:function(e,f){var a=this,b=a.dragData,c=b.sourceTerminal,d=c.className.match(/sch-terminal-(\w+)/)[0];a.fireEvent('dragstart',a);if(a.useLineProxy){a.initLineProxy(c,b.isStart);a.lineProxyEl.show()}a.proxy.setStyle('display','none');Ext.fly(b.sourceTerminal.parentNode).select('.sch-terminal:not(.'+d+')').addCls('sch-terminal-hidden')},onDrag:function(a,b){this.useLineProxy&&this.updateLineProxy(a.getXY())},afterRepair:function(){var a=this;a.dragging=!1;if(!a.destroyed){a.fireEvent('afterdrop',a.dropZone)}},onMouseUp:function(){var a=this;a.el.removeCls('sch-terminals-visible');a.dragData.sourceTerminal.style.display='';if(a.lineProxyEl){var b=a.lineProxyEl;b.animate({to:{height:0},duration:a.animationDuration,callback:function(){Ext.destroy(b)}});a.lineProxyEl=null}},getRepairXY:function(){return this.dragData.repairXY},destroy:function(){var a=this;Ext.destroy([a.lineProxyEl,a.dropZone]);a.callParent(arguments)}});Ext.define('Sch.util.RectangularPathFinder',{alias:'schpathfinder.rectangular',mixins:['Ext.mixin.Factoryable'],uses:['Ext.Array'],config:{startSide:'right',startArrowSize:8,startArrowMargin:6,startShift:0,endSide:'left',endArrowSize:8,endArrowMargin:6,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null},constructor:function(a){var b=this;b.callParent([a]);b.initConfig(a)},findPath:function(h,f){var b=this,a,u,v,s,t,d,e,n,o,A,C,i,j,w,y,x,z,g,B,E,m,p,D,F,q,r,l,c,k;if(f&&!Ext.isArray(f)){f=[f]}for(k=0;h&&!c;){a=Ext.applyIf(h,b.getConfig());u=a.startBox,v=a.endBox,s=a.startShift,t=a.endShift,d=a.startSide,e=a.endSide,n=a.startArrowSize,o=a.endArrowSize,A=a.startArrowMargin,C=a.endArrowMargin,i=a.horizontalMargin,j=a.verticalMargin,w=a.hasOwnProperty('startHorizontalMargin')?a.startHorizontalMargin:i,y=a.hasOwnProperty('startVerticalMargin')?a.startVerticalMargin:j,x=a.hasOwnProperty('endHorizontalMargin')?a.endHorizontalMargin:i,z=a.hasOwnProperty('endVerticalMargin')?a.endVerticalMargin:j,g=a.otherBoxes;d=b.normalizeSide(d);e=b.normalizeSide(e);B=b.getConnectionCoordinatesFromBoxSideShift(u,d,s);E=b.getConnectionCoordinatesFromBoxSideShift(v,e,t);q=b.calcGridBaseBoxFromBoxAndDrawParams(u,d,n,A,w,y);r=b.calcGridBaseBoxFromBoxAndDrawParams(v,e,o,C,x,z);g=g&&Ext.Array.map(g,function(a){return b.calcGridBaseBoxFromBoxAndDrawParams(a,!1,0,0,i,j)});m=b.getConnectionCoordinatesFromBoxSideShift(q,d,s);p=b.getConnectionCoordinatesFromBoxSideShift(r,e,t);l=b.buildPathGrid(q,r,m,p,d,e,g);D=b.convertDecartPointToGridPoint(l,m);F=b.convertDecartPointToGridPoint(l,p);c=b.findPathOnGrid(l,D,F,d,e);for(h=!1;!c&&!h&&f&&k<f.length;k++){h=f[k](a)}}if(c){c=b.prependPathWithArrowStaffSegment(c,B,n,d);c=b.appendPathWithArrowStaffSegment(c,E,o,e);c=b.optimizePath(c)}return c},getConnectionCoordinatesFromBoxSideShift:function(a,d,c){var b;switch(d){case 'left':b={x:a.start,y:(a.top+a.bottom)/2+c};break;case 'right':b={x:a.end,y:(a.top+a.bottom)/2+c};break;case 'top':b={x:(a.start+a.end)/2+c,y:a.top};break;case 'bottom':b={x:(a.start+a.end)/2+c,y:a.bottom};break;}return b},calcGridBaseBoxFromBoxAndDrawParams:function(a,g,f,e,b,c){var d;switch(g){case 'left':d={start:a.start-Math.max(f+e,b),end:a.end+b,top:a.top-c,bottom:a.bottom+c};break;case 'right':d={start:a.start-b,end:a.end+Math.max(f+e,b),top:a.top-c,bottom:a.bottom+c};break;case 'top':d={start:a.start-b,end:a.end+b,top:a.top-Math.max(f+e,c),bottom:a.bottom+c};break;case 'bottom':d={start:a.start-b,end:a.end+b,top:a.top-c,bottom:a.bottom+Math.max(f+e,c)};break;default:d={start:a.start-b,end:a.end+b,top:a.top-c,bottom:a.bottom+c};}return d},buildPathGrid:function(a,b,q,s,l,m,i){var d,e,g,f,h,c,t,u,o,v,j,k,p,n={},r=[];d=[a.start,l=='left'||l=='right'?(a.start+a.end)/2:q.x,a.end,b.start,m=='left'||m=='right'?(b.start+b.end)/2:s.x,b.end];e=[a.top,l=='top'||l=='bottom'?(a.top+a.bottom)/2:q.y,a.bottom,b.top,m=='top'||m=='bottom'?(b.top+b.bottom)/2:s.y,b.bottom];if(i){Ext.Array.forEach(i,function(a){d.push(a.start,(a.start+a.end)/2,a.end);e.push(a.top,(a.top+a.bottom)/2,a.bottom)})}d=Ext.Array.unique(Ext.Array.sort(d,Ext.Array.numericSortFn));e=Ext.Array.unique(Ext.Array.sort(e,Ext.Array.numericSortFn));for(c=0,u=e.length;c<u;++c){n[c]=n[c]||{};g=e[c];for(h=0,t=d.length;h<t;++h){f=d[h];k=(f<=a.start||f>=a.end||g<=a.top||g>=a.bottom)&&(f<=b.start||f>=b.end||g<=b.top||g>=b.bottom);if(i){for(o=0,v=i.length;k&&o<v;++o){j=i[o];k=f<=j.start||f>=j.end||g<=j.top||g>=j.bottom}}p={distance:Math.pow(2,53)-1,permitted:k,x:f,y:g,ix:h,iy:c};n[c][h]=p;r.push(p)}}return {width:d.length,height:e.length,xs:d,ys:e,points:n,linearPoints:r}},convertDecartPointToGridPoint:function(a,b){var c=Ext.Array.indexOf(a.xs,b.x),d=Ext.Array.indexOf(a.ys,b.y);return a.points[d][c]},findPathOnGrid:function(a,b,c,g,f){var e=this,d=!1;if(b.permitted&&c.permitted){a=e.waveForward(a,b,0);d=e.collectPath(a,c,f)}return d},getGridPointNeighbors:function(c,g,b){var d=g.ix,e=g.iy,f=[],a;if(e<c.height-1){a=c.points[e+1][d];(!b||b(a))&&f.push(a)}if(e>0){a=c.points[e-1][d];(!b||b(a))&&f.push(a)}if(d<c.width-1){a=c.points[e][d+1];(!b||b(a))&&f.push(a)}if(d>0){a=c.points[e][d-1];(!b||b(a))&&f.push(a)}return f},waveForward:function(f,g,c){var h=this,b,a,e,d,i,j,k,l;g.distance=c;b=h.getGridPointNeighbors(f,g,function(a){return a.permitted&&a.distance>c+1});for(a=0,e=b.length;a<e;++a){d=b[a];d.distance=c+1}for(a=0,e=b.length;a<e;++a){d=b[a];h.waveForward(f,d,c+1)}return f},collectPath:function(i,a,b){var j=this,g=!0,d,c,e,f,h=[];while(g&&a.distance){d=j.getGridPointNeighbors(i,a,function(b){return b.permitted&&b.distance==a.distance-1});g=d.length>0;if(g){d=Ext.Array.sort(d,function(g,h){var c,d;c=g.ix-a.ix;d=g.iy-a.iy;var e=(b=='left'||b=='right')&&d===0||(b=='top'||b=='bottom')&&c===0?-1:1;c=h.ix-a.ix;d=h.iy-a.iy;var f=(b=='left'||b=='right')&&d===0||(b=='top'||b=='bottom')&&c===0?-1:1;if(e>f){return 1}else {if(e<f){return -1}else {if(e==f){return g.y>h.y?-1:1}}}});c=d[0];h.push({x1:c.x,y1:c.y,x2:a.x,y2:a.y});e=c.ix-a.ix;f=c.iy-a.iy;switch(!0){case !f&&e>0:b='left';break;case !f&&e<0:b='right';break;case !e&&f>0:b='top';break;case !e&&f<0:b='bottom';break;}a=c}}return g&&h.reverse()||!1},prependPathWithArrowStaffSegment:function(e,c,d,f){var a,b;if(e.length>0){b=e[0];a={x2:b.x1,y2:b.y1};switch(f){case 'left':a.x1=c.x-d;a.y1=b.y1;break;case 'right':a.x1=c.x+d;a.y1=b.y1;break;case 'top':a.x1=b.x1;a.y1=c.y-d;break;case 'bottom':a.x1=b.x1;a.y1=c.y+d;break;}e.unshift(a)}return e},appendPathWithArrowStaffSegment:function(c,d,e,f){var a,b;if(c.length>0){b=c[c.length-1];a={x1:b.x2,y1:b.y2};switch(f){case 'left':a.x2=d.x-e;a.y2=b.y2;break;case 'right':a.x2=d.x+e;a.y2=b.y2;break;case 'top':a.x2=b.x2;a.y2=d.y-e;break;case 'bottom':a.x2=b.x2;a.y2=d.y+e;break;}c.push(a)}return c},optimizePath:function(c){var d=[],a,b;if(c.length>0){a=c.shift();d.push(a);while(c.length>0){b=c.shift();if(a.x1==b.x1&&a.y1==b.y1&&a.x2==b.x2&&a.y2==b.y2){a=b}else {if(a.y1-a.y2===0&&b.y1-b.y2===0){a.x2=b.x2}else {if(a.x1-a.x2===0&&b.x1-b.x2===0){a.y2=b.y2}else {d.push(b);a=b}}}}}return d},normalizeSide:function(a){return this.self.sideToSide[a]||a},statics:{sideToSide:{'l':'left','r':'right','t':'top','b':'bottom'}}});Ext.define('Sch.template.Dependency',{extend:'Ext.XTemplate',disableFormats:!0,rtl:null,text:'<tpl if="startArrow">'+'<div style="__SIDE__:{startArrow.side}px;top:{startArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-start-arrow sch-dependency-arrow-{startArrow.dir} {lineCls} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.highlighted || "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{[values.dependencyId]}"</tpl>></div>'+'</tpl>'+'<tpl for="segments">'+'<div class="sch-dependency sch-dependency-line sch-dependency-line-{dir} {parent.lineCls} {[ parent.highlighted || "" ]} {[ this.getSuffixedCls(parent.cls, "-line") ]}" style="__SIDE__:{side}px;top:{top}px;<tpl if="width !== null && width !== undefined">width:{width}px;</tpl><tpl if="height !== null && height !== undefined">height:{height}px</tpl>" <tpl if="parent.dependencyId">data-sch-dependency-id="{parent.dependencyId}"</tpl>></div>'+'</tpl>'+'<tpl if="endArrow">'+'<div style="__SIDE__:{endArrow.side}px;top:{endArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-end-arrow sch-dependency-arrow-{endArrow.dir} {lineCls} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.highlighted || "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{dependencyId}"</tpl>></div>'+'</tpl>',constructor:function(b){var a=this;Ext.apply(a,b);a.text=a.text.replace(/__SIDE__/g,a.rtl?'right':'left');a.callParent([a.text])},getSuffixedCls:function(a,c){var b='';if(a&&a.indexOf(' ')!=-1){b=a.replace(/^\s*(.*)\s*$/,'$1').split(/\s+/).join(c+' ')+c}else {if(a){b=a+c}}return b}});Ext.define('Sch.view.dependency.Painter',function(b){function resetArrowMargins(a){var b=!1;if(a.startArrowMargin>0||a.endArrowMargin>0){a.startArrowMargin=a.endArrowMargin=0;b=!0}return b?a:b}function shrinkStartEndMarginsBy2(a){var b=!1;if(a.hasOwnProperty('startHorizontalMargin')&&a.startHorizontalMargin>2){a.startHorizontalMargin=Math.round(a.startHorizontalMargin/2);b=!0}if(a.hasOwnProperty('startVerticalMargin')&&a.startVerticalMargin>2){a.startVerticalMargin=Math.round(a.startVerticalMargin/2);b=!0}if(a.hasOwnProperty('endHorizontalMargin')&&a.endHorizontalMargin>2){a.endHorizontalMargin=Math.round(a.endHorizontalMargin/2);b=!0}if(a.hasOwnProperty('endVerticalMargin')&&a.endVerticalMargin>2){a.endVerticalMargin=Math.round(a.endVerticalMargin/2);b=!0}return b?a:b}function resetArrowSizes(a){var b=!1;if(a.startArrowSize>0||a.endArrowSize>0){a.startArrowSize=a.endArrowSize=0;b=!0}return b?a:b}var a=[resetArrowMargins,shrinkStartEndMarginsBy2,shrinkStartEndMarginsBy2,shrinkStartEndMarginsBy2,resetArrowSizes];return {alias:'schdependencypainter.default',mixins:['Ext.mixin.Factoryable'],requires:['Sch.util.RectangularPathFinder','Sch.template.Dependency'],uses:['Ext.Array','Ext.XTemplate','Ext.dom.Query','Sch.util.Date','Sch.util.RectangularPathFinder','Sch.template.Dependency'],config:{cls:'',rtl:!1,lineTpl:null,canvasCls:null,pathFinderConfig:null,realLineThickness:null,useDependencyRowIntersectionCache:!0},pathFinder:null,dependencyIdAttr:'data-sch-dependency-id',constructor:function(b){var a=this;a.initConfig(b);a.pathFinder=a.createPathFinder(a.getPathFinderConfig());if(!a.getLineTpl()){a.setLineTpl(new Sch.template.Dependency({rtl:a.getRtl()}))}a.resetRowIntersectionCache()},clone:function(){var a=this;return new a.self(a.getConfig())},applyLineTpl:function(a){return a instanceof Ext.XTemplate?a:new Ext.XTemplate(a)},updatePathFinderConfig:function(b){var a=this;if(a.pathFinder){if(b&&'type' in b&&b.type!==a.pathFinder.type){Ext.destroy(a.pathFinder);a.pathFinder=a.createPathFinder(b)}else {a.pathFinder.setConfig(b)}}},createPathFinder:function(a){return Sch.util.RectangularPathFinder.create(a)},getCanvasSpecification:function(){return {tag:'div',role:'presentation',cls:this.getCanvasCls()}},paint:function(d,a,c,h){var b=this,g=b.getUseDependencyRowIntersectionCache()?b.filterByRowIntersections(d,c):c,e=b.generatePaintMarkup(d,g);a=Ext.fly(a);if(h){var f=document.createElement('div');f.innerHTML=e;a.syncContent(f)}else {a.insertHtml('beforeEnd',e)}},generatePaintMarkup:function(d,c){var b=this,a=b.getLineDefsForDependencies(d,c);if(!Ext.isArray(a)){a=[a]}return Ext.Array.map(a,function(a){var c;a.path=b.findPath(a);c=a.path&&b.getLineTplData(a);return c&&b.getLineTpl().apply(c)||''}).join('')},isDependencyElement:function(a){return Ext.fly(a).is('.sch-dependency')},getElementsForDependency:function(b,a){var c=this;if(a&&!Ext.isArray(a)){a=[a]}return new Ext.dom.CompositeElementLite(Ext.Array.reduce(a||[],function(d,a){return d.concat(Ext.dom.Query.select('['+c.dependencyIdAttr+'="'+a.internalId+'"]',Ext.getDom(b)))},[]))},getDependencyElements:function(b){var a=Ext.getDom(b);return new Ext.dom.CompositeElementLite(a&&a.childNodes||[])},getElementDependencyInternalId:function(a){return Ext.fly(a).getAttribute(this.dependencyIdAttr)},findPath:function(c){var b;b=this.pathFinder.findPath(c,a);return b},getLineTplData:function(a){var c=this,h,d,e,f,b;b=a.path;if(!a.startBox.rendered&&!a.endBox.rendered){for(var i=b.length-1;i>=0;i--){var g=b[i];if(g.x1===g.x2){b=[g];a.startArrowSize=a.endArrowSize=0;break}}}h=c.getRtl();d=c.getRealLineThickness();e=b.length&&b[0];f=b.length&&b[b.length-1];b={cls:a.cls||'',lineCls:a.lineCls||'',dependencyId:a.dependencyId||'',highlighted:a.highlighted,segments:Ext.Array.map(b,function(a){var e=c.getSegmentDir(a),b;if(e=='horizontal'){b={width:Math.abs(a.x1-a.x2)+1,height:d,top:Math.min(a.y1,a.y2),side:Math.min(a.x1,a.x2),dir:e}}else {b={height:Math.abs(a.y1-a.y2)+1,width:d,top:Math.min(a.y1,a.y2),side:Math.min(a.x1,a.x2),dir:e}}return b}),startArrow:a.startArrowSize&&{side:e.x1,top:e.y1,dir:c.convertSideToDir(a.startSide,h)},endArrow:a.endArrowSize&&{side:f.x2,top:f.y2,dir:c.convertSideToDir(a.endSide,h)},realLineThickness:c.getRealLineThickness()};return b},isDependencyInTimeSpan:function(d,b,c){var a=d.getDateRange();return a&&(!b||!c||Sch.util.Date.intersectSpans(a.start,a.end,b,c))},addToRowIntersectionCacheIfNotPresent:function(b,d){var a=this,e=b.getViewStartDate(),f=b.getViewEndDate(),c=a.dependencyStore.count()===d.length;if(a.allInRowIntersectionCache){return}Ext.Array.each(d,function(d){if(c||!a.isInRowIntersectionCache(d)){var l=d.getSourceEvent(),m=d.getTargetEvent();if(a.isDependencyInTimeSpan(d,e,f)){var j=a.getIndexForCache(b,l),k=a.getIndexForCache(b,m),h=Math.min(j,k),i=Math.max(j,k);if(h>-1&&i>-1){h=Math.floor(h/10);i=Math.floor(i/10);for(var g=h;g<=i;g++){if(!a.rowIntersectionCache[g]){a.rowIntersectionCache[g]=[]}a.rowIntersectionCache[g].push(d);a.cachedDependencies[d.internalId]=!0}}}}});if(!c){c=Object.keys(a.cachedDependencies).length===a.dependencyStore.count()}if(c){a.allInRowIntersectionCache=!0}},getIndexForCache:function(c,a){if('getResource' in a){var b=a.getResource();if(b){return c.getResourceStore().indexOf(b)}if(!b&&a.resourceIdField in a.data){return -1}throw new Error('Not implemented for scheduler with multi assignment')}else {if('getTaskStore' in a){return a.getTaskStore().indexOf(a)}}},resetRowIntersectionCache:function(a){this.allInRowIntersectionCache=!1;if(!a){this.rowIntersectionCache={};this.cachedDependencies={}}},isInRowIntersectionCache:function(a){return !!this.cachedDependencies[a.internalId]},filterByRowIntersections:function(b,a){var i=this;if(!Ext.isArray(a)){a=[a]}if(!a.length){return []}i.addToRowIntersectionCacheIfNotPresent(b,a);var c=[],g=b.getNodes(),e=b.indexOf(g[0]),f=b.indexOf(g[g.length-1]),d;e=Math.floor(e/10);f=Math.floor(f/10);for(var h=e;h<=f;h++){d=i.rowIntersectionCache[h];d&&c.push.apply(c,d)}return Ext.Array.intersect(a,Ext.Array.unique(c))},getLineDefsForDependencies:function(d,c){var f=Ext.Array,e=this,b={},g=d.getViewStartDate(),h=d.getViewEndDate(),a;if(!Ext.isArray(c)){c=[c]}if(!c.length){return []}var i=f.reduce(c||[],function(k,j){var l=j.getSourceEvent(),m=j.getTargetEvent(),c,i;if(e.isDependencyInTimeSpan(j,g,h)){a=l.internalId;if(!b[a]){c=e.getItemBox(d,l)||[];if(!Ext.isArray(c)){c=[c]}b[a]=c}else {c=b[a]}a=m.internalId;if(!b[a]){i=e.getItemBox(d,m)||[];if(!Ext.isArray(i)){i=[i]}b[a]=i}else {i=b[a]}k=f.reduce(c,function(b,a,c){return f.reduce(i,function(c,b,f){if(a&&b&&(a.rendered||b.rendered||a.relPos!=b.relPos)){c.push(e.createLineDef(d,j,l,m,a,b,null))}return c},b)},k)}return k},[]);return i},getItemBox:function(a,b){return a.getItemBox(b)},createLineDef:function(d,c,n,o,e,f,x){var g=c.self.Type,i=this,h=c.getType(),j=i.pathFinder.getHorizontalMargin(),k=i.pathFinder.getVerticalMargin(),w=c.getBidirectional(),u=w?i.pathFinder.getStartArrowMargin():0,v=w?i.pathFinder.getStartArrowSize():0,p=i.pathFinder.getEndArrowMargin(),l=i.pathFinder.getEndArrowSize(),a=c.getFromSide(),b=c.getToSide();if(!a){switch(!0){case h==g.StartToEnd:a=d.getConnectorStartSide(n);break;case h==g.StartToStart:a=d.getConnectorStartSide(n);break;case h==g.EndToStart:a=d.getConnectorEndSide(n);break;case h==g.EndToEnd:a=d.getConnectorEndSide(n);break;default:throw new Error('Invalid dependency type: '+c.getType());}}if(!b){switch(!0){case h==g.StartToEnd:b=d.getConnectorEndSide(o);break;case h==g.StartToStart:b=d.getConnectorStartSide(o);break;case h==g.EndToStart:b=d.getConnectorStartSide(o);break;case h==g.EndToEnd:b=d.getConnectorEndSide(o);break;default:throw new Error('Invalid dependency type: '+c.getType());}}switch(!0){case (a=='left'||a=='right')&&(b=='left'||b=='right'):k=2;j=5;break;case (a=='top'||a=='bottom')&&(b=='top'||b=='bottom'):k=7;j=2;break;}var m=Number.MAX_VALUE;var s={from:(e.start+e.end)/2,to:(f.start+f.end)/2};var t={from:(e.top+e.bottom)/2,to:(f.top+f.bottom)/2};if((a==='top'&&b==='bottom'||a==='bottom'&&b==='top')&&s.from===s.to){m=Math.abs(e[a]-f[b])}else {if((a==='left'&&b==='right'||a==='right'&&b==='left')&&t.from===t.to){var q=a==='left'?'start':'end';var r=b==='left'?'start':'end';if(d.rtl){q=q==='start'?'end':'start';r=r==='start'?'end':'start'}var y=e[q];var z=f[r];m=Math.abs(y-z)}}if(m<l*p*2){u=p=0;if(m<=l*2){v=l=0}}return Ext.applyIf({startBox:e,startSide:a,startArrowSize:v,startArrowMargin:u,endBox:f,endSide:b,endArrowSize:l,endArrowMargin:p,top:Math.min(e.top,f.top),bottom:Math.max(e.bottom,f.bottom),verticalMargin:k,horizontalMargin:j,startVerticalMargin:k,startHorizontalMargin:j,endVerticalMargin:k,endHorizontalMargin:j,otherBoxes:x,dependency:c,dependencyId:c.internalId,lineCls:i.getCls(),cls:c.getCls(),highlighted:c.getHighlighted()},i.getConfig())},convertSideToDir:function(a,b){return this.self.sideToDir[a+(b&&'-rtl'||'')]},getSegmentDir:function(a){var b='vertical';if(a.y1===a.y2){b='horizontal'}return b},inheritableStatics:{sideToDir:{'left':'right','right':'left','top':'down','bottom':'up','left-rtl':'left','right-rtl':'right','top-rtl':'down','bottom-rtl':'up'}}}});Ext.define('Sch.view.dependency.renderingstrategy.Abstract',function(){function depsToMap(a){return Ext.Array.reduce(a,function(a,b){a[b.getId()]=b;return a},{})}function uniqueDeps(a){return Ext.Object.getValues(depsToMap(a))}function diffDeps(d,e){var b,c,a=[];b=depsToMap(d);c=depsToMap(e);Ext.Object.each(b,function(b,d){c.hasOwnProperty(b)||a.push(d)});return a}var b=function(){Ext.Error.raise('Method is not allowed to call at this state')};var d={render:b,clear:b,scheduledRender:b,destroy:b};var a,e,c;a=Ext.applyIf({render:function(a,b,h,i){var f,g,c,d;f=new Ext.Promise(function(a,b){g=a;c=b});if(b.canDrawDependencies()){a._depsToRender=h;a._depsRendered=[];d=b.getPrimaryView().up('{isHidden()}');if(d){a._scheduledRenderDetacher=d.on('show',function(){delete a._scheduledRenderDetacher;a._fsaState.scheduledRender(a,b)},null,{single:!0,destroyable:!0})}else {a._scheduledRenderCancelId=Ext.asap(function(){delete a._scheduledRenderCancelId;a._fsaState.scheduledRender(a,b)})}a.hasListeners['rendering-start']&&a.fireEvent('rendering-start',a);a._renderPromise=f;a._renderPromiseResolve=g;a._renderPromiseReject=c;a._fsaState=e}else {c(h)}return f},clear:function(e,a,c,d){var b;if(a.canDrawDependencies()){if(a.isDependencyCanvasPresent()){if(d){a.getPainter().paint(a.getPrimaryView(),a.getDependencyCanvas(),[],!0)}else {Ext.destroy(a.getPainter().getElementsForDependency(a.getDependencyCanvas(),c))}}b=Ext.Promise.resolve(c)}else {b=Ext.Promise.reject(c)}return b},destroy:function(a){a.destroyed=!0;a._fsaState=c}},d);e=Ext.applyIf({render:function(a,d,b,c){a._depsToRender=c?b:uniqueDeps(a._depsToRender.concat(b));return a._renderPromise},clear:function(d,a,b,e){var c;if(a.canDrawDependencies()){if(a.isDependencyCanvasPresent()){if(e){a.getPainter().paint(a.getPrimaryView(),a.getDependencyCanvas(),[],!0)}else {Ext.destroy(a.getPainter().getElementsForDependency(a.getDependencyCanvas(),b))}}if(e){d._depsToRender=[]}else {d._depsToRender=diffDeps(d._depsToRender,b)}c=Ext.Promise.resolve(b)}else {c=Ext.Promise.reject(b)}return c},scheduledRender:function(b,c){var d,e;if(c.canDrawDependencies()){d=c.getPrimaryView().up('{isHidden()}');if(d){b._scheduledRenderDetacher=d.on('show',function(){delete b._scheduledRenderDetacher;b._fsaState.scheduledRender(b,c)},null,{single:!0,destroyable:!0})}else {if(b._depsToRender.length>0){e=b.delegateRendering(c,b._depsToRender,b._depsRendered);b._depsRendered=uniqueDeps(b._depsRendered.concat(e[0]));b._depsToRender=e[1];b.hasListeners['rendering-progress']&&b.fireEvent('rendering-progress',b,b._depsToRender,b._depsRendered);if(b._depsToRender.length>0){b._scheduledRenderCancelId=Ext.asap(function(){delete b._scheduledRenderCancelId;b._fsaState.scheduledRender(b,c)})}else {b.hasListeners['rendering-complete']&&b.fireEvent('rendering-complete',b,b._depsRendered);b._renderPromiseResolve(b._depsRendered);delete b._renderPromise;delete b._renderPromiseResolve;delete b._renderPromiseReject;delete b._depsToRender;delete b._depsRendered;b._fsaState=a}}else {b.hasListeners['rendering-complete']&&b.fireEvent('rendering-complete',b,b._depsRendered);b._renderPromiseResolve(b._depsRendered);delete b._renderPromise;delete b._renderPromiseResolve;delete b._renderPromiseReject;delete b._depsToRender;delete b._depsRendered;b._fsaState=a}}}else {b.hasListeners['rendering-canceled']&&b.fireEvent('rendering-canceled',b,b._depsRendered,b._depsToRender);b._renderPromiseReject(b._depsToRender);delete b._renderPromise;delete b._renderPromiseResolve;delete b._renderPromiseReject;delete b._depsToRender;delete b._depsRendered;b._fsaState=a}},destroy:function(a){if(a._scheduledRenderCancelId){Ext.asapCancel(a._scheduledRenderCancelId);delete a._scheduledRenderCancelId}if(a._scheduledRenderDetacher){Ext.destroy(a._scheduledRenderDetacher);delete a._scheduledRenderDetacher}a.hasListeners['rendering-canceled']&&a.fireEvent('rendering-canceled',a,a._depsRendered,a._depsToRender);a._renderPromiseReject(a._depsToRender);delete a._renderPromise;delete a._renderPromiseResolve;delete a._renderPromiseReject;delete a._depsToRender;delete a._depsRendered;a.destroyed=!0;a._fsaState=c}},d);c=d;return {alias:'sch_dependency_rendering_strategy.abstract',mixins:['Ext.mixin.Factoryable','Ext.mixin.Observable'],_fsaState:a,constructor:function(b){var a=this;a.mixins.observable.constructor.call(a,b)},destroy:function(){var a=this;return a._fsaState.destroy(a)},renderDependencies:function(b,a){var c=this,d=!a;return c._fsaState.render(c,b,a||b.getDependencyStore().getRange(),d)},clearDependencies:function(b,a){var c=this,d=!a;return c._fsaState.clear(c,b,a||b.getDependencyStore().getRange(),d)},updateDependencies:function(c,a){var b=this,d=!a;a=a||c.getDependencyStore().getRange();return b._fsaState.clear(b,c,a,d).then(function(){a=d?c.getDependencyStore().getRange():Ext.Array.reduce(a,function(b,a){if(a.store&&Ext.Array.indexOf(a.store.removed,a)===-1){b.push(a)}return b},[]);return !b.destroyed?b._fsaState.render(b,c,a,d):a})},delegateRendering:function(c,b,a){},inheritableStatics:{depsToMap:depsToMap,uniqueDeps:uniqueDeps,diffDeps:diffDeps}}});Ext.define('Sch.view.dependency.renderingstrategy.Combined',{extend:'Sch.view.dependency.renderingstrategy.Abstract',alias:'sch_dependency_rendering_strategy.combined',config:{depsPerStep:50,mode:'bulk'},delegateRendering:function(d,c,b){var a=this;return a.getMode()=='bulk'?a.delegateRenderingBulk(d,c,b):a.delegateRenderingAsync(d,c,b)},delegateRenderingBulk:function(a,b,c){a.getPainter().paint(a.getPrimaryView(),a.getDependencyCanvas(),b,!1);return [b,[]]},delegateRenderingAsync:function(a,b,g){var f=this,d=f.getDepsPerStep(),c=b.slice(0,d),e=b.slice(d);a.getPainter().paint(a.getPrimaryView(),a.getDependencyCanvas(),c,!1);return [c,e]}});Ext.define('Sch.view.dependency.View',{alias:'schdependencyview.base',mixins:['Ext.mixin.Factoryable','Ext.mixin.Observable'],requires:['Sch.view.dependency.Tooltip','Sch.view.dependency.DragZone','Sch.view.dependency.Painter','Sch.view.dependency.renderingstrategy.Combined'],uses:['Ext.data.StoreManager','Ext.Array','Ext.dom.CompositeElementLite'],config:{primaryView:null,dependencyStore:null,drawDependencies:!0,bulkRenderingDependencyLimit:100,asyncRenderingDepsPerStep:50,painterConfig:{canvasCls:'sch-dependencyview-ct'},canvasLayer:0,enableDependencyDragDrop:!0,terminalSides:['left','right','top','bottom'],dragTipTpl:null,tipTpl:null,showTooltip:!0,dragZoneConfig:null,selectedCls:'sch-dependency-selected',overCls:'sch-dependency-over'},painter:null,renderingStrategy:null,primaryViewDetacher:null,primaryViewLockableDetacher:null,primaryViewElDetacher:null,dependencyStoreDetacher:null,dragZone:null,scrolling:!1,tip:null,constructor:function(c){var a=this,b;a.callParent([c]);a.mixins.observable.constructor.call(a,c);a.initConfig(c);a.painter=a.createPainter(Ext.apply({rtl:a.getPrimaryView().rtl,dependencyStore:a.getDependencyStore()},a.getPainterConfig()));if(a.painter.getUseDependencyRowIntersectionCache()){if(a.getPrimaryView().resourceStore){a.getPrimaryView().mon(a.getPrimaryView().resourceStore,{add:a.resetPainterCache,remove:a.resetPainterCache,clear:a.resetPainterCache,refresh:a.resetPainterCache,scope:a})}if(a.getDependencyStore()){a.mon(a.getDependencyStore(),{add:a.updatePainterCache,remove:a.resetPainterCache,clear:a.resetPainterCache,refresh:a.resetPainterCache,scope:a})}a.mon(a.getPrimaryView().ownerGrid,{viewchange:a.resetPainterCache,scope:a})}if(a.canDrawDependencies()){a.startDrawDependencies()}if(a.getEnableDependencyDragDrop()){b=a.getPrimaryView();a.dragZone=a.createDragZone(Ext.apply({view:b,ddGroup:b.getId()+'-dep-dd',rtl:b.rtl,terminalSelector:'.sch-terminal',dependencyStore:a.getDependencyStore(),tipTpl:a.getDragTipTpl()},a.getDragZoneConfig()||{}));a.dragZone.on({dragstart:a.onDragStart,drop:a.onDependencyDrop,afterdrop:a.onDependencyAfterDrop,scope:a});a.relayEvents(a.dragZone,['beforedrag','dragstart','drop','afterdrop'])}var d=a.getShowTooltip();if(d){a.tip=new Sch.view.dependency.Tooltip(Ext.apply({dependencyView:a,tpl:a.getTipTpl()},d))}},destroy:function(){var a=this;a.stopDrawDependencies();a.tip&&a.tip.destroy();a.dragZone&&a.dragZone.destroy()},destroyDetachers:function(){var a=this;Ext.destroyMembers(this,'primaryViewDetacher','primaryViewLockableDetacher','primaryViewElDetacher','dependencyStoreDetacher')},destroyDependencyCanvas:function(){var a=this;if(a.isDependencyCanvasPresent()){Ext.destroy(a.getDependencyCanvas())}},destroyRenderingStrategy:function(){var a=this;Ext.destroy(a.renderingStrategy);a.renderingStrategy=null},resetPainterCache:function(){this.painter.resetRowIntersectionCache()},updatePainterCache:function(){this.painter.resetRowIntersectionCache(!0)},canDrawDependencies:function(c,b,d){var a=this;return !!(a.painter&&a.getPrimaryView()&&(c||a.getDrawDependencies())&&(b||a.isDependencyCanvasAvailable())&&(d||a.getDependencyStore()))},startDrawDependencies:function(){var a=this,b=a.getPrimaryView(),d=a.getDependencyStore(),c;if(!a.renderingStrategy){a.renderingStrategy=a.createRenderingStrategy();a.primaryViewDetacher=b.on(Ext.applyIf({destroyable:!0},a.getPrimaryViewListeners()));a.primaryViewElDetacher=b.getEl().on(Ext.applyIf({destroyable:!0},a.getPrimaryViewElListeners()));if(b.grid){c=b.grid.ownerLockable&&b.grid.ownerLockable.getView();if(b!=c){a.primaryViewLockableDetacher=c.on(Ext.applyIf({destroyable:!0},a.getPrimaryViewLockableListeners()))}}a.dependencyStoreDetacher=d.on(Ext.applyIf({destroyable:!0},a.getDependencyStoreListeners()))}a.renderAllDependencies().then(null,Ext.emptyFn)},stopDrawDependencies:function(){var a=this;a.destroyRenderingStrategy();a.destroyDetachers();a.destroyDependencyCanvas()},createRenderingStrategy:function(){var a=this;return Sch.view.dependency.renderingstrategy.Combined.create({depsPerStep:a.getAsyncRenderingDepsPerStep()})},maybeSwitchRenderingStrategy:function(){var a=this;if(a.getDependencyStore().getCount()<=a.getBulkRenderingDependencyLimit()){a.renderingStrategy.setMode('bulk')}else {a.renderingStrategy.setMode('async')}},updatePrimaryView:function(b,c){var a=this;if(c){a.stopDrawDependencies()}if(b){if(!a.getDependencyStore()&&b.getEventStore()){a.setDependencyStore(b.getEventStore().getDependencyStore())}if(a.canDrawDependencies()){a.startDrawDependencies()}}},applyDependencyStore:function(a){return a&&Ext.StoreMgr.lookup(a)},updateDependencyStore:function(b,c){var a=this;if(c){a.stopDrawDependencies()}if(b&&a.canDrawDependencies()){a.startDrawDependencies()}},updateDrawDependencies:function(b,c){var a=this;if(b&&a.canDrawDependencies(!0)){a.startDrawDependencies()}else {if(!b){a.stopDrawDependencies()}}},applyPainterConfig:function(a){return Ext.isObject(a)?Ext.apply({},a):a},updatePainterConfig:function(b){var a=this;if(a.painter){if(b){b=Ext.apply({},{rtl:a.getPrimaryView().rtl},b)}if(b&&'type' in b&&b.type!==a.painter.type){Ext.destroy(a.painter);a.painter=a.createPainter(b)}else {a.painter.setConfig(b)}a.destroyDependencyCanvas();if(a.canDrawDependencies()){a.renderAllDependencies().then(null,Ext.emptyFn)}}},updateCanvasLayer:function(b){var a=this;a.destroyDependencyCanvas();if(a.canDrawDependencies()){a.renderAllDependencies().then(null,Ext.emptyFn)}},getPrimaryViewListeners:function(){var a=this;return {'itemadd':a.onPrimaryViewItemAdd,'itemremove':a.onPrimaryViewItemRemove,'itemupdate':a.onPrimaryViewItemUpdate,'refresh':a.onPrimaryViewRefresh,'bufferedrefresh':a.onPrimaryViewRefresh,'expandbody':a.onPrimaryViewExpandBody,'collapsebody':a.onPrimaryViewCollapseBody,'eventrepaint':a.onPrimaryViewEventRepaint,'baseline-show':a.onPrimaryViewRefresh,'baseline-hide':a.onPrimaryViewRefresh,scope:a}},getPrimaryViewLockableListeners:function(){var a=this;return {'expandbody':a.onPrimaryViewExpandBody,'collapsebody':a.onPrimaryViewCollapseBody,scope:a}},getPrimaryViewElListeners:function(){var a=this;return {'dblclick':a.onPrimaryViewDependencyElPointerEvent,'click':a.onPrimaryViewDependencyElPointerEvent,'contextmenu':a.onPrimaryViewDependencyElPointerEvent,'mouseover':a.onPrimaryViewDependencyElPointerEvent,'mouseout':a.onPrimaryViewDependencyElPointerEvent,delegate:'.sch-dependency',scope:a}},getDependencyStoreListeners:function(){var a=this;return {'add':a.onDependencyStoreAdd,'remove':a.onDependencyStoreRemove,'update':a.onDependencyStoreUpdate,'refresh':a.onDependencyStoreRefresh,'clear':a.onDependencyStoreClear,scope:a}},createPainter:function(a){return Sch.view.dependency.Painter.create(a)},getPainter:function(){return this.painter},clonePainter:function(){var a=this;return a.painter&&a.painter.clone()||null},createDragZone:function(a){return Sch.view.dependency.DragZone.create(a)},isDependencyCanvasAvailable:function(){var a=this.getPrimaryView();return a&&a.isItemCanvasAvailable()},isDependencyCanvasPresent:function(){var b=this,a=b.getPrimaryView();return a&&a.isItemCanvasPresent(b.getCanvasLayer())},getDependencyCanvas:function(){var a=this;return a.getPrimaryView().getItemCanvasEl(a.getCanvasLayer(),a.painter.getCanvasSpecification())},renderAllDependencies:function(){var a=this,b;if(a.canDrawDependencies()&&(a.refreshing||a.fireEvent('beforerefresh',a)!==!1)){a.refreshing||a.renderingStrategy.on('rendering-complete',function(c,b){a.refreshing=!1;a.fireEvent('refresh',a)},null,{single:!0});a.refreshing=!0;b=a.renderingStrategy.updateDependencies(a)}else {b=Ext.Promise.reject(a.getDependencyStore().getRange())}return b},renderDependencies:function(b,d){var a=this,c;if(!Ext.isArray(b)){b=[b]}if(a.canDrawDependencies()){if(d){c=a.renderingStrategy.clearDependencies(a).then(function(){return !a.renderingStrategy.destroyed?a.renderingStrategy.renderDependencies(a,b):b})}else {c=a.renderingStrategy.renderDependencies(a,b)}}else {c=Ext.Promise.reject(b)}return c},updateDependencies:function(a){var c=this,b;if(!Ext.isArray(a)){a=[a]}if(c.canDrawDependencies()){b=c.renderingStrategy.updateDependencies(c,a)}else {b=Ext.Promise.reject(a)}return b},clearDependencies:function(a){var c=this,b;if(!Ext.isArray(a)){a=[a]}if(c.canDrawDependencies()){b=c.renderingStrategy.clearDependencies(c,a)}else {b=Ext.Promise.reject(a)}return b},clearAllDependencies:function(){var b=this,a;if(b.canDrawDependencies()){a=b.renderingStrategy.clearDependencies(b)}else {a=Ext.Promise.reject()}return a},getDependencyForElement:function(e){var d=this,c=d.getDependencyStore(),b=null,a;if(c){a=d.painter.getElementDependencyInternalId(e);b=c.getByInternalId(a)}return b},highlightDependency:function(a,c){var b=this;if(!(a&&a.isModel)){a=b.getDependencyStore().getById(a)}a&&a.highlight(c||b.getSelectedCls())},unhighlightDependency:function(a,c){var b=this;if(!(a&&a.isModel)){a=b.getDependencyStore().getById(a)}a&&a.unhighlight(c||b.getSelectedCls())},getHighlightedDependencies:function(c){var b=this,a=b.getDependencyStore();return a&&a.getHighlightedDependencies(c||b.getSelectedCls())||[]},onPrimaryViewItemAdd:function(a,b,c,d){this.renderAllDependencies().then(null,Ext.emptyFn)},onPrimaryViewItemUpdate:function(a,b,c,d){this.renderAllDependencies().then(null,Ext.emptyFn)},onPrimaryViewItemRemove:function(a,b,c,d){this.renderAllDependencies().then(null,Ext.emptyFn)},onPrimaryViewRefresh:function(a){this.renderAllDependencies().then(null,Ext.emptyFn)},onPrimaryViewExpandBody:function(){this.renderAllDependencies().then(null,Ext.emptyFn)},onPrimaryViewCollapseBody:function(){this.renderAllDependencies().then(null,Ext.emptyFn)},onPrimaryViewEventRepaint:function(){this.renderAllDependencies().then(null,Ext.emptyFn)},onPrimaryViewDependencyElPointerEvent:function(c,e,h){var a=this,g=a.painter.getElementDependencyInternalId(e),d=a.getDependencyStore().getByInternalId(g);if(d){a.fireEvent('dependency'+c.type,a,d,c,e);var b=this.getOverCls(),f=a.painter.getElementsForDependency(a.getDependencyCanvas(),d);if(b&&c.type==='mouseover'){f.addCls(b)}else {if(b&&c.type==='mouseout'){f.removeCls(b)}}}},onDependencyStoreAdd:function(c,b){var a=this;a.maybeSwitchRenderingStrategy();a.renderDependencies(b).then(null,Ext.emptyFn)},onDependencyStoreRemove:function(c,b){var a=this;a.maybeSwitchRenderingStrategy();a.clearDependencies(b).then(null,Ext.emptyFn)},onDependencyStoreUpdate:function(b,a){this.updateDependencies(a).then(null,Ext.emptyFn)},onDependencyStoreRefresh:function(b){var a=this;a.maybeSwitchRenderingStrategy();a.renderAllDependencies().then(null,Ext.emptyFn)},onDependencyStoreClear:function(b){var a=this;a.maybeSwitchRenderingStrategy();a.renderAllDependencies().then(null,Ext.emptyFn)},onDragStart:function(){var a=this,b=a.getPrimaryView();b.onDragDropStart&&b.onDragDropStart();a.tip&&a.tip.disable();a.getPrimaryView().getEl().addCls('sch-terminals-visible')},onDependencyDrop:function(c,a,b){b&&this.getDependencyStore().add(a)},onDependencyAfterDrop:function(){var a=this.getPrimaryView();if(!a.destroyed){a.onDragDropEnd&&a.onDragDropEnd();a.getEl().removeCls('sch-terminals-visible');a.getEl().select('.sch-terminal-hidden').removeCls('sch-terminal-hidden');this.tip&&this.tip.enable()}}});Ext.define('Sch.view.dependency.Mixin',{extend:'Ext.Mixin',requires:['Sch.view.dependency.View'],mixinConfig:{after:{initComponent:'initComponent',destroy:'destroy'}},dependencyViewConfig:null,dependencyView:null,dependencyViewRelayDetacher:null,dependencyDragRelayDetacher:null,initComponent:function(){var a=this;a.on('viewready',function(){if(a.getEventStore()){a.setupDependencyView(a.getDependencyViewConfig(),a.getSchedulingView())}})},getDependencyViewConfig:function(){return this.dependencyViewConfig},setDependencyViewConfig:function(a){var b=this;if(b.dependencyViewConfig!==a){b.dependencyViewConfig=a;if(b.dependencyView){if(a&&'type' in a&&a.type!==b.dependencyView.type){b.setupDependencyView(a,b.getSchedulingView())}else {b.dependencyView.setConfig(a)}}}},hasDependencyView:function(){return !!this.dependencyView},getDependencyView:function(){return this.dependencyView},createDependencyView:function(b,a){return Sch.view.dependency.View.create(Ext.applyIf({primaryView:a},b))},destroy:function(){Ext.destroyMembers(this,'dependencyViewRelayDetacher','dependencyDragRelayDetacher','dependencyView')},setupDependencyView:function(c,b){var a=this;Ext.destroy(a.dependencyView);a.dependencyView=a.createDependencyView(c,b);a.setupDependencyViewRelay();a.fireEvent('dependencyviewready',a,a.dependencyView);if(a.dependencyView.canDrawDependencies()){a.dependencyView.renderAllDependencies().then(null,Ext.emptyFn)}},setupDependencyViewRelay:function(){var a=this;Ext.destroy(a.dependencyViewRelayDetacher,a.dependencyDragRelayDetacher);a.dependencyViewRelayDetacher=a.relayEvents(a.getDependencyView(),['dependencyclick','dependencydblclick','dependencycontextmenu','dependencymouseover','dependencymouseout']);a.dependencyDragRelayDetacher=a.relayEvents(a.getDependencyView(),['beforedrag','dragstart','drop','afterdrop'],'dependency')}});Ext.define('Sch.panel.SchedulerGrid',{extend:'Sch.panel.TimelineGridPanel',mixins:['Sch.mixin.SchedulerPanel','Sch.view.dependency.Mixin'],alias:['widget.schedulergrid','widget.schedulerpanel'],alternateClassName:'Sch.SchedulerPanel',viewType:'schedulergridview',isSchedulerGrid:!0,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define('Sch.view.AllDayMode',{extend:'Sch.view.Horizontal',getScheduledEventsForResource:function(){var b=this.view,a=[];b.getEventStore().each(function(c){if(c.getAllDay()&&c.isScheduled()&&b.timeAxis.isRangeInAxis(c)){a.push(c)}});return a},onEventAdd:function(){this.view.refreshView()},onEventUpdate:function(){this.view.refreshView()},onEventRemove:function(){this.view.refreshView()}});Ext.define('Sch.view.AllDay',{extend:'Sch.view.SchedulerGridView',requires:['Sch.view.AllDayMode'],allDay:!0,eventAnimations:!1,horizontalViewClass:'Sch.view.AllDayMode',additionalEventCls:'',repaintEventsForResource:function(){this.refreshView()},generateTplData:function(c,a,d){var b,e;a=c.getResource()||this.resourceStore.first();b=this.callParent([c,a,d]);b.isCalendarContext=!0;b.internalCls+=' '+this.additionalEventCls;if(a){if(Ext.isFunction(a.getCls)&&a.getCls()){b.internalCls+=' '+a.getCls()}if(Ext.isFunction(a.getColor)&&a.getColor()){b.style=(b.style||'')+';background-color: '+a.getColor()+';'}}return b},setEventStore:function(b,e){b=b&&Ext.StoreManager.lookup(b);var a=this,d=a.getEventStore(),c=b&&b.getResourceStore();a.suspendEvents(!1);a.callParent(arguments);a.resumeEvents();if(a.eventStore){a.eventStore.setResourceStore(c);if(!e){a.fireEvent('eventstorechange',a,a.eventStore,d);a.refreshView()}}}});Ext.define('Sch.panel.AllDayHeader',{extend:'Sch.panel.SchedulerGrid',requires:['Sch.view.AllDay'],xtype:'alldayheader',cls:'sch-all-day-header',columns:[],weight:1000,height:24,rowHeight:24,hideHeaders:!0,reserveScrollbar:!1,barMargin:1,enableDragCreation:!1,enablePinchZoom:!1,mainScheduler:null,mainSchedulerView:null,mainSchedulerTimeAxis:null,storedColumnWidth:null,lastTimeTdHeight:0,resourceStore:{type:'resourcestore',data:[{Id:1}]},relayedConfigs:['readOnly','eventStore','recurringEvents','eventRenderer','eventRendererScope','onEventCreated','tooltipTpl'],normalViewConfig:null,createConfig:{showHoverTip:!1,showDragTip:!1},enableEventDragDrop:!1,resizeConfig:{showTooltip:!1},viewPreset:{name:'dayAndWeek',timeColumnWidth:25,timeResolution:{unit:'d',increment:1},headerConfig:{middle:{unit:'d',align:'center',dateFormat:'G'}}},constructor:function(c){var a=this,b=c.mainScheduler;a.relayedConfigs.forEach(function(a){c[a]=b[a]});a.mainSchedulerTimeAxis=b.timeAxis;a.mainSchedulerView=b.getSchedulingView();a.resourceStore.model=b.resourceStore.model;a.normalViewConfig=Ext.apply({xclass:'Sch.view.AllDay',eventPrefix:a.mainSchedulerView.id,eventBodyTemplate:a.mainSchedulerView.eventBodyTemplate,additionalEventCls:a.mainSchedulerView.additionalEventCls||'',selectedEventCls:a.mainSchedulerView.selectedEventCls||''},c.normalViewConfig);a.callParent(arguments);var d=a.getSchedulingView();a.mon(a.mainSchedulerTimeAxis,{reconfigure:a.onMainTimeAxisReconfigure,scope:a});d.on({refresh:a.onSchedulingViewUpdate,itemupdate:a.onSchedulingViewUpdate,scope:a});a.syncTimeAxisSpan();a.syncScroll();a.fixEventSelection();a.mainSchedulerView.relayEvents(a.getSchedulingView(),a.relayedViewEvents.concat(['scheduleclick','scheduledblclick','schedulecontextmenu','schedulelongpress']));a.oldHeaderCtLayout=b.normalGrid.headerCt.layout.roundFlex;b.normalGrid.headerCt.layout.roundFlex=Ext.Function.bind(a.roundFlex,a);b.normalGrid.on('afterlayout',a.onContainerGridAfterLayout,a)},roundFlex:function(b){var a=this;if(!a.storedColumnWidth){a.storedColumnWidth=Math.floor(b)}return a.storedColumnWidth},resetStoredColumnWidth:function(){delete this.storedColumnWidth},onContainerGridAfterLayout:function(a){if(this.storedColumnWidth){if(this.timeAxisViewModel.getTickWidth()!==this.storedColumnWidth){this.timeAxisViewModel.suppressFit=!0;this.timeAxisViewModel.setTickWidth(this.storedColumnWidth)}}else {if(this.timeAxisViewModel.getTickWidth()!==this.mainScheduler.timeAxisViewModel.weekViewColumnWidth){this.timeAxisViewModel.setTickWidth(this.mainScheduler.timeAxisViewModel.weekViewColumnWidth)}}this.resetStoredColumnWidth()},onMainTimeAxisReconfigure:function(){this.syncTimeAxisSpan()},syncTimeAxisSpan:function(){var a=this;a.setTimeSpan(a.mainSchedulerTimeAxis.getStart(),a.mainSchedulerTimeAxis.getEnd())},onResize:function(c,b){var a=this;a.callParent(arguments);a.syncLockedHeaderComponent();return a},syncLockedHeaderComponent:function(){this.lockedHeaderPartner.setHeight(this.getHeight())},getDesiredComponentHeight:function(){return this.el.down('.sch-timetd').getHeight()},onSchedulingViewUpdate:function(){var a=this,b=a.getDesiredComponentHeight();if(b!==a.lastTimeTdHeight){a.lastTimeTdHeight=b;Ext.asap(function(){if(!a.destroyed){a.setHeight(b)}})}},onDestroy:function(){this.mainScheduler.normalGrid.headerCt.layout.roundFlex=this.oldHeaderCtLayout;this.callParent()},syncScroll:function(){this.getView().normalView.getScrollable().addPartner(this.mainScheduler.getView().normalView.getScrollable(),'x')},fixEventSelection:function(){var a=this,b=a.mainSchedulerView;b.on({eventmousedown:a.clearPartnerSelection,scope:a});a.on({scheduleclick:a.clearSelection,schedulecontextmenu:a.clearSelection,schedulelongpress:a.clearSelection,scope:a})},clearPartnerSelection:function(e,g,f){var c=this,b=c.getEventSelectionModel(),a=b.getSelectionMode(),d=a==='SINGLE'||a==='MULTI'&&!f.ctrlKey;if(e===c.mainSchedulerView&&d){b.deselectAll()}},clearSelection:function(){this.mainScheduler.getEventSelectionModel().deselectAll()}});Ext.define('Sch.panel.TimelineTreePanel',{extend:'Ext.tree.Panel',requires:['Ext.grid.Panel','Ext.data.TreeStore','Sch.mixin.FilterableTreeView'],mixins:['Sch.mixin.Localizable','Sch.mixin.TimelinePanel'],alias:['widget.timelinetree'],useArrows:!0,rootVisible:!1,lockedXType:'treepanel',isTimelineTreePanel:!0,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define('Sch.panel.SchedulerTree',{extend:'Sch.panel.TimelineTreePanel',mixins:['Sch.mixin.SchedulerPanel','Sch.view.dependency.Mixin'],alias:['widget.schedulertree'],viewType:'schedulergridview',isSchedulerTree:!0,setMode:function(a){if(a!=='horizontal'){Ext.Error.raise('Sch.panel.SchedulerTree only support horizontal mode')}},initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define('Sch.patches.BufferedRenderer',{extend:'Sch.util.Patch',target:'Ext.grid.plugin.BufferedRenderer',overrides:{refreshView:function(){var b=this.view,a=b.lockingPartner;if(!arguments.length&&a&&a.refreshCounter>b.refreshCounter){this.callParent([a.all.startIndex])}else {this.callParent(arguments)}},setBodyTop:function(f,b){var a=this.view,e=a.all;if(!a.rendered){return}var c=this.grid.ownerCt&&this.grid.ownerCt.scrollable&&this.grid.ownerCt.scrollable.getSpacerXY();if(e.endIndex===a.store.getCount()-1){b=!1}else {if(c&&c.y<=this.scrollHeight-1){b=!1}}var d=this.callParent(arguments);a.fireEvent('bufferedrefresh',this);return d},getScrollHeight:function(){var a=this,j=a.view,d=j.all,i=a.store,c=i.getCount(),g=d.getCount(),h,f,e,b;if(!c){return 0}if(!a.hasOwnProperty('rowHeight')){if(g){if(a.variableRowHeight){a.rowHeight=Math.floor(a.bodyHeight/g)}else {h=d.first();f=h.getHeight();if(Ext.isIE8){e=h.getBorderWidth('b');if(e>0){f-=e}}a.rowHeight=f}}else {delete a.rowHeight}}if(a.variableRowHeight){if(d.endIndex===c-1){b=a.bodyTop+a.bodyHeight-1}else {b=Math.floor((c-g)*a.rowHeight)+a.bodyHeight;b+=Math.max(a.bodyTop-d.startIndex*a.rowHeight,0)}}else {b=Math.floor(c*a.rowHeight)}return a.scrollHeight=b}}});Ext.define('Sch.patches.BufferedRendererResize',{extend:'Sch.util.Patch',target:'Ext.grid.plugin.BufferedRenderer',minVersion:'7.3.1',overrides:{doRefreshView:function(){var a=this.scroller;if(this.view.ownerGrid.is('timelinegrid,timelinetree')&&a){var c=this.position;var b=this.scrollTop;this.callParent(arguments);if(this.scrollTop!==b){this.doVerticalScroll(a,c,!0)}}else {this.callParent(arguments)}}}});Ext.define('Sch.patches.BufferedRenderer_6_2_1',{extend:'Sch.util.Patch',target:'Ext.grid.plugin.BufferedRenderer',minVersion:'6.2.1',applyFn:function(){if(Ext.isIE11){Ext.define(null,{override:'Ext.grid.plugin.BufferedRenderer',getFirstVisibleRowIndex:function(b,e,c,f){var a=this,m=a.view,g=m.all,l=g.elements,k=a.viewClientHeight,d,i,j=a.bodyTop;if(g.getCount()&&a.variableRowHeight){if(!arguments.length){b=g.startIndex;e=g.endIndex;c=a.scrollTop;f=c+k;if(j>f||j+a.bodyHeight<c){a.teleported=!0;return Math.floor(a.scrollTop/a.rowHeight)}d=b+Math.min(a.numFromEdge+(a.lastScrollDirection===-1?a.leadingBufferZone:a.trailingBufferZone),Math.floor((e-b)/2))}else {if(b===e){return e}d=b+Math.floor((e-b)/2)}var h=l[d];i=j+h.offsetTop;if(i+h.offsetHeight<=c&&h.offsetHeight){return a.getFirstVisibleRowIndex(d+1,e,c,f)}if(i<=c){return d}else {if(d!==b){return a.getFirstVisibleRowIndex(b,d-1,c,f)}}}return Math.floor(a.scrollTop/a.rowHeight)}})}}});Ext.define('Sch.patches.CellContext',{extend:'Sch.util.Patch',target:'Ext.grid.CellContext',minVersion:'6.0.0',maxVersion:'6.6.0',applyFn:function(){var a={setAll:function(a,e,c,f,b){var d=this;if(b&&c==-1&&a!==d.view){a=d.view;c=a.getVisibleColumnManager().indexOf(b)}return this.callParent(arguments)}};if(Ext.getVersion().isGreaterThanOrEqual('6.0.1')){a.setPosition=function(b,a){b=b||0;a=a||0;return this.callParent(arguments)}}Ext.override(Ext.grid.CellContext,a)}});Ext.define('Sch.patches.DateField',{extend:'Sch.util.Patch',target:'Ext.form.field.Date',minVersion:'6.0.2',maxVersion:'6.5.1.345',overrides:{onSelect:function(c,b){var a=this;a.setValue(b);a.fireEvent('select',a,a.rawDate);a.onTabOut(c)}}});Ext.define('Sch.patches.DragZone',{extend:'Sch.util.Patch',target:'Ext.dd.DragZone',minVersion:'6.2.0',overrides:{unreg:function(){try{this.callParent(arguments)}catch(b){}}}});Ext.define('Sch.patches.DragZoneDupIds',{extend:'Sch.util.Patch',target:'Ext.dd.DragZone',minVersion:'6.0.2',reportUrl:'https://www.sencha.com/forum/showthread.php?338467-DragZone-duplicates-DOM-ids-which-leads-to-error-if-one-Ext-get()s-duplicated-element',obsoleteTestName:'patches/005_dragzone_dup_ids.t.js',description:['Drag zone clones dragged element into drag status proxy without substituting cloned element id, thus we might','hit the case when there are two or more elements with the same id in the DOM. If such original element has been','accessed before via Ext.get(), i.e. it is cached in Ext.dom.Element cache, then accessing the similar element','inside drag proxy with Ext.get() will lead to duplicate ids exception thrown from Ext.get()'].join(' '),overrides:{onInitDrag:function(c,d){var a=this,b=a.dragData.ddel.cloneNode(!0);b.id=Ext.id();a.proxy.update(b);a.onStartDrag(c,d);return !0}}});Ext.define('Sch.patches.Element',{extend:'Sch.util.Patch',target:['Ext.dom.Element'],applyFn:function(){Ext.override(Ext.dom.Element,{pxRe:/^-?\d+(?:\.\d*)?px$/i,getLocalX:function(){var c=this,b,a=c.getStyle('left');if(!a||a==='auto'){a=0}else {if(this.pxRe.test(a)){a=parseFloat(a)}else {a=c.getX();b=c.dom.offsetParent;if(b){a-=Ext.fly(b).getX()}}}return a}})}});Ext.define('Sch.patches.Element_6_5',{extend:'Sch.util.Patch',target:['Ext.dom.Element'],minVersion:'6.5.0',applyFn:function(){if(Ext.isIE11p){Ext.override(Ext.dom.Element,{selectText:function(){try{this.callParent(arguments)}catch(b){}}})}}});Ext.define('Sch.patches.TablePanelScroll6.2',{extend:'Sch.util.Patch',target:'Ext.panel.Table',minVersion:'6.2.0',overrides:{afterRender:function(){this.callParent(arguments);if(this.lockedGrid){this.lockedGrid.getView().relayEvents(this.getScrollable(),['scrollend']);this.normalGrid.getView().relayEvents(this.getScrollable(),['scrollend'])}}}});Ext.define('Sch.patches.TablePanel_6_2_1',{extend:'Sch.util.Patch',target:'Ext.panel.Table',minVersion:'6.2.1',overrides:{initComponent:function(){var a=this,b;a.callParent(arguments);if(a.headerCt&&(b=a.headerCt.getScrollable())){b.suspendPartnerSync();a.view.on({refresh:function(){b.resumePartnerSync();b.getElement().dom.scrollLeft=a.view.getScrollable().getElement().dom.scrollLeft},single:!0,delay:100})}},privates:{initFocusableElement:function(){},doEnsureVisible:function(a,d){if(this.lockable){return this.ensureLockedVisible(a,d)}if(typeof a!=='number'&&!a.isEntity){a=this.store.getById(a)}var b=this,c=b.getView(),f=c.getNode(a),o=b.ownerGrid.lockable,i,k,j,h,m,l,g,p,e,n;if(d){i=d.callback;k=d.scope;j=d.animate;h=d.highlight;m=d.select;l=d.focus;e=d.column}if(b.deferredEnsureVisible){b.deferredEnsureVisible.destroy()}if(!c.componentLayoutCounter){b.deferredEnsureVisible=c.on({resize:b.doEnsureVisible,args:Ext.Array.slice(arguments),scope:b,single:!0,destroyable:!0});return}if(typeof e==='number'){e=b.ownerGrid.getVisibleColumnManager().getColumns()[e]}if(f){g=o?b.ownerGrid.getScrollable():c.getScrollable();if(g){if(e){n=Ext.fly(f).selectNode(e.getCellSelector())}if(o&&e){g.scrollIntoView(f,!1);c.getScrollable().scrollIntoView(n||f,!0,j,h)}else {g.scrollIntoView(n||f,!!e,j,h)}}if(!a.isEntity){a=c.getRecord(f)}if(m){c.getSelectionModel().select(a)}if(l){c.getNavigationModel().setPosition(a,0)}Ext.callback(i,k||b,[!0,a,f])}else {if(c.bufferedRenderer){c.bufferedRenderer.scrollTo(a,{animate:j,highlight:h,select:m,focus:l,column:e,callback:function(d,c,a){Ext.callback(i,k||b,[!0,c,a])}})}else {Ext.callback(i,k||b,[!1,null])}}}}}});Ext.define('Sch.patches.TableView',{extend:'Sch.util.Patch',target:'Ext.view.Table',overrides:{scrollBy:function(b,c,a){if(this.lockingPartner){this.callParent([b||null,null,a]);this.ownerCt.ownerCt.getScrollable().scrollBy(null,c,a)}else {this.callParent([b,c,a])}}}});Ext.define('Sch.patches.TimelineGridView',{extend:'Sch.util.Patch',target:'Sch.view.TimelineGridView',minVersion:'6.0.1',overrides:{initComponent:function(){this.callParent(arguments);if(this.rtl){this.headerCt.on('afterlayout',function(a){a.scrollTo(this.getScrollX())},this)}}}});Ext.define('Sch.patches.TimelineGridViewScroll6_2',{extend:'Sch.util.Patch',target:'Sch.view.TimelineGridView',minVersion:'6.2.0',overrides:{scrollVerticallyTo:function(b,a){this.up('timelinegrid,timelinetree').getScrollable().scrollTo(null,b,a)},getVerticalScroll:function(){var a=this.up('timelinegrid,timelinetree').getScrollable();if(a.getNormalScroller){if(a.getNormalScroller()){return a.getPosition().y}else {return 0}}else {return a.getPosition().y}}}});Ext.define('Sch.patches.TimelinePanel',{extend:'Sch.util.Patch',target:'Sch.mixin.TimelinePanel',minVersion:'6.2.0',applyFn:function(){Sch.panel.TimelineGridPanel&&Sch.panel.TimelineGridPanel.override({hideHeaders:!1});Sch.panel.TimelineTreePanel&&Sch.panel.TimelineTreePanel.override({hideHeaders:!1})}});Ext.define('Sch.patches.TouchAction',{extend:'Sch.util.Patch',requires:['Ext.dom.TouchAction'],target:'Ext.dom.TouchAction',applyFn:function(){var a=Ext.dom.TouchAction.onTouchEnd;Ext.dom.TouchAction.onTouchEnd=function(b){b.touches=b.touches||[];return a.apply(this,arguments)}}});Ext.define('Sch.plugin.CellPlugin',{extend:'Ext.AbstractPlugin',alias:'plugin.scheduler_cellplugin',requires:['Ext.form.field.Base','Sch.field.CellEditor','Sch.util.Date','Sch.eventlayout.Table'],mixins:{observable:'Ext.util.Observable'},frameCls:'sch-cellplugin-highlighter',editingCls:'sch-cellplugin-highlighter-editing',activeCls:'sch-cellplugin-active',frameTemplate:new Ext.Template(['<div class="{cls}" style="width: {width}px; height: {height}px;">','<div class="sch-cellplugin-border sch-cellplugin-border-horizontal sch-cellplugin-border-top"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-horizontal sch-cellplugin-border-bottom"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-vertical sch-cellplugin-border-left"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-vertical sch-cellplugin-border-right"></div>','</div>']),editor:'Sch.field.CellEditor',singleClickEditing:!0,dblClickTimeout:100,editing:!1,context:{},position:{},selContext:[],lockedView:null,schedulingView:null,timeAxisViewModel:null,keyNav:null,constructor:function(a){this.mixins.observable.constructor.call(this);this.callParent(arguments);this.context={};this.position={}},init:function(b){var a=this;a.schedulingView=b.getSchedulingView();a.lockedView=b.lockedGrid.getView();b.getNavigationModel().disable();a.timeAxisViewModel=b.timeAxisViewModel;a.keyNav=new Ext.util.KeyNav({target:a.lockedView,eventName:'itemkeydown',processEvent:function(e,b,d,c,a){a.stopEvent();return a},ignoreInputFields:!0,up:a.onKeyUp,down:a.onKeyDown,right:a.onKeyRight,left:a.onKeyLeft,tab:a.onKeyTab,enter:a.onKeyEnter,esc:a.onKeyEsc,scope:a});if(b.bufferedRenderer){a.schedulingView.on('afterrender',function(){a.schedulingView.getScrollable().on('scroll',a.onViewScroll,a)});a.schedulingView.on('itemadd',a.onItemAdd,a)}a.handleSingleClickTask=new Ext.util.DelayedTask(a.handleCellClick,a);b.on({headerclick:a.onContainerClick,zoomchange:a.destroyHighlighter,scope:a});a.schedulingView.on({containerclick:a.onContainerClick,scheduleclick:a.onCellClick,scheduledblclick:a.onCellDblClick,eventclick:a.onEventClick,eventdblclick:a.onEventDblClick,containerkeydown:a.onEditorKeyDown,groupcollapse:a.onGroupCollapse,groupexpand:a.onGroupExpand,scope:a});if(Ext.getVersion().isGreaterThan('6.2.0')){a.schedulingView.on('refresh',a.moveContainerElToSecondaryCanvas,a);a.mon(a.timeAxisViewModel,'update',a.moveContainerElToSecondaryCanvas,a)}a.mon(a.timeAxisViewModel,{update:a.onViewModelUpdate,scope:a});a.mon(b.getTimeAxis(),{beforereconfigure:a.onBeforeReconfigure,scope:a});a.bindResourceStore(b.getResourceStore());a.bindEventStore(b.getEventStore());a.lockedView.on({cellclick:a.onLockedCellClick,beforeitemkeydown:a.onBeforeItemKeyDown,scope:a});b.on('eventstorechange',function(d,b,c){a.bindEventStore(c,!0);a.bindEventStore(b)});b.on('resourcestorechange',function(d,b,c){a.bindResourceStore(c,!0);a.bindResourceStore(b)})},moveContainerElToSecondaryCanvas:function(){if(this.containerEl){this.schedulingView.getSecondaryCanvasEl().appendChild(this.containerEl)}},getNbrOfTicks:function(){return this.schedulingView.timeAxis.getCount()},onEditorKeyDown:function(b,a){if(!this.getPosition().hasOwnProperty('tickIndex')){return}switch(a.getKey()){case a.TAB:a.stopEvent();if(a.shiftKey){this.editPrevious(a)}else {this.editNext(a)};break;case a.ENTER:this.onEditorKeyEnter();break;case a.ESC:this.cancelEdit(a);break;default:break;}},onEditorKeyEnter:function(){if(this.completeEdit()){this.beginEditBelow()}else {this.showEditorInCell(this.getEventOrCell(this.getPosition(),!0))}},destroy:function(){this.keyNav.destroy();this.editor&&this.editor.destroy&&this.editor.destroy();this.destroyHighlighter();this.callParent(arguments)},destroyHighlighter:function(){var a=this;a.clearSelection();if(a.editor&&a.editor.el&&!a.schedulingView.destroyed){a.schedulingView.getSecondaryCanvasEl().appendChild(a.editor.el);a.editor.hide()}if(a.containerEl){a.containerEl.destroy();delete a.containerEl}a.context={};a.position={}},onGroupCollapse:function(){var a=this;if(a.getResourceIndex()===-1){a.destroyHighlighter()}else {a.refreshCell()}},onGroupExpand:function(){this.refreshCell()},onViewScroll:function(){var a=this;if(a.containerEl){var b=a.schedulingView.getNodeByRecord(a.getPosition().resource);if(b){a.containerEl.setY(Ext.fly(b).getY()-1)}}},onItemAdd:function(){var a=this,b=a.getPosition().resource;if(b){var c=a.schedulingView.getNodeByRecord(b);if(c){a.containerEl.show()}else {a.containerEl.hide()}}},getResourceIndex:function(a){var b=this;a=a||b.getPosition().resource;return b.schedulingView.indexOf(a)},getResource:function(a){return this.schedulingView.dataSource.getAt(a)},onResourceAdd:function(b,a){this.refreshCell()},onResourceRemove:function(c,b){var a=this;if(c.getCount()===0||Ext.Array.indexOf(b,a.getPosition().resource)!==-1){a.destroyHighlighter()}else {a.refreshCell()}},onBeforeReconfigure:function(b){var a=this.getPosition();if(!this.startDate&&Ext.isNumber(a.tickIndex)){this.startDate=b.getAt(a.tickIndex).getStartDate()}},onLockedCellClick:function(c,f,d,e,g,a,b){this.showEditorInCell({tickIndex:this.getPosition().tickIndex||0,resourceIndex:a},b)},onBeforeItemKeyDown:function(b,c,e,d,a){if(!a.isSpecialKey()){this.beginEdit()}},onViewModelUpdate:function(c){var a=this,d=c.timeAxis;if(a.startDate){var b=d.getTickFromDate(a.startDate);if(b>=0){delete a.startDate;a.position.tickIndex=b;if(!a.containerEl){a.renderElement()}a.refreshCell()}else {a.destroyHighlighter()}}else {a.refreshCell()}},refreshCell:function(){var a=this;var b=a.timeAxisViewModel.getTickWidth();if(a.containerEl){a.containerEl.setWidth(b);a.containerEl.setLeft(b);a.showEditorInCell({tickIndex:a.getPosition().tickIndex,resourceIndex:a.getResourceIndex()})}if(a.editor instanceof Ext.form.field.Base){a.editor.setMaxWidth(b)}},clearSelection:function(){var a=this;if(a.schedulingView.rendered){a.schedulingView.getSecondaryCanvasEl().select('.'+a.frameCls+'.sch-cellplugin-clone').remove()}a.selContext=[]},addSelection:function(){var a=this;var b=a.frameTemplate.apply({cls:[a.frameCls,'sch-cellplugin-clone'].join(' '),width:a.containerEl.getWidth(),height:a.containerEl.getHeight()});b=Ext.get(Ext.dom.Helper.append(a.containerEl.parent(),b));b.setStyle('top',a.containerEl.getStyle('top'));b.setStyle('left',a.containerEl.getStyle('left'));a.selContext.push(Ext.apply({},a.context))},applyVisibilityMode:function(a){a.setVisibilityMode(Ext.dom.Element.OFFSETS)},renderElement:function(){var a=this;var c=a.timeAxisViewModel.getTickWidth();var b=a.timeAxisViewModel.getViewRowHeight();var e=a.frameTemplate.apply({cls:[a.frameCls,a.activeCls].join(' '),width:c,height:b});a.containerEl=Ext.get(Ext.DomHelper.append(a.schedulingView.getSecondaryCanvasEl(),e));a.applyVisibilityMode(a.containerEl);var d={height:b,maxHeight:b,width:c,maxWidth:c,listeners:{render:function(b){a.applyVisibilityMode(b.el)}},renderTo:a.containerEl};if(Ext.isObject(a.editor)&&!(a.editor instanceof Ext.Base)){a.editor=Ext.create(Ext.apply(d,a.editor,{xclass:'Sch.field.CellEditor'}))}else {if(typeof a.editor==='string'){a.editor=Ext.create(a.editor,d)}else {a.containerEl.appendChild(a.editor.el);a.applyVisibilityMode(a.editor.el)}}a.editor.inputEl.setStyle({height:b-3+'px',minHeight:b-3+'px'})},onContainerClick:function(){var a=this;if(a.lockedView.getSelectionModel().getSelection().length>0){if(a.editor.isVisible&&a.editor.isVisible()){a.editor.focus()}}},onCellClick:function(){this.handleSingleClickTask.delay(this.dblClickTimeout,null,null,arguments)},handleCellClick:function(g,d,c,f,e){var a=this;var b=Math.floor(a.schedulingView.timeAxis.getTickFromDate(d));if(a.fireEvent('cellclick',a,b,c)!==!1){a.showEditorInCell({tickIndex:b,resourceIndex:c},e);if(a.singleClickEditing){a.beginEdit()}}},onCellDblClick:function(d,c,b,a,e){this.handleSingleClickTask.cancel();this.handleCellDblClick(d,c,b,a,e)},handleCellDblClick:function(g,d,c,f,e){var a=this;var b=Math.floor(a.schedulingView.timeAxis.getTickFromDate(d));if(a.fireEvent('celldblclick',a,b,c)!==!1){a.showEditorInCell({tickIndex:b,resourceIndex:c},e);a.beginEdit()}},onEventClick:function(g,b,c){var a=this;var d=a.schedulingView.getDateFromDomEvent(c);var e=Math.floor(a.schedulingView.timeAxis.getTickFromDate(d));var f=a.getResourceIndex(b.getResource());a.showEditorInCell({tickIndex:e,resourceIndex:f,eventRecord:b},c)},onEventDblClick:function(g,b,c){var a=this;var d=a.schedulingView.getDateFromDomEvent(c);var e=Math.floor(a.schedulingView.timeAxis.getTickFromDate(d));var f=a.getResourceIndex(b.getResource());a.showEditorInCell({tickIndex:e,resourceIndex:f,eventRecord:b},c);a.beginEdit()},showEditorInCell:function(b,c){var a=this;if(b.tickIndex===-1||b.resourceIndex===-1){return}if(!b.isCellContext){b=a.getEventOrCell(b)}var e=b.startDate,g=b.endDate,h=b.resourceIndex,f=b.resource,d=b.eventRecord;if(c&&c.type==='click'&&!d){b.eventRecord=d=a.getCellEvents(b).getAt(0)}if(a.fireEvent('beforeselect',a,f,e,g,d)===!1){return}a.onBeforeSelect(c);if(!a.containerEl){a.renderElement()}else {if(c&&c.ctrlKey){a.addSelection()}else {a.clearSelection()}}a.setPosition(b);a.alignEditor();a.onAfterSelect(c);a.fireEvent('select',a,f,e,g);a.fireEvent('selectionchange',a,a.getSelection())},getContextFromPosition:function(a){var b={startDate:a.startDate,endDate:a.endDate,resource:a.resource};if(a.eventRecord){b.eventRecord=a.eventRecord}return b},getPosition:function(){return Ext.apply({},this.position)},setPosition:function(b){var a=this;a.context=a.getContextFromPosition(b);Ext.apply(a.position,b)},stripPosition:function(a){return {tickIndex:a.tickIndex,resourceIndex:a.resourceIndex}},alignEditor:function(){var b=this.getPosition(),a=b.eventRecord;if(a){this.alignEditorWithRecord(a,b.resource)}else {this.alignEditorWithCell()}},alignEditorWithRecord:function(d,c){var b=this;var e=b.schedulingView.getElementsFromEventRecord(d,c),a=e[0].getBox();a.y--;a.x--;b.alignEditorToBox(a)},alignEditorWithCell:function(){var a=this,c=a.getPosition();var b=Ext.get(a.schedulingView.getRow(c.resource));b&&a.alignEditorToBox({left:a.timeAxisViewModel.getTickWidth()*c.tickIndex,y:b.getTop()-1,height:b.getHeight()+1,width:a.timeAxisViewModel.getTickWidth()})},alignEditorToBox:function(a){var b=this;b.containerEl.setY(a.y);if('x' in a){b.containerEl.setX(a.x)}else {b.containerEl.setLeft(a.left)}b.containerEl.setWidth(a.width);b.containerEl.setHeight(a.height);b.containerEl.show()},getSelection:function(){return this.selContext.concat(this.context)},getEventRecord:function(a){return (a||this.context).eventRecord},getResourceRecord:function(a){return (a||this.context).resource},onKeyUp:function(a){this.moveUp(a)},onKeyDown:function(a){this.moveDown(a)},onKeyLeft:function(a){this.moveLeft(a)},onKeyRight:function(a){this.moveRight(a)},onKeyTab:function(a){if(a.shiftKey){this.moveLeft(a)}else {this.moveRight(a)}},onKeyEnter:function(){this.beginEdit()},onKeyEsc:function(){this.destroyHighlighter()},findPreviousIndex:function(){var a=this,c=a.getPosition();var b=a.schedulingView.walkRecs(c.resource,-1);if(b!==c.resource){return a.getResourceIndex(b)}else {return -1}},findNextIndex:function(){var a=this,c=a.getPosition();var b=a.schedulingView.walkRecs(c.resource,1);if(b!==c.resource){return a.getResourceIndex(b)}else {return -1}},getCellEvents:function(a){var d=this,b=d.schedulingView;a=a||d.getPosition();if(a.resourceIndex===-1||a.tickIndex===-1){return new Ext.util.MixedCollection()}var c=b.getEventStore().queryBy(function(b){return b.getResourceId()===a.resource.getId()&&b.getStartDate()>=a.startDate&&b.getStartDate()<a.endDate});c.sortBy(function(e,f){var c=b.getElementsFromEventRecord(e,a.resource)[0],d=b.getElementsFromEventRecord(f,a.resource)[0];return c.getY()<d.getY()?-1:1});return c},getAbove:function(a){var b=this;a=a||b.getPosition();if(a.eventRecord){var e=b.getCellEvents(a);var f=e.indexOf(a.eventRecord);if(f>0){var d=f-1;return {tickIndex:a.tickIndex,resourceIndex:a.resourceIndex,eventIndexInCell:d,eventRecord:e.getAt(d)}}}var c=b.findPreviousIndex();if(c===-1){return {resourceIndex:-1}}return b.getEventOrCell({tickIndex:a.tickIndex,resourceIndex:c},!0)},getBelow:function(a){var b=this;a=a||b.getPosition();if(a.eventRecord){var d=b.getCellEvents(a);var f=d.indexOf(a.eventRecord);var c=f+1;if(f>=0&&d.getCount()>c){return {tickIndex:a.tickIndex,resourceIndex:a.resourceIndex,eventIndexInCell:c,eventRecord:d.getAt(c)}}}var e=b.findNextIndex();if(e===-1){return {resourceIndex:-1}}return b.getEventOrCell({resourceIndex:e,tickIndex:a.tickIndex})},getEventOrCell:function(a,j){var k=this;if(a.tickIndex===-1||a.resourceIndex===-1){return a}var i=this.schedulingView,h=i.timeAxis.getAt(a.tickIndex),e=h.getStartDate(),g=h.getEndDate(),f=i.dataSource.getAt(a.resourceIndex),c=a.eventRecord,b=a.eventIndexInCell;var d=k.getCellEvents({resource:f,startDate:e,endDate:g});if(d.getCount()){if(j===!0){b=d.getCount()-1;c=d.getAt(b)}else {if(c){b=Ext.Array.indexOf(d,c)}else {b=0;c=d.getAt(0)}}}return {tickIndex:a.tickIndex,startDate:e,endDate:g,resourceIndex:a.resourceIndex,resource:f,eventRecord:c,eventIndexInCell:b,isCellContext:!0}},getPrevious:function(b){var a=this;b=a.stripPosition(b||a.getPosition());if(b.tickIndex>0){return a.getEventOrCell({tickIndex:b.tickIndex-1,resourceIndex:b.resourceIndex})}else {return a.getEventOrCell({tickIndex:a.getNbrOfTicks()-1,resourceIndex:a.findPreviousIndex()})}},getNext:function(b){var a=this;b=a.stripPosition(b||a.getPosition());if(b.tickIndex<a.getNbrOfTicks()-1){return a.getEventOrCell({tickIndex:b.tickIndex+1,resourceIndex:b.resourceIndex})}else {return a.getEventOrCell({tickIndex:0,resourceIndex:a.findNextIndex()})}},moveUp:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getAbove(),b)},moveDown:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getBelow(),b)},moveLeft:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getPrevious(),b)},moveRight:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getNext(),b)},editNext:function(d){var b=this,c=b.getPosition(),a=b.getNext(c);while(!b.beginEdit(a)&&a.resourceIndex!==-1){c=a;a=b.getNext(c)}},editPrevious:function(d){var b=this,c=b.getPosition(),a=b.getPrevious(c);while(!b.beginEdit(a)&&a.resourceIndex!==-1){c=a;a=b.getPrevious(c)}},expandResourceRow:function(d,a,c){var b=this;Ext.fly(d).setHeight(a.height+c);Ext.fly(b.lockedView.getNodeByRecord(b.getPosition().resource)).setHeight(a.height+c);b.__oldHeight=a.height},getNewBottomEditorCoordinate:function(f){var a=this,g=a.getCellEvents().last();if(g){var e=a.getPosition(),h=a.schedulingView,c=h.getNodeByRecord(e.resource),b=Ext.fly(c).getBox(),d=h.getElementsFromEventRecord(g,e.resource)[0].getBox();if(Math.abs(d.bottom-b.bottom)<f-1){a.expandResourceRow(c,b,f);return b.bottom}else {return d.bottom}}},collapseResourceRow:function(){var a=this;if(a.__oldHeight){var b=a.getPosition();Ext.fly(a.schedulingView.getNodeByRecord(b.resource)).setHeight(a.__oldHeight);Ext.fly(a.lockedView.getNodeByRecord(b.resource)).setHeight(a.__oldHeight);delete a.__oldHeight}},beginEditBelow:function(){var a=this;if(!a.containerEl){return}delete a.context.eventRecord;a.beginEdit();var b=a.timeAxisViewModel.getViewRowHeight();var c=a.getNewBottomEditorCoordinate(b);a.alignEditorToBox({left:a.timeAxisViewModel.getTickWidth()*a.getPosition().tickIndex,y:c,width:a.timeAxisViewModel.getTickWidth(),height:b})},beginEdit:function(b){var a=this;if(!a.containerEl||b&&b.resourceIndex===-1){return !1}if(a.fireEvent('beforecelledit',a,b?[a.getContextFromPosition(b)]:a.getSelection())===!1){return !1}if(b){a.showEditorInCell(b)}a.editing=!0;a.editor.startDate=a.getPosition().startDate;a.editor.bottomUnit=Sch.util.Date.getSubUnit(a.timeAxisViewModel.getBottomHeader().unit);a.containerEl.select('.sch-cellplugin-border').hide();a.containerEl.addCls(a.editingCls);var c=a.getEventRecord(),g=a.getResourceRecord();if(c){var e=Ext.Date;var d=Ext.isArray(a.editor.dateFormat)?a.editor.dateFormat[0]:a.editor.dateFormat;var f=e.format(c.getStartDate(),d);var h=e.format(c.getEndDate(),d);a.editor.record=c;a.editor.setValue([f,h].join(a.editor.divider));a.editor.recordNode=a.schedulingView.getElementsFromEventRecord(c,g)[0];Ext.fly(a.editor.recordNode).hide()}a.editor.show();a.editor.setWidth(a.editor.getMaxWidth());a.editor.focus();a.fireEvent('begincelledit',a,a.getSelection());return a.editing},cancelEdit:function(){var a=this;if(a.editor&&a.editor.getValue){var c=a.editor.getValue();var b=a.getSelection();if(a.fireEvent('beforecancelcelledit',a,c,b)===!1){return}a.stopEditing();a.fireEvent('cancelcelledit',a,c,b)}},completeEdit:function(){var a=this,e=!1;if(!a.editing||!a.containerEl){return}var b=a.editor,c=a.editor.getValue(),g=a.getSelection();if(a.fireEvent('beforecompletecelledit',a,c,g)===!1){return}if(c&&b.isValid()){var d=a.schedulingView,k=b.record,l=b.getDates(c),h=l[0],j=l[1];if(k){k.setStartEndDate(h,j);delete b.record}else {var i=a.context.resource,f=Ext.create(d.getEventStore().getModel(),{StartDate:h,EndDate:j,ResourceId:i.getId()});d.onEventCreated(f,[i]);d.getEventStore().add(f)}e=!0}a.stopEditing();a.fireEvent('completecelledit',a,c,g);return e},stopEditing:function(){var a=this,b=a.editor;if(b.recordNode){Ext.fly(b.recordNode).show();delete b.recordNode}a.collapseResourceRow();b.setValue('');a.editing=!1;a.clearSelection();a.containerEl.select('.sch-cellplugin-border').show();a.containerEl.removeCls(a.editingCls);b.hide();var c=a.lockedView.getRow(a.getPosition().resource);c&&Ext.fly(c).down(a.lockedView.getCellSelector()).focus()},onBeforeSelect:function(a){var b=this;a&&a.isNavKeyPress&&a.isNavKeyPress()&&b.clearSelection();b.completeEdit()},onAfterSelect:function(c){var a=this,b=a.getPosition().resource;a.lockedView.getSelectionModel().select(b);Ext.fly(a.lockedView.getRow(b)).down(a.lockedView.getCellSelector()).focus();a.editor.setValue('');a.containerEl.scrollIntoView(a.schedulingView.getEl())},bindResourceStore:function(b,c){if(b){var a=this;a[c?'mun':'mon'](b,{add:a.onResourceAdd,remove:a.onResourceRemove,clear:a.destroyHighlighter,scope:a})}},bindEventStore:function(b,c){if(b){var a=this;a[c?'mun':'mon'](b,{load:a.destroyHighlighter,scope:a})}}});Ext.define('Sch.plugin.DragSelector',{extend:'Sch.util.DragTracker',alias:'plugin.scheduler_dragselector',mixins:['Ext.AbstractPlugin'],requires:['Sch.util.ScrollManager'],lockableScope:'top',schedulerView:null,eventBoxes:null,sm:null,proxy:null,bodyRegion:null,constructor:function(a){a=a||{};Ext.applyIf(a,{onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.callParent(arguments)},bindListenersOnDragStart:function(){var a=this.getCmp().getScrollable().getElement();a&&a.on('scroll',this.onScroll,this);this.callParent(arguments)},unbindListenersOnDragEnd:function(){var a=this.getCmp().getScrollable().getElement();a&&a.un('scroll',this.onScroll,this);this.callParent(arguments)},init:function(a){this.setCmp(a);var b=this.schedulerView=a.getSchedulingView();b.on({afterrender:this.onSchedulingViewRender,scope:this})},onScroll:function(a){this.updateEventNodeBoxes();this.onMouseMove.apply(this,arguments)},onBeforeStart:function(a){return !a.getTarget('.sch-event')&&a.ctrlKey},onStart:function(b){var a=this.schedulerView;this.proxy.show();this.bodyRegion=a.getScheduleRegion();this.eventBoxes={};this.updateEventNodeBoxes();this.sm.deselectAll();Sch.util.ScrollManager.activate(a);a.on('bufferedrefresh',this.updateSelection,this);this.mon(a.getScrollable(),'scroll',this.onSchedulerViewScroll,this)},onSchedulerViewScroll:function(){this.updateEventNodeBoxes();this.updateSelection()},updateEventNodeBoxes:function(){var b=this,a=this.schedulerView;a.getEventNodes().each(function(c){var d=c.getRegion();b.eventBoxes[c.dom.id]={eventRecord:a.getEventRecordFromDomElement(c.dom),region:d,node:c.dom}})},onDrag:function(){var a=this.getRegion().constrainTo(this.bodyRegion);this.proxy.setBox(a);this.updateSelection()},getCurrentScroll:function(){return this.schedulerView.getScroll()},updateSelection:function(){var a=this.sm,d=this.eventBoxes,c=this.getRegion(),b;Ext.Object.getValues(d).forEach(function(d){var e=d.eventRecord;b=c.intersect(d.region);if(b&&!a.isSelected(e)){a.selectNode(d.node,!0)}else {if(!b&&a.isSelected(e)){a.deselectNode(d.node)}}})},onEnd:function(a){if(this.proxy){this.proxy.setDisplayed(!1)}this.schedulerView.un('bufferedrefresh',this.updateSelection,this);this.mun(this.schedulerView.getScrollable(),'scroll',this.onSchedulerViewScroll,this);Sch.util.ScrollManager.deactivate()},onSchedulingViewRender:function(a){this.sm=a.getEventSelectionModel();this.initEl(this.schedulerView.el);this.proxy=a.el.createChild({cls:'sch-drag-selector'})},destroy:function(){if(this.proxy){Ext.destroy(this.proxy)}this.callParent(arguments)}});Ext.define('Sch.plugin.mixin.Editor',{extend:'Ext.Mixin',mixinConfig:{before:{showRecord:'beforeShowRecord',hide:'beforeEditorHide'},after:{showRecord:'afterShowRecord'}},hideOnBlur:!0,saveAndCloseOnEnter:!0,triggerEvent:'eventdblclick',record:null,dragProxyEl:null,ignoreCls:'sch-event-editor-ignore-click',ignoreCheckMaxDepth:30,lockableScope:'normal',width:400,initEditor:function(){var a=this;var b=a.getCmp();var c=a.getEventEditor();c.saveOnEnter=a.saveAndCloseOnEnter;c.allowOverlap=b.allowOverlap===undefined?!0:b.allowOverlap;var d=c.getRecurringEvents&&c.getRecurringEvents();c.setRecurringEvents&&c.setRecurringEvents(d!==!1&&b.recurringEvents!==!1);a.setEventStore(b.getEventStore());a.setResourceStore(b.getResourceStore());if(b.rendered){a.onCmpAfterRender()}else {a.mon(b,'afterrender',a.onCmpAfterRender,a)}a.mon(b,{dragcreateend:a.onDragCreateEnd,eventstorechange:a.onCmpEventStoreChange,resourcestorechange:a.onCmpResourceStoreChange,scope:a});a.mon(c,{aftereventadd:a.onAfterEventAdd,aftereventsave:a.onAfterEventSave,aftereventdelete:a.onAfterEventDelete,scope:a});a.on('hide',a.hideDragProxy,a);if(a.triggerEvent){a.mon(b,a.triggerEvent,a.onActivateEditor,a)}},beforeShowRecord:function(c,b){var a=this;a.addRepaintListener();a.show()},addRepaintListener:function(){var a=this;var b=a.getCmp();if(b.isSchedulerGrid||b.isSchedulerTree){a.eventRepaintListener=a.mon(b.getSchedulingView(),'eventrepaint',a.onEventRepaint,a,{destroyable:!0})}},afterShowRecord:function(d,c){var a=this;var b=a.getCmp();var e=b&&b.isReadOnly&&b.isReadOnly();var f=a.getEventEditor();a.setRecord(d);a.alignEditorToElement(Ext.isObject(c)&&c.alignToEl);f.loadRecord(d,e)},beforeEditorHide:function(c,b){var a=this;a.eventRepaintListener&&a.eventRepaintListener.destroy()},setEventStore:function(b){var c=this;var a=c.getEventEditor();a.setEventStore(b)},setResourceStore:function(b){var c=this;var a=c.getEventEditor();a.setResourceStore(b)},getEventEditor:function(){return this.isEventEditor?this:this.editor},onAfterEventAdd:function(b,a){if(b.scrollNewEventIntoView&&a.getResources().length<2){this.scrollEventIntoView(a)}},onAfterEventSave:function(b,a){this.hideEditor()},scrollEventIntoView:function(a){this.getCmp().getSchedulingView().scrollEventIntoView(a)},onCmpEventStoreChange:function(b,a){this.setEventStore(a)},onCmpResourceStoreChange:function(b,a){this.setResourceStore(a)},onAfterEventDelete:function(){this.hideEditor()},onCmpAfterRender:function(){var a=this;if(!a.isWindow){a.render(document.body)}if(a.hideOnBlur){a.mon(Ext.getDoc(),'mousedown',a.mouseDownAction,a)}a.registerEditorInComponent()},registerEditorInComponent:function(){var a=this;var b=a.getCmp();b.getSchedulingView().registerEventEditor(a)},onDragCreateEnd:function(k,f,a,e,b){var c=this;var h=c.getCmp();var i=c.getEventEditor();var g=[];if(a&&a.isResourceModel){i.resourceRecord=a;g=[a]}if(h.onEventCreated){h.onEventCreated(f,g)}var j=b||e.getTarget&&e.getTarget()||e.target||null;c.showRecord(f,{alignToEl:j});if(b){var d=b.dom.cloneNode(!0);d.id='';b.dom.parentNode.appendChild(d);c.dragProxyEl=Ext.get(d)}},addIgnoreCls:function(){var a=this,c=a.getEventEditor(),b=c.getFloatingComponents();Ext.Array.each(b,function(b){b.addCls(a.ignoreCls)})},mouseDownAction:function(a){if(this.isVisible()&&!this.isEventWithinComponent(a)){this.hideEditor()}},isEventWithinComponent:function(a){return a.within(this.getEl())||!!a.getTarget('.'+this.ignoreCls,this.ignoreCheckMaxDepth)||!!a.getTarget('.'+Ext.baseCSSPrefix+'mask',1)},onActivateEditor:function(f,b,e){var d=this;var a=d.getSelectorToAlignEditorBy();var c=e.getTarget(a);this.showRecord(b,{alignToEl:c})},getSelectorToAlignEditorBy:function(){var c=this;var a=c.getCmp();var b=a.getSchedulingView&&a.getSchedulingView()&&a.getSchedulingView().eventCls;return b?'.'+b:null},hideDragProxy:function(){var a=this.dragProxyEl;if(a&&a.dom.parentNode){a.dom.parentNode.removeChild(a.dom);delete this.dragProxyEl}},hideEditor:function(){this.hide()},setRecord:function(a){this.record=a},getRecord:function(){return this.record}});Ext.define('Sch.widget.mixin.CustomizableRecordForm',{extend:'Ext.Mixin',isCustomizableRecordForm:!0,customizableFieldNames:null,mixinConfig:{id:'customizableRecordForm',before:{loadRecord:'beforeCustomizableRecordLoad',updateRecord:'beforeCustomizableRecordUpdate'},after:{updateRecord:'afterCustomizableRecordUpdate'}},updateAllFields:!1,renameCustomizableFieldNamesOnce:!0,customizableFieldNamesRenamed:0,autogeneratedFieldsToRemove:null,setupCustomizableRecordForm:function(e,c){var d=this;d.customizableFieldNames={};if(c){var b=c.prototype;for(var a in b){if(a.match(/Field$/)&&typeof b[a]=='string'){d.customizableFieldNames[a]=b[a]}}}},extractCustomizableFieldNames:function(b){var a;if(b){a={};for(var c in this.customizableFieldNames){a[c]=b[c]}}return a},beforeCustomizableRecordLoad:function(a){if(!this.renameCustomizableFieldNamesOnce||!this.customizableFieldNamesRenamed){this.renameCustomizableFieldNames(a)}},renameCustomizableFieldNames:function(e){var a=this.extractCustomizableFieldNames(e);if(a){this.customizableFieldNamesRenamed++;var f=this.getForm(),d=!1,b;for(var c in this.customizableFieldNames){b=f.findField(this.customizableFieldNames[c]);if(b&&a[c]&&a[c]!=b.name){d=!0;b.name=a[c]}}if(d){this.customizableFieldNames=a}}},buildMissingCustomizableRecordField:function(a,b){return Ext.create(Ext.apply({xtype:'hiddenfield',name:a},b))},addMissingCustomizableRecordFields:function(){var a=this,f=a.getForm().getFieldValues(),c=Ext.Object.getValues(a.customizableFieldNames),e=[];for(var b=0;b<c.length;b++){var d=c[b];if(!f.hasOwnProperty(d)){e.push(a.add(a.buildMissingCustomizableRecordField(d)))}}return e},beforeCustomizableRecordUpdate:function(){var a=this;if(a.updateAllFields){a.autogeneratedFieldsToRemove=a.addMissingCustomizableRecordFields()}},afterCustomizableRecordUpdate:function(){var a=this;if(a.autogeneratedFieldsToRemove){var c=a.autogeneratedFieldsToRemove;for(var b=0;b<c.length;b++){a.remove(c[b])}}}});Ext.define('Sch.widget.recurrence.field.FrequencyComboBox',{extend:'Ext.form.field.ComboBox',alias:'widget.frequencycombo',mixins:['Sch.mixin.Localizable'],tpl:['<ul class="'+Ext.baseCSSPrefix+'list-plain">','<tpl for=".">','<li class="'+Ext.baseCSSPrefix+'boundlist-item {cls}">{text}</li>','</tpl>','</ul>'],listConfig:{htmlEncode:!0},editable:!1,queryMode:'local',displayField:'text',valueField:'name',initComponent:function(){var a=this;this.emptyText=a.localizeText(this.emptyText);a.store=a.store||{fields:['name','text','cls'],data:a.buildOptions()};a.callParent(arguments)},buildOptions:function(){var a=this;return [['DAILY',a.L('Daily')],['WEEKLY',a.L('Weekly')],['MONTHLY',a.L('Monthly')],['YEARLY',a.L('Yearly')]]}});Ext.define('Sch.widget.recurrence.field.RecurrenceComboBox',{extend:'Sch.widget.recurrence.field.FrequencyComboBox',alias:'widget.recurrencecombo',allowBlank:!1,emptyText:'L{None}',customValue:'custom',splitCls:'sch-recurrencecombo-split',listConfig:{htmlEncode:!0},buildOptions:function(){var a=this,b=a.callParent(arguments);b.unshift([null,a.L('None')]);b.push([a.customValue,a.L('Custom...'),a.splitCls]);return b},setRecurrence:function(b){var a=this;if(b){a.setValue(a.isCustomRecurrence(b)?a.customValue:b.getFrequency())}else {a.setValue([null])}},isCustomRecurrence:function(a){var e=a.getInterval(),d=a.getDays(),b=a.getMonthDays(),c=a.getMonths();return Boolean(e!=1||d&&d.length||b&&b.length||c&&c.length)}});Ext.define('Sch.widget.recurrence.LegendButton',{extend:'Ext.button.Button',requires:['Sch.data.util.recurrence.Legend'],alias:'widget.recurrencelegendbutton',recurrence:null,eventStartDate:null,initComponent:function(){this.callParent(arguments);this.setRecurrence(this.recurrence)},setRecurrence:function(a){this.recurrence=a;this.refreshLegend()},setEventStartDate:function(a){this.eventStartDate=a;this.refreshLegend()},refreshLegend:function(){var a=this,b=a.recurrence;a.setText(b?Sch.data.util.recurrence.Legend.getLegend(b,a.eventStartDate):'')}});Ext.define('Sch.widget.recurrence.field.PositionsComboBox',{extend:'Ext.form.field.ComboBox',requires:['Ext.data.StoreManager','Ext.data.ArrayStore'],mixins:['Sch.mixin.Localizable'],alias:'widget.positionscombobox',tpl:['<ul class="'+Ext.baseCSSPrefix+'list-plain">','<tpl for=".">','<li class="'+Ext.baseCSSPrefix+'boundlist-item {cls}">{text}</li>','</tpl>','</ul>'],splitCls:'sch-recurrenceformpositions-split',listConfig:{htmlEncode:!0},editable:!1,queryMode:'local',displayField:'text',valueField:'name',allowBlank:!1,maxPosition:5,defaultValue:'1',initComponent:function(){var a=this;a.value=a.value||a.defaultValue;a.store=a.store&&Ext.data.StoreManager.lookup(a.store)||new Ext.data.ArrayStore({fields:['name','text','cls'],data:a.buildDayNumbers().concat([['-1',a.L('position-1'),a.splitCls]])});a.callParent(arguments)},buildDayNumbers:function(){var c=this,b=[],a;for(a=1;a<=c.maxPosition;a++){b.push([a+'',c.L('position'+a)])}return b},setValue:function(a){var b=this;if(a&&Ext.isArray(a)){a=a.join(',')}if(a&&this.store.findExact('name',a)!==-1){this.callParent([a])}else {this.callParent([this.defaultValue])}},getValue:function(){var a=this.callParent(arguments);return a?Ext.Array.map(a.split(','),function(a){return parseInt(a,10)}):[]}});Ext.define('Sch.widget.recurrence.field.DaysComboBox',{extend:'Ext.form.field.ComboBox',requires:['Ext.data.StoreManager','Ext.data.ArrayStore','Ext.Date','Sch.data.util.recurrence.DayRuleEncoder'],mixins:['Sch.mixin.Localizable'],alias:'widget.dayscombo',tpl:['<ul class="'+Ext.baseCSSPrefix+'list-plain">','<tpl for=".">','<li class="'+Ext.baseCSSPrefix+'boundlist-item {cls}">{text}</li>','</tpl>','</ul>'],splitCls:'sch-recurrenceformdays-split',listConfig:{htmlEncode:!0,maxHeight:350},editable:!1,queryMode:'local',displayField:'text',valueField:'name',allowBlank:!1,weekStartDay:1,dayNames:null,defaultValue:null,allDaysValue:'SU,MO,TU,WE,TH,FR,SA',workingDaysValue:'MO,TU,WE,TH,FR',nonWorkingDaysValue:'SU,SA',initComponent:function(){var a=this;a.defaultValue=a.defaultValue||a.allDaysValue;a.value=a.value||a.defaultValue;a.dayNames=a.dayNames||Ext.Date.dayNames.slice(a.weekStartDay).concat(Ext.Date.dayNames.slice(0,a.weekStartDay));a.store=a.store&&Ext.data.StoreManager.lookup(a.store)||new Ext.data.ArrayStore({fields:['name','text','cls'],data:a.buildOptions()});a.callParent(arguments)},buildOptions:function(){var a=this;return a.buildWeekDays().concat([[a.allDaysValue,a.L('day'),a.splitCls],[a.workingDaysValue,a.L('weekday')],[a.nonWorkingDaysValue,a.L('weekend day')]])},buildWeekDays:function(){var a=this;return Ext.Array.map(a.dayNames,function(d,c){var b=(c+a.weekStartDay)%a.dayNames.length;return [Sch.data.util.recurrence.DayRuleEncoder.encodeDay(b),d]})},setValue:function(a){var b=this;if(a&&Ext.isArray(a)){a=a.join(',')}if(a&&this.store.findExact('name',a)!==-1){this.callParent([a])}else {this.callParent([this.defaultValue])}},getValue:function(){var a=this.callParent(arguments);return a?a.split(','):[]}});Ext.define('Sch.widget.recurrence.field.DaysSegmentedButton',{extend:'Sch.field.SegmentedButton',alias:'widget.dayssegmentedbutton',allowBlank:!1,margin:'0 0 10 0',weekStartDay:0,initComponent:function(){var a=this;a.dayNames=Ext.Date.dayNames.slice(a.weekStartDay).concat(Ext.Date.dayNames.slice(0,a.weekStartDay));a.items=a.buildItems();a.callParent(arguments)},buildItems:function(){var a=this;return Ext.Array.map(a.dayNames,function(d,c){var b=(c+a.weekStartDay)%a.dayNames.length;return {text:d.substring(0,3),value:Sch.data.util.recurrence.DayRuleEncoder.encodeDay(b)}})}});Ext.define('Sch.widget.recurrence.field.MonthDaysSegmentedButton',{extend:'Sch.field.SegmentedButton',alias:'widget.monthdayssegmentedbutton',allowBlank:!1,margin:'0 0 10 0',columns:7,initComponent:function(){var a=this;a.items=a.buildItems();a.callParent(arguments)},buildItems:function(){var b=[],a;for(a=1;a<=Ext.Date.MAX_DAYS_IN_MONTH;a++){b.push({text:a+'',value:a})}return b}});Ext.define('Sch.widget.recurrence.field.MonthsSegmentedButton',{extend:'Sch.field.SegmentedButton',alias:'widget.monthssegmentedbutton',allowBlank:!1,margin:'0 0 10 0',columns:4,initComponent:function(){var a=this;a.items=a.buildItems();a.callParent(arguments)},buildItems:function(){var a=this;return Ext.Array.map(Ext.Date.monthNames,function(b,a){return {text:b.substring(0,3),value:a+1}})}});Ext.define('Sch.widget.recurrence.field.StopConditionComboBox',{extend:'Ext.form.field.ComboBox',alias:'widget.stopconditioncombo',mixins:['Sch.mixin.Localizable'],editable:!1,queryMode:'local',displayField:'text',valueField:'name',allowBlank:!1,listConfig:{htmlEncode:!0},initComponent:function(){var a=this;a.store=a.store||{fields:['name','text'],data:a.buildOptions()};a.addCls('sch-combo-with-no-value');a.callParent(arguments)},buildOptions:function(){var a=this;return [[null,a.L('Never')],['count',a.L('After')],['date',a.L('On date')]]},setRecurrence:function(b){var a=null;if(b.getEndDate()){a='date'}else {if(b.getCount()){a='count'}}this.setValue([a])}});Ext.define('Sch.widget.recurrence.Form',{extend:'Ext.form.Panel',requires:['Ext.layout.container.HBox','Ext.layout.container.VBox','Ext.form.field.Display','Ext.form.field.Number','Ext.form.field.Radio','Sch.model.Recurrence','Sch.widget.recurrence.field.FrequencyComboBox','Sch.widget.recurrence.field.PositionsComboBox','Sch.widget.recurrence.field.DaysComboBox','Sch.widget.recurrence.field.DaysSegmentedButton','Sch.widget.recurrence.field.MonthDaysSegmentedButton','Sch.widget.recurrence.field.MonthsSegmentedButton','Sch.widget.recurrence.field.StopConditionComboBox'],mixins:['Sch.widget.mixin.CustomizableRecordForm','Sch.mixin.Localizable'],alias:'widget.recurrenceform',layout:{type:'vbox',align:'stretch'},trackResetOnLoad:!0,updateAllFields:!0,weekStartDay:1,dateFormat:'Y-m-d',radioFieldName:'radio',checkboxFieldName:'checkbox',recurrenceModel:null,frequencyField:null,intervalField:null,intervalUnit:null,daysButtonField:null,monthdaysButtonField:null,monthDaysRadioField:null,monthsButtonField:null,positionAndDayRadioField:null,positionAndDayCheckboxField:null,stopRecurrenceField:null,countField:null,countUnit:null,endDateField:null,positionsCombo:null,daysCombo:null,intervalContainer:null,positionDayContainer:null,countFieldContainer:null,initComponent:function(){var a=this;a.recurrenceModel=a.recurrenceModel||Sch.model.Recurrence;a.setupCustomizableRecordForm(a,a.recurrenceModel);a.items=a.buildItems();a.callParent(arguments)},buildItems:function(){var a=this;if(!a.frequencyField||!a.frequencyField.isInstance){a.frequencyField=Ext.create(Ext.apply({xtype:'frequencycombo',name:a.customizableFieldNames.frequencyField,fieldLabel:a.L('Frequency')},a.frequencyField));a.mon(a.frequencyField,'change',a.onFrequencyFieldChange,a)}if(!a.intervalField||!a.intervalField.isInstance){a.intervalField=Ext.create(Ext.apply({xtype:'numberfield',name:a.customizableFieldNames.intervalField,minValue:1,width:85,margin:'0 5 0 0',allowBlank:!1},a.intervalField))}if(!a.intervalUnit||!a.intervalUnit.isInstance){a.intervalUnit=Ext.create(Ext.apply({xtype:'displayfield',submitValue:!1},a.intervalUnit))}if(!a.daysButtonField||!a.daysButtonField.isInstance){a.daysButtonField=Ext.create(Ext.apply({xtype:'dayssegmentedbutton',name:a.customizableFieldNames.daysField,forFrequency:'WEEKLY'},a.daysButtonField))}if(!a.monthDaysRadioField||!a.monthDaysRadioField.isInstance){a.monthDaysRadioField=Ext.create(Ext.apply({xtype:'radiofield',name:a.radioFieldName,submitValue:!1,forFrequency:'MONTHLY',boxLabel:this.L('Each'),handler:a.togglePositionAndDayFields,scope:a},a.monthDaysRadioField))}if(!a.monthdaysButtonField||!a.monthdaysButtonField.isInstance){a.monthdaysButtonField=Ext.create(Ext.apply({xtype:'monthdayssegmentedbutton',name:a.customizableFieldNames.monthDaysField,forFrequency:'MONTHLY'},a.monthdaysButtonField))}if(!a.monthsButtonField||!a.monthsButtonField.isInstance){a.monthsButtonField=Ext.create(Ext.apply({xtype:'monthssegmentedbutton',name:a.customizableFieldNames.monthsField,forFrequency:'YEARLY'},a.monthsButtonField))}if(!a.positionAndDayRadioField||!a.positionAndDayRadioField.isInstance){a.positionAndDayRadioField=Ext.create(Ext.apply({xtype:'radiofield',name:a.radioFieldName,submitValue:!1,forFrequency:'MONTHLY',boxLabel:this.L('On the'),handler:a.togglePositionAndDayFields,scope:a},a.positionAndDayRadioField))}if(!a.positionAndDayCheckboxField||!a.positionAndDayCheckboxField.isInstance){a.positionAndDayCheckboxField=Ext.create(Ext.apply({xtype:'checkbox',name:a.checkboxFieldName,submitValue:!1,forFrequency:'YEARLY',boxLabel:this.L('On the'),handler:a.togglePositionAndDayFields,scope:a},a.positionAndDayCheckboxField))}if(!a.stopRecurrenceField||!a.stopRecurrenceField.isInstance){a.stopRecurrenceField=Ext.create(Ext.apply({xtype:'stopconditioncombo',submitValue:!1,fieldLabel:a.L('End repeat'),value:[null]},a.stopRecurrenceField));a.mon(a.stopRecurrenceField,'change',a.onStopRecurrenceFieldChange,a)}if(!a.countField||!a.countField.isInstance){a.countField=Ext.create(Ext.apply({xtype:'numberfield',name:a.customizableFieldNames.countField,minValue:2,allowBlank:!1,flex:1,margin:'0 5 0 0',disabled:!0},a.countField))}if(!a.countUnit||!a.countUnit.isInstance){a.countUnit=Ext.create(Ext.apply({xtype:'displayfield',value:a.L('time(s)'),submitValue:!1,flex:1,disabled:!0},a.countUnit))}if(!a.countFieldContainer||!a.countFieldContainer.isInstance){a.countFieldContainer=Ext.create(Ext.apply({xtype:'fieldcontainer',layout:'hbox',margin:0,hideEmptyLabel:!1,hidden:!0,items:[a.countField,a.countUnit]},a.countFieldContainer))}if(!a.endDateField||!a.endDateField.isInstance){a.endDateField=Ext.create(Ext.apply({xtype:'datefield',name:a.customizableFieldNames.endDateField,hidden:!0,disabled:!0,hideEmptyLabel:!1,allowBlank:!1,startDay:a.weekStartDay,format:a.dateFormat,altFormats:''},a.endDateField))}if(!a.intervalContainer||!a.intervalContainer.isInstance){a.intervalContainer=Ext.create(Ext.apply({xtype:'fieldcontainer',layout:'hbox',fieldLabel:a.L('Every'),margin:0,items:[a.intervalField,a.intervalUnit]},a.intervalContainer))}if(!a.positionsCombo||!a.positionsCombo.isInstance){a.positionsCombo=Ext.create(Ext.apply({xtype:'positionscombobox',name:a.customizableFieldNames.positionsField,forFrequency:'MONTHLY|YEARLY',flex:1,margin:'0 5 0 0'},a.positionsCombo))}if(!a.daysCombo||!a.daysCombo.isInstance){a.daysCombo=Ext.create(Ext.apply({xtype:'dayscombo',name:a.customizableFieldNames.daysField,forFrequency:'MONTHLY|YEARLY',weekStartDay:a.weekStartDay,flex:1},a.daysCombo))}if(!a.positionDayContainer||!a.positionDayContainer.isInstance){a.positionDayContainer=Ext.create(Ext.apply({xtype:'fieldcontainer',layout:'hbox',items:[a.positionsCombo,a.daysCombo]},a.positionDayContainer))}return [a.frequencyField,a.intervalContainer,a.daysButtonField,a.monthDaysRadioField,a.monthdaysButtonField,a.monthsButtonField,a.positionAndDayRadioField,a.positionAndDayCheckboxField,a.positionDayContainer,a.stopRecurrenceField,a.countFieldContainer,a.endDateField]},loadRecord:function(a){var b=this,f=this.callParent(arguments),e=a.getEvent(),c=e&&e.getStartDate();b.daysCombo.setValue(a.getDays());if(c){if(!a.getDays()||!a.getDays().length){this.daysButtonField.setValue([Sch.data.util.recurrence.DayRuleEncoder.encodeDay(c.getDay())])}if(!a.getMonthDays()||!a.getMonthDays().length){this.monthdaysButtonField.setValue(c.getDate())}if(!a.getMonths()||!a.getMonths().length){this.monthsButtonField.setValue(c.getMonth()+1)}}var d=Boolean(a.getDays()&&a.getPositions());b.monthDaysRadioField.setValue(!d);b.positionAndDayRadioField.setValue(d);b.positionAndDayCheckboxField.setValue(d);b.stopRecurrenceField.setRecurrence(a);return f},toggleStopFields:function(){var a=this;switch(a.stopRecurrenceField.getValue()){case 'count':a.countFieldContainer.show();a.countField.enable();a.countUnit.enable();a.endDateField.hide();a.endDateField.disable();break;case 'date':a.countFieldContainer.hide();a.countField.disable();a.countUnit.disable();a.endDateField.show();a.endDateField.enable();break;default:a.countFieldContainer.hide();a.endDateField.hide();a.countField.disable();a.countUnit.disable();a.endDateField.disable();}},togglePositionAndDayFields:function(){var a=this,c=a.frequencyField.getValue(),b=c=='MONTHLY'?!a.positionAndDayRadioField.getValue():!a.positionAndDayCheckboxField.getValue();a.daysCombo.setDisabled(b);a.positionsCombo.setDisabled(b);if(c=='MONTHLY'){a.monthdaysButtonField.setDisabled(!a.monthDaysRadioField.getValue())}},onFrequencyFieldChange:function(f,d){var b=this,e=b.query('[forFrequency]');for(var c=0;c<e.length;c++){var a=e[c];if(a.forFrequency.indexOf(d)>-1){a.show();a.enable()}else {a.hide();a.disable()}}b.intervalUnit.setValue(b.L(d+'intervalUnit'));b.togglePositionAndDayFields();b.toggleStopFields()},onStopRecurrenceFieldChange:function(a,b){this.toggleStopFields()}});Ext.define('Sch.widget.recurrence.Dialog',{extend:'Ext.window.Window',requires:['Ext.button.Button','Sch.model.Recurrence','Sch.widget.recurrence.Form'],alias:'widget.recurrencedialog',mixins:['Sch.mixin.Localizable'],border:!1,width:400,resizable:!1,modal:!0,recurrenceDialogCls:'sch-recurrencedialog',weekStartDay:1,dateFormat:'Y-m-d',form:null,recurrenceModel:null,saveHandler:null,cancelHandler:null,scope:null,title:'L{Repeat event}',initComponent:function(){var a=this;a.addCls(a.recurrenceDialogCls);a.title=a.localizeText(a.title);a.recurrenceModel=a.recurrenceModel||Sch.model.Recurrence;if(!a.form||!a.form.isInstance){a.form=Ext.create(Ext.apply({xtype:'recurrenceform',padding:'10 10 0 10',weekStartDay:a.weekStartDay,dateFormat:a.dateFormat,recurrenceModel:a.recurrenceModel,border:!1},a.form))}a.items=[a.form];a.buttons=a.buttons||[{xtype:'button',text:a.L('Save'),scope:a,handler:a.onSaveClick},{xtype:'button',text:a.L('Cancel'),scope:a,handler:a.onCancelClick}];a.callParent(arguments)},onSaveClick:function(){var a=this;if(a.saveHandler){a.saveHandler.call(a.scope||a,a,a.getRecord())}else {a.updateRecord();a.close()}},onCancelClick:function(){var a=this;if(a.cancelHandler){a.cancelHandler.call(a.scope||a,a,a.getRecord())}else {a.close()}},loadRecord:function(a){return this.form.loadRecord.apply(this.form,arguments)},updateRecord:function(a){return this.form.updateRecord.apply(this.form,arguments)},getRecord:function(a){return this.form.getRecord.apply(this.form,arguments)},getFloatingComponents:function(){var e=this,b=[],d=e.query('pickerfield'),a;for(a=0;a<d.length;a++){var f=d[a];f.getPicker()}var c=e.query('[floating]');if(Ext.isArray(c)){b=b.concat(c)}return b}});Ext.define('Sch.widget.recurrence.EventEditorMixin',{extend:'Ext.Mixin',requires:['Ext.form.field.Hidden','Sch.widget.recurrence.field.RecurrenceComboBox','Sch.widget.recurrence.LegendButton','Sch.widget.recurrence.Dialog','Sch.widget.RecurrenceConfirmation'],isRecurrableEventEditor:!0,recurrenceRule:null,recurrenceCombo:null,recurrenceLegendButton:null,recurrenceDialog:null,config:{recurringEvents:!0},onClassMixedIn:function(a){Ext.override(a,{getDefaultFields:function(){var a=this.callParent(arguments)||[];return a.concat(this.getRecurrableEventDefaultFields())},getFloatingComponents:function(){var a=this.callParent(arguments)||[];return a.concat(this.getRecurrableEventFloatingComponents())}})},setupRecurrableEventEditorMixin:function(b){var a=this;a.mon(b,{loadevent:a.onRecurrableEventLoad,beforeeventdelete:a.onRecurrableEventBeforeDelete,beforeeventsave:a.onRecurrableEventBeforeSave,destroy:a.onEditorDestroy,scope:b,priority:-100})},onEditorDestroy:function(){this.recurrenceDialog&&this.recurrenceDialog.destroy()},getRecurrableEventDefaultFields:function(){var a=this,b=[];if(a.recurringEvents!==!1){if(!a.recurrenceRule||!a.recurrenceRule.isInstance){a.recurrenceRule=Ext.create(Ext.apply({xtype:'hiddenfield',name:a.customizableFieldNames.recurrenceRuleField},a.recurrenceRule))}if(!a.recurrenceCombo||!a.recurrenceCombo.isInstance){a.recurrenceCombo=Ext.create(Ext.apply({xtype:'recurrencecombo',fieldLabel:a.L('Repeat'),value:[null]},a.recurrenceCombo));a.mon(a.recurrenceCombo,'change',a.onRecurrenceComboChange,a)}if(!a.recurrenceLegendButton||!a.recurrenceLegendButton.isInstance){a.recurrenceLegendButton=Ext.create(Ext.apply({xtype:'recurrencelegendbutton',hideEmptyLabel:!1,handler:a.onRecurrenceLegendClick,scope:a},a.recurrenceLegendButton))}b.push(a.recurrenceRule,a.recurrenceCombo,a.recurrenceLegendButton);a.recurrenceDialog=Ext.create({xtype:'recurrencedialog',weekStartDay:a.weekStartDay,dateFormat:a.dateFormat,closeAction:'hide',saveHandler:a.recurrenceDialogSaveHandler,cancelHandler:a.recurrenceDialogCancelHandler,scope:a});a.startDateField&&a.mon(a.startDateField,'change',a.onRecurrableEventStartDateChange,a)}return b},updateRecurringEvents:function(b){var a=this;if(b){if(a.recurrenceCombo){a.recurrenceCombo.show()}if(a.recurrenceLegendButton){a.recurrenceLegendButton.show()}}else {if(a.recurrenceCombo){a.recurrenceCombo.hide()}if(a.recurrenceLegendButton){a.recurrenceLegendButton.hide()}}},onRecurrableEventLoad:function(d,b,e){var a=this;a.recurrence=null;if(b.isRecurrableEvent&&a.getRecurringEvents()){var c=b.isOccurrence()?b.getRecurringEvent().getRecurrence():b.getRecurrence();if(!b.getRecurrenceRule()){a.recurrenceRule.setValue(null)}if(a.recurrenceCombo){a.recurrenceCombo.show();a.recurrenceCombo.setRecurrence(c)}if(a.recurrenceLegendButton){a.recurrenceLegendButton.setRecurrence(c);if(c){a.recurrenceLegendButton.show()}else {a.recurrenceLegendButton.hide()}}}else {a.recurrenceCombo&&a.recurrenceCombo.hide();a.recurrenceLegendButton&&a.recurrenceLegendButton.hide()}},onRecurrableEventBeforeDelete:function(d,a,b){var c=this;if(a.isRecurrableEvent&&c.getRecurringEvents()&&(a.isRecurring()||a.isOccurrence())){Sch.widget.RecurrenceConfirmation.show({actionType:'delete',eventRecord:a,changerFn:b});return !1}},onRecurrableEventBeforeSave:function(e,a,c,b){var d=this;if(a.isRecurrableEvent&&d.getRecurringEvents()&&(a.isRecurring()||a.isOccurrence())){Sch.widget.RecurrenceConfirmation.show({actionType:'update',eventRecord:a,values:c,changerFn:b});return !1}},getRecurrableEventFloatingComponents:function(){var b=this,a=[];a.push(Sch.widget.RecurrenceConfirmation);if(b.recurrenceDialog){a.push(b.recurrenceDialog);var c=b.recurrenceDialog.getFloatingComponents&&b.recurrenceDialog.getFloatingComponents();if(Ext.isArray(c)){a=a.concat(c)}}return a},onRecurrenceLegendClick:function(){this.showRecurrenceDialog()},makeRecurrence:function(d){var b=this.getEventRecord(),a=b.getRecurrence(),c=b.copy(null);if(!d&&a){a=a.copy(null)}else {a=new b.recurrenceModel({rule:d})}a.setEvent(c);c.setStartDate(this.getStartDateValue());a.suspendEventNotifying();return a},showRecurrenceDialog:function(){var a=this.eventRecord;if(this.recurrenceDialog&&a&&a.isRecurrableEvent){this.captureRecurrence();this.recurrence=this.recurrence||this.makeRecurrence();this.recurrence.getEvent().setStartDate(this.getStartDateValue());this.recurrenceDialog.loadRecord(this.recurrence);this.recurrenceDialog.show()}},captureRecurrence:function(){var a=this.recurrenceRule.getValue();this.capturedRecurrence=a?this.makeRecurrence(a):null},getCapturedRecurrence:function(){return this.capturedRecurrence},onRecurrenceComboChange:function(b,a){if(!this.loadingRecord){if(a==b.customValue){if(!this.inOnRecurrenceUpdate){this.showRecurrenceDialog()}}else {this.onRecurrenceUpdate(a&&this.makeRecurrence('FREQ='+a)||null)}}},onRecurrenceUpdate:function(b){var a=this;if(!a.inOnRecurrenceUpdate){a.inOnRecurrenceUpdate=!0;a.recurrence=b;if(!a.loadingRecord){a.recurrenceRule.setValue(b?b.getRule():null)}if(a.recurrenceCombo){a.recurrenceCombo.setRecurrence(b)}if(a.recurrenceLegendButton){a.recurrenceLegendButton.setRecurrence(b);if(b){a.recurrenceLegendButton.show()}else {a.recurrenceLegendButton.hide()}}a.inOnRecurrenceUpdate=!1}},recurrenceDialogSaveHandler:function(b,a){b.updateRecord(a);this.onRecurrenceUpdate(a);b.close()},recurrenceDialogCancelHandler:function(b){var a=this.getCapturedRecurrence();this.onRecurrenceUpdate(a);b.close()},onRecurrableEventStartDateChange:function(b,a){if(this.recurrenceLegendButton){if(Ext.isDate(a)){this.recurrenceLegendButton.setEventStartDate(a)}}}});Ext.define('Sch.widget.EventEditor',{extend:'Ext.form.Panel',mixins:['Sch.widget.mixin.CustomizableRecordForm','Sch.widget.recurrence.EventEditorMixin','Sch.mixin.Localizable'],alias:['widget.eventeditorform','plugin.scheduler_eventeditorform'],isEventEditor:!0,requires:['Ext.util.Region','Ext.form.Label','Ext.form.field.ComboBox','Ext.form.field.Date','Ext.form.field.Hidden','Ext.form.field.Time','Ext.Button','Sch.model.Event','Sch.util.Date','Sch.patches.DateField'],trackResetOnLoad:!0,isSavingEvent:0,eventStore:null,saveOnEnter:!0,showDeleteButton:!0,allDayField:null,startDateField:null,startTimeField:null,endDateField:null,endTimeField:null,nameField:null,resourceField:null,startTimeConfig:null,startDateConfig:null,endTimeConfig:null,endDateConfig:null,resourceFieldConfig:null,nameFieldConfig:null,allDayFieldConfig:null,showResourceField:!1,scrollNewEventIntoView:!0,border:!1,bodyPadding:6,fieldsPanelConfig:null,dateFormat:'Y-m-d',weekStartDay:1,timeFormat:'H:i',eventeditorCls:'sch-eventeditor',dynamicForm:!0,eventRecord:null,resourceRecord:null,currentForm:null,allowOverlap:!0,readOnly:!1,typeField:'EventType',layout:{type:'vbox',align:'stretch'},initComponent:function(){var a=this;a.addCls(a.eventeditorCls);a.setupCustomizableRecordForm(a,Sch.model.Event);a.setupRecurrableEventEditorMixin(a);Ext.apply(a,{buttons:a.buttons||a.buildButtons(),items:[{xtype:'container',itemId:'defaultFields',margin:'5 5 5 5',defaults:{width:'100%'},border:!1,items:a.getDefaultFields()},Ext.applyIf(a.fieldsPanelConfig,{flex:1,activeItem:0})]});a.callParent(arguments);a.defaultFields=a.down('#defaultFields')},afterRender:function(){this.callParent(arguments);if(this.saveOnEnter){this.el.on({'keyup':function(a,b){if(a.getKey()===a.ENTER&&b.tagName.toLowerCase()==='input'){this.save()}},scope:this})}},onAllDayChange:function(f,e){var a=this,b,d,c;if(!a.loadingRecord){b=this.getValues();a.suspendDateFieldsChange();if(e){if(b.startDate){d=Sch.model.Event.getAllDayDisplayStartDate(b.startDate);a.startDateField.setValue(d);a.startTimeField.setValue(d)}if(b.startDate&&b.endDate){c=Sch.model.Event.getAllDayDisplayEndDate(b.startDate,b.endDate);a.endDateField.setValue(c);a.endTimeField.setValue(c)}}else {if(b.startDate){c=Sch.util.Date.add(b.startDate,Sch.util.Date.HOUR,1);a.endDateField.setValue(c);a.endTimeField.setValue(c)}}a.resumeDateFieldsChange();a.toggleAllDayFields()}},onDatesChange:function(b,d,e){var c=Sch.util.Date;var a=this.getValues();if(!Ext.isDate(a.startDate)||!Ext.isDate(a.endDate)||a.startDate.getTime()<a.endDate.getTime()){return}this.suspendDateFieldsChange();if(!a.allDay&&a.startDate.getTime()>=a.endDate.getTime()){if(b===this.startDateField||b===this.startTimeField){this.endDateField.setValue(c.add(a.startDate,c.DAY,1))}else {this.startDateField.setValue(c.add(a.endDate,c.DAY,-1))}}else {if(a.allDay&&a.startDate.getTime()>a.endDate.getTime()){if(b===this.startDateField||b===this.startTimeField){this.endDateField.setValue(a.startDate)}else {this.startDateField.setValue(a.endDate)}}}this.resumeDateFieldsChange()},getDefaultFields:function(){var a=[];this.nameField=Ext.create(Ext.apply({fieldId:this.eventeditorCls+'-name-field',xtype:'textfield',fieldLabel:this.L('nameText'),name:this.customizableFieldNames.nameField,selectOnFocus:!0,allowBlank:!1},this.nameFieldConfig));a.push(this.nameField);if(this.showResourceField){this.resourceField=Ext.create(Ext.Object.merge({fieldId:this.eventeditorCls+'-resource-field',xtype:'combo',listConfig:{htmlEncode:!0},fieldLabel:this.L('resourceText'),queryMode:'local',valueField:'Id',displayField:'Name',allowBlank:!1,editable:!1},this.resourceFieldConfig));a.push(this.resourceField)}this.allDayField=Ext.create(Ext.apply({fieldId:this.eventeditorCls+'-all-day-field',xtype:'checkboxfield',fieldLabel:this.L('allDayText'),handler:this.onAllDayChange,scope:this},this.allDayFieldConfig));a.push(this.allDayField);this.startDateField=Ext.create(Ext.apply({fieldId:this.eventeditorCls+'-start-date-field',xtype:'datefield',fieldLabel:this.L('startDateText'),allowBlank:!1,format:this.dateFormat,altFormats:'',startDay:this.weekStartDay,flex:1,listeners:{change:this.onDatesChange,scope:this}},this.startDateConfig));this.startTimeField=Ext.create(Ext.apply({fieldId:this.eventeditorCls+'-start-time-field',cls:this.eventeditorCls+'-timefield',xtype:'timefield',format:this.timeFormat,altFormats:'',increment:30,width:100,margin:'0 0 0 10',allowBlank:!1,listeners:{change:this.onDatesChange,scope:this}},this.startTimeConfig));this.endDateField=Ext.create(Ext.apply({fieldId:this.eventeditorCls+'-end-date-field',xtype:'datefield',fieldLabel:this.L('endDateText'),allowBlank:!1,format:this.dateFormat,altFormats:'',startDay:this.weekStartDay,flex:1,listeners:{change:this.onDatesChange,scope:this}},this.endDateConfig));this.endTimeField=Ext.create(Ext.apply({fieldId:this.eventeditorCls+'-end-time-field',cls:this.eventeditorCls+'-timefield',xtype:'timefield',format:this.timeFormat,altFormats:'',increment:30,width:100,margin:'0 0 0 10',allowBlank:!1,listeners:{change:this.onDatesChange,scope:this}},this.endTimeConfig));a.push({xtype:'container',layout:'hbox',margin:'0 0 10 0',items:[this.startDateField,this.startTimeField]});a.push({xtype:'container',layout:'hbox',margin:'0 0 10 0',items:[this.endDateField,this.endTimeField]});return a},setReadOnly:function(a){if(a!==this.readOnly){Ext.Array.each(this.query('field'),function(b){b.setReadOnly(a)});this.saveButton.setVisible(!a);this.deleteButton&&this.deleteButton.setVisible(!a);this.readOnly=a}},getEventRecord:function(){return this.eventRecord},suspendDateFieldsChange:function(){this.startDateField.suspendCheckChange++;this.startTimeField.suspendCheckChange++;this.endDateField.suspendCheckChange++;this.endTimeField.suspendCheckChange++},resumeDateFieldsChange:function(){this.startDateField.suspendCheckChange--;this.startTimeField.suspendCheckChange--;this.endDateField.suspendCheckChange--;this.endTimeField.suspendCheckChange--},loadRecord:function(b,g){var a=this;a.loadingRecord=!0;a.reset();a.suspendDateFieldsChange();a.setReadOnly(g);if(a.deleteButton){a.deleteButton.setVisible(!g&&!a.isNewRecord(b))}a.eventRecord=b;var h=b.getStartDate();var j=b.getEndDate();var i=b.getAllDay();a.startTimeField.setValue(h);a.endTimeField.setValue(j);if(!i){a.startDateField.setValue(h);a.endDateField.setValue(j)}else {a.startDateField.setValue(Sch.model.Event.getAllDayDisplayStartDate(a.eventRecord));a.endDateField.setValue(Sch.model.Event.getAllDayDisplayEndDate(a.eventRecord))}a.allDayField.setValue(i);a.toggleAllDayFields();var e=b.getResources(a.getEventStore());if(a.isNewRecord(b)&&!e.length){e=[a.resourceRecord]}a.resourceField&&a.setResourcesValue(e);a.currentForm=a;a.callParent([b]);var f=b.get(a.typeField);if(f&&a.dynamicForm){var c=a.items.getAt(1),k=c.query('> form[EventType]'),d=c.query('> form[EventType='+f+']')[0];if(!d){throw new Error("Can't find form for with EventType equal to "+f)}if(!c.getLayout().setActiveItem){throw new Error("Can't switch active component in the 'fieldsPanel'")}c.getLayout().setActiveItem(d);a.currentForm=d;d.loadRecord(b)}a.fireEvent('loadevent',a,b,g);a.nameField.focus();a.resumeDateFieldsChange();a.loadingRecord=!1},toggleAllDayFields:function(){var a=this;if(a.allDayField.isVisible()){var b=a.allDayField.getValue();a.startTimeField.setDisabled(b);a.startTimeField.setHidden(b);a.endTimeField.setDisabled(b);a.endTimeField.setHidden(b)}},getFloatingComponents:function(){var f=this,c=[],e=f.query('pickerfield'),a;for(a=0;a<e.length;a++){var b=e[a],g=b.getPicker();if(b.fieldId){g.addCls(b.fieldId+'-picker')}}var d=f.query('[floating]');if(Ext.isArray(d)){c=c.concat(d)}return c},setEventStore:function(a){this.eventStore=a},setResourceStore:function(a){var b=this;b.resourceStore=a;if(b.resourceField){if(a){b.resourceField.valueField=a&&a.getModel().prototype.idProperty;b.resourceField.displayField=a&&a.getModel().prototype.nameField;b.resourceField.setDisplayTpl()}b.resourceField.setStore(a)}},getEventStore:function(){return this.eventStore},getResourceStore:function(){return this.resourceStore},isNewRecord:function(b){var a=this.getEventStore();return !a||a.indexOf(b)===-1},onSaveClick:function(){this.save()},save:function(b){var a=this;b=b||a.eventRecord;if(!b||!a.isValid()){return}var e=a.getEventStore(),c=a.getValues(),g=c.hasOwnProperty('resources');if(!a.allowOverlap&&e){var f=!1;Ext.each(g?c.resources:b.getResources(a.getEventStore()),function(a){return f=!e.isDateRangeAvailable(c.startDate,c.endDate,b,a)});if(f){return}}var d=function(){a.doSave(b,c)};if(a.fireEvent('beforeeventsave',a,b,c,d)!==!1){d()}return b},doSave:function(b,c){var a=this,d=a.getEventStore(),f=c.hasOwnProperty('resources'),e=d&&d.getAutoSync();if(e){d.suspendAutoSync()}a.isSavingEvent++;a.onBeforeSave(b);b.beginEdit();a.updateRecord(b);if(a.currentForm!==a){a.currentForm.updateRecord(b)}if(c.allDay){b.setStartEndDate(c.startDate,Sch.util.Date.getNext(c.endDate,Sch.util.Date.DAY,1))}else {b.setStartEndDate(c.startDate,c.endDate)}b.setAllDay(c.allDay);b.endEdit();if(f&&!a.isNewRecord(b)){a.assignResourcesToEvent(b,c.resources)}if(d&&a.isNewRecord(b)){if(a.fireEvent('beforeeventadd',a,b,c.resources)!==!1){if(d.isTreeStore){b.set('leaf',!0)}d.append(b);if(f){a.assignResourcesToEvent(b,c.resources)}a.fireEvent('aftereventadd',a,b)}}a.fireEvent('aftereventsave',a,b);a.onAfterSave(b);a.isSavingEvent--;if(e){d.resumeAutoSync(!0)}},setResourcesValue:function(a){this.resourceField.setValue(a)},getResourcesValue:function(){return [this.resourceField.getSelection()]},assignResourcesToEvent:function(a,b){a.unassign();a.assign(b)},isValid:function(){var a=!0;Ext.each(this.query('[isFormField]:not([excludeForm])'),function(b){return a=b.isHidden()||b.isValid()});return a},combineDateAndTime:function(b,c){var a=null;if(Ext.isDate(b)&&Ext.isDate(c)){a=Sch.util.Date.copyTimeValues(Ext.Date.clone(b),c)}return a},getStartDateValue:function(){return this.combineDateAndTime(this.startDateField.getValue(),this.startTimeField.getValue())},getEndDateValue:function(){return this.combineDateAndTime(this.endDateField.getValue(),this.endTimeField.getValue())},getValues:function(){var a=this,b=a.callParent(arguments);if(a.resourceField){b.resources=a.getResourcesValue()}else {if(a.resourceRecord){b.resources=[a.resourceRecord]}}return Ext.apply(b,{startDate:a.getStartDateValue(),endDate:a.getEndDateValue(),name:a.nameField.getValue(),allDay:a.allDayField.getValue(),resource:b.resources&&b.resources[0]})},onBeforeSave:function(a){},onAfterSave:function(a){},onDeleteClick:function(){this.deleteEvent()},deleteEvent:function(a){var b=this;a=a||b.eventRecord;var c=function(){b.doDeleteEvent(a)};if(b.fireEvent('beforeeventdelete',b,a,c)!==!1){c()}},doDeleteEvent:function(b){var a=this,c=a.getEventStore();c&&c.remove(b);a.fireEvent('aftereventdelete',a,b)},onCancelClick:Ext.emptyFn,buildButtons:function(){var a=[];this.saveButton=new Ext.Button({text:this.L('saveText'),scope:this,handler:this.onSaveClick});a.push(this.saveButton);if(this.showDeleteButton){this.deleteButton=new Ext.Button({text:this.L('deleteText'),scope:this,handler:this.onDeleteClick});a.push(this.deleteButton)}this.cancelButton=new Ext.Button({text:this.L('cancelText'),scope:this,handler:this.onCancelClick});a.push(this.cancelButton);return a}});Ext.define('Sch.plugin.EditorWindow',{extend:'Ext.window.Window',mixins:['Ext.AbstractPlugin','Sch.plugin.mixin.Editor'],requires:['Sch.widget.EventEditor'],alias:['widget.scheduler_editorwindow','plugin.scheduler_editorwindow'],cls:'sch-eventeditor-window',layout:'fit',closeAction:'hide',constrain:!0,editorConfig:null,privates:{alignOnResize:function(){}},initComponent:function(){var a=this;if(!a.editor){a.editor=Ext.create(Ext.apply({xtype:'eventeditorform',saveOnEnter:a.saveAndCloseOnEnter,onCancelClick:function(){a.hide()}},a.editorConfig));a.items=a.editor}a.callParent(arguments)},init:function(a){this.initEditor(a)},afterRender:function(){this.callParent(arguments);var a=this.getCmp().up('[floating=true]');if(a){this.mon(a,{activate:this.floatAboveFloatingContainer,move:this.floatAboveFloatingContainer,scope:this})}this.addIgnoreCls()},showRecord:function(a,b){this.floatAboveFloatingContainer();this.setTitle(a.getName())},alignEditorToElement:function(b){var a=this;if(b){a.alignTo(b,'tl-tr'+(a.constrain?'?':''))}else {a.center()}},getEventRecord:function(){return this.editor.getEventRecord()},floatAboveFloatingContainer:function(){var a=this.getCmp().up('[floating=true]');if(this.isVisible()&&a){this.setZIndex(a.getEl().getZIndex()+1)}},onEventRepaint:function(b,a){if(this.isVisible()&&a===this.getEventRecord()&&!this.getEventEditor().isSavingEvent){this.showRecord(a)}}});Ext.define('Sch.plugin.EventEditor',{extend:'Sch.widget.EventEditor',mixins:['Ext.AbstractPlugin','Sch.plugin.mixin.Editor'],alias:['widget.eventeditor','plugin.scheduler_eventeditor'],requires:['Ext.util.Region'],border:!1,shadow:!1,hidden:!0,collapsed:!0,preventHeader:!0,floating:!0,hideMode:'offsets',constrain:!1,floatingCls:'sch-eventeditor-floating-container',constructor:function(a){this.callParent(arguments);this.addCls(this.floatingCls)},init:function(a){this.ownerCt=a;this.initEditor(a)},afterRender:function(){this.callParent(arguments);this.addIgnoreCls()},showRecord:function(b,a){this.expand(!this.constrain)},alignEditorToElement:function(b){var c=this;var a=c.getCmp();b=b||a.getElementsFromEventRecord&&a.getElementsFromEventRecord(c.getRecord())[0]||null;if(b){c.alignTo(b,(a.isHorizontal&&a.isHorizontal()?'bl':'tl-tr')+(c.constrain?'?':''))}},onDeleteClick:function(){this.callParent(arguments);this.hideEditor()},onCancelClick:function(){this.hideEditor()},hideEditor:function(){this.collapse(null,!0)},afterCollapse:function(){this.hide();this.callParent(arguments)},onEventRepaint:function(b,a){if(!this.getCollapsed()&&a===this.eventRecord){this.showRecord(a)}}});Ext.define('Sch.plugin.EventTools',{extend:'Ext.Container',mixins:['Ext.AbstractPlugin'],lockableScope:'top',alias:'plugin.scheduler_eventtools',hideDelay:500,align:'b-t',defaults:{xtype:'tool',baseCls:'sch-tool',overCls:'sch-tool-over',width:24,height:24,visibleFn:Ext.emptyFn},hideTimer:null,cachedSize:null,layout:'hbox',autoRender:!0,floating:!0,shadow:!1,hideMode:'offsets',hidden:!0,eventRecord:null,resourceRecord:null,targetNode:null,getEventRecord:function(){return this.eventRecord},getResourceRecord:function(){return this.resourceRecord},init:function(a){if(!this.items){throw 'Must define an items property for this plugin to function correctly'}this.addCls('sch-event-tools');this.scheduler=a;this.defaultAlign=this.align;a.on({'eventresizestart':this.onOperationStart,'aftereventresize':this.onOperationEnd,'eventdragstart':this.onOperationStart,'eventdrop':this.onOperationEnd,'eventmouseenter':this.onEventMouseEnter,'eventmouseleave':this.onContainerMouseLeave,scope:this})},onRender:function(){this.callParent(arguments);this.el.on({mouseenter:this.onContainerMouseEnter,mouseover:this.onContainerMouseEnter,mouseleave:this.onContainerMouseLeave,scope:this})},onEventMouseEnter:function(d,e,f){window.clearTimeout(this.hideTimer);var a=this,c=!1,b;a.targetNode=f.getTarget(d.eventSelector);a.eventRecord=e;a.resourceRecord=d.resolveResource(a.targetNode);a.items.each(function(d){b=d.visibleFn(a.eventRecord)!==!1;d.setVisible(b);if(b){c=!0}});if(!c){return}a.showBy(a.targetNode)},onContainerMouseEnter:function(){window.clearTimeout(this.hideTimer)},onContainerMouseLeave:function(){window.clearTimeout(this.hideTimer);this.hideTimer=Ext.defer(this.hide,this.hideDelay,this)},onOperationStart:function(){this.scheduler.un('eventmouseenter',this.onEventMouseEnter,this);window.clearTimeout(this.hideTimer);this.hide()},onOperationEnd:function(){this.scheduler.on('eventmouseenter',this.onEventMouseEnter,this)},destroy:function(){clearTimeout(this.hideTimer);this.callParent(arguments)}});Ext.define('Sch.plugin.exporter.AbstractExporter',{extend:'Ext.util.Observable',requires:['Ext.XTemplate'],mixins:['Sch.mixin.Localizable'],pageHeaderHeight:41,headerHeight:41,pageFooterHeight:41,footerHeight:41,bufferedHeightMargin:25,isExporter:!0,paperWidth:0,paperHeight:0,printHeight:0,lockedRowsHeight:0,normalRowsHeight:0,iterateTimeout:10,tableSelector:undefined,currentPage:undefined,headerTplDataFn:null,footerTplDataFn:null,headerTplDataFnScope:null,footerTplDataFnScope:null,config:{exporterId:'abstractexporter',id:'abstractexporter',name:'',translateURLsToAbsolute:!0,expandAllBeforeExport:!1,headerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',tpl:'<!DOCTYPE html>'+'<html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}">'+'<head>'+'<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />'+'<title>{title}</title>'+'{styles}'+'</head>'+'<body class="'+Ext.baseCSSPrefix+'webkit sch-export {bodyClasses}">'+'{header}'+'<div id="{id}" class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">'+'{HTML}'+'</div>'+'{footer}'+'</body>'+'</html>',footerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',rowVisibilityThreshold:0.6},callbacks:undefined,error:undefined,extractedPages:undefined,numberOfPages:0,firstExportedRowOffset:0,secondaryCanvasOffset:0,eventBoxes:null,dependencyPainter:null,dependenciesHtml:'',depViewBeforeRefreshDetacher:null,depView:null,collectRowsTimer:null,collectRowsTimerTimeout:1,collectRowsStepTimer:null,scrollToTimer:null,timer1:null,timer2:null,stylesheets:null,constructor:function(a){var b=this;a=a||{};if(a.pageHeaderHeight){a.headerHeight=a.pageHeaderHeight}if(a.pageFooterHeight){a.footerHeight=a.pageFooterHeight}if(a.exporterId){a.id=a.exporterId}b.callParent(arguments);delete a.getUserHeaderTplData;delete a.getUserFooterTplData;b.initConfig(a);if(!a.tableSelector){b.tableSelector='.'+Ext.baseCSSPrefix+'grid-item-container'}if(!a.name){b.setName(b.L('name'))}},getExporterId:function(){return this.getId()},destroy:function(){clearTimeout(this.collectRowsStepTimer);clearTimeout(this.collectRowsTimer);clearTimeout(this.scrollToTimer);clearTimeout(this.timer1);clearTimeout(this.timer2);this.callParent(arguments)},setHeaderTpl:function(a){this.headerTpl=this.getTplInstance(a)},getHeaderTpl:function(){return this.headerTpl},setTpl:function(a){this.tpl=this.getTplInstance(a)},getTpl:function(){return this.tpl},setFooterTpl:function(a){this.footerTpl=this.getTplInstance(a)},getFooterTpl:function(){return this.footerTpl},getTplInstance:function(a){return a&&!a.isTemplate?new Ext.XTemplate(a,{disableFormats:!0}):a},getBodyClasses:function(){var b=new RegExp(Ext.baseCSSPrefix+'ie\\d?|'+Ext.baseCSSPrefix+'gecko','g'),a=document.body.className.replace(b,'');if(Ext.isIE){a+=' sch-ie-export'}return a},getComponentClasses:function(){return this.getComponent().el.dom.className},setComponent:function(b){var a=this;a.component=b;a.view=b.getSchedulingView();a.normalGrid=b.normalGrid;a.lockedGrid=b.lockedGrid;a.normalView=b.normalGrid.getView();a.lockedView=b.lockedGrid.getView();a.lockedBodySelector='#'+a.lockedView.getId();a.normalBodySelector='#'+a.normalView.getId();a.lockedHeader=a.lockedGrid.headerCt;a.normalHeader=a.normalGrid.headerCt;a.gridHeaderHeight=a.normalHeader.getHeight();a.printHeight=Math.floor(a.paperHeight)-a.gridHeaderHeight-(a.exportConfig.showHeader?a.headerHeight:0)-(a.exportConfig.showFooter?a.footerHeight:0);a.saveComponentState(b);a.initDependencyPainter(b)},getComponent:function(){return this.component},setPaperSize:function(a,c){var b=this;if(c==='landscape'){b.paperWidth=a.height;b.paperHeight=a.width}else {b.paperWidth=a.width;b.paperHeight=a.height}},getPaperFormat:function(){return this.exportConfig.format},isBuffered:function(){return !!this.getBufferedRenderer()},getBufferedRenderer:function(){return this.view.bufferedRenderer},setComponentRange:function(b){var d=this,e=d.getComponent();if(b.range!=='complete'){var h=d.view,c,a;switch(b.range){case 'date':c=new Date(b.dateFrom);a=new Date(b.dateTo);if(Sch.util.Date.getDurationInDays(c,a)<1){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)};break;case 'current':var f=h.getVisibleDateRange();c=f.startDate;a=f.endDate||h.timeAxis.getEnd();break;case 'completedata':var g=e.getEventStore().getTotalTimeSpan();c=g.start;a=g.end;break;}if(c&&a){e.setTimeSpan(c,a)}}d.ticks=e.timeAxis.getTicks();if(b.rowsRange=='visible'){b.rowsRange=d.findVisibleRowsRange()}else {b.rowsRange=null}},getStylesheets:function(){var b=this.getTranslateURLsToAbsolute(),c=Ext.select('link[rel="stylesheet"], style',!0),a='';var d=window.origin;c.each(function(e){var c=e.dom.cloneNode(!0);if(b&&c.href){c.setAttribute('href',b===!0?c.href:c.href.replace(d,b))}a+=c.outerHTML;if(Ext.isIE&&c.styleSheet&&/style/i.test(c.tagName)){a+='<style type="text/css">'+e.dom.styleSheet.cssText+'</style>'}});return a},forEachTimeSpanPlugin:function(a,f,e){if(Sch.feature&&Sch.feature.AbstractTimeSpan){var g=this;var c=[].concat(a.plugins,a.normalGrid.plugins,a.columnLinesFeature);for(var b=0,h=c.length;b<h;b++){var d=c[b];if(d instanceof Sch.feature.AbstractTimeSpan){f.call(e||g,d)}}}},setCellSize:function(b){var a=this;a.timeColumnWidth=b[0];if(a.timeColumnWidth){this.getComponent().setTimeColumnWidth(a.timeColumnWidth)}if(b.length>1){a.view.setRowHeight(b[1])}},findVisibleRowsRange:function(){var d=this,c=d.lockedView.all,g=c.startIndex,h=c.endIndex;var b=!1,e=-1,f=-1;for(var a=g;a<=h;a++){var i=c.item(a,!0);if(d.isRowVisible(i,d.lockedBox)){if(!b){e=a;b=!0}f=a}else {if(b){break}}}return [e,f]},prepareComponent:function(b,c){var a=this;b=b||a.getComponent();a.suspendInfiniteScroll(b);a.forEachTimeSpanPlugin(b,function(a){a._renderDelay=a.renderDelay;a.renderDelay=0});b.getSchedulingView().timeAxisViewModel.suppressFit=!0;b.timeAxis.autoAdjust=!1;b.normalGrid.expand();b.lockedGrid.expand();if(Ext.getVersion().isGreaterThan('6.2.0')){a.lockedBox=a.lockedGrid.body.getBox();a.normalBox=a.normalGrid.body.getBox()}else {a.lockedBox=a.lockedView.getBox();a.normalBox=a.normalView.getBox()}a.setComponentRange(c);c.cellSize&&a.setCellSize(c.cellSize);c.beforeExport&&c.beforeExport(b,a.ticks);a.prepareColumns(c.columns);if(a.expandAllBeforeExport&&b.expandAll){b.expandAll()}a.fitComponentIntoPage(c);a.view.timeAxisViewModel.setTickWidth(a.view.timeAxisViewModel.getTickWidth());a.stylesheets=a.getStylesheets()},prepareColumns:function(a){var b=this;if(a&&a.length){b.lockedGrid.headerCt.items.each(function(b){if(Ext.Array.contains(a,b)){b.show()}else {b.hide()}})}},restoreComponent:function(b){var a=this;b=b||a.getComponent();a.forEachTimeSpanPlugin(b,function(a){a.renderDelay=a._renderDelay;delete a._renderDelay});if(a.depViewBeforeRefreshDetacher){a.depViewBeforeRefreshDetacher.destroy();a.depViewBeforeRefreshDetacher=null;a.depView.updateCanvasLayer()}a.restoreComponentState(b);a.restoreInfiniteScroll(b);a.exportConfig.afterExport&&a.exportConfig.afterExport(b)},saveComponentState:function(a){a=a||this.getComponent();var h=this,c=a.getSchedulingView(),e=a.normalGrid,d=a.lockedGrid;var g=[];d.headerCt.items.each(function(a){g.push({column:a,visible:!a.isHidden()})});var b=c.timeAxisViewModel;var i=b.originalTickWidth;var f=b.getTickWidth();b.setTickWidth(f,!0);h.restoreSettings={width:a.getWidth(),height:a.getHeight(),rowHeight:b.getViewRowHeight(),originalTickWidth:i,columnWidth:f,startDate:a.getStart(),endDate:a.getEnd(),normalWidth:e.getWidth(),normalLeft:e.getEl().getStyle('left'),lockedWidth:d.getWidth(),lockedCollapse:d.collapsed,normalCollapse:e.collapsed,columns:g,autoAdjust:a.timeAxis.autoAdjust,suppressFit:b.suppressFit,startIndex:c.all.startIndex,lockedScrollX:h.lockedView.getScrollX(),normalScrollX:c.getScrollX(),scrollY:c.getVerticalScroll()}},restoreComponentState:function(b){var d=this;b=b||d.getComponent();var a=d.restoreSettings,c=b.getSchedulingView();b.timeAxis.autoAdjust=a.autoAdjust;b.normalGrid.show();b.setWidth(a.width);b.setHeight(a.height);b.setTimeSpan(a.startDate,a.endDate);b.setTimeColumnWidth(a.columnWidth,!0);b.setRowHeight(a.rowHeight);Ext.Array.each(a.columns,function(a){a.column.setVisible(a.visible)});b.lockedGrid.show();b.normalGrid.setWidth(a.normalWidth);b.normalGrid.getEl().setStyle('left',a.normalLeft);b.lockedGrid.setWidth(a.lockedWidth);c.timeAxisViewModel.suppressFit=a.suppressFit;c.timeAxisViewModel.setTickWidth(a.columnWidth);c.timeAxisViewModel.originalTickWidth=a.originalTickWidth;if(a.lockedCollapse){b.lockedGrid.collapse()}if(a.normalCollapse){b.normalGrid.collapse()}d.restoreComponentScroll(a)},restoreComponentScroll:function(a){var b=this;b.lockedView.setScrollX(a.lockedScrollX);b.normalView.scrollTo(a.normalScrollX,a.scrollY)},extractPages:function(c,b,d,e){var a=this;a.enableGarbageCollector=Ext.enableGarbageCollector;Ext.enableGarbageCollector=!1;Ext.dom.GarbageCollector.pause();a.exportConfig=b;a.normalRows=[];a.lockedRows=[];a.extractedPages=[];a.numberOfPages=0;a.lockedRowsHeight=0;a.normalRowsHeight=0;a.firstExportedRowOffset=0;a.secondaryCanvasOffset=0;a._abort=!1;a.stylesheets=null;a.setPaperSize(b.pageSize,b.orientation);a.setComponent(c,b);a.prepareComponent(c,b);a.callbacks={success:d,scope:e||a};a.collectRowsTimer=setTimeout(function(){a.collectRows(a._onRowsCollected,a,b)},a.collectRowsTimerTimeout)},onPagesExtracted:function(a){var b=this;a=b.renderPages(a);b.restoreComponent();b.submitPages(a)},submitPages:function(c){var b=this,a=b.callbacks;a.success.call(a.scope,c);Ext.enableGarbageCollector=b.enableGarbageCollector;Ext.dom.GarbageCollector.resume()},getCurrentPage:function(){return this.currentPage},setCurrentPage:function(a){this.currentPage=a},getExpectedNumberOfPages:function(){throw 'Sch.plugin.exporter.AbstractExporter: [getExpectedNumberOfPages] Abstract method called.'},commitPage:function(c){var a=this;a.numberOfPages++;var b=a.preparePageToCommit(c);a.fireEvent('beforecommitpage',a,b,a.numberOfPages,a.getExpectedNumberOfPages());var d=Ext.apply({html:b.dom.outerHTML,number:a.numberOfPages},c);a.extractedPages.push(d);a.fireEvent('commitpage',a,d,a.numberOfPages,a.getExpectedNumberOfPages())},collectLockedRow:function(c,e,f){var d=Ext.get(c),a=d.getHeight()-(f?d.getBorderWidth('b'):0);this.lockedRowsHeight+=a;var b={height:a,row:c.cloneNode(!0),record:this.lockedView.getRecord(e)};this.lockedRows.push(b);return b},collectNormalRow:function(c,e,f){var d=Ext.get(c),b=d.getHeight()-(f?d.getBorderWidth('b'):0);this.normalRowsHeight+=b;var a={height:b,row:c.cloneNode(!0),record:this.normalView.getRecord(e)};this.normalRows.push(a);if(this.depView&&this.depView.getDependencyStore()){this.fillRecordRelatedBoxes(a.record)}return a},_onRowsCollected:function(){var a=this,b=a.depView;if(b&&b.getDependencyStore()){a.renderDependencies()}a.onRowsCollected.apply(a,arguments)},onRowsCollected:function(){throw 'Sch.plugin.exporter.AbstractExporter: [onRowsCollected] Abstract method called.'},_abort:!1,abort:function(){this._abort=function(){this.restoreComponent()}},iterateAsync:function(d,b){var a=this;b=b||a;var c=function(){var e=arguments;a.timer2=setTimeout(function(){!a._abort?d.apply(b,[].concat.apply([c],e)):a._abort()},a.iterateTimeout)};c.apply(a,Ext.Array.slice(arguments,2))},callAsync:function(b,a){a=a||this;this.timer1=setTimeout(function(){b.apply(a,Ext.Array.slice(arguments,2))},this.iterateTimeout)},canStartRowsCollecting:function(){var b=this.getComponent(),a=b.getDependencyView();return !a||a.getDependencyCanvas()},depViewRefreshBlocker:function(){return !1},collectRows:function(e,f,c){var a=this,b=0;if(!a.canStartRowsCollecting()){var h=Ext.Array.slice(arguments,0);a.collectRowsTimer=setTimeout(function(){a.collectRows.apply(a,h)},a.collectRowsTimerTimeout);return}var g=a.getComponent().getDependencyView();if(a.depView){a.depViewBeforeRefreshDetacher=g.on({beforerefresh:a.depViewRefreshBlocker,destroyable:!0})}var d=a.isBuffered();if(c.rowsRange){b=c.rowsRange[0];d=!(c.rowsRange[0]>=a.view.all.startIndex&&c.rowsRange[1]<=a.view.all.endIndex)}if(d){a.scrollToTimer=setTimeout(function(){a.scrollTo(b,function(){b&&a.initFirstExportedRowOffset(b);a.iterateAsync(a.collectRowsStep,a,b,e,f,c)})},1)}else {b&&a.initFirstExportedRowOffset(b);a.collectRowsStepTimer=setTimeout(function(){a.collectRowsStep(null,b,e,f,c)},1)}},initFirstExportedRowOffset:function(a){this.firstExportedRowOffset=this.view.el.getScrollTop()-this.view.el.getTop()+Ext.fly(this.view.getNode(a)).getTop()},isRowVisible:function(g,c){var e=Ext.fly(g),d=e.getTop(),b=e.getHeight(),f=d+b,a=(1-this.getRowVisibilityThreshold())*b;return d+a>c.top&&f-a<c.bottom},collectRowsStep:function(p,d,e,g,n){var a=this,f=a.normalView.all.endIndex,o=a.component.store.getCount(),m=n.rowsRange,j=a.normalView.all.slice(d),i=a.lockedView.all.slice(d),b=0;var l;if(m){l=m[1]}var k=!1;for(var c=d,h=j.length;b<h;b++){if(c>l){k=!0;break}i[b]&&a.collectLockedRow(i[b],c,b+1===h);a.collectNormalRow(j[b],c,b+1===h);c++}a.fireEvent('collectrows',a,d,c,o);if(!k&&a.isBuffered()){if(f+1<o){a.callAsync(function(){a.scrollTo(f+1,function(){p(f+1,e,g,n)})})}else {a.callAsync(function(){a.scrollTo(0,function(){e.call(g||a,a.lockedRows,a.normalRows)})})}}else {e.call(g||a,a.lockedRows,a.normalRows)}},renderPages:function(a){var d=this;a=a||d.extractedPages;for(var b=0,e=a.length;b<e;b++){var c=a[b];c.html=d.applyPageTpl(c)}return a},applyPageTpl:function(b){var a=this;return a.getTpl().apply(a.getPageTplData(b))},applyHeaderTpl:function(d){var a=this,c=a.getHeaderTpl();if(a.exportConfig.showHeader&&c){var e=a.headerTplDataFn;var g=e&&e.call(a.headerTplDataFnScope||a,d);var f=c.apply(Ext.apply(a.getHeaderTplData(d),g));var b=document.createElement('div');b.innerHTML=f;Ext.fly(b).select('img').each(function(a){a.dom.setAttribute('src',a.dom.src)});return b.innerHTML}return ''},applyFooterTpl:function(d){var a=this,c=a.getFooterTpl();if(a.exportConfig.showFooter&&c){var e=a.footerTplDataFn;var g=e&&e.call(a.footerTplDataFnScope||a,d);var f=c.apply(Ext.apply(a.getFooterTplData(d),g));var b=document.createElement('div');b.innerHTML=f;Ext.fly(b).select('img').each(function(a){a.dom.setAttribute('src',a.dom.src)});return b.innerHTML}return ''},getHeaderTplData:function(b){var a=this;return {width:a.paperWidth,height:a.headerHeight,totalPages:a.numberOfPages,pageNo:b.number}},getFooterTplData:function(b){var a=this;return {width:a.paperWidth,height:a.footerHeight,totalPages:a.numberOfPages,pageNo:b.number}},getPageTplData:function(b){var a=this;return {id:a.getComponent().id,bodyClasses:a.getBodyClasses(),bodyHeight:a.printHeight+a.gridHeaderHeight,componentClasses:a.getComponentClasses(),styles:a.stylesheets,showHeader:a.exportConfig.showHeader,showFooter:a.exportConfig.showFooter,header:a.applyHeaderTpl(b),HTML:b.html,footer:a.applyFooterTpl(b),totalWidth:a.paperWidth,pageNo:b.number,totalPages:a.numberOfPages,title:b.number+' of '+a.numberOfPages}},fitComponentIntoPage:Ext.emptyFn,getLockedGridBody:function(a){a=a||this.getCurrentPage();return a.down(this.lockedBodySelector+' '+this.tableSelector,!0)},getNormalGridBody:function(a){a=a||this.getCurrentPage();return a.down(this.normalBodySelector+' '+this.tableSelector,!0)},emptyLockedGrid:function(a){Ext.fly(this.getLockedGridBody(a)).select(this.lockedView.getItemSelector()).remove()},fillGrids:function(d,e,b,a){var c=this;c.fillLockedGrid(d,b,a);c.fillNormalGrid(e,b,a)},fillLockedGrid:function(d,c,b){var a=this;if(!b){a.emptyLockedGrid()}a.appendRows(a.getLockedGridBody(),d||a.lockedRows,c)},fillNormalGrid:function(d,c,b){var a=this;if(!b){a.emptyNormalGrid()}a.appendRows(a.getNormalGridBody(),d||a.normalRows,c)},appendRows:function(c,b,d){for(var a=0,e=b.length;a<e;a++){c.appendChild(d?b[a].row.cloneNode(!0):b[a].row)}},emptyNormalGrid:function(a){Ext.fly(this.getNormalGridBody(a)).select(this.normalView.getItemSelector()).remove()},getRowHeight:function(){return this.view.timeAxisViewModel.getViewRowHeight()},getTotalSize:function(){return {width:this.getTotalWidth(),height:this.getTotalHeight()}},getTotalHeight:function(){var a=this,b;if(a.isBuffered()){b=a.bufferedHeightMargin+a.normalRowsHeight}else {b=a.lockedView.getEl().down(a.tableSelector).getHeight()}return a.headerHeight+b},getTotalWidth:function(){var a;if(Ext.getVersion().isGreaterThan('6.2.0')){a=this.component.lockedGrid.split?this.component.down('splitter').getWidth():0}else {a=this.component.split?this.component.down('splitter').getWidth():0}return this.getLockedGridWidth()+a+this.normalView.getEl().down(this.tableSelector).getWidth()},getLockedGridWidth:function(){var a=this.exportConfig.columns;if(a&&a.length===0){return 0}return this.lockedHeader.getEl().down('.'+Ext.baseCSSPrefix+'box-inner').getWidth()},getNormalGridWidth:function(){return this.normalHeader.getEl().down('.'+Ext.baseCSSPrefix+'box-inner').getWidth()},preparePageToCommit:function(s){var a=this.getCurrentPage(),h=this.component,k=h.lockedGrid,d=h.normalGrid,i=a.down('.sch-secondary-canvas',!0);a.select('.sch-remove').remove();var b=function(b){return a.down('#'+b,!0)},g=function(a){if(a){a.style.width='100%'}},f=function(a){if(a){a.style.height='100%'}};var o=a.down(this.normalBodySelector,!0);o.style.top='0px';var n=a.down(this.lockedBodySelector,!0);n.style.top='0px';var l=this.getLockedGridBody(),m=this.getNormalGridBody();if(l){l.style.transform=''}if(m){m.style.transform=''}if(i){i.style.top=this.secondaryCanvasOffset+'px';Ext.fly(i).select('.sch-column-line').setHeight(this.normalRowsHeight)}var j=[b(h.id+'-targetEl'),b(h.id+'-innerCt'),b(k.id),b(k.body.id),b(k.view.el.id)];if(Ext.getVersion().isGreaterThan('6.2.0')){var c='.'+Ext.baseCSSPrefix;var e=a.down(c+'grid-scroll-container',!0);e.style.top=this.gridHeaderHeight+1+'px';e.style.left=0;f(e);g(e);var p=a.down(c+'grid-scroll-body',!0);f(p);p.style['overflow-y']='hidden';Ext.Array.each(a.query(c+'grid-view',!0),function(a){f(a)});n.style.margin=o.style.margin=0;Ext.Array.each(a.query(c+'grid-scroll-container '+c+'scroller-spacer',!0),function(a){a.parentNode.removeChild(a)});var q=a.down('.'+Ext.baseCSSPrefix+'splitter',!0);if(q){Ext.fly(q).setZIndex(2)}}Ext.Array.each(j,f);g(j[0]);g(j[1]);if(Ext.isIE){var r=b(d.headerCt.id);if(r){r.style.width=''}}else {g(b(d.headerCt.id))}Ext.Array.each([b(d.id),b(d.body.id),b(d.getView().id)],function(a){if(a){a.style.height=a.style.width='100%'}});a.dom.style.height='100%';a.dom.style.width='';a.dom.style.top='';return a},startPage:function(c){var b=this;var a=(c||b.getComponent().body).dom.cloneNode(!0);a.id='';b.setCurrentPage(Ext.get(a))},scrollTo:function(e,b,d){var a=this;var c=a.component.store.getAt(e);if(c){a.component.ensureVisible(c,{callback:function(){a.component.syncRowHeights();if(b){b.apply(d||a)}},select:!1,focus:!1,animate:!1})}else {b.apply(d||a)}},removeNode:function(a){if(a&&a.parentNode){a.parentNode.removeChild(a)}else {if(a.elements){for(var b=0;b<a.elements.length;b++){var c=a.elements[b];c.parentNode.removeChild(c)}}}},restoreInfiniteScroll:function(a){var b=a.getSchedulingView();if(a.infiniteScroll&&b.rendered){a.timeAxis.setTimeSpan(this._oldStart,this._oldEnd);b.setScrollX(this._oldScrollX);b.bindInfiniteScrollListeners()}},suspendInfiniteScroll:function(a){var b=a.getSchedulingView();if(a.infiniteScroll&&b.rendered){b.unbindInfiniteScrollListeners();this._oldStart=a.timeAxis.getStart();this._oldEnd=a.timeAxis.getEnd();this._oldScrollX=b.getScrollX();var c=a.getEventStore().getTotalTimeSpan();a.setTimeSpan(c.start,c.end)}},dependencyPainterMembers:{getItemBox:function(d,a){var c=this,b=c.exporter.eventBoxes[a.internalId];return b||this.callParent(arguments)}},initDependencyPainter:function(c){var a=this,b=c.getDependencyView();if(b){a.dependencyPainter=b.clonePainter();Ext.override(a.dependencyPainter,Ext.apply({},{exporter:a},a.dependencyPainterMembers))}a.depView=b;a.eventBoxes={}},fillRecordRelatedBoxes:function(j){var e=this,a=e.normalView,i=e.depView.painter,h=e.depView.getDependencyStore();var g=j.getEvents();for(var f=0;f<g.length;f++){var d=g[f];if(a.timeAxis.isRangeInAxis(d)&&h.getEventDependencies(d).length){var b=i.getItemBox(a,d);for(var c=0;c<b.length;c++){if(a.bufferedRenderer){b[c].top+=a.bufferedRenderer.bodyTop;b[c].bottom+=a.bufferedRenderer.bodyTop}b[c].rendered=!0}e.eventBoxes[d.internalId]=b}}},renderDependencies:function(){var a=this,b=a.depView;if(b.getDrawDependencies()){a.dependenciesHtml=a.dependencyPainter.generatePaintMarkup(b.getPrimaryView(),b.getDependencyStore().getRange())}else {a.dependenciesHtml=''}}});Ext.define('Sch.plugin.exporter.SinglePage',{extend:'Sch.plugin.exporter.AbstractExporter',config:{id:'singlepage'},getExpectedNumberOfPages:function(){return 1},getPaperFormat:function(){var d=this,a=d.getTotalSize(),c=a.width,b=a.height+110;return c+'px*'+b+'px'},onRowsCollected:function(){var a=this;a.startPage();a.fillGrids();a.commitPage();a.onPagesExtracted()},getPageTplData:function(){var b=this,a=b.getTotalSize();return Ext.apply(b.callParent(arguments),{bodyHeight:a.height,totalWidth:a.width})},getHeaderTplData:function(b){var a=this;return Ext.apply(a.callParent(arguments),{width:a.getTotalWidth(),height:a.headerHeight})},getFooterTplData:function(b){var a=this;return Ext.apply(a.callParent(arguments),{width:a.getTotalWidth(),height:a.footerHeight})},fitComponentIntoPage:function(b){var c=this,a=c.lockedGrid;if(b.columns&&!b.columns.length){a.setWidth(0)}else {a.setWidth(Ext.fly(a.getView().getNodeContainer()).getWidth())}},preparePageToCommit:function(){var b=this,a=b.callParent(arguments),d=a.select('.sch-secondary-canvas').first(),k=d.select('.sch-zone'),j=d.select('.sch-column-line'),g=b.getTotalHeight();d.setTop(-this.firstExportedRowOffset);k.setHeight(g);j.setHeight(g);var c=a.selectNode('.sch-dependencyview-ct');if(c){c.innerHTML=b.dependenciesHtml;c.style.top=-this.firstExportedRowOffset+'px';c.style.left='0px';c.style.visibility='visible'}var e=b.normalView,i=e.getEl().down(b.tableSelector).getWidth(),m=e.id,l=a.select('#'+m).first().dom;l.style.width=i+'px';var h=a.selectNode('#'+b.normalView.id);h.style.overflow='hidden';var f=a.selectNode('.'+Ext.baseCSSPrefix+'splitter');if(f){f.style.height='100%'}return a}});Ext.define('Sch.plugin.exporter.MultiPage',{extend:'Sch.plugin.exporter.AbstractExporter',config:{id:'multipage'},rowPageIndex:0,columnPageIndex:0,pagesPerColumn:0,depsTopOffset:0,onRowsCollected:function(b,c){var a=this;a.depsTopOffset=-a.firstExportedRowOffset;a.rowPageIndex=0;a.columnPageIndex=0;a.pagesPerColumn=0;a.buildPageFrames(function(){a.buildPages(a.onPagesExtracted,a,b,c)})},buildPages:function(e,f,c,d){var a=this,b=a.pageFrames[0];a.startPage(b,!0);this.iterateAsync(a.rowIteratorStep,a,{rowIndex:0,pageFrame:b,rowsHeight:0,leftHeight:this.printHeight,lockeds:[],normals:[],lockedRows:c,normalRows:d,callback:e,scope:f||a})},rowIteratorStep:function(j,a){var b=this,f=a.rowIndex,l=a.lockedRows,g=a.normalRows,k=a.leftHeight,d=a.lockeds,e=a.normals,i=!0;if(f<g.length){var h=l[f],c=g[f];if(c.height<=k){d.push(h);e.push(c);a.leftHeight-=c.height;a.rowsHeight+=c.height;i=!1}else {b.fillGrids(d,e,a.pageFrame);b.commitPage({rowsHeight:a.rowsHeight});b.startPage(a.pageFrame);a.lockeds=[h];a.normals=[c];a.leftHeight=b.printHeight-c.height;a.rowsHeight=c.height}a.rowIndex++}else {if(b.columnPageIndex<b.pageFrames.length){b.fillGrids(d,e,a.pageFrame);b.commitPage({rowsHeight:a.rowsHeight});a.pageFrame=b.pageFrames[b.columnPageIndex];b.startPage(a.pageFrame,!0);a.leftHeight=b.printHeight;a.rowsHeight=0;a.lockeds=[];a.normals=[];a.rowIndex=0}else {b.fillGrids(d,e,a.pageFrame);b.commitPage({rowsHeight:a.rowsHeight});a.callback.call(a.scope);return}}if(i){j(a)}else {b.rowIteratorStep(j,a)}},fillGrids:function(e,f,c){var a=this,b=a.lockedColumnPages[a.columnPageIndex-1],d=!b||b&&b.leftWidth;if(b){a.fillLockedGrid(e,!0);a.removeHiddenLockedColumns(b)}if(d){a.fillNormalGrid(f,!0);a.removeInvisibleEvents(-c.normalGridOffset,-c.normalGridOffset+c.normalGridWidth)}},buildPageFrame:function(i,d){var a=this,c=a.lockedColumnPages[i];if(c){a.lockedGrid.setWidth(a.showLockedColumns(c.start,c.end)+(c.startOffset||0));if(c.leftWidth){a.normalGrid.show()}else {var g=a.lockedGrid.headerCt.getHeight();a.lockedGrid.getVisibleColumns()[0].setHeight(g);a.normalGrid.hide()}}else {a.lockedGrid.setWidth(0);a.lockedGrid.hide();a.normalGrid.show()}var b=a.getComponent().body.dom.cloneNode(!0);b.id='';b=Ext.get(b);b.normalGridOffset=d;b.lockedGridOffset=c&&c.startOffset||0;b.normalGridWidth=a.normalGrid.getWidth();b.lockedGridWidth=a.lockedGrid.getWidth();b.down(a.lockedBodySelector,!0).style.position='';b.down('#'+a.lockedView.id,!0).style.overflow='visible';if(!a.normalGrid.hidden){var f=b.select(a.normalBodySelector).first();f.dom.style.position='';f.dom.style.top='0px';var j=a.getNormalGridBody(b);var e=b.down('#'+a.normalView.headerCt.id,!0);var h=b.down('.sch-secondary-canvas',!0);var k=b.down('#'+a.normalView.id,!0);j.style.left=d+'px';if(!c){b.down('#'+a.normalGrid.id,!0).style['border-style']='none'}e.style.left=d+'px';e.style.overflow='visible';h.style.left=d+'px';k.style.overflow='visible'}return b},buildPageFrames:function(e,b){var a=this;b=b||a;a.lockedColumnPages=a.calculateLockedColumnPages();var d=Math.ceil(a.getTotalWidth()/a.paperWidth),c=a.pageFrames=[];a.iterateAsync(function(i,f,g){if(f>=d){e.call(b,c);return}c.push(a.buildPageFrame(f,g));var h=a.lockedColumnPages[f];if(h){g-=h.leftWidth||0}else {g-=a.paperWidth}i(f+1,g)},a,0,0)},startPage:function(c,b){var a=this;if(b){a.depsTopOffset=-a.firstExportedRowOffset;if(a.columnPageIndex==1){a.pagesPerColumn=a.extractedPages.length}a.rowPageIndex=0;a.columnPageIndex++;a.secondaryCanvasOffset=a.firstExportedRowOffset}a.rowPageIndex++;a.callParent(arguments);a.emptyNormalGrid();a.emptyLockedGrid()},commitPage:function(b){var a=this;a.callParent([Ext.apply({row:a.rowPageIndex,column:a.columnPageIndex},b)]);a.secondaryCanvasOffset-=b.rowsHeight;a.depsTopOffset-=b.rowsHeight},getExpectedPagesPerColumn:function(){return this.pagesPerColumn||Math.ceil((this.normalRowsHeight||this.component.store.count()*this.component.getRowHeight())/this.printHeight)},getExpectedColumnsNumber:function(){return this.pageFrames?this.pageFrames.length:Math.ceil((this.lockedGrid.getWidth()+this.ticks.length*this.view.timeAxisViewModel.getTickWidth())/this.paperWidth)},getExpectedNumberOfPages:function(){return this.getExpectedColumnsNumber()*this.getExpectedPagesPerColumn()},calculateLockedColumnPages:function(){var e=this,d=[],f=e.lockedColumns,c=e.paperWidth,a;for(var b=0,i=f.length;b<i;b++){var h=f[b],g=h.width;a=a||{start:b,end:b};c-=g;if(c<0){d.push(a);if(c){a={start:b,end:b}}c=e.paperWidth-g+c}else {a.end=b}}if(a){a.leftWidth=c;d.push(a)}return d},getPageTplData:function(a){return Ext.apply(this.callParent(arguments),{title:a.number+' of '+this.numberOfPages+' (column: '+a.column+', row: '+a.row+')'})},showLockedColumns:function(b,c){var g=this,d=g.lockedColumns,f=0;b=b||0;c=c||d.length-1;for(var a=0;a<d.length;a++){var e=d[a];if(a>=b&&a<=c){e.column.show();f+=e.width}else {e.column.hide()}}return f},removeInvisibleEvents:function(d,c){var a=this,e=a.getNormalGridBody(),b=a.normalView.eventSelector;Ext.Array.each(Ext.fly(e).select(b).elements,function(b){var e=parseInt(b.style.left,10),f=e+parseInt(b.style.width,10);if(f<d||e>c){a.removeNode(b)}})},removeHiddenLockedColumns:function(c){var a=this,j=a.getCurrentPage(),g=a.getLockedGridBody();for(var b=0;b<a.lockedColumns.length;b++){var d=a.lockedColumns[b].column;if(b<c.start||b>c.end){var e='#'+d.getId();var h=j.select(e);a.removeNode(h);var f=d.getCellSelector();var i=Ext.fly(g).select(f);a.removeNode(i)}}},fitComponentIntoPage:function(){var a=this,b=a.getComponent();b.setWidth(a.paperWidth)},prepareComponent:function(d,b){var a=this,c=a.lockedColumns=[];a.callParent(arguments);if(!(b.columns&&b.columns.length===0)){a.lockedGrid.headerCt.items.each(function(a){if(!a.hidden){c.push({column:a,width:a.getWidth()})}})}},restoreComponentState:function(){this.callParent(arguments);this.showLockedColumns()},preparePageToCommit:function(i){var a=this,b=a.callParent(arguments),f=b.down('.'+Ext.baseCSSPrefix+'splitter',!0),c=b.selectNode('.sch-dependencyview-ct'),e=a.pageFrames[a.columnPageIndex-1];if(f){if(e.lockedHidden){f.style.display='none';b.down('.'+Ext.baseCSSPrefix+'grid-inner-normal',!0).style.left=0}else {Ext.fly(f).setHeight('100%')}}if(!e.normalHidden){if(c){c.innerHTML=a.dependenciesHtml;c.style.top=a.depsTopOffset+'px';c.style.visibility='visible'}var d=b.selectNode('#'+a.normalView.id);if(d){var h=a.normalView.getEl().down(a.tableSelector).getWidth();d.style.width=h+'px';d.style.overflow='hidden'}}if(!e.lockedHidden){var g=b.selectNode('#'+a.lockedView.id);if(g){g.style.overflow='hidden'}}return b}});Ext.define('Sch.plugin.exporter.MultiPageVertical',{extend:'Sch.plugin.exporter.AbstractExporter',config:{id:'multipagevertical'},minRowHeight:20,minAverageColumnWidth:100,visibleColumns:null,visibleColumnsWidth:0,depsTopOffset:0,onRowsCollected:function(c,b){var a=this;a.depsTopOffset=-a.firstExportedRowOffset;a.iterateAsync(function(m,i){if(i===b.length){a.onPagesExtracted();return}var d=i,h=a.printHeight,f=0,j=[],l=[],k=!1,e,g;a.startPage();while(!k&&d<b.length){e=b[d];g=c[d];h-=e.height;if(h>0){f+=e.height;g&&j.push(g);l.push(e);d++}else {k=!0}}a.fillGrids(j,l);a.commitPage({rowIndex:d,rowsHeight:f});a.secondaryCanvasOffset-=f;m(d)},a,0)},startPage:function(){var a=this;a.callParent(arguments);var b=a.getCurrentPage().select('#'+a.lockedView.id).first();b.dom.style.overflow='visible'},commitPage:function(b){var a=this;a.callParent(arguments);if(a.depView&&a.depView.getDependencyStore()){a.depsTopOffset-=b.rowsHeight}},getExpectedNumberOfPages:function(){return Math.ceil(this.normalRowsHeight/this.printHeight)},prepareColumns:function(b){this.callParent(arguments);var a=this,c=a.visibleColumns=[];a.visibleColumnsWidth=0;if(b&&b.length===0){return}a.lockedGrid.headerCt.items.each(function(b){if(!b.hidden){c.push({column:b,width:b.getWidth()});a.visibleColumnsWidth+=b.getWidth()}})},fitComponentIntoPage:function(){var a=this,d=a.getComponent(),m=d.getSchedulingView(),j=d.normalGrid,i=d.lockedGrid,k=a.getTotalWidth(),l=a.ticks,h=a.timeColumnWidth||m.timeAxisViewModel.getTickWidth();var b=Math.floor(a.visibleColumnsWidth/k*a.paperWidth);var g=a.visibleColumns.length,c=g*a.minAverageColumnWidth;c=c>a.paperWidth/2?Math.floor(a.paperWidth/2):c;b=c>b?c:b;var e=a.paperWidth-b;var f=e/l.length;a.setRowHeight(f/h*a.getRowHeight());d.setWidth(a.paperWidth);j.setWidth(e);i.setWidth(b);a.fitLockedColumnWidth(b);d.setTimeColumnWidth(f)},setRowHeight:function(b){var a=this;a.component.setRowHeight(b<a.minRowHeight?a.minRowHeight:b)},fitLockedColumnWidth:function(e){var h=this,a=this.visibleColumns;var f=e/h.visibleColumnsWidth;if(a.length){for(var b=0;b<a.length;b++){var c=a[b],d=c.width,g=Math.floor(d*f);c.column.setWidth(g)}this._restoreColumnWidth=!0}},restoreComponentState:function(c){var e=this;c=c||e.getComponent();if(this._restoreColumnWidth){var b=this.visibleColumns;for(var a=0;a<b.length;a++){var d=b[a];d.column.setWidth(d.width)}}this.callParent(arguments)},preparePageToCommit:function(){var a=this,c=a.callParent(arguments),b=c.selectNode('.sch-dependencyview-ct');if(b){b.innerHTML=a.dependenciesHtml;b.style.top=a.depsTopOffset+'px';b.style.left='0px';b.style.visibility='visible'}var g=a.normalView.getEl().down(a.tableSelector).getWidth();var d=c.selectNode('#'+a.normalView.id);d.style.width=g+'px';d.style.overflow='hidden';var f=c.selectNode('#'+a.lockedView.id);f.style.overflow='hidden';var e=c.selectNode('.'+Ext.baseCSSPrefix+'splitter');if(e){e.style.height='100%'}return c}});Ext.define('Sch.widget.ResizePicker',{extend:'Ext.Panel',alias:'widget.dualrangepicker',width:200,height:200,border:!0,collapsible:!1,bodyStyle:'position:absolute; margin:5px',verticalCfg:{height:120,value:24,increment:2,minValue:20,maxValue:80,reverse:!0,disabled:!0},horizontalCfg:{width:120,value:100,minValue:25,increment:5,maxValue:200,disable:!0},initComponent:function(){var a=this;a.horizontalCfg.value=a.dialogConfig.columnWidth;a.verticalCfg.value=a.dialogConfig.rowHeight;a.verticalCfg.disabled=a.dialogConfig.scrollerDisabled||!1;a.dockedItems=[a.vertical=new Ext.slider.Single(Ext.apply({dock:'left',style:'margin-top:10px',vertical:!0,stateful:a.dialogConfig.stateful,stateId:'exporter_resize_vertical',stateEvents:['change'],listeners:{change:a.onSliderChange,changecomplete:a.onSliderChangeComplete,scope:a}},a.verticalCfg)),a.horizontal=new Ext.slider.Single(Ext.apply({dock:'top',style:'margin-left:28px',stateful:a.dialogConfig.stateful,stateId:'exporter_resize_horizontal',stateEvents:['change'],listeners:{change:a.onSliderChange,changecomplete:a.onSliderChangeComplete,scope:a}},a.horizontalCfg))];a.callParent(arguments)},afterRender:function(){var a=this;a.addCls('sch-ux-range-picker');a.valueHandle=a.body.createChild({cls:'sch-ux-range-value',cn:{tag:'span'}});a.valueSpan=a.valueHandle.down('span');var b=new Ext.dd.DD(a.valueHandle);Ext.apply(b,{startDrag:function(){a.dragging=!0;this.constrainTo(a.body)},onDrag:function(){a.updateValuesFromHandles()},endDrag:function(){a.updateValuesFromHandles();a.dragging=!1}});a.setValues(a.getValues());a.callParent(arguments);a.body.on('click',a.onBodyClick,a)},onBodyClick:function(b,c){var a=[b.getXY()[0]-8-this.body.getX(),b.getXY()[1]-8-this.body.getY()];this.valueHandle.setLeft(Ext.Number.constrain(a[0],0,this.getAvailableWidth()));this.valueHandle.setTop(Ext.Number.constrain(a[1],0,this.getAvailableHeight()));this.updateValuesFromHandles();this.onSliderChangeComplete()},updateValuesFromHandles:function(){this.setValues(this.getValuesFromXY())},getAvailableWidth:function(){return this.body.getWidth()-18},getAvailableHeight:function(){return this.body.getHeight()-18},getValuesFromXY:function(a){a=a||[this.valueHandle.getLeft(!0),this.valueHandle.getTop(!0)];var d=a[0]/this.getAvailableWidth();var e=a[1]/this.getAvailableHeight();var b=Math.round((this.horizontalCfg.maxValue-this.horizontalCfg.minValue)*d);var c=Math.round((this.verticalCfg.maxValue-this.verticalCfg.minValue)*e)+this.verticalCfg.minValue;return [b+this.horizontalCfg.minValue,c]},getXYFromValues:function(a){var c=this.horizontalCfg.maxValue-this.horizontalCfg.minValue;var d=this.verticalCfg.maxValue-this.verticalCfg.minValue;var e=Math.round((a[0]-this.horizontalCfg.minValue)*this.getAvailableWidth()/c);var b=a[1]-this.verticalCfg.minValue;var f=Math.round(b*this.getAvailableHeight()/d);return [e,f]},updatePosition:function(){var a=this.getValues();var b=this.getXYFromValues(a);this.valueHandle.setLeft(Ext.Number.constrain(b[0],0,this.getAvailableWidth()));if(this.verticalCfg.disabled){this.valueHandle.setTop(this.dialogConfig.rowHeight)}else {this.valueHandle.setTop(Ext.Number.constrain(b[1],0,this.getAvailableHeight()))}this.positionValueText();this.setValueText(a)},positionValueText:function(){var b=this.valueHandle.getTop(!0);var a=this.valueHandle.getLeft(!0);this.valueSpan.setLeft(a>30?-30:10);this.valueSpan.setTop(b>10?-20:20)},setValueText:function(a){if(this.verticalCfg.disabled){a[1]=this.dialogConfig.rowHeight}this.valueSpan.update('['+a.toString()+']')},setValues:function(a){this.horizontal.setValue(a[0]);if(this.verticalCfg.reverse){if(!this.verticalCfg.disabled){this.vertical.setValue(this.verticalCfg.maxValue+this.verticalCfg.minValue-a[1])}}else {if(!this.verticalCfg.disabled){this.vertical.setValue(a[1])}}if(!this.dragging){this.updatePosition()}this.positionValueText();this.setValueText(a)},getValues:function(){if(!this.verticalCfg.disabled){var a=this.vertical.getValue();if(this.verticalCfg.reverse){a=this.verticalCfg.maxValue-a+this.verticalCfg.minValue}return [this.horizontal.getValue(),a]}return [this.horizontal.getValue()]},onSliderChange:function(){if(!this.rendered){return}this.fireEvent('change',this,this.getValues());if(!this.dragging){this.updatePosition()}},onSliderChangeComplete:function(){this.fireEvent('changecomplete',this,this.getValues())},afterLayout:function(){this.callParent(arguments);this.updatePosition()}});Ext.define('Sch.widget.ColumnPicker',{extend:'Ext.form.field.ComboBox',requires:['Ext.data.Store'],multiSelect:!0,valueField:'id',displayField:'name',forceSelection:!0,editable:!1,listConfig:{htmlEncode:!0,cls:'sch-columnpicker-list',selectedItemCls:Ext.baseCSSPrefix+'fa fa-check'},columns:null,columnEmptyText:null,columnEmptyRegExp:/^(\s*|&(nbsp|#160);)$/,initComponent:function(){this.store=new Ext.data.Store({proxy:'memory',fields:['id','name','column'],data:this.processColumns(this.columns)});this.callParent(arguments)},processColumns:function(b){var d=this,a=[],c=Ext.Array.map(b||[],function(b){if(!b.isHidden()){a.push(b.id)}return {id:b.id,name:d.getColumnTitle(b),column:b}});this.value=this.value||a;return c},getColumnTitle:function(a){var b=this;return !Ext.String.trim(a.text)||a.text.match(b.columnEmptyRegExp)?b.columnEmptyText:a.text},getPicker:function(){var a=this.callParent(arguments);a.selectedItemCls+=' '+Ext.baseCSSPrefix+'fa fa-check';return a},getSelectedColumns:function(){var b=this,a=b.getValue();if(!Ext.isArray(a)){a=[a]}return Ext.Array.map(a,function(a){return b.store.getById(a).get('column')})}});Ext.define('Sch.widget.ExportDialogForm',{extend:'Ext.form.Panel',requires:['Ext.data.Store','Ext.XTemplate','Ext.form.field.Number','Ext.form.field.ComboBox','Ext.form.field.Date','Ext.form.FieldContainer','Ext.form.field.Checkbox','Sch.widget.ResizePicker','Sch.widget.ColumnPicker'],mixins:['Sch.mixin.Localizable'],alias:'widget.export_dialog_form',border:!1,bodyPadding:'10 10 0 10',autoHeight:!0,stateful:!0,rangeField:null,resizerHolder:null,resizePicker:null,dateFromField:null,dateToField:null,datesHolder:null,columnPicker:null,rowsRangeField:null,exportersField:null,formatField:null,orientationField:null,dpiField:null,showHeaderField:null,showFooterField:null,dateRangeFormat:'',columnPickerConfig:null,dpiFieldConfig:null,dateRangeRestriction:!0,rangeFieldConfig:null,rowsRangeFieldConfig:null,formatFieldConfig:null,orientationFieldConfig:null,exportersFieldConfig:null,showHeaderFieldConfig:null,showFooterFieldConfig:null,dateFromFieldConfig:null,dateToFieldConfig:null,showResizePicker:!1,showColumnPicker:!0,showDPIField:!0,showShowHeaderField:!0,showShowFooterField:!1,showRowsRangeField:!0,initComponent:function(){var a=this;a.fieldDefaults=Ext.apply({labelAlign:'left',labelWidth:120,anchor:'99%'},a.fieldDefaults);a.items=a.createFields();a.callParent(arguments);a.onRangeChange(a.rangeField,a.rangeField.getValue());a.onExporterChange(a.exportersField,a.exportersField.getValue())},isValid:function(){var a=this;if(a.rangeField.getValue()=='date'){return a.dateFromField.isValid()&&a.dateToField.isValid()}return !0},getValues:function(c,f,d,e){var a=this.callParent(arguments);if(this.showShowHeaderField){a.showHeader=!!a.showHeader}if(this.showShowFooterField){a.showFooter=!!a.showFooter}a.onlyVisibleRows=!!a.onlyVisibleRows;if(this.resizePicker&&this.rangeField.getValue()=='current'){var b=this.resizePicker.getValues();if(c){a+='&cellSize[0]='+b[0]+'&cellSize[1]='+b[1]}else {a.cellSize=b}}if(this.columnPicker){a.columns=this.columnPicker.getSelectedColumns()}return a},createFields:function(){var a=this,c='<table class="sch-fieldcontainer-label-wrap"><td width="1" class="sch-fieldcontainer-label">',d='<td><div class="sch-fieldcontainer-separator"></div></table>';if(a.showResizePicker){a.resizePicker=new Sch.widget.ResizePicker({dialogConfig:a,margin:'10 20'});a.resizerHolder=new Ext.form.FieldContainer({fieldLabel:a.scrollerDisabled?a.L('adjustCols'):a.L('adjustColsAndRows'),labelAlign:'top',hidden:!0,labelSeparator:'',beforeLabelTextTpl:c,afterLabelTextTpl:d,layout:'vbox',defaults:{flex:1,allowBlank:!1},items:[a.resizePicker]})}a.dateFromField=Ext.ComponentManager.create(Ext.apply(a.applyStateful({xtype:'datefield',fieldLabel:a.L('dateRangeFromText'),baseBodyCls:'sch-exportdialogform-date',name:'dateFrom',format:a.dateRangeFormat||Ext.Date.defaultFormat,allowBlank:!1,maxValue:a.dateRangeRestriction&&a.endDate||null,minValue:a.dateRangeRestriction&&a.startDate||null,value:a.startDate}),a.dateFromFieldConfig));a.dateToField=Ext.ComponentManager.create(Ext.apply(a.applyStateful({xtype:'datefield',fieldLabel:a.L('dateRangeToText'),name:'dateTo',format:a.dateRangeFormat||Ext.Date.defaultFormat,baseBodyCls:'sch-exportdialogform-date',allowBlank:!1,maxValue:a.dateRangeRestriction&&a.endDate||null,minValue:a.dateRangeRestriction&&a.startDate||null,value:a.endDate}),a.dateToFieldConfig));a.datesHolder=new Ext.form.FieldContainer({fieldLabel:a.L('specifyDateRange'),labelAlign:'top',hidden:!0,labelSeparator:'',beforeLabelTextTpl:c,afterLabelTextTpl:d,layout:'vbox',defaults:{flex:1,allowBlank:!1},items:[a.dateFromField,a.dateToField]});if(a.showColumnPicker){a.columnPicker=new Sch.widget.ColumnPicker(a.applyStateful(Ext.apply({fieldLabel:a.L('columnPickerLabel'),columnEmptyText:a.L('columnEmptyText'),cls:'sch-export-dialog-columns'},a.columnPickerConfig)))}if(a.showDPIField){a.dpiField=Ext.ComponentManager.create(Ext.apply(a.applyStateful({xtype:'numberfield',fieldLabel:a.L('dpiFieldLabel'),cls:'sch-export-dialog-dpi',minValue:65,name:'DPI',value:a.exportConfig.DPI,maxValue:200}),a.dpiFieldConfig))}if(a.showShowHeaderField){a.showHeaderField=Ext.ComponentManager.create(Ext.apply(a.applyStatefulFull({xtype:'checkbox',fieldLabel:a.L('showHeaderLabel'),cls:'sch-export-dialog-header',name:'showHeader',checked:!!a.exportConfig.showHeader,checkedValue:!0,uncheckedValue:!1}),a.showHeaderFieldConfig))}if(a.showShowFooterField){a.showFooterField=Ext.ComponentManager.create(Ext.apply(a.applyStatefulFull({xtype:'checkbox',fieldLabel:a.L('showFooterLabel'),cls:'sch-export-dialog-footer',name:'showFooter',checked:!!a.exportConfig.showFooter,checkedValue:!0,uncheckedValue:!1}),a.showFooterFieldConfig))}a.formatField=Ext.ComponentManager.create(Ext.Object.merge(a.applyStateful({xtype:'combobox',listConfig:{htmlEncode:!0},fieldLabel:a.L('formatFieldLabel'),value:a.exportConfig.format,triggerAction:'all',forceSelection:!0,editable:!1,name:'format',queryMode:'local',store:a.pageFormats||['A5','A4','A3','Letter','Legal']}),a.formatFieldConfig));a.orientationField=Ext.ComponentManager.create(Ext.Object.merge(a.applyStateful({xtype:'combobox',listConfig:{htmlEncode:!0},fieldLabel:a.L('orientationFieldLabel'),value:a.exportConfig.orientation,triggerAction:'all',forceSelection:!0,editable:!1,name:'orientation',displayField:'name',valueField:'value',queryMode:'local',store:{fields:['name','value'],data:[{name:a.L('orientationPortraitText'),value:'portrait'},{name:a.L('orientationLandscapeText'),value:'landscape'}]}}),a.orientationFieldConfig));a.rangeField=Ext.ComponentManager.create(Ext.Object.merge(a.applyStateful({xtype:'combobox',listConfig:{htmlEncode:!0},fieldLabel:a.L('rangeFieldLabel'),value:a.exportConfig.range,triggerAction:'all',cls:'sch-export-dialog-range',forceSelection:!0,editable:!1,name:'range',queryMode:'local',displayField:'name',valueField:'value',store:{fields:['name','value'],data:[{name:a.L('completeViewText'),value:'complete'},{name:a.L('completeDataText'),value:'completedata'},{name:a.L('dateRangeText'),value:'date'},{name:a.L('currentViewText'),value:'current'}]}}),a.rangeFieldConfig));a.mon(a.rangeField,'change',a.onRangeChange,a);a.exportersField=Ext.ComponentManager.create(Ext.Object.merge(a.applyStateful({xtype:'combobox',listConfig:{htmlEncode:!0},fieldLabel:a.L('exportersFieldLabel'),value:a.defaultExporter,triggerAction:'all',cls:'sch-export-dialog-exporter',forceSelection:!0,editable:!1,name:'id',queryMode:'local',displayField:'name',valueField:'value',store:{fields:['name','value'],data:Ext.Array.map(a.exporters,function(a){return {name:a.getName(),value:a.getId()}})}}),a.exportersFieldConfig));a.mon(a.exportersField,'change',a.onExporterChange,a);if(a.showRowsRangeField){a.rowsRangeField=Ext.ComponentManager.create(Ext.Object.merge(a.applyStateful({xtype:'combobox',listConfig:{htmlEncode:!0},fieldLabel:a.L('rowsRangeLabel'),value:a.exportConfig.rowsRange,triggerAction:'all',cls:'sch-export-dialog-rowsrange',forceSelection:!0,editable:!1,name:'rowsRange',queryMode:'local',displayField:'name',valueField:'value',store:{fields:['name','value'],data:[{name:a.L('allRowsLabel'),value:'all'},{name:a.L('visibleRowsLabel'),value:'visible'}]}}),a.rowsRangeFieldConfig))}var b=[];b.push(a.rangeField);if(a.resizerHolder){b.push(a.resizerHolder)}b.push(a.datesHolder);if(a.columnPicker){b.push(a.columnPicker)}if(a.rowsRangeField){b.push(a.rowsRangeField)}b.push(a.exportersField,a.formatField,a.orientationField);if(a.dpiField){b.push(a.dpiField)}if(a.showHeaderField){b.push(a.showHeaderField)}if(a.showFooterField){b.push(a.showFooterField)}return b},applyStateful:function(a){if(!this.stateful){return a}var c=this,b=c.stateId||'exporter';return Ext.applyIf(a,{stateful:!0,stateId:b+'_'+a.name})},applyStatefulFull:function(b){if(!this.stateful){return b}var a=this;return Ext.apply(a.applyStateful(b),{stateEvents:['change'],applyState:a.applyFieldState,getState:a.getFieldState})},getFieldState:function(){return {value:this.getValue()}},applyFieldState:function(a){if('value' in a){this.setValue(a.value)}},onRangeChange:function(b,a){switch(a){case 'complete':case 'completedata':this.datesHolder.hide();this.resizerHolder&&this.resizerHolder.hide();break;case 'date':this.datesHolder.show();this.resizerHolder&&this.resizerHolder.hide();break;case 'current':this.datesHolder.hide();if(this.resizerHolder){this.resizerHolder.show();this.resizePicker.expand(!0)};break;}},onExporterChange:function(b,a){switch(a){case 'singlepage':this.disableFields(!0);break;default:this.disableFields(!1);}},disableFields:function(a){var b=this;b.formatField.setDisabled(a);b.orientationField.setDisabled(a)}});Ext.define('Sch.widget.ExportDialog',{alternateClassName:'Sch.widget.PdfExportDialog',extend:'Ext.window.Window',requires:['Ext.ProgressBar','Sch.widget.ExportDialogForm'],mixins:['Sch.mixin.Localizable'],alias:'widget.exportdialog',width:450,cls:'sch-exportdialog',frame:!1,layout:'fit',draggable:!0,constrain:!0,progressBar:null,buttonsPanel:null,buttonsPanelScope:null,doExportFnScope:null,doExportFn:function(a,b,c){throw 'Sch.widget.ExportDialog: doExportFn needs to be set in the config'},form:null,defaultFormXType:'export_dialog_form',exportButtonConfig:null,cancelButtonConfig:null,formConfigs:'pageFormats,startDate,endDate,rowHeight,columnWidth,defaultExporter,exporters,'+'dateRangeFormat,exportConfig,showColumnPicker,columnPickerConfig,showDPIField,dpiFieldConfig,showShowHeaderField,'+'showShowFooterField,showResizePicker,stateful,stateId,dateRangeRestriction,showRowsRangeField,'+'rowsRangeFieldConfig,rangeFieldConfig,formatFieldConfig,orientationFieldConfig,exportersFieldConfig',constructor:function(a){Ext.apply(this,a);this.title=this.title||this.L('title');this.callParent(arguments)},mapFormConfigs:function(){this.form=this.form||{};var a=this.form;var d=this.formConfigs.split(',');for(var c=0,e=d.length;c<e;c++){var b=d[c];if(this.hasOwnProperty(b)&&!a.hasOwnProperty(b)){a[b]=this[b]}}if(this.hasOwnProperty('showFooterField')&&!a.hasOwnProperty('showShowFooterField')){a.showShowFooterField=this.showFooterField}if(this.hasOwnProperty('showHeaderField')&&!a.hasOwnProperty('showShowHeaderField')){a.showShowHeaderField=this.showHeaderField}if(a.stateId){a.stateId='form_'+a.stateId}},initComponent:function(){var a=this;if(!a.form||!a.form.isForm){a.mapFormConfigs();a.form=a.buildForm()}a.buttonsPanel=a.buttonsPanel||a.buildButtons(a.buttonsPanelScope||a);Ext.apply(a,{items:{items:[a.form,a.progressBar||a.buildProgressBar()]},fbar:a.buttonsPanel});a.callParent(arguments)},afterRender:function(){var a=this;if(a.form.resizePicker){a.relayEvents(a.form.resizePicker,['change','changecomplete','select'])}a.callParent(arguments)},buildButtons:function(b){var a=this;return [Ext.apply({xtype:'button',scale:'medium',itemId:'export',text:a.L('exportButtonText'),handler:a.onExportButtonPress,scope:b||a},a.exportButtonConfig),Ext.apply({xtype:'button',scale:'medium',itemId:'cancel',text:a.L('cancelButtonText'),handler:a.onCancelButtonPress,scope:b||a},a.cancelButtonConfig)]},onExportButtonPress:function(){if(this.form.isValid()){var a=this.form.getValues();this.beforeExport();var b=this.dateRangeFormat||Ext.Date.defaultFormat;if(a.dateFrom&&!Ext.isDate(a.dateFrom)){a.dateFrom=Ext.Date.parse(a.dateFrom,b)}if(a.dateTo&&!Ext.isDate(a.dateTo)){a.dateTo=Ext.Date.parse(a.dateTo,b)}this.doExportFn.call(this.doExportFnScope||this,a,this.onExportSuccess,this.onExportFailure)}},afterExport:function(){var a=this.down('#export');a&&a.enable();this.progressBar&&this.progressBar.hide()},beforeExport:function(){var a=this.down('#export');a&&a.disable();this.progressBar&&this.progressBar.show()},onExportSuccess:function(){this.afterExport()},onExportFailure:function(){this.afterExport()},onCancelButtonPress:function(){this.destroy()},buildForm:function(a){this.form=Ext.apply(this.form||{},a);return Ext.ComponentManager.create(this.form,this.defaultFormXType)},buildProgressBar:function(){return this.progressBar=new Ext.ProgressBar({text:this.L('progressBarText'),animate:!0,hidden:!0,margin:'4px 10px 10px 10px'})}});Ext.define('Sch.plugin.Export',{extend:'Ext.util.Observable',alternateClassName:'Sch.plugin.PdfExport',alias:'plugin.scheduler_export',mixins:['Ext.AbstractPlugin','Sch.mixin.Localizable'],requires:['Ext.XTemplate','Sch.plugin.exporter.SinglePage','Sch.plugin.exporter.MultiPage','Sch.plugin.exporter.MultiPageVertical','Sch.widget.ExportDialog'],lockableScope:'top',pageSizes:{A5:{width:5.8,height:8.3},A4:{width:8.3,height:11.7},A3:{width:11.7,height:16.5},Letter:{width:8.5,height:11},Legal:{width:8.5,height:14}},enableWebSocket:!1,DPI:95,printServer:undefined,timeout:60000,headerTpl:null,headerTplDataFn:null,headerTplDataFnScope:null,tpl:null,footerTpl:null,footerTplDataFn:null,footerTplDataFnScope:null,exportDialogClassName:'Sch.widget.ExportDialog',exportDialogConfig:{},exporterConfig:null,exportConfig:{format:'A4',orientation:'portrait',range:'complete',rowsRange:'all',showHeader:!0,showFooter:!1},expandAllBeforeExport:!1,translateURLsToAbsolute:!0,openAfterExport:!0,openInNewTab:!1,beforeExport:Ext.emptyFn,afterExport:Ext.emptyFn,fileFormat:'pdf',defaultExporter:'multipage',exporters:undefined,callbacks:undefined,currentAjaxRequest:undefined,currentWebSocketRequest:undefined,hideExportDialogTimeout:1000,constructor:function(b){var a=this;b=b||{};a.exportersIndex={};if(b.exportDialogConfig){Ext.Object.each(this.exportConfig,function(c,e,d){var a=b.exportDialogConfig[c];if(a){d[c]=a}})}if(!('WebSocket' in window)){b.enableWebSocket=!1}a.callParent([b]);a.setFileFormat(a.fileFormat);if(!a.exporters){a.exporters=a.buildExporters()}a.initExporters();a.bindExporters()},init:function(b){var a=this;b.showExportDialog=Ext.Function.bind(a.showExportDialog,a);b.doExport=Ext.Function.bind(a.doExport,a);a.scheduler=b},initExporters:function(){var c=this,b=c.exporters;for(var a=0;a<b.length;a++){if(!b[a].isExporter){b[a]=c.createExporter(b[a])}}},bindExporters:function(){var b=this.exporters;for(var a=0;a<b.length;a++){this.bindExporter(b[a])}},bindExporter:function(b){var a=this;a.mon(b,{commitpage:a.onPageCommit,collectrows:a.onRowCollected,scope:a})},unbindExporter:function(b){var a=this;a.mun(b,{commitpage:a.onPageCommit,collectrows:a.onRowCollected,scope:a})},buildExporters:function(){return ['Sch.plugin.exporter.SinglePage','Sch.plugin.exporter.MultiPage','Sch.plugin.exporter.MultiPageVertical']},getExporterConfig:function(c,d){var a=this;var b=Ext.apply({translateURLsToAbsolute:a.translateURLsToAbsolute,expandAllBeforeExport:a.expandAllBeforeExport,DPI:a.DPI},a.exporterConfig);if(a.headerTpl){b.headerTpl=a.headerTpl}if(a.headerTplDataFn){b.headerTplDataFn=a.headerTplDataFn;b.headerTplDataFnScope=a.headerTplDataFnScope}if(a.tpl){b.tpl=a.tpl}if(a.footerTpl){b.footerTpl=a.footerTpl}if(a.footerTplDataFn){b.footerTplDataFn=a.footerTplDataFn;b.footerTplDataFnScope=a.footerTplDataFnScope}return b},createExporter:function(a,c){var d=this,b=d.getExporterConfig(a,c);if(Ext.isObject(a)){return Ext.create(Ext.apply(b,a))}else {return Ext.create(a,Ext.apply(b,c))}},registerExporter:function(a,b){if(!(a instanceof Sch.plugin.exporter.AbstractExporter)){a=this.createExporter.apply(this,arguments)}this.exporters.push(a);this.bindExporter(a)},getExporter:function(b){if(!b){return}var a=this.exportersIndex[b];if(a){return a}a=this.exportersIndex[b]=Ext.Array.findBy(this.exporters,function(a){return a.getId()==b});return a},getExporters:function(){return this.exporters},setFileFormat:function(a){this.fileFormat=a},showExportDialog:function(){var a=this,b=a.getActiveExportDialog();if(b){b.destroy()}a.setActiveExportDialog(a.buildExportDialog());b=a.getActiveExportDialog();b.on('destroy',a.onExportDialogDestroy,a);if(b.progressBar){b.mon(a,{progressupdate:a.onExportProgress,scope:a})}b.show()},buildExportDialog:function(){return Ext.create(this.exportDialogClassName,this.buildExportDialogConfig())},buildExportDialogConfig:function(){var a=this,b=a.scheduler.getSchedulingView();return Ext.Object.merge({doExportFn:a.doExport,doExportFnScope:a,startDate:Ext.Date.clone(a.scheduler.getStart()),endDate:Ext.Date.clone(a.scheduler.getEnd()),rowHeight:b.timeAxisViewModel.getViewRowHeight(),columnWidth:b.timeAxisViewModel.getTickWidth(),defaultExporter:a.defaultExporter,exportConfig:Ext.apply(a.exportConfig,{DPI:a.DPI}),exporters:a.exporters,pageFormats:a.getPageFormats(),columnPickerConfig:{columns:a.scheduler.lockedGrid.query('gridcolumn[ignoreInExport!=true]')}},a.exportDialogConfig)},onExportDialogDestroy:function(){this.cancelExport();this.setActiveExportDialog(null)},onExportProgress:function(d,c){var b=this.getActiveExportDialog(),a=b&&b.progressBar;if(a){a.updateProgress(d);if(typeof c=='string'){a.updateText(c)}}},showError:function(a){Ext.Msg.alert('',a||this.L('generalError'))},getPageFormats:function(){var b=this.pageSizes,a=[];Ext.Object.each(b,function(c,b){a.push({width:b.width,height:b.height,name:c})});return Ext.Array.map(a.sort(function(a,b){return a.width-b.width}),function(a){return a.name})},getExportConfig:function(c){var b=this;var a=Ext.apply({fileFormat:b.fileFormat,id:b.defaultExporter,beforeExport:Ext.Function.bind(b.beforeExport,b),afterExport:Ext.Function.bind(b.afterExport,b)},c,b.exportConfig);a.DPI=a.DPI||b.DPI;a.pageSize=Ext.apply({},b.pageSizes[a.format]);a.pageSize.width*=a.DPI;a.pageSize.height*=a.DPI;return a},doExport:function(h,e,f,g){var a=this,c=a.scheduler,b=a.getExportConfig(h);a.callbacks={success:e,failure:f,scope:g||a};var d=a.exporter=a.getExporter(b.id);if(a.fireEvent('beforeexport',c,d,b)!==!1){a.myBeforeExport();a.exporter.extractPages(c,b,function(e){a.onPagesExtracted(e,c,d,b)},a)}},cancelExport:function(){if(this.currentAjaxRequest){Ext.Ajax.abort(this.currentAjaxRequest);this.currentAjaxRequest=null}else {if(this.currentWebSocketRequest){this.currentWebSocketRequest.close();this.currentWebSocketRequest=null}else {if(this.exporter){this.exporter.abort()}}}this.scheduler.getEl().unmask()},onPagesExtracted:function(b,c,d,a){this.fireEvent('progressupdate',0.8,this.L('requestingPrintServer'));if(this.enableWebSocket){this.doSocketRequest(b,a)}else {this.doRequest(b,a)}},onRowCollected:function(d,c,a,b){this.fireEvent('progressupdate',0.2*(a+1)/b,Ext.String.format(this.L('fetchingRows'),a,b))},onPageCommit:function(c,d,b,a){a=Math.max(b,a);this.fireEvent('progressupdate',0.2+0.6*b/a,Ext.String.format(this.L('builtPage'),b,a))},onExportSuccess:function(d){var a=this,e=a.getActiveExportDialog(),c=a.callbacks,f=c&&c.success,g=c&&c.scope||a;a.fireEvent('progressupdate',1);a.myAfterExport(!0,d.url);f&&f.apply(g,arguments);a.hideExportDialogTimer=setTimeout(function(){e&&e.destroy()},a.hideExportDialogTimeout);if(a.openAfterExport){if(Ext.isIE){window.open(d.url,'ExportedPanel')}else {var b=document.createElement('a');b.download='export';b.href=d.url;if(a.openInNewTab){b.target='_blank'}document.body.appendChild(b);b.click();document.body.removeChild(b)}}},onExportFailure:function(c,f){var a=this,e=this.getActiveExportDialog(),b=a.callbacks,d=b&&b.failure,g=b&&b.scope||a;d&&d.call(g,c);a.fireEvent('error',e,c,f);a.showError(c);a.myAfterExport(!1,null)},doSocketRequest:function(e,d){var a=this,c=a.scheduler;if(a.printServer){var g=this.printServer.replace(/^http(s)?/i,'ws');var f=Ext.encode(Ext.apply({html:e,startDate:c.getStartDate(),endDate:c.getEndDate(),format:a.exporter.getPaperFormat(),orientation:d.orientation,range:d.range,fileFormat:a.fileFormat},this.getParameters()));var b=new WebSocket(g);a.currentWebSocketRequest=b;b.onopen=function(){b.send(f)};b.onmessage=function(d){var c=Ext.decode(d.data);b.close();a.currentWebSocketRequest=null;if(c.success){c.url=a.printServer+'/'+c.file;a.onExportSuccess(c)}else {a.onExportFailure(c.msg,c)}}}},doRequest:function(b,f){var a=this,e=a.scheduler;if(!a.test&&!a.debug){if(a.printServer){var c={method:'POST',url:a.printServer,timeout:a.timeout,params:Ext.apply({html:{array:Ext.JSON.encode(b)},startDate:e.getStartDate(),endDate:e.getEndDate(),format:a.exporter.getPaperFormat(),orientation:f.orientation,range:f.range,fileFormat:a.fileFormat},this.getParameters()),success:a.onRequestSuccess,failure:a.onRequestFailure,scope:a};Ext.apply(c,this.getAjaxConfig(c));this.currentAjaxRequest=Ext.Ajax.request(c)}else {a.onExportFailure('Print server URL is not defined, please specify printServer config')}}else {if(a.debug){var g=b||[];for(var d=0,i=g.length;d<i;d++){var h=window.open();h.document.write(g[d].html);h.document.close()}}a.onExportSuccess(a.testResponse||{success:!0,url:'foo',htmlArray:b})}},onRequestSuccess:function(c){this.currentAjaxRequest=null;var b=this,a;try{a=Ext.JSON.decode(c.responseText)}catch(d){b.onExportFailure('Wrong server response received');return}if(a.success){b.onExportSuccess(a)}else {b.onExportFailure(a.msg,a)}},onRequestFailure:function(a){this.currentAjaxRequest=null;var c=this,b=a.status===200?a.responseText:a.statusText;c.onExportFailure(b,a)},getParameters:function(){return {}},getAjaxConfig:function(a){return {}},getActiveExportDialog:function(){return this.win},setActiveExportDialog:function(a){this.win=a},myBeforeExport:function(){this.fireEvent('exportstart',this);var c=this.scheduler.getEl().mask();c.addCls('sch-export-mask');var a=this.getActiveExportDialog(),b=a&&a.progressBar;if(b){b.show()}},myAfterExport:function(a,b){this.fireEvent('afterexport',this,a,b);this.scheduler.getEl().unmask()},destroy:function(){var a=this.getActiveExportDialog();a&&a.destroy();this.callParent(arguments);clearTimeout(this.openAfterExportTimer);clearTimeout(this.hideExportDialogTimer);if(this.getActiveExportDialog()){this.getActiveExportDialog().destroy()}}});Ext.define('Sch.plugin.HeaderTooltip',{extend:'Ext.AbstractPlugin',requires:['Ext.tip.ToolTip','Ext.Date','Sch.view.HorizontalTimeAxis'],alias:'plugin.scheduler_headertooltip',dateFormat:'M j, Y H:i',tipCfg:null,tip:null,tipCls:'sch-header-tooltip',delegateCls:'sch-column-header',init:function(a){a.getSchedulingView().on('afterrender',this.setupTooltip,this)},setupTooltip:function(){var a=this,b=a.getCmp().normalGrid.getHeaderContainer();a.tip=Ext.create(Ext.apply({xtype:'tooltip',cls:a.tipCls,showDelay:0,trackMouse:!0,target:b.getEl(),delegate:'.'+a.delegateCls},a.tipCfg));a.tip.on('beforeshow',a.beforeTipShow,a)},beforeTipShow:function(){var b=this,a=Ext.Date.parse(b.tip.triggerElement.dataset.date,Sch.view.HorizontalTimeAxis.encodeDateFormat);a=this.getCmp().getSchedulingView().convertDateToTimeZone(a);b.tip.update(b.getTipContent(a))},getTipContent:function(a){return Ext.Date.format(a,this.dateFormat)},destroy:function(){if(this.tip){this.tip.destroy()}this.callParent(arguments)}});Ext.define('Sch.plugin.HeaderZoom',{extend:'Sch.util.DragTracker',mixins:['Ext.AbstractPlugin'],alias:'plugin.scheduler_headerzoom',lockableScope:'top',scheduler:null,proxy:null,headerRegion:null,init:function(a){this.scheduler=a;this.onModeChange();a.on('modechange',this.onModeChange,this)},onOrientationChange:function(){return this.onModeChange.apply(this,arguments)},onModeChange:function(){var a=this.scheduler.down('timeaxiscolumn');if(a){if(a.rendered){this.onTimeAxisColumnRender(a)}else {a.on({afterrender:this.onTimeAxisColumnRender,scope:this})}}},onTimeAxisColumnRender:function(a){this.proxy=a.el.createChild({cls:'sch-drag-selector'});this.initEl(a.el)},onStart:function(a){this.proxy.show();this.headerRegion=this.scheduler.normalGrid.headerCt.getRegion()},onDrag:function(c){var a=this.headerRegion;var b=this.getRegion().constrainTo(a);b.top=a.top;b.bottom=a.bottom;this.proxy.setBox(b)},onEnd:function(h){if(this.proxy){this.proxy.setDisplayed(!1);var a=this.scheduler;var g=this.getRegion();var b=a.getSchedulingView().getStartEndDatesFromRegion(g);if(b){var c=a.timeAxis;var e=a.getSchedulingView().timeAxisViewModel.getBottomHeader().unit;var d=c.floorDate(b.start,!1,e,1);var f=c.ceilDate(b.end,!1,e,1);if(this.fireEvent('beforeheaderzoom',this,a,d,f)!==!1){a.zoomToSpan({start:d,end:f})}}}},destroy:function(){if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}this.callParent(arguments)}});Ext.define('Sch.plugin.Pan',{extend:'Ext.AbstractPlugin',alias:'plugin.scheduler_pan',lockableScope:'top',enableVerticalPan:!0,statics:{KEY_SHIFT:1,KEY_CTRL:2,KEY_ALT:4,KEY_ALL:7},disableOnKey:0,constructor:function(a){Ext.apply(this,a)},init:function(a){this.view=a.getSchedulingView();this.view.on('afterrender',this.onRender,this)},onRender:function(){this.view.el.on('mousedown',this.onMouseDown,this)},onMouseDown:function(a){if(a.event.touches&&a.event.touches.length>0||!a.event.touches&&a.button!==0){return}var c=this.self,b=this.disableOnKey;if(a.shiftKey&&b&c.KEY_SHIFT||a.ctrlKey&&b&c.KEY_CTRL||a.altKey&&b&c.KEY_ALT){return}if(a.getTarget(this.view.timeCellSelector,10)&&!a.getTarget(this.view.timeCellSelector+' > div > *')){this.mouseX=a.getX();this.mouseY=a.getY();Ext.getBody().on('mousemove',this.onMouseMove,this);Ext.getDoc().on('mouseup',this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().on('mouseenter',this.onMouseUp,this)}a.stopEvent()}},onMouseMove:function(c){if(this.disabled){return}c.stopEvent();var f=c.getX(),g=c.getY(),b=0,a=this.mouseX-f;if(this.enableVerticalPan){b=this.mouseY-g}this.mouseX=f;this.mouseY=g;var d=this.view.getScroll();b&&this.view.scrollVerticallyTo(Math.max(0,b+d.top),!1);a&&this.view.scrollHorizontallyTo(Math.max(0,a+d.left),!1);var e=this.view.headerCt.getScrollable();e&&e.scrollBy(a,0,!1)},onMouseUp:function(){Ext.getBody().un('mousemove',this.onMouseMove,this);Ext.getDoc().un('mouseup',this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().un('mouseenter',this.onMouseUp,this)}}});Ext.define('Sch.plugin.Printable',{extend:'Sch.plugin.Export',requires:['Ext.XTemplate','Ext.window.Toast'],alternateClassName:['Sch.plugin.Print'],alias:['plugin.scheduler_printable','plugin.scheduler_print'],docType:'<!DOCTYPE HTML>',beforePrint:function(){},afterPrint:function(){},exportDialogConfig:{showDPIField:!0},removeSecondaryCanvas:!1,wrapHeaders:!1,autoPrintAndClose:!0,mainTpl:'{docType}'+'<html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}">'+'<head>'+'<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />'+'<title>{title}</title>'+'{styles}'+'</head>'+'<body class="sch-print-body {bodyClasses}">'+'<div class="sch-print-ct" style="width:{totalWidth}px">'+'<tpl for="pages">{html}</tpl>'+'</div>'+'<script type="text/javascript">'+'{setupScript}'+'</script>'+'</body>'+'</html>',pageTpl:'{header}'+'<div id="{id}" class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>'+'{footer}'+'<div style="page-break-after:always;"></div>',setupScriptTpl:'window.onload = function(){ '+'document._loaded  = true;'+'if ({autoPrintAndClose}) {'+'window.print();'+'if (!{isChrome}) window.close();'+'}'+'}',openAfterExport:!1,DPI:72,fakeBackgroundColor:!1,doRequest:function(){},constructor:function(a){Ext.apply(this,a);if(!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl)}this.callParent(arguments);this.exportDialogConfig=Ext.applyIf({l10n:{title:this.L('dialogTitle'),exportButtonText:this.L('exportButtonText')}},this.exportDialogConfig)},init:function(b){var a=this;b.print=Ext.Function.bind(a.print,a);a.scheduler=b},showPopupBlockedMessage:function(){Ext.toast(this.getPopupBlockedMessageConfig())},getPopupBlockedMessageConfig:function(){return {html:this.L('disablePopupBlocking'),title:this.L('popupBlockerDetected'),autoCloseDelay:5000}},getExporterConfig:function(c,d){var a=this,b=a.callParent(arguments);return Ext.apply(b,{tpl:a.pageTpl})},getExportConfig:function(c){var a=this,b=a.callParent(arguments);return Ext.apply(b,{beforeExport:Ext.Function.bind(a.beforePrint,a),afterExport:Ext.Function.bind(a.afterPrint,a)})},onPagesExtracted:function(d,a,b,c){this.fireEvent('progressupdate',0.8,this.L('requestingPrintServer'));this.printPages(d,a,b,c)},print:function(){this.showExportDialog()},onBeforePageCommit:function(g,b,n,m){var f=this.scheduler,k=f.lockedGrid,a=f.normalGrid,i=function(a){return b.select('#'+a).first()};var e=b.select(g.normalBodySelector).first(),d=i(a.headerCt.id),j=b.select(g.lockedBodySelector).first(),c=i(k.headerCt.id);e.addCls(['sch-print-normal-rows-ct',this.fakeBackgroundColor?'sch-print-fake-background':'']);j.addCls('sch-print-locked-rows-ct');if(this.removeSecondaryCanvas){b.select('.sch-secondary-canvas').remove()}if(this.fakeBackgroundColor){var l=e.select(a.view.eventSelector);l.each(function(a){a.setStyle('border-right-width',a.dom.style.width)})}d.addCls('sch-print-normalheader');c.addCls('sch-print-lockedheader');if(this.wrapHeaders){d.wrap('<div class="sch-print-header-wrap"></div>');c.wrap('<div class="sch-print-header-wrap"></div>')}if(Ext.isIE&&a.bodyWrap){var h=a.bodyWrap.getHeight();Ext.fly(c.el.dom.parentNode).setStyle({position:'absolute',height:h+'px'});Ext.fly(d.el.dom.parentNode).setStyle({position:'absolute',height:h+'px'})}},prepareMainTplData:function(a){return a},printPages:function(g,e,b,h){if(!this.mainTpl||!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl,{compiled:!0,disableFormats:!0})}var f=b.stylesheets,c=document.body;var d=this.mainTpl.apply(this.prepareMainTplData({docType:this.docType,htmlClasses:c.parentNode.className,bodyClasses:c.className,title:e.title||'',styles:f,totalWidth:b.paperWidth,setupScript:this.setupScriptTpl.replace('{autoPrintAndClose}',this.autoPrintAndClose).replace('{isChrome}',Ext.isChrome),pages:g}));var a=window.open('','printgrid');if(!a||!a.document||a.closed||typeof a.closed==='undefined'){this.showPopupBlockedMessage();return !1}this.printWindow=a;a.document.write(d);a.document.close();this.onExportSuccess({success:!0,url:'foo',htmlArray:[d]})},bindExporter:function(b){var a=this;a.callParent(arguments);a.mon(b,{beforecommitpage:a.onBeforePageCommit,scope:a})},unbindExporter:function(b){var a=this;a.callParent(arguments);a.mun(b,{beforecommitpage:a.onBeforePageCommit,scope:a})}});Ext.define('Sch.plugin.SimpleEditor',{extend:'Ext.Editor',alias:'plugin.scheduler_simpleeditor',requires:['Ext.form.TextField'],mixins:['Ext.AbstractPlugin','Sch.mixin.Localizable'],lockableScope:'top',cls:'sch-simpleeditor',allowBlur:!1,shadow:!1,delegate:'.sch-event-inner',dataIndex:null,completeOnEnter:!0,cancelOnEsc:!0,dragProxyEl:null,eventRecord:null,resourceRecord:null,triggerEvent:'eventdblclick',newEventText:null,autoSize:{width:'boundEl'},initComponent:function(){this.field=this.field||{xtype:'textfield',selectOnFocus:!0};this.callParent(arguments)},init:function(a){this.scheduler=a.getSchedulingView();a.on('afterrender',this.onSchedulerRender,this);this.scheduler.registerEventEditor(this);this.dataIndex=this.dataIndex||this.scheduler.getEventStore().model.prototype.nameField},edit:function(b,a,c){if(!this.rendered){this.renderTo=this.scheduler.getEl()}this.eventEl=c||this.scheduler.getElementsFromEventRecord(b,a)[0];this.eventRecord=b;this.resourceRecord=a;this.startEdit(c.dom.querySelector(this.delegate),this.eventRecord.get(this.dataIndex));this.realign()},onSchedulerRender:function(b){var a=this;a.on({startedit:a.onStartEdit,complete:function(g,e,f){var b=a.eventRecord,c=a.scheduler.getEventStore(),d=c.getAutoSync();if(d){c.suspendAutoSync()}b.set(a.dataIndex,e);if(c.indexOf(b)<0){if(a.scheduler.fireEvent('beforeeventadd',a.scheduler,b,[a.resourceRecord])!==!1){a.scheduler.onEventCreated(b,[a.resourceRecord]);c.append(b);b.assign(a.resourceRecord)}}a.onAfterEdit();if(d){c.resumeAutoSync(!0)}},canceledit:a.onAfterEdit,hide:function(){var b=a.dragProxyEl;if(b&&b.dom&&b.dom.parentNode){b.destroy()}},scope:a});b.on('dragcreateend',a.onDragCreateEnd,a);b.on(a.triggerEvent,a.onTriggerEvent,a)},onStartEdit:function(){if(!this.allowBlur){Ext.getBody().on('mousedown',this.onMouseDown,this,{capture:!0})}},onTriggerEvent:function(b,d,e){if(!this.scheduler.isReadOnly()){var a=e.getTarget(b.eventSelector);var c=b.resolveResource(a);this.edit(d,c,Ext.get(a));this.getEl().setBox(this.getEl().getRegion().constrainTo(this.scheduler.getRegion()))}},onAfterEdit:function(){this.eventRecord=null;this.resourceRecord=null;if(!this.allowBlur){Ext.getBody().un('mousedown',this.onMouseDown,this,{capture:!0})}},onMouseDown:function(a,b){if(this.editing&&this.el&&!a.within(this.el)){this.completeEdit()}},onDragCreateEnd:function(f,b,d,e,c){var a=c.dom.cloneNode(!0);a.id='';c.dom.parentNode.appendChild(a);this.dragProxyEl=Ext.get(a);if(b.get(this.dataIndex)===''){b.set(this.dataIndex,this.newEventText||this.L('newEventText'))}this.edit(b,d,this.dragProxyEl)},destroy:function(){this.cancelEdit();this.eventRecord=null;this.resourceRecord=null;this.callParent(arguments)},realign:function(c){var a=this,d=a.callParent([c]),b=a.eventEl&&a.eventEl.getBox();if(b){a.getEl().setBox(b);a.getEl().down('input').setBox(b)}return d}});Ext.define('Sch.plugin.Split',{extend:'Ext.AbstractPlugin',mixins:['Sch.mixin.Localizable'],requires:['Ext.menu.Menu'],alias:'plugin.scheduler_split',splitGrid:!1,triggerEvent:'contextmenu',menuConfig:null,menu:null,grid:null,gridClone:null,splitMergeMenuItem:null,splitMergeMenuItemId:'sch-dosplitmerge',splitCls:'sch-grid-split',resizeHandleCls:'sch-grid-split-resize-handle',gridCloneCls:'sch-grid-split-clone',staticCloneConfig:{__cloned:!0,splitGrid:!1,eventPrefix:null,dock:'bottom',id:null,itemId:null,hideHeaders:!0,header:!1,tbar:null,tools:null,bbar:null,buttons:null,margin:0,padding:0,resizable:{pinned:!0,handles:'n',dynamic:!0}},init:function(a){if(!a.__cloned){a.on('afterlayout',function(){this.setupGrid(a)},this,{single:!0})}},setupGrid:function(a){this.grid=a;if(this.triggerEvent){this.createMenu();this.addGridListeners()}a.split=Ext.Function.bind(this.split,this);a.merge=Ext.Function.bind(this.merge,this);a.isSplit=Ext.Function.bind(this.isSplit,this);this.splitGrid=!Ext.isEmpty(a.splitGrid)?a.splitGrid:this.splitGrid;if(this.splitGrid){this.split()}},split:function(b){if(this.isSplit()||!this.grid.isHorizontal()){return}this.gridClone=this.cloneGrid(b);this.grid.addCls(this.splitCls);this.gridClone.addCls(this.gridCloneCls);var a=this.grid.getEl().down('.'+Ext.baseCSSPrefix+'docked .'+Ext.baseCSSPrefix+'resizable-handle-north');a.addCls(this.resizeHandleCls);this.gridClone.mon(a,'dblclick',this.merge,this);this.gridClone.mon(this.grid,'resize',this.onMainGridResize,this);this.setupSynchronization();this.grid.fireEvent('split',this)},merge:function(){if(!this.isSplit()||!this.grid.isHorizontal()){return}this.gridClone.destroy();this.gridClone=null;this.grid.removeCls(this.splitCls);this.grid.fireEvent('merge',this)},isSplit:function(){return !!this.gridClone},getCloneConfig:function(b,a){return {}},onMenuTriggerEvent:function(a){if(!this.grid.isHorizontal()){return}this.menu.showAt(a.getXY());if(this.splitMergeMenuItem){this.splitMergeMenuItem.setText(this.isSplit()?this.L('mergeText'):this.L('splitText'));var b=a.getTarget('.'+Ext.baseCSSPrefix+'grid-cell');if(b){var c=(this.grid.normalGrid||this.grid).getView().getEl().getY();this.splitMergeMenuItem.splitPosition=Ext.fly(b).getBottom()-c}}a.stopEvent()},createMenu:function(){this.menu=Ext.create(Ext.apply({xclass:'Ext.menu.Menu',plain:!0,defaults:{scope:this},items:[{itemId:this.splitMergeMenuItemId,handler:'onSplitMergeMenuItemClick'}]},this.menuConfig));this.splitMergeMenuItem=this.menu.down('#'+this.splitMergeMenuItemId)},addGridListeners:function(){this.grid.on('item'+this.triggerEvent,function(c,d,e,b,a){this.onMenuTriggerEvent(a)},this);this.grid.getEl().on(this.triggerEvent,this.onMenuTriggerEvent,this,{delegate:'.'+this.resizeHandleCls});this.grid.on('beforemodechange',this.onBeforeGridModeChange,this)},onBeforeGridModeChange:function(c,a){var b=Ext.isString(a)?a:a.mode;if(b!=='horizontal'&&this.isSplit()){this.merge()}},onSplitMergeMenuItemClick:function(a,b){if(this.isSplit()){this.merge()}else {this.split(a.splitPosition)}},cloneGrid:function(d){var a=this.grid,c=Ext.Array.map(a.headerCt.getGridColumns(),this.cloneColumn,this);c=Ext.Array.filter(c,function(a){return a.xtype!=='timeaxiscolumn'});var b=Ext.apply({partnerTimelinePanel:a,xtype:a.xtype,crudManager:a.crudManager,eventStore:a.eventStore,resourceStore:a.resourceStore,dependencyStore:a.dependencyStore,assignmentStore:a.assignmentStore,height:d?this.getGridViewHeight()-d:this.getGridViewHeight()/2,maxHeight:this.getCloneMaxHeight(),columns:c},this.staticCloneConfig);b=Ext.applyIf(b,a.initialConfig);b=Ext.apply(b,this.getCloneConfig(a,b));return a.addDocked(b)[0]},cloneColumn:function(a){return Ext.applyIf({width:a.getWidth(),locked:a.locked,flex:a.flex},a.initialConfig)},getGridViewHeight:function(){var a=this.grid.lockedGrid?this.grid.lockedGrid.getView():this.grid.getView();return a.getHeight()},setupSynchronization:function(){var b=this.grid.normalGrid||this.grid;var a=this.gridClone.normalGrid||this.gridClone;this.setupColumnSync(b.getHeaderContainer(),a.getHeaderContainer());if(this.grid.lockedGrid){this.setupColumnSync(this.grid.lockedGrid.getHeaderContainer(),this.gridClone.lockedGrid.getHeaderContainer())}},setupColumnSync:function(b,a){a.mon(b,{columnresize:this.onColumnResize,scope:a});a.mon(b,{columnschanged:this.onColumnsChanged,scope:this})},onColumnResize:function(c,e,d){var a=this;var b=a.getGridColumns();b[c.items.indexOf(e)].setWidth(d)},onColumnsChanged:function(c,f,d,e){var b=this.grid.normalGrid||this.grid;var a=this.gridClone.normalGrid||this.gridClone;a.getHeaderContainer().removeAll();a.getHeaderContainer().add(Ext.Array.map(b.getHeaderContainer().getGridColumns(),this.cloneColumn,this));if(this.grid.lockedGrid){b=this.grid.lockedGrid;a=this.gridClone.lockedGrid;a.getHeaderContainer().removeAll();a.getHeaderContainer().add(Ext.Array.map(b.getHeaderContainer().getGridColumns(),this.cloneColumn,this))}},onMainGridResize:function(){var a=this.getCloneMaxHeight();this.gridClone.resizer.maxHeight=this.gridClone.resizer.resizeTracker.maxHeight=a;if(this.gridClone.getHeight()>a){this.gridClone.setHeight(a)}this.gridClone.setMaxHeight(a)},getCloneMaxHeight:function(){var a=this.grid.down('headercontainer').el.getBottom()-this.grid.el.getTop();return this.grid.getHeight()-a},destroy:function(){if(this.menu){this.menu.destroy()}this.callParent(arguments)}});Ext.define('Sch.plugin.SummaryBar',{extend:'Ext.AbstractPlugin',mixins:['Sch.mixin.Localizable'],requires:['Ext.XTemplate'],alias:'plugin.scheduler_summarybar',renderer:!1,scope:null,height:20,titleContainer:null,barContainer:null,titleContainerCls:'sch-summaryrow-title',barContainerCls:'sch-summaryrow-view',grid:null,view:null,resourceStore:null,eventStore:null,tpl:'<table style="width: {totalWidth}px;" cellpadding="0" cellspacing="0">'+'<tr>'+'<tpl for="bars">'+'<td style="width: {width}px;">'+'<div class="sch-summaryrow-bar-wrapper">'+'<div class="sch-summaryrow-bar {cls}" style="{style}" {attr}>'+'<span class="sch-summaryrow-bar-text">{value}</span>'+'</div>'+'</div>'+'</td>'+'</tpl>'+'</tr>'+'</table>',init:function(b){var a=this;a.grid=b;a.view=b.getSchedulingView();a.eventStore=b.getEventStore();a.resourceStore=b.getResourceStore();a.tpl=new Ext.XTemplate(a.tpl);if(b.isHorizontal()){a.initBars()}a.setupListeners();a.callParent(arguments)},initBars:function(){var a=this;a.titleContainer=a.grid.lockedGrid.addDocked({xtype:'component',dock:'bottom',height:a.height,cls:a.titleContainerCls,html:'<span class="sch-summaryrow-title-text" style="line-height: '+a.height+'px;">'+a.L('totalText')+'</span>'})[0];a.barContainer=a.grid.normalGrid.addDocked({xtype:'component',dock:'bottom',height:a.height,cls:a.barContainerCls,scrollable:{x:!1,y:!1}})[0];a.barContainer.getScrollable().addPartner(a.view.getScrollable(),'x')},destroyBars:function(){var a=this;if(a.barContainer){a.barContainer.destroy();a.barContainer=null}if(a.titleContainer){a.titleContainer.destroy();a.titleContainer=null}},setupListeners:function(){var a=this,b=a.grid;a.view.on('refresh',a.renderSummaryRow,a);var c={add:a.renderSummaryRow,remove:a.renderSummaryRow,update:a.renderSummaryRow,scope:a};b.mon(a.eventStore,c);b.mon(a.resourceStore,c);if(b.getAssignmentStore()){b.mon(b.getAssignmentStore(),c)}a.grid.on('modechange',a.onGridModeChange,a)},onGridModeChange:function(){var a=this;if(a.grid.isHorizontal()){a.initBars();a.renderSummaryRow()}else {a.destroyBars()}},renderSummaryRow:function(){var a=this;if(!a.barContainer){return}var b=document.createElement('div');b.innerHTML=a.tpl.apply(a.buildRenderData());a.barContainer.el.syncContent(b)},buildRenderData:function(){var a=this,c=a.view.timeAxis.getTicks(),b=a.view.timeAxisViewModel.getTickWidth(),d=b*c.length;return {totalWidth:d,bars:Ext.Array.map(c,function(d){var e=a.resourceStore.getScheduledEventsInTimeSpan(d.start,d.end,a.eventStore),c={width:b,cls:'',style:'',attr:''};c.value=a.renderer?a.renderer.call(a.scope||a,e,c):'&nbsp;';return c})}}});Ext.define('Sch.plugin.TimeGap',{extend:'Sch.plugin.Zones',alias:'plugin.scheduler_timegap',requires:['Ext.data.JsonStore','Sch.model.Range'],getZoneCls:Ext.emptyFn,eventStoreListeners:null,init:function(a){this.store=new Ext.data.JsonStore({autoDestroy:!0,model:'Sch.model.Range'});this.scheduler=a;this.setEventStore(a.getEventStore());a.on({afterrender:this.populateStore,eventstorechange:function(b,a){this.setEventStore(a);this.populateStore()},scope:this});this.schedulerView=a.getSchedulingView();this.callParent(arguments)},setEventStore:function(a){this.eventStoreListeners&&this.eventStoreListeners.destroy();this.eventStoreListeners=this.mon(a,{load:this.populateStore,update:this.populateStore,remove:this.populateStore,add:this.populateStore,datachanged:this.populateStore,destroyable:!0,scope:this})},populateStore:function(j){var d=this.schedulerView.getEventsInView(),e=[],h=this.scheduler.getStart(),f=this.scheduler.getEnd(),i=d.getCount(),a=h,g=0,b,c;d.sortBy(function(a,b){return a.getStartDate()-b.getStartDate()});c=d.getAt(0);while(a<f&&g<i){b=c.getStartDate();if(!Sch.util.Date.betweenLesser(a,b,c.getEndDate())&&a<b){e.push(new this.store.model({StartDate:a,EndDate:b,Cls:this.getZoneCls(a,b)||''}))}a=Sch.util.Date.max(c.getEndDate(),a);g++;c=d.getAt(g)}if(a<f){e.push({StartDate:a,EndDate:f,Cls:this.getZoneCls(a,f)||''})}this.store.removeAll(e.length>0);this.store.add(e)}});Ext.define('Sch.plugin.TreeCellEditing',{extend:'Ext.grid.plugin.CellEditing',alias:'plugin.scheduler_treecellediting',requires:['Sch.patches.Element_6_5'],lockableScope:'locked',editorsStarted:0,init:function(){this.on('beforeedit',this.onMyBeforeEdit,this);this.callParent(arguments)},getEditor:function(){var a=this.callParent(arguments);if(a&&!a._startEdit){var b=a._startEdit=a.startEdit;a.startEdit=function(){var a=this.field,c;if(a&&a.isTaskField){a.setSuppressTaskUpdate(!0)}c=b.apply(this,arguments);if(a&&a.isTaskField){a.setSuppressTaskUpdate(!1)}return c}}return a},activateCell:function(b){var c=this.callParent(arguments);if(c){var a=this.getEditor(b.record,b.column);if(!a._cancelEdit){a._cancelEdit=a.cancelEdit;a.cancelEdit=this.myCancelEdit}this.fireEvent('editingstart',this,a)}return c},checkReadOnly:function(){var a=this.getCmp();if(a){if(!a.isTimelineTreePanel&&!a.isTimelineGridPanel){a=a.up('tablepanel')}return !a.isReadOnly()}},onEditComplete:function(b,a,c){var d=this;if(b.field.applyChanges){if(a instanceof Date&&a-c||!(a instanceof Date)&&a!==c){b.field.applyChanges(b.field.task||d.context.record)}return d.callParent([b,a,a])}else {return d.callParent([b,a,c])}},myCancelEdit:function(){var b=this,a=b.field;if(a&&a.applyChanges){var c=a.instantUpdate;a.instantUpdate=!0;var d=b._cancelEdit.apply(this,arguments);a.instantUpdate=c;return d}else {return b._cancelEdit.apply(this,arguments)}},onMyBeforeEdit:function(c,b){var a=b.column.getEditor();if(a&&a.setTask){a.setTask(b.record);b._valueFromTaskField=a.getValue()}return this.checkReadOnly()},setEditingContext:function(a){if(a.hasOwnProperty('_valueFromTaskField')){a.value=a.originalValue=a._valueFromTaskField;delete a._valueFromTaskField}this.callParent(arguments)}});Ext.define('Sch.preset.ViewPresetHeaderRow',{});Ext.define('Sch.util.Debug',{singleton:!0,runDiagnostics:function(){var a;var e=this;var h=window.console;if(h&&h.log){a=function(){h.log.apply(h,arguments)}}else {if(!e.schedulerDebugWin){e.schedulerDebugWin=new Ext.Window({height:400,width:500,bodyStyle:'padding:10px',closeAction:'hide',autoScroll:!0})}e.schedulerDebugWin.show();e.schedulerDebugWin.update('');a=function(a){e.schedulerDebugWin.update((e.schedulerDebugWin.body.dom.innerHTML||'')+a+'<br/>')}}var m=Ext.select('.sch-schedulerpanel');if(m.getCount()===0){a('No scheduler component found')}var f=Ext.getCmp(m.elements[0].id),c=f.getResourceStore(),b=f.getEventStore();if(!b.isEventStore){a('Your event store must be or extend Sch.data.EventStore')}a('Scheduler view start: '+f.getStart()+', end: '+f.getEnd());if(!c){a('No store configured');return}if(!b){a('No event store configured');return}var g=new Ext.util.MixedCollection(),i=new Ext.util.MixedCollection();for(var d=0;d<b.model.prototype.fields.length;d++){g.add(b.model.prototype.fields[d].name,b.model.prototype.fields[d])}for(d=0;d<c.model.prototype.fields.length;d++){i.add(c.model.prototype.fields[d].name,c.model.prototype.fields[d])}a(c.getCount()+' records in the resource store');a(b.getCount()+' records in the eventStore');var k=b.model.prototype.idProperty;var j=c.model.prototype.idProperty;var o=g.getByKey(k);var n=i.getByKey(j);if(!(new b.model() instanceof Sch.model.Event)){a('Your event model must extend Sch.model.Event')}if(!(new c.model() instanceof Sch.model.Resource)){a('Your resource model must extend Sch.model.Resource')}if(!o){a('idProperty on the event model is incorrectly setup, value: '+k)}if(!n){a('idProperty on the resource model is incorrectly setup, value: '+j)}var l=f.getSchedulingView();a(l.el.select(l.eventSelector).getCount()+' events present in the DOM');if(b.getCount()>0){if(!b.first().getStartDate()||!(b.first().getStartDate() instanceof Date)){a('The eventStore reader is misconfigured - The StartDate field is not setup correctly, please investigate');a('StartDate is configured with dateFormat: '+g.getByKey(b.model.prototype.startDateField).dateFormat);a('See Ext JS docs for information about different date formats: http://docs.sencha.com/extjs/#!/api/Ext.Date')}if(!b.first().getEndDate()||!(b.first().getEndDate() instanceof Date)){a('The eventStore reader is misconfigured - The EndDate field is not setup correctly, please investigate');a('EndDate is configured with dateFormat: '+g.getByKey(b.model.prototype.endDateField).dateFormat);a('See Ext JS docs for information about different date formats: http://docs.sencha.com/extjs/#!/api/Ext.Date')}if(b.proxy&&b.proxy.reader&&b.proxy.reader.jsonData){a('Dumping jsonData to console');console&&console.dir&&console.dir(b.proxy.reader.rawData)}a('Records in the event store:');b.each(function(b,c){a(c+1+'. '+b.startDateField+':'+b.getStartDate()+', '+b.endDateField+':'+b.getEndDate()+', '+b.resourceIdField+':'+b.getResourceId());if(!b.getStartDate()){a(b.getStartDate())}})}else {a('Event store has no data. Has it been loaded properly?')}if(c.isTreeStore){c=c.nodeStore}if(c.getCount()>0){a('Records in the resource store:');c.each(function(b,c){a(c+1+'. '+b.idProperty+':'+b.getId());return})}else {a('Resource store has no data.');return}a('Everything seems to be setup ok!')}});Ext.define('Sch.view.dependency.renderingstrategy.Async',{extend:'Sch.view.dependency.renderingstrategy.Abstract',alias:'sch_dependency_rendering_strategy.async',config:{depsPerStep:50},delegateRendering:function(a,b,g){var f=this,d=f.getDepsPerStep(),c=b.slice(0,d),e=b.slice(d);a.getPainter().paint(a.getPrimaryView(),a.getDependencyCanvas(),c,!1);return [c,e]}});Ext.define('Sch.view.dependency.renderingstrategy.Bulk',{extend:'Sch.view.dependency.renderingstrategy.Abstract',alias:'sch_dependency_rendering_strategy.bulk',delegateRendering:function(a,b,c){a.getPainter().paint(a.getPrimaryView(),a.getDependencyCanvas(),b,!1);return [b,[]]}});Ext.define('Sch.widget.PagingToolbar',{extend:'Ext.toolbar.Paging',alias:'widget.sch_pagingtoolbar',getStoreId:function(){if(this.storeId){return this.storeId}var a=this.store.storeId;if(!a){var b=this.store.crudManager;var c=b&&b.getStore(this.store);a=c&&c.storeId}this.storeId=a;return a},loadPage:function(b){var a=this;if(a.store.crudManager){var c=a.getStoreId();if(c){var d={};d[c]={pageSize:a.store.pageSize,page:b};a.store.crudManager.load(d)}}else {a.store.loadPage(b)}},onPagingKeyDown:function(g,a){var d=this,c=a.getKey(),e=d.getPageData(),f=a.shiftKey?10:1,b;if(c==a.RETURN){a.stopEvent();b=d.readPageFromInput(e);if(b!==!1){b=Math.min(Math.max(1,b),e.pageCount);if(d.fireEvent('beforechange',d,b)!==!1){d.loadPage(b)}}}else {if(c==a.HOME||c==a.END){a.stopEvent();b=c==a.HOME?1:e.pageCount;g.setValue(b)}else {if(c==a.UP||c==a.PAGE_UP||c==a.DOWN||c==a.PAGE_DOWN){a.stopEvent();b=d.readPageFromInput(e);if(b){if(c==a.DOWN||c==a.PAGE_DOWN){f*=-1}b+=f;if(b>=1&&b<=e.pageCount){g.setValue(b)}}}}}},moveFirst:function(){if(this.fireEvent('beforechange',this,1)!==!1){this.loadPage(1)}},movePrevious:function(){var a=this,b=a.store.currentPage-1;if(b>0){if(a.fireEvent('beforechange',a,b)!==!1){a.loadPage(b)}}},moveNext:function(){var a=this,c=a.getPageData().pageCount,b=a.store.currentPage+1;if(b<=c){if(a.fireEvent('beforechange',a,b)!==!1){a.loadPage(b)}}},moveLast:function(){var a=this,b=a.getPageData().pageCount;if(a.fireEvent('beforechange',a,b)!==!1){a.loadPage(b)}},doRefresh:function(){var a=this,b=a.store.currentPage;if(a.fireEvent('beforechange',a,b)!==!1){a.loadPage(b)}}});