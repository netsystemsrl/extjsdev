var $jscomp={};$jscomp.scope={};$jscomp.defineProperty=typeof Object.defineProperties=='function'?Object.defineProperty:function(b,c,a){a=(a);if(a.get||a.set){throw new TypeError('ES3 does not support getters and setters.')}if(b==Array.prototype||b==Object.prototype){return}b[c]=a.value};$jscomp.getGlobal=function(a){return typeof window!='undefined'&&window===a?a:typeof global!='undefined'&&global!=null?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(i,f,j,k){if(!f){return}var a=$jscomp.global;var b=i.split('.');for(var e=0;e<b.length-1;e++){var d=b[e];if(!(d in a)){a[d]={}}a=a[d]}var g=b[b.length-1];var h=a[g];var c=f(h);if(c==h||c==null){return}$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:c})};$jscomp.polyfill('Array.prototype.copyWithin',function(a){if(a){return a}var b=function(c,b,a){var d=this.length;c=Number(c);b=Number(b);a=Number(a!=null?a:d);if(c<b){a=Math.min(a,d);while(b<a){if(b in this){this[c++]=this[b++]}else {delete this[c++];b++}}}else {a=Math.min(a,d+b-c);c+=a-b;while(a>b){if(--a in this){this[--c]=this[a]}else {delete this[c]}}}return this};return b},'es6-impl','es3');$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global.Symbol){$jscomp.global.Symbol=$jscomp.Symbol}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return ($jscomp.SYMBOL_PREFIX+(a||'')+$jscomp.symbolCounter_++)};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;if(!a){a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('iterator')}if(typeof Array.prototype[a]!='function'){$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}})}$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){if(b<a.length){return {done:!1,value:a[b++]}}else {return {done:!0}}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();var a={next:b};a[$jscomp.global.Symbol.iterator]=function(){return this};return (a)};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();if(a instanceof String){a=a+''}var c=0;var b={next:function(){if(c<a.length){var e=c++;return {value:d(e,a[e]),done:!1}}b.next=function(){return {done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill('Array.prototype.entries',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a,b){return [a,b]})};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.fill',function(a){if(a){return a}var b=function(e,b,a){var c=this.length||0;if(b<0){b=Math.max(0,c+(b))}if(a==null||a>c){a=c}a=Number(a);if(a<0){a=Math.max(0,c+a)}for(var d=Number(b||0);d<a;d++){this[d]=e}return this};return b},'es6-impl','es3');$jscomp.findInternal=function(a,d,e){if(a instanceof String){a=(String(a))}var f=a.length;for(var b=0;b<f;b++){var c=a[b];if(d.call(e,c,b,a)){return {i:b,v:c}}}return {i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).v};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.findIndex',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).i};return b},'es6-impl','es3');$jscomp.polyfill('Array.from',function(a){if(a){return a}var b=function(a,b,f){$jscomp.initSymbolIterator();b=b!=null?b:function(a){return a};var c=[];var e=(a)[Symbol.iterator];if(typeof e=='function'){a=e.call(a);var g;while(!(g=a.next()).done){c.push(b.call((f),g.value))}}else {var h=a.length;for(var d=0;d<h;d++){c.push(b.call((f),a[d]))}}return c};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.keys',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a){return a})};return b},'es6-impl','es3');$jscomp.polyfill('Array.of',function(a){if(a){return a}var b=function(a){return Array.from(arguments)};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.values',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})};return b},'es6','es3');$jscomp.executeAsyncGenerator=function(a){function passValueToGenerator(b){return a.next(b)}function passErrorToGenerator(b){return a['throw'](b)}return new Promise(function(b,c){function handleGeneratorRecord(a){if(a.done){b(a.value)}else {Promise.resolve(a.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,c)}}handleGeneratorRecord(a.next())})};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=(a)[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator((a))};$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};$jscomp.polyfill('WeakMap',function(c){function isConformant(){if(!c||!Object.seal){return !1}try{var b=Object.seal({});var d=Object.seal({});var a=new (c)([[b,2],[d,3]]);if(a.get(b)!=2||a.get(d)!=3){return !1}a['delete'](b);a.set(d,4);return !a.has(b)&&a.get(d)==4}catch(e){return !1}}if(isConformant()){return c}var a='$jscomp_hidden_'+Math.random().toString().substring(2);function insert(b){if(!$jscomp.owns(b,a)){var c={};$jscomp.defineProperty(b,a,{value:c})}}function patch(a){var b=Object[a];if(b){Object[a]=function(a){insert(a);return b(a)}}}patch('freeze');patch('preventExtensions');patch('seal');var d=0;var b=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=$jscomp.makeIterator(a);var b;while(!(b=e.next()).done){var c=b.value;this.set((c[0]),(c[1]))}}};b.prototype.set=function(b,c){insert(b);if(!$jscomp.owns(b,a)){throw new Error('WeakMap key fail: '+b)}b[a][this.id_]=c;return this};b.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:undefined};b.prototype.has=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};b.prototype['delete']=function(b){if(!$jscomp.owns(b,a)||!$jscomp.owns(b[a],this.id_)){return !1}return delete b[a][this.id_]};return b},'es6-impl','es3');$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.polyfill('Map',function(b){var h=!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var e=Object.seal({x:4});var c=new b($jscomp.makeIterator([[e,'s']]));if(c.get(e)!='s'||c.size!=1||c.get({x:4})||c.set({x:4},'t')!=c||c.size!=2){return !1}var d=c.entries();var a=d.next();if(a.done||a.value[0]!=e||a.value[1]!='s'){return !1}a=d.next();if(a.done||a.value[0].x!=4||a.value[1]!='t'||!d.next().done){return !1}return !0}catch(k){return !1}}();if(h){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=new WeakMap();var c=function(){};c.prototype.previous;c.prototype.next;c.prototype.head;c.prototype.key;c.prototype.value;var a=function(a){this.data_={};this.head_=g();this.size=0;if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.set((c[0]),(c[1]))}}};a.prototype.set=function(c,b){var a=d(this,c);if(!a.list){a.list=this.data_[a.id]=[]}if(!a.entry){a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,value:b};a.list.push(a.entry);this.head_.previous.next=a.entry;this.head_.previous=a.entry;this.size++}else {a.entry.value=b}return this};a.prototype['delete']=function(b){var a=d(this,b);if(a.entry&&a.list){a.list.splice(a.index,1);if(!a.list.length){delete this.data_[a.id]}a.entry.previous.next=a.entry.next;a.entry.next.previous=a.entry.previous;a.entry.head=null;this.size--;return !0}return !1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};a.prototype.has=function(a){return !!d(this,a).entry};a.prototype.get=function(b){var a=d(this,b).entry;return (a&&(a.value))};a.prototype.entries=function(){return e(this,function(a){return [a.key,a.value]})};a.prototype.keys=function(){return e(this,function(a){return a.key})};a.prototype.values=function(){return e(this,function(a){return a.value})};a.prototype.forEach=function(d,c){var e=this.entries();var b;while(!(b=e.next()).done){var a=b.value;d.call((c),(a[1]),(a[0]),this)}};(a.prototype)[Symbol.iterator]=a.prototype.entries;var d=function(f,d){var e=j(d);var a=f.data_[e];if(a&&$jscomp.owns(f.data_,e)){for(var c=0;c<a.length;c++){var b=a[c];if(d!==d&&b.key!==b.key||d===b.key){return {id:e,list:a,index:c,entry:b}}}}return {id:e,list:a,index:-1,entry:undefined}};var e=function(b,c){var a=b.head_;return $jscomp.iteratorPrototype(function(){if(a){while(a.head!=b.head_){a=a.previous}while(a.next!=a.head){a=a.next;return {done:!1,value:c(a)}}a=null}return {done:!0,value:void 0}})};var g=function(){var a={};a.previous=a.next=a.head=a;return a};var i=0;var j=function(a){var b=a&&typeof a;if(b=='object'||b=='function'){a=(a);if(!f.has(a)){var c=''+ ++i;f.set(a,c);return c}return f.get(a)}return 'p_'+a};return a},'es6-impl','es3');$jscomp.polyfill('Math.acosh',function(a){if(a){return a}var b=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};return b},'es6-impl','es3');$jscomp.polyfill('Math.asinh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.log1p',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var e=a;var f=1;var b=a;var c=0;var d=1;while(c!=b){e*=a;d*=-1;b=(c=b)+d*e/++f}return b}return Math.log(1+a)};return b},'es6-impl','es3');$jscomp.polyfill('Math.atanh',function(b){if(b){return b}var a=Math.log1p;var c=function(b){b=Number(b);return (a(b)-a(-b))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.cbrt',function(a){if(a){return a}var b=function(a){if(a===0){return a}a=Number(a);var b=Math.pow(Math.abs(a),1/3);return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.clz32',function(a){if(a){return a}var b=function(a){a=Number(a)>>>0;if(a===0){return 32}var b=0;if((a&4.29490176E9)===0){a<<=16;b+=16}if((a&4.27819008E9)===0){a<<=8;b+=8}if((a&4.02653184E9)===0){a<<=4;b+=4}if((a&3.221225472E9)===0){a<<=2;b+=2}if((a&2.147483648E9)===0){b++}return b};return b},'es6-impl','es3');$jscomp.polyfill('Math.cosh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);return (b(a)+b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.expm1',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var d=a;var e=1;var b=a;var c=0;while(c!=b){d*=a/++e;b=(c=b)+d}return b}return Math.exp(a)-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.hypot',function(a){if(a){return a}var b=function(b,c,g){b=Number(b);c=Number(c);var a,f,e;var d=Math.max(Math.abs(b),Math.abs(c));for(a=2;a<arguments.length;a++){d=Math.max(d,Math.abs(arguments[a]))}if(d>1.0E100||d<1.0E-100){b=b/d;c=c/d;e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a])/d;e+=f*f}return Math.sqrt(e)*d}else {e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a]);e+=f*f}return Math.sqrt(e)}};return b},'es6-impl','es3');$jscomp.polyfill('Math.imul',function(a){if(a){return a}var b=function(a,b){a=Number(a);b=Number(b);var e=a>>>16&65535;var c=a&65535;var f=b>>>16&65535;var d=b&65535;var g=e*d+c*f<<16>>>0;return c*d+g|0};return b},'es6-impl','es3');$jscomp.polyfill('Math.log10',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN10};return b},'es6-impl','es3');$jscomp.polyfill('Math.log2',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN2};return b},'es6-impl','es3');$jscomp.polyfill('Math.sign',function(a){if(a){return a}var b=function(a){a=Number(a);return a===0||isNaN(a)?a:a>0?1:-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.sinh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);if(a===0){return a}return (b(a)-b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.tanh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.exp(-2*Math.abs(a));var c=(1-b)/(1+b);return a<0?-c:c};return b},'es6-impl','es3');$jscomp.polyfill('Math.trunc',function(a){if(a){return a}var b=function(a){a=Number(a);if(isNaN(a)||a===Infinity||a===-Infinity||a===0){return a}var b=Math.floor(Math.abs(a));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Number.EPSILON',function(a){return Math.pow(2,-52)},'es6-impl','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.MIN_SAFE_INTEGER',function(){return -9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.isFinite',function(a){if(a){return a}var b=function(a){if(typeof a!=='number'){return !1}return !isNaN(a)&&a!==Infinity&&a!==-Infinity};return b},'es6-impl','es3');$jscomp.polyfill('Number.isInteger',function(a){if(a){return a}var b=function(a){if(!Number.isFinite(a)){return !1}return a===Math.floor(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isNaN',function(a){if(a){return a}var b=function(a){return typeof a==='number'&&isNaN(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isSafeInteger',function(a){if(a){return a}var b=function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER};return b},'es6-impl','es3');$jscomp.polyfill('Object.assign',function(a){if(a){return a}var b=function(d,e){for(var c=1;c<arguments.length;c++){var a=arguments[c];if(!a){continue}for(var b in a){if($jscomp.owns(a,b)){d[b]=a[b]}}}return d};return b},'es6-impl','es3');$jscomp.polyfill('Object.getOwnPropertySymbols',function(a){if(a){return a}return function(){return []}},'es6-impl','es5');$jscomp.polyfill('Object.is',function(a){if(a){return a}var b=function(a,b){if(a===b){return a!==0||1/a===1/(b)}else {return a!==a&&b!==b}};return b},'es6-impl','es3');$jscomp.polyfill('Object.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+' is not extensible')}return a};return b},'es6','es5');$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.polyfill('Promise',function(c){if(c&&!$jscomp.FORCE_POLYFILL_PROMISE){return c}function AsyncExecutor(){this.batch_=null}AsyncExecutor.prototype.asyncExecute=function(a){if(this.batch_==null){this.batch_=[];this.asyncExecuteBatch_()}this.batch_.push(a);return this};AsyncExecutor.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global['setTimeout'];AsyncExecutor.prototype.asyncExecuteFunction=function(a){e(a,0)};AsyncExecutor.prototype.executeBatch_=function(){while(this.batch_&&this.batch_.length){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var c=b[a];delete b[a];try{c()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var b={PENDING:0,FULFILLED:1,REJECTED:2};var a=function(c){this.state_=b.PENDING;this.result_=undefined;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.createResolveAndReject_=function(){var b=this;var a=!1;function firstCallWins(c){return function(d){if(!a){a=!0;c.call(b,d)}}}return {resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this){this.reject_(new TypeError('A Promise cannot resolve to itself'))}else {if(b instanceof a){this.settleSameAsPromise_((b))}else {if(isObject(b)){this.resolveToNonPromiseObj_((b))}else {this.fulfill_(b)}}}};a.prototype.resolveToNonPromiseObj_=function(b){var a=undefined;try{a=b.then}catch(f){this.reject_(f);return}if(typeof a=='function'){this.settleSameAsThenable_(a,(b))}else {this.fulfill_(b)}};function isObject(a){switch(typeof a){case 'object':return a!=null;case 'function':return !0;default:return !1;}}a.prototype.reject_=function(a){this.settle_(b.REJECTED,a)};a.prototype.fulfill_=function(a){this.settle_(b.FULFILLED,a)};a.prototype.settle_=function(c,a){if(this.state_!=b.PENDING){throw new Error('Cannot settle('+c+', '+a|'): Promise already settled in state'+this.state_)}this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){var b=this.onSettledCallbacks_;for(var a=0;a<b.length;++a){(b[a]).call();b[a]=null}this.onSettledCallbacks_=null}};var d=new AsyncExecutor();a.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};a.prototype.settleSameAsThenable_=function(b,c){var a=this.createResolveAndReject_();try{b.call(c,a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.then=function(e,f){var b;var c;var d=new a(function(a,d){b=a;c=d});function createCallback(a,d){if(typeof a=='function'){return function(d){try{b(a(d))}catch(g){c(g)}}}else {return d}}this.callWhenSettled_(createCallback(e,b),createCallback(f,c));return d};a.prototype['catch']=function(a){return this.then(undefined,a)};a.prototype.callWhenSettled_=function(c,e){var a=this;function callback(){switch(a.state_){case b.FULFILLED:c(a.result_);break;case b.REJECTED:e(a.result_);break;default:throw new Error('Unexpected state: '+a.state_);}}if(this.onSettledCallbacks_==null){d.asyncExecute(callback)}else {this.onSettledCallbacks_.push(function(){d.asyncExecute(callback)})}};a.resolve=function(b){if(b instanceof a){return b}else {return new a(function(a,c){a(b)})}};a.reject=function(b){return new a(function(c,a){a(b)})};a.race=function(b){return new a(function(e,f){var d=$jscomp.makeIterator(b);for(var c=d.next();!c.done;c=d.next()){a.resolve(c.value).callWhenSettled_(e,f)}})};a.all=function(d){var c=$jscomp.makeIterator(d);var b=c.next();if(b.done){return a.resolve([])}else {return new a(function(f,g){var d=[];var e=0;function onFulfilled(a){return function(b){d[a]=b;e--;if(e==0){f(d)}}}do{d.push(undefined);e++;a.resolve(b.value).callWhenSettled_(onFulfilled(d.length-1),g);b=c.next()}while(!b.done)})}};if($jscomp.EXPOSE_ASYNC_EXECUTOR){a['$jscomp$new$AsyncExecutor']=function(){return new AsyncExecutor()}}return a},'es6-impl','es3');$jscomp.polyfill('Reflect.apply',function(a){if(a){return a}var c=Function.prototype.apply;var b=function(d,b,a){return c.call(d,b,a)};return b},'es6','es3');$jscomp.polyfill('Reflect.construct',function(a){if(a){return a}var b=function(b,d,a){if(a===undefined){a=b}var e=a.prototype||Object.prototype;var c=Object.create(e);var f=Reflect.apply(b,c,d);return f||c};return b},'es6','es5');$jscomp.polyfill('Reflect.defineProperty',function(a){if(a){return a}var b=function(d,c,b){try{Object.defineProperty(d,c,b);var a=Object.getOwnPropertyDescriptor(d,c);if(!a){return !1}return a.configurable===(b.configurable||!1)&&a.enumerable===(b.enumerable||!1)&&('value' in a?a.value===b.value&&a.writable===(b.writable||!1):a.get===b.get&&a.set===b.set)}catch(e){return !1}};return b},'es6','es5');$jscomp.polyfill('Reflect.deleteProperty',function(a){if(a){return a}var b=function(b,a){if(!$jscomp.owns(b,a)){return !0}try{return delete b[a]}catch(c){return !1}};return b},'es6','es3');$jscomp.polyfill('Reflect.getOwnPropertyDescriptor',function(a){return a||Object.getOwnPropertyDescriptor},'es6','es5');$jscomp.polyfill('Reflect.getPrototypeOf',function(a){return a||Object.getPrototypeOf},'es6','es5');$jscomp.findDescriptor=function(d,c){var a=d;while(a){var b=Reflect.getOwnPropertyDescriptor(a,c);if(b){return b}a=Reflect.getPrototypeOf(a)}return undefined};$jscomp.polyfill('Reflect.get',function(a){if(a){return a}var b=function(c,b,d){if(arguments.length<=2){return c[b]}var a=$jscomp.findDescriptor(c,b);if(a){return a.get?a.get.call(d):a.value}return undefined};return b},'es6','es5');$jscomp.polyfill('Reflect.has',function(a){if(a){return a}var b=function(b,a){return a in b};return b},'es6','es3');$jscomp.polyfill('Reflect.isExtensible',function(a){if(a){return a}if(typeof Object.isExtensible=='function'){return Object.isExtensible}return function(){return !0}},'es6','es3');$jscomp.polyfill('Reflect.ownKeys',function(b){if(b){return b}var a='jscomp_symbol_';function isSymbol(b){return b.substring(0,a.length)==a}var c=function(d){var e=[];var b=Object.getOwnPropertyNames(d);var c=Object.getOwnPropertySymbols(d);for(var a=0;a<b.length;a++){(isSymbol(b[a])?c:e).push(b[a])}return e.concat(c)};return c},'es6','es5');$jscomp.polyfill('Reflect.preventExtensions',function(a){if(a){return a}if(typeof Object.preventExtensions!='function'){return function(){return !1}}var b=function(a){Object.preventExtensions(a);return !Object.isExtensible(a)};return b},'es6','es3');$jscomp.polyfill('Reflect.set',function(a){if(a){return a}var b=function(a,c,d,e){var b=$jscomp.findDescriptor(a,c);if(!b){if(Reflect.isExtensible(a)){a[c]=d;return !0}return !1}if(b.set){b.set.call(arguments.length>3?e:a,d);return !0}else {if(b.writable&&!Object.isFrozen(a)){a[c]=d;return !0}}return !1};return b},'es6','es5');$jscomp.polyfill('Reflect.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){try{a.__proto__=b;return a.__proto__===b}catch(c){return !1}};return b},'es6','es5');$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.polyfill('Set',function(b){var c=!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var d=Object.seal({x:4});var c=new b($jscomp.makeIterator([d]));if(!c.has(d)||c.size!=1||c.add(d)!=c||c.size!=1||c.add({x:4})!=c||c.size!=2){return !1}var e=c.entries();var a=e.next();if(a.done||a.value[0]!=d||a.value[1]!=d){return !1}a=e.next();if(a.done||a.value[0]==d||a.value[0].x!=4||a.value[1]!=a.value[0]){return !1}return e.next().done}catch(f){return !1}}();if(c){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=function(a){this.map_=new Map();if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.add(c)}}this.size=this.map_.size};a.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};a.prototype['delete']=function(b){var a=this.map_['delete'](b);this.size=this.map_.size;return a};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=function(a){return this.map_.has(a)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};(a.prototype)[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(b,a){var c=this;this.map_.forEach(function(d){return b.call((a),d,d,c)})};return a},'es6-impl','es3');$jscomp.checkStringArgs=function(a,c,b){if(a==null){throw new TypeError("The 'this' value for String.prototype."+b+' must not be null or undefined')}if(c instanceof RegExp){throw new TypeError('First argument to String.prototype.'+b+' must not be a regular expression')}return a+''};$jscomp.polyfill('String.prototype.codePointAt',function(a){if(a){return a}var b=function(a){var d=$jscomp.checkStringArgs(this,null,'codePointAt');var e=d.length;a=Number(a)||0;if(!(a>=0&&a<e)){return void 0}a=a|0;var b=d.charCodeAt(a);if(b<55296||b>56319||a+1===e){return b}var c=d.charCodeAt(a+1);if(c<56320||c>57343){return b}return (b-55296)*1024+c+9216};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.endsWith',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'endsWith');a=a+'';if(b===void 0){b=c.length}var e=Math.max(0,Math.min(b|0,c.length));var d=a.length;while(d>0&&e>0){if(c[--e]!=a[--d]){return !1}}return d<=0};return b},'es6-impl','es3');$jscomp.polyfill('String.fromCodePoint',function(a){if(a){return a}var b=function(d){var b='';for(var c=0;c<arguments.length;c++){var a=Number(arguments[c]);if(a<0||a>1114111||a!==Math.floor(a)){throw new RangeError('invalid_code_point '+a)}if(a<=65535){b+=String.fromCharCode(a)}else {a-=65536;b+=String.fromCharCode(a>>>10&1023|55296);b+=String.fromCharCode(a&1023|56320)}}return b};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.includes',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'includes');return c.indexOf(a,b||0)!==-1};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.repeat',function(a){if(a){return a}var b=function(a){var b=$jscomp.checkStringArgs(this,null,'repeat');if(a<0||a>1342177279){throw new RangeError('Invalid count value')}a=a|0;var c='';while(a){if(a&1){c+=b}if(a>>>=1){b+=b}}return c};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.startsWith',function(a){if(a){return a}var b=function(a,f){var b=$jscomp.checkStringArgs(this,a,'startsWith');a=a+'';var g=b.length;var d=a.length;var e=Math.max(0,Math.min((f)|0,b.length));var c=0;while(c<d&&e<g){if(b[e++]!=a[c++]){return !1}}return c>=d};return b},'es6-impl','es3');$jscomp.arrayFromIterator=function(c){var b;var a=[];while(!(b=c.next()).done){a.push(b.value)}return a};$jscomp.arrayFromIterable=function(a){if(a instanceof Array){return a}else {return $jscomp.arrayFromIterator($jscomp.makeIterator(a))}};$jscomp.inherits=function(a,b){function tempCtor(){}tempCtor.prototype=b.prototype;a.prototype=new tempCtor();a.prototype.constructor=a;for(var c in b){if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);if(d){Object.defineProperty(a,c,d)}}else {a[c]=b[c]}}};$jscomp.polyfill('WeakSet',function(b){function isConformant(){if(!b||!Object.seal){return !1}try{var c=Object.seal({});var d=Object.seal({});var a=new (b)([c]);if(!a.has(c)||a.has(d)){return !1}a['delete'](c);a.add(d);return !a.has(c)&&a.has(d)}catch(e){return !1}}if(isConformant()){return b}var a=function(a){this.map_=new WeakMap();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=b.value;this.add(c)}}};a.prototype.add=function(a){this.map_.set(a,!0);return this};a.prototype.has=function(a){return this.map_.has(a)};a.prototype['delete']=function(a){return this.map_['delete'](a)};return a},'es6-impl','es3');try{if(Array.prototype.values.toString().indexOf('[native code]')==-1){delete Array.prototype.values}}catch(a){}Ext.define('Gnt.locale.En',{extend:'Sch.locale.Locale',requires:'Sch.locale.En',singleton:!0,l10n:{'Gnt.util.DurationParser':{unitsRegex:{MILLI:/^ms$|^mil/i,SECOND:/^s$|^sec/i,MINUTE:/^m$|^min/i,HOUR:/^h$|^hr$|^hour/i,DAY:/^d$|^day/i,WEEK:/^w$|^wk|^week/i,MONTH:/^mo|^mnt/i,QUARTER:/^q$|^quar|^qrt/i,YEAR:/^y$|^yr|^year/i}},'Gnt.util.DependencyParser':{typeText:{SS:'SS',SF:'SF',FS:'FS',FF:'FF'}},'Gnt.panel.Timeline':{start:'Start',end:'End',format:'m/d/Y'},'Gnt.field.ShowInTimeline':{yes:'Yes',no:'No'},'Gnt.column.ShowInTimeline':{text:'Show in timeline'},'Gnt.field.ConstraintType':{none:'None',invalidText:'Invalid value'},'Gnt.field.Duration':{invalidText:'Invalid value'},'Gnt.field.Cost':{invalidText:'Invalid value',currencySymbol:'$',currencySymbolAlign:'left'},'Gnt.field.Effort':{invalidText:'Invalid effort value'},'Gnt.field.Percent':{invalidText:'Invalid value'},'Gnt.field.SchedulingMode':{Normal:'Normal',FixedDuration:'Fixed duration',EffortDriven:'Effort driven',DynamicAssignment:'Dynamic assignment',invalidText:'Invalid value'},'Gnt.template.Deadline':{deadline:'Deadline'},'Gnt.column.DeadlineDate':{text:'Deadline'},'Gnt.Tooltip':{startText:'Starts: ',endText:'Ends: ',durationText:'Duration: '},'Gnt.template.TaskTooltip':{startText:'Start',endText:'End',percentText:'Complete',format:'m/d/Y',overflowText:'There {[values.nbrOverflowing > 1 ? "are" : "is"]} {nbrOverflowing} more {[values.nbrOverflowing > 1 ? "tasks" : "task"]}'},'Gnt.plugin.TaskContextMenu':{taskInformation:'Task information...',projectInformation:'Project information...',newTaskText:'New task',deleteTask:'Delete task(s)',editLeftLabel:'Edit left label',editRightLabel:'Edit right label',add:'Add...',deleteDependency:'Delete dependency...',addTaskAbove:'Task above',addTaskBelow:'Task below',addMilestone:'Milestone',addSubtask:'Sub-task',addSuccessor:'Successor',addPredecessor:'Predecessor',convertToMilestone:'Convert to milestone',convertToRegular:'Convert to regular task',splitTask:'Split task'},'Gnt.plugin.DependencyEditor':{fromText:'From',toText:'To',typeText:'Type',lagText:'Lag',endToStartText:'Finish-To-Start',startToStartText:'Start-To-Start',endToEndText:'Finish-To-Finish',startToEndText:'Start-To-Finish',okButtonText:'Ok',cancelButtonText:'Cancel',deleteButtonText:'Delete'},'Gnt.widget.calendar.Calendar':{dayOverrideNameHeaderText:'Name',overrideName:'Name',startDate:'Start Date',endDate:'End Date',error:'Error',dateText:'Date',addText:'Add',editText:'Edit',removeText:'Remove',workingDayText:'Working day',weekendsText:'Weekends',overriddenDayText:'Overridden day',overriddenWeekText:'Overridden week',workingTimeText:'Working time',nonworkingTimeText:'Non-working time',dayOverridesText:'Day overrides',weekOverridesText:'Week overrides',okText:'OK',cancelText:'Cancel',parentCalendarText:'Parent calendar',noParentText:'No parent',selectParentText:'Select parent',newDayName:'[Without name]',calendarNameText:'Calendar name',isProjectCalendarText:'Project calendar',tplTexts:{tplWorkingHours:'Working hours for',tplIsNonWorking:'is non-working',tplOverride:'override',tplInCalendar:'in calendar',tplDayInCalendar:'standard day in calendar',tplBasedOn:'Based on'},overrideErrorText:'There is already an override for this day',overrideDateError:'There is already a week override on this date: {0}',startAfterEndError:'Start date should be less than end date',weeksIntersectError:'Week overrides should not intersect'},'Gnt.widget.calendar.AvailabilityGrid':{startText:'Start',endText:'End',addText:'Add',removeText:'Remove',error:'Error'},'Gnt.widget.calendar.DayEditor':{workingTimeText:'Working time',nonworkingTimeText:'Non-working time'},'Gnt.widget.calendar.WeekEditor':{defaultTimeText:'Default time',workingTimeText:'Working time',nonworkingTimeText:'Non-working time',error:'Error',noOverrideError:"Week override contains only 'default' days - can't save it"},'Gnt.widget.calendar.ResourceCalendarGrid':{name:'Name',calendar:'Calendar'},'Gnt.widget.calendar.CalendarWindow':{title:'Calendar',ok:'Ok',cancel:'Cancel'},'Gnt.widget.calendar.CalendarManager':{addText:'Add',removeText:'Remove',add_child:'Add child',add_node:'Add calendar',add_sibling:'Add sibling',remove:'Remove',calendarName:'Calendar',confirm_action:'Confirm action',confirm_message:'Calendar has unsaved changes. Would you like to save your changes?'},'Gnt.widget.calendar.CalendarManagerWindow':{title:'Calendar manager',ok:'Apply changes',cancel:'Close',confirm_action:'Confirm action',confirm_message:'Calendar has unsaved changes. Would you like to save your changes?'},'Gnt.field.Assignment':{cancelText:'Cancel',closeText:'Save and Close'},'Gnt.column.AssignmentUnits':{text:'Units'},'Gnt.column.Duration':{text:'Duration'},'Gnt.column.Effort':{text:'Effort'},'Gnt.column.BaselineEffort':{text:'Baseline Effort'},'Gnt.column.ActualEffort':{text:'Actual Effort'},'Gnt.column.EffortVariance':{text:'Effort Variance'},'Gnt.column.Cost':{text:'Cost'},'Gnt.column.BaselineCost':{text:'Baseline Cost'},'Gnt.column.ActualCost':{text:'Actual Cost'},'Gnt.column.CostVariance':{text:'Cost Variance',currencySymbol:'$',currencySymbolAlign:'left'},'Gnt.column.EndDate':{text:'Finish'},'Gnt.column.PercentDone':{text:'% Done'},'Gnt.column.ResourceAssignment':{text:'Assigned Resources'},'Gnt.column.ResourceName':{text:'Resource Name'},'Gnt.column.Rollup':{text:'Rollup task',no:'No',yes:'Yes'},'Gnt.field.ManuallyScheduled':{yes:'Yes',no:'No'},'Gnt.field.ReadOnly':{yes:'Yes',no:'No'},'Gnt.column.ManuallyScheduled':{text:'Manual mode'},'Gnt.column.SchedulingMode':{text:'Mode'},'Gnt.column.Predecessor':{text:'Predecessors'},'Gnt.column.Successor':{text:'Successors'},'Gnt.column.StartDate':{text:'Start'},'Gnt.column.WBS':{text:'WBS'},'Gnt.column.Sequence':{text:'#'},'Gnt.column.Calendar':{text:'Calendar'},'Gnt.column.ReadOnly':{text:'Read Only'},'Gnt.widget.taskeditor.ProjectForm':{nameText:'Name',startText:'Start',finishText:'Finish',calendarText:'Calendar',readOnlyText:'Read Only',allowDependenciesText:'Allow cross-project dependencies'},'Gnt.widget.taskeditor.TaskForm':{taskNameText:'Name',durationText:'Duration',datesText:'Dates',baselineText:'Baseline',startText:'Start',finishText:'Finish',percentDoneText:'Percent Complete',baselineStartText:'Start',baselineFinishText:'Finish',baselinePercentDoneText:'Percent Complete',baselineEffortText:'Effort',effortText:'Effort',invalidEffortText:'Invalid effort value',calendarText:'Calendar',manuallyScheduledText:'Manually Scheduled',schedulingModeText:'Scheduling Mode',rollupText:'Rollup',wbsCodeText:'WBS code','Constraint Type':'Constraint Type','Constraint Date':'Constraint Date',readOnlyText:'Read Only'},'Gnt.widget.DependencyGrid':{addDependencyText:'Add new',dropDependencyText:'Remove',idText:'ID',snText:'SN',taskText:'Task Name',blankTaskText:'Please select task',invalidDependencyText:'Invalid dependency',parentChildDependencyText:'Dependency between child and parent found',duplicatingDependencyText:'Duplicate dependency found',transitiveDependencyText:'Transitive dependency',cyclicDependencyText:'Cyclic dependency',typeText:'Type',lagText:'Lag',clsText:'CSS class',endToStartText:'Finish-To-Start',startToStartText:'Start-To-Start',endToEndText:'Finish-To-Finish',startToEndText:'Start-To-Finish',predecessorsText:'Predecessors',successorsText:'Successors'},'Gnt.widget.AssignmentEditGrid':{confirmAddResourceTitle:'Confirm',confirmAddResourceText:'Resource &quot;{0}&quot; not found in list. Would you like to add it?',noValueText:'Please select resource to assign',noResourceText:'No resource &quot;{0}&quot; found in the list','Resource is already assigned':'Resource is already assigned',addAssignmentText:'Add new',dropAssignmentText:'Remove'},'Gnt.widget.taskeditor.TaskEditor':{generalText:'General',resourcesText:'Resources',notesText:'Notes',advancedText:'Advanced'},'Gnt.widget.taskeditor.ProjectEditor':{generalText:'General',descriptionText:'Description'},'Gnt.plugin.taskeditor.BaseEditor':{title:'Task Information',alertCaption:'Information',alertText:'Please correct marked errors to save changes',okText:'Ok',cancelText:'Cancel'},'Gnt.plugin.taskeditor.ProjectEditor':{title:'Project Information'},'Gnt.field.EndDate':{endBeforeStartText:'End date is before start date'},'Gnt.field.ConstraintDate':{format:'m/d/Y H:i'},'Gnt.column.Note':{text:'Note'},'Gnt.column.AddNew':{text:'Add new column...'},'Gnt.column.EarlyStartDate':{text:'Early Start'},'Gnt.column.EarlyEndDate':{text:'Early Finish'},'Gnt.column.LateStartDate':{text:'Late Start'},'Gnt.column.LateEndDate':{text:'Late Finish'},'Gnt.field.Calendar':{calendarNotApplicable:'Task calendar has no overlapping with assigned resources calendars',invalidText:'Invalid value'},'Gnt.column.Slack':{text:'Free Slack'},'Gnt.column.TotalSlack':{text:'Total Slack'},'Gnt.column.Name':{text:'Task Name'},'Gnt.column.BaselineStartDate':{text:'Baseline Start Date'},'Gnt.column.BaselineEndDate':{text:'Baseline End Date'},'Gnt.column.Milestone':{text:'Milestone'},'Gnt.field.Milestone':{yes:'Yes',no:'No'},'Gnt.field.Dependency':{invalidFormatText:'Invalid dependency format',invalidDependencyText:'Invalid dependency found, please make sure you have no cyclic paths between your tasks',invalidDependencyType:'Invalid dependency type {0}. Allowed values are: {1}.'},'Gnt.constraint.Base':{name:'A constraint','Remove the constraint':'Continue. Remove the {0} constraint','Cancel the change and do nothing':'Cancel the change and do nothing','This action will cause a scheduling conflict':'This action will cause a scheduling conflict for summary task "{0}". The {1} constraint on the summary task puts it in conflict with one of its subtasks.'},'Gnt.constraint.implicit.Dependency':{'You moved the task away':'You moved the task "{2}" away from "{1}" and the two tasks are linked ({0}). As a result the link between the tasks will not drive the later task position.','You moved the task before':'You moved the task "{2}" before "{1}" and the two tasks are linked ({0}). As a result the link cannot be honored.','Remove the constraint':'Remove the dependency',depType0:'Start-To-Start',depType1:'Start-To-Finish',depType2:'Finish-To-Start',depType3:'Finish-To-Finish','Keep the dependency & move the task':'Keep the dependency and move the task to {0}'},'Gnt.constraint.implicit.PotentialConflict':{'This could result in a scheduling conflict':'You set a {0} constraint on the task "{1}". This could result in a scheduling conflict since the task has a predecessor.','Remove the constraint':'Continue. Set the {0} constraint','Replace the constraint':'Continue but avoid the conflict by using a {0} constraint instead'},'Gnt.constraint.FinishNoEarlierThan':{name:'Finish no earlier than','Move the task to finish on {0}':'Move the task to finish on {0}'},'Gnt.constraint.FinishNoLaterThan':{name:'Finish no later than','Move the task to finish on {0}':'Move the task to finish on {0}'},'Gnt.constraint.MustFinishOn':{name:'Must finish on','Move the task to finish on {0}':'Move the task to finish on {0}'},'Gnt.constraint.MustStartOn':{name:'Must start on','Move the task to start at {0}':'Move the task to start at {0}'},'Gnt.constraint.StartNoEarlierThan':{name:'Start no earlier than','Move the task to start at {0}':'Move the task to start at {0}'},'Gnt.constraint.StartNoLaterThan':{name:'Start no later than','Move the task to start at {0}':'Move the task to start at {0}'},'Gnt.column.ConstraintDate':{text:'Constraint date',format:'m/d/Y H:i'},'Gnt.column.ConstraintType':{text:'Constraint'},'Gnt.widget.ConstraintResolutionForm':{dateFormat:'m/d/Y H:i','OK':'OK','Cancel':'Cancel','Resolution options':'Resolution options',"Don't ask again":"Don't ask again",'Task {0} violates constraint {1}':'Task "{0}" violates constraint {1}','Task {0} violates constraint {1} {2}':'Task "{0}" violates constraint {1} {2}'},'Gnt.widget.ConstraintResolutionWindow':{'Constraint violation':'Constraint violation'},'Gnt.panel.ResourceHistogram':{resourceText:'Resource'}},apply:function(a){Sch.locale.En.apply(a);this.callParent(arguments)}});Ext.define('Gnt.mixin.Localizable',{extend:'Sch.mixin.Localizable',requires:['Gnt.locale.En']});Ext.define('Gnt.Tooltip',{extend:'Ext.tip.ToolTip',alias:'widget.gantt_task_tooltip',requires:['Ext.Template'],mixins:['Gnt.mixin.Localizable'],anchor:'bottom',autoHide:!1,maskOnDisable:!1,mode:'startend',durationDecimalPrecision:1,template:null,avoidPointer:!1,gantt:null,lastTarget:null,defaultAlign:'b-t',reverseDefaultAlign:'t-b',initComponent:function(){var a=this;a.initialDefaultAlign=a.defaultAlign;a.rtl=a.gantt.rtl;a.startLabel=a.L('startText');a.label2Text=a.mode==='duration'?a.L('durationText'):a.L('endText');if(!a.template){a.template=(new Ext.Template('<div class="sch-timetipwrap x-fa {cls}">'+'<table cellpadding="0" cellspacing="0">'+'<tpl if="value1"><tr><td class="sch-gantt-tip-desc">{label1}</td><td class="sch-gantt-tip-value">{value1}</td></tr></tpl>'+'<tr><td class="sch-gantt-tip-desc">{label2}</td><td class="sch-gantt-tip-value">{value2}</td></tr>'+'</table>'+'</div>')).compile()}a.callParent(arguments);a.update(a.template.apply({value1:'',value2:''}));a.addCls('gnt-tooltip');if(a.avoidPointer){a.on({scope:a,'mouseover':{'element':'el',fn:a.onTipElementMouseOver}})}},updateContent:function(d,f,e,c){var a=this,b;if(a.mode==='duration'){b=a.getDurationContent(d,f,e,c)}else {b=a.getStartEndContent(d,f,e,c)}a.update(b)},getStartEndContent:function(a,e,h,f){var c=this.gantt,g=a&&c.getFormattedDate(a),b;if(a){if(e-a>0){b=c.getFormattedEndDate(e,a)}else {b=g}}else {b=c.getFormattedEndDate(e)}var d={cls:h?'sch-tip-ok fa-check':'sch-tip-notok fa-ban',label2:this.label2Text,value2:b,task:f};if(a){d.label1=this.startLabel;d.value1=a&&c.getFormattedDate(a)}return this.template.apply(d)},getDurationContent:function(c,f,e,a){var d=a.getDurationUnit();var b=a.calculateDuration(c,f,d);return this.template.apply({cls:e?'sch-tip-ok fa-check':'sch-tip-notok fa-ban',label1:this.startLabel,value1:this.gantt.getFormattedDate(c),label2:this.label2Text,value2:parseFloat(Ext.Number.toFixed(b,this.durationDecimalPrecision))+' '+Sch.util.Date.getReadableNameOfUnit(d,b>1),task:a})},onTipElementMouseOver:function(){var a=this,b=a.defaultAlign;a.defaultAlign=a.reverseDefaultAlign;a.reverseDefaultAlign=b;a.lastTarget&&a.showBy(a.lastTarget)},showBy:function(h){var a=this,e,f,b,c,g,d;a.defaultAlign=a.initialDefaultAlign;a.lastTarget=h;if(a.anchor){a.anchorTarget=h}a.callParent([h]);if(Ext.getVersion().isLessThanOrEqual('6.0.2.*')&&a.syncAnchor){e=Ext.fly(h).getRegion();f=a.getEl().getRegion();if(e.bottom<=f.top&&a.tipAnchor!='top'){c='top';g='tl-bl?'}else {if(e.top>=f.bottom&&a.tipAnchor!='bottom'){c='bottom';g='bl-tl?'}else {if(e.right<=f.left&&a.tipAnchor!='left'){c='left';g='l-r?'}else {if(e.left>=f.right&&a.tipAnchor!='right'){c='right';g='r-l?'}}}}if(a.tipAnchor!=c){a.tipAnchor=a.anchor=c;a.syncAnchor();b=Ext.fly(a.getEl().down('.'+Ext.baseCSSPrefix+'tip-anchor')).getRegion();switch(c){case 'top':d=[0,(b.bottom-b.top)/2];break;case 'bottom':d=[0,(b.top-b.bottom)/2];break;case 'left':d=[(b.left-b.right)/2,0];break;case 'right':d=[(b.right-b.left)/2,0];break;}a.alignTo(h,g,d);a.getTargetXY()}}},afterHide:function(b,c,d){var a=this;a.callParent([b,c,d]);a.lastTarget=null}});Ext.define('Gnt.field.mixin.TaskField',{extend:'Ext.Mixin',taskField:'',fieldProperty:'',getTaskValueMethod:'',setTaskValueMethod:'',isTaskField:!0,task:null,taskStore:null,suppressTaskUpdate:0,highlightTaskUpdates:!0,highlightColor:'#009900',lastHighlight:0,instantUpdate:!0,originalInstantUpdate:null,readOnlyUpdateSuspended:0,mixinConfig:{before:{constructor:'beforeConstructed',destroy:'beforeDestroyed'},after:{constructor:'afterConstructed'}},onClassMixedIn:function(a){if(Ext.isIE9&&Ext.getVersion().isGreaterThan('6.5.3')){a.override({selectText:Ext.emptyFn})}},selectOnFocus:!!Ext.isIE9,beforeConstructed:function(){this.setSuppressTaskUpdate(!0)},afterConstructed:function(){this.taskField=this.taskField||this.fieldProperty;this.task&&this.setTask(this.task);this.setSuppressTaskUpdate(!1)},setInstantUpdate:function(a){this.instantUpdate=a},beforeDestroyed:function(){this.destroyTaskListener()},setTask:function(a){if(!a){return}this.destroyTaskListener();this.updateReadOnly(a);this.task=a;a.on('taskupdated',this.onTaskUpdateProcess,this);if(!a.getCalendar(!0)&&!a.getTaskStore(!0)){a.taskStore=a.getTaskStore(!0)||this.taskStore;if(!a.taskStore){throw 'Configuration issue: Gnt.data.taskStore instance should be provided.'}if(!a.getCalendar(!0)&&!a.taskStore.getCalendar()){throw 'Configuration issue: Gnt.data.Calendar instance should be provided.'}}this.setSuppressTaskUpdate(!0);this.onSetTask(a);this.setSuppressTaskUpdate(!1)},onSetTask:function(a){a=a||this.task;this.setValue(this.getTaskValue(a))},setSuppressTaskUpdate:function(a){a?this.suppressTaskUpdate++:this.suppressTaskUpdate--},getSuppressTaskUpdate:function(){return this.suppressTaskUpdate},isReadOnlyUpdateSuspended:function(){return this.readOnlyUpdateSuspended},suspendReadOnlyUpdate:function(){this.readOnlyUpdateSuspended++},resumeReadOnlyUpdate:function(){if(this.isReadOnlyUpdateSuspended()){this.readOnlyUpdateSuspended--}if(!this.readOnlyUpdateSuspended){this.updateReadOnly(this.task)}return this.readOnlyUpdateSuspended},updateReadOnly:function(a){if(this.taskField&&!this.disabled&&!this.forceReadOnly&&!this.isReadOnlyUpdateSuspended()){if(this.editable===!1){if(!a.isEditable(a[this.taskField])){this.setReadOnly(!0)}else {this.setReadOnly(!1);if(this.inputEl){this.inputEl.dom.readOnly=!0}}}else {this.setReadOnly(!a.isEditable(a[this.taskField]))}}},onTaskUpdateProcess:function(b,c){if(c!==this){var a=this.getValue();this.updateReadOnly(b);this.setSuppressTaskUpdate(!0);if(this.onTaskUpdate){this.onTaskUpdate(b,c)}else {this.onSetTask(b)}this.setSuppressTaskUpdate(!1);if(this.highlightTaskUpdates){var e=this.getValue(),d=Ext.isDate(a);if(d&&a-e!==0||!d&&String(a)!==String(e)){this.highlightField()}}}},highlightField:function(b,a){if(this.rendered&&new Date()-this.lastHighlight>1000){this.lastHighlight=new Date();this.inputEl.highlight(b||this.highlightColor,a||{attr:'color'})}},destroyTaskListener:function(){if(this.task){this.task.un('taskupdated',this.onTaskUpdateProcess,this)}},callTaskMethod:function(a,b,c){a=a||this.task;return a&&a[b].apply(a,c)},getTaskValue:function(a){return this.callTaskMethod(a,this.getTaskValueMethod,Ext.Array.slice(arguments,1))},setTaskValue:function(a){if(a.propagating){return}return this.callTaskMethod(a,this.setTaskValueMethod,Ext.Array.slice(arguments,1))},applyChanges:function(a){a=a||this.task;this.setTaskValue(a,this.getValue());a.fireEvent('taskupdated',a,this)}});Ext.define('Gnt.field.Cost',{extend:'Ext.form.field.Number',alias:'widget.costfield',mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],alternateClassName:'Gnt.widget.CostField',disableKeyFilter:!1,minValue:0,allowExponential:!1,baseChars:'0123456789',taskField:'costField',setTaskValueMethod:'setCost',getTaskValueMethod:'getCost',instantUpdate:!0,currencySymbol:null,currencySymbolAlign:null,initComponent:function(){this.invalidText=this.L('invalidText');this.currencySymbol=this.currencySymbol||this.L('currencySymbol');this.currencySymbolAlign=this.currencySymbolAlign||this.L('currencySymbolAlign');this.baseChars=this.baseChars+this.currencySymbol;this.callParent(arguments)},valueToRaw:function(a){return this.valueToVisible(a)},valueToVisible:function(b){var a='';if(Ext.isNumber(b)){a=Ext.Number.toFixed(b,this.decimalPrecision);if(this.currencySymbolAlign=='left'){a=this.currencySymbol+' '+a}else {a+=' '+this.currencySymbol}}return a},rawToValue:function(a){if(a){return this.parseValue(a)}return a},parseValue:function(a){return this.callParent([a&&a.replace(this.currencySymbol,'')])},getErrors:function(a){var b=this.parseValue(a);if(b===null){if(a!==null&&a!==''){return [this.invalidText]}else {b=''}}return this.callParent([b])},setValue:function(a){this.callParent([a]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define('Gnt.column.mixin.TaskFieldColumn',{extend:'Ext.Mixin',mixins:['Gnt.mixin.Localizable'],instantUpdate:!1,field:null,fieldProperty:'',fieldConfigs:'instantUpdate,fieldProperty',defaultEditor:'textfield',useRenderer:!0,htmlEncode:!0,mixinConfig:{after:{initComponent:'afterInitComponent',onRender:'_beforeRender'},afterIf:{applyColumnCls:'applyColumnCls'}},_beforeRender:function(){var a=this.getEditor&&this.getEditor();if(a&&a.setInstantUpdate){a.originalInstantUpdate=a.instantUpdate;a.setInstantUpdate(!1)}},initTaskFieldColumn:function(a){this.text=this.config.text||this.L('text');this.initColumnEditor(a);this.scope=this.scope||this;if(this.useRenderer){this.renderer=this.renderer||this.taskFieldRenderer}this.on('added',this.onColumnAdded,this)},applyColumnCls:function(c,a,b){if(!b.isEditable(this.dataIndex)){a.tdCls=(a.tdCls||'')+' sch-column-readonly'}},afterInitComponent:function(){this.hasCustomRenderer=!0},initColumnEditor:function(b){var a=this.editor;if(a){if('string'==typeof a){a={xtype:a}}if(!a.isInstance){if(!a.xtype&&!a.xclass){a.xtype=this.defaultEditor}var c=Ext.copyTo(Ext.apply({},b),this,this.fieldConfigs,!0);this.editor=Ext.ComponentManager.create(Ext.apply(c,a))}this.field=this.editor}},onColumnAdded:function(){var a=this.up('[taskStore]')||this.up('[store]');var b=a.taskStore||a.store;if(!this.dataIndex&&this.fieldProperty){this.dataIndex=b.model.prototype[this.fieldProperty]}if(this.onReadOnlySet){this.mon(a,'setreadonly',this.onReadOnlySet,this)}},getValueToRender:function(b,d,c){var a=this.field;return a&&a.valueToVisible&&a.valueToVisible(b,c)||b},taskFieldRenderer:function(c,d,e){var a=this.getValueToRender.apply(this,arguments);var b=this.htmlEncode?Ext.util.Format.htmlEncode(a):a;this.applyColumnCls(c,d,e);return b},afterClassMixedIn:function(a){var b=this.prototype,c=b.mixinConfig,d=c&&c.beforeIf,e=c&&c.afterIf;d&&Ext.Object.each(d,function(c,d){if(c in a.prototype){a.addMember(c,function(){if(b[d].apply(this,arguments)!==!1){return this.callParent(arguments)}})}else {a.addMember(c,function(){b[d].apply(this,arguments)})}});e&&Ext.Object.each(e,function(c,d){if(c in a.prototype){a.addMember(c,function(){this.callParent(arguments);b[d].apply(this,arguments)})}else {a.addMember(c,function(){b[d].apply(this,arguments)})}})}});Ext.define('Gnt.column.Cost',{extend:'Ext.grid.column.Column',alias:['widget.costcolumn','widget.ganttcolumn.cost'],requires:['Gnt.field.Cost'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:80,align:'left',decimalPrecision:2,instantUpdate:!0,fieldProperty:'costField',fieldConfigs:['instantUpdate','decimalPrecision','currencySymbol','currencySymbolAlign','fieldProperty'],currencySymbol:null,currencySymbolAlign:null,editor:'costfield',defaultEditor:'costfield',editorConfig:null,initComponent:function(){this.initTaskFieldColumn(this.editorConfig);this.callParent(arguments)},getValueToRender:function(a,b,c){return this.field.valueToVisible(a)},putRawData:function(b,a){a.set(a[this.fieldProperty],b)}});Ext.define('Gnt.field.ActualCost',{extend:'Gnt.field.Cost',alias:'widget.actualcostfield',alternateClassName:'Gnt.widget.ActualCostField',taskField:'actualCostField',setTaskValueMethod:'setActualCost',getTaskValueMethod:'getActualCost'});Ext.define('Gnt.column.ActualCost',{extend:'Gnt.column.Cost',alias:['widget.actualcostcolumn','widget.ganttcolumn.actualcost'],requires:['Gnt.field.ActualCost'],fieldProperty:'actualCostField',editor:'actualcostfield',defaultEditor:'actualcostfield'});Ext.define('Gnt.util.DurationParser',{requires:['Sch.util.Date'],mixins:['Gnt.mixin.Localizable'],parseNumberFn:null,durationRegex:null,allowDecimals:!0,constructor:function(a){Ext.apply(this,a);if(this.unitsRegex){Ext.apply(this.l10n.unitsRegex,this.unitsRegex)}if(!this.durationRegex){this.durationRegex=this.allowDecimals?/^\s*([\-+]?\d+(?:[.,]\d*)?|[\-+]?(?:[.,]\d+))\s*([^\s]+)?/i:/^\s*([\-+]?\d+)(?![.,])\s*([^\s]+)?/i}},parse:function(d){var b=this.durationRegex.exec(d);if(d==null||!b){return null}var e=this.parseNumberFn(b[1]);var c=b[2];var a;if(c){Ext.iterate(this.L('unitsRegex'),function(d,b){if(b.test(c)){a=Sch.util.Date.getUnitByName(d);return !1}});if(!a){return null}}return {value:e,unit:a}}});Ext.define('Gnt.field.trigger.DurationSpinner',{extend:'Ext.form.trigger.Spinner',alias:'trigger.gantt_durationspinner',initEvents:function(){var a=this,b=a.isFieldEnabled,c=a.getStateEl(),d=a.el;c.addClsOnOver(a.overCls,b,a);c.addClsOnClick(a.clickCls,b,a);if(a.repeatClick){a.clickRepeater=new Ext.util.ClickRepeater(d,Ext.apply({preventDefault:!0,handler:a.onClick,delay:Ext.isIE?1000:250,listeners:{mousedown:a.onClickRepeaterMouseDown,scope:a},scope:a},this.repeaterConfig))}else {a.field.mon(d,{click:a.onClick,mousedown:a.onMouseDown,scope:a})}},onClick:function(){var a=this,d=arguments,c=a.clickRepeater?d[1]:d[0],b=a.field;if(!b.readOnly&&!b.disabled){if(a.upEl.contains(c.target)){Ext.callback(a.upHandler,a.scope,[b,a,c],0,b)}else {if(a.downEl.contains(c.target)){Ext.callback(a.downHandler,a.scope,[b,a,c],0,b)}}}!Ext.isIE&&b.inputEl.focus()}});Ext.define('Gnt.field.Duration',{extend:'Ext.form.field.Number',requires:['Gnt.util.DurationParser','Gnt.field.trigger.DurationSpinner'],mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],alias:'widget.durationfield',alternateClassName:'Gnt.widget.DurationField',disableKeyFilter:!0,allowExponential:!1,minValue:0,durationUnit:'',config:{triggers:{spinner:{type:'gantt_durationspinner',upHandler:'onSpinnerUpClick',downHandler:'onSpinnerDownClick',scope:'this'}}},useAbbreviation:!1,getDurationUnitMethod:'getDurationUnit',setTaskValueMethod:'setDuration',getTaskValueMethod:'getDuration',fieldProperty:'durationField',durationParser:null,durationParserConfig:null,constructor:function(b){var a=this;Ext.apply(this,b);this.originalDurationUnit=this.durationUnit;this.durationParser=new Gnt.util.DurationParser(Ext.apply({parseNumberFn:function(){return a.parseValue.apply(a,arguments)},allowDecimals:this.decimalPrecision>0},this.durationParserConfig));this.callParent(arguments);this.invalidText=this.L('invalidText')},onSetTask:function(){this.durationUnit=this.originalDurationUnit||this.task[this.getDurationUnitMethod]();var a=this.getTaskValueMethod?this.getTaskValue(null,this.durationUnit):this.task.get(this.task[this.fieldProperty]);this.setValue(a);this.setSpinUpEnabled(a==null||a<this.maxValue,!0);this.setSpinDownEnabled(a>this.minValue,!0)},rawToValue:function(b){var a=this.parseDuration(b);if(!a){return null}this.durationUnit=a.unit;return a.value!=null?a.value:null},valueToVisible:function(a,d){if(Ext.isNumber(a)){var c=parseInt(a,10),b=Ext.Number.toFixed(a,this.decimalPrecision);return String(c==b?c:b).replace('.',this.decimalSeparator)+' '+Sch.util.Date[this.useAbbreviation?'getShortNameOfUnit':'getReadableNameOfUnit'](d||this.durationUnit,a!==1)}return ''},valueToRaw:function(a){return this.valueToVisible(a,this.durationUnit||'h',this.decimalPrecision,this.useAbbreviation)},parseDuration:function(b){if(b==null){return null}var a=this.durationParser.parse(b);if(!a){return null}a.unit=a.unit||this.durationUnit;return a},getDurationValue:function(){return this.parseDuration(this.getRawValue())},getErrors:function(a){var b;if(a){b=this.parseDuration(a);if(!b){return [this.L('invalidText')]}a=b.value}if(arguments.length>0&&a==null){a=''}return this.callParent(arguments)},checkChange:function(){if(!this.suspendCheckChange){var c=this,a=c.getDurationValue(),b=c.lastValue;var d=a&&!b||!a&&b||a&&b&&(a.value!=b.value||a.unit!=b.unit);if(d&&!c.isDestroyed){c.lastValue=a;c.fireEvent('change',c,a,b);c.onChange(a,b)}}},getValue:function(){return this.value},applyChanges:function(a){a=a||this.task;this.setTaskValue(a,this.getValue(),this.durationUnit);a.fireEvent('taskupdated',a,this)},onBlur:function(c){var a=this;a.blurring=!0;var b=a.callParent(arguments);a.blurring=!1;return b},setValue:function(a,c){var b=a;if(Ext.isObject(a)){this.durationUnit=a.unit;b=a.value}this.callParent([b]);if(!this.readOnly&&(c||this.blurring||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}},assertValue:function(){var b=this,c=b.getValue(),e=b.durationUnit,a=b.getDurationValue();if(this.isValid()){var d=!a&&c||a&&(a.value!=c||a.unit!=e);if(d){b.setValue(a,!0)}}},beforeBlur:function(){this.assertValue()},onSpinUp:function(){var a=this;if(!a.readOnly){var b=a.getValue()||0;a.setSpinValue(Ext.Number.constrain(b+a.step,a.minValue,a.maxValue))}},onSpinDown:function(){var a=this;if(!a.readOnly){var b=a.getValue()||0;a.setSpinValue(Ext.Number.constrain(b-a.step,a.minValue,a.maxValue))}}});Ext.define('Gnt.column.Duration',{extend:'Ext.grid.column.Column',alias:['widget.durationcolumn','widget.ganttcolumn.duration'],requires:['Gnt.field.Duration'],mixins:['Gnt.column.mixin.TaskFieldColumn'],isDurationColumn:!0,width:80,align:'left',decimalPrecision:2,useAbbreviation:!1,instantUpdate:!0,fieldProperty:'durationField',fieldConfigs:['instantUpdate','useAbbreviation','decimalPrecision','fieldProperty'],editor:'durationfield',defaultEditor:'durationfield',initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},afterRender:function(){this.callParent(arguments);this.setSorter(Ext.Function.bind(this.sorterFn,this))},getValueToRender:function(a,d,b){if(!Ext.isNumber(a)){return ''}var c=this.field.originalDurationUnit||b.getDurationUnit();a=b.getDuration(c);return this.field.valueToVisible(a,c)},putRawData:function(a,b){b.setDuration(a)},sorterFn:function(a,b){var c=a.getCalendar().convertDurationToMs(a.getDuration(),a.getDurationUnit()),d=b.getCalendar().convertDurationToMs(b.getDuration(),b.getDurationUnit());return c===d?0:c<d?-1:1}});Ext.define('Gnt.field.Effort',{extend:'Gnt.field.Duration',alias:'widget.effortfield',alternateClassName:'Gnt.widget.EffortField',fieldProperty:'effortField',getDurationUnitMethod:'getEffortUnit',setTaskValueMethod:'setEffort',getTaskValueMethod:'getEffort',applyChanges:function(a){a=a||this.task;this.setTaskValue(a,this.getValue()||null,this.durationUnit);a.fireEvent('taskupdated',a,this)}});Ext.define('Gnt.field.ActualEffort',{extend:'Gnt.field.Effort',alias:'widget.actualeffortfield',alternateClassName:'Gnt.widget.ActualEffortField',taskField:'actualEffortField',setTaskValueMethod:'setActualEffort',getTaskValueMethod:'getActualEffort'});Ext.define('Gnt.column.ActualEffort',{extend:'Gnt.column.Duration',alias:['widget.actualeffortcolumn','widget.ganttcolumn.actualeffort'],requires:['Gnt.field.ActualEffort'],fieldProperty:'actualEffortField',editor:'actualeffortfield',defaultEditor:'actualeffortfield',getValueToRender:function(a,c,b){if(!Ext.isNumber(a)){return ''}return this.field.valueToVisible(a,b.getEffortUnit())},putRawData:function(a,b){b.setActualEffort(a)}});Ext.define('Gnt.field.Percent',{extend:'Ext.form.field.Number',alias:'widget.percentfield',mixins:['Gnt.mixin.Localizable'],alternateClassName:'Gnt.widget.PercentField',disableKeyFilter:!1,minValue:0,maxValue:100,allowExponential:!1,baseChars:'0123456789%',selectOnFocus:Ext.isIE9?!0:!1,constructor:function(){this.callParent(arguments);this.invalidText=this.L('invalidText')},valueToRaw:function(a){if(Ext.isNumber(a)){if(a>99&&a<100){var b=Math.pow(10,this.decimalPrecision);a=Math.floor(a*b)/b}return parseFloat(Ext.Number.toFixed(a,this.decimalPrecision))+'%'}return ''},getErrors:function(b){var a=this.parseValue(b);if(a===null){if(b!==null&&b!==''){return [this.invalidText]}else {a=''}}return this.callParent([a])}});Ext.define('Gnt.column.AssignmentUnits',{extend:'Ext.grid.column.Number',mixins:['Gnt.mixin.Localizable'],requires:['Gnt.field.Percent'],alias:'widget.assignmentunitscolumn',dataIndex:'Units',format:'0 %',align:'left',editor:{xtype:'percentfield',minValue:0,maxValue:undefined,step:10,selectOnFocus:Ext.isIE?!1:!0},constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.scope=this;this.callParent(arguments)},renderer:function(a,c,b){if(a){return Ext.util.Format.number(a,this.format)}}});Ext.define('Gnt.widget.DatePickerWithDateHighlighting',{extend:'Ext.picker.Date',alias:'widget.datepickerwithdatehighlighting',workingDayCls:'gnt-datepicker-workingday',nonWorkingDayCls:'gnt-datepicker-nonworkingday',overriddenDayCls:'gnt-datepicker-overriddenday',overriddenWeekDayCls:'gnt-datepicker-overriddenweekday',weekOverridesStore:null,dayOverridesCalendar:null,update:function(){this.callParent(arguments);this.refreshCssClasses()},refreshCssClasses:function(){var a=this;if(!a.cells||!a.cells.elements){return}var c=a.cells.elements;this.removeCustomCls();for(var b=0;b<a.numDays;b++){var d=c[b].firstChild.dateValue;c[b].className+=' '+this.getDateCls(new Date(d))}},getDateCls:function(a){var b=this.workingDayCls;if(a.getMonth()!==this.getActive().getMonth()){return}if(this.calendar&&!this.calendar.isWorkingDay(a)){b=this.nonWorkingDayCls}return b},removeCustomCls:function(){this.cells.removeCls([this.overriddenDayCls,this.nonWorkingDayCls,this.workingDayCls,this.overriddenWeekDayCls])}});Ext.define('Gnt.field.Date',{extend:'Ext.form.field.Date',mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],requires:['Gnt.widget.DatePickerWithDateHighlighting'],adjustMilestones:!0,keepDuration:!1,reAssertValue:!0,keepTime:!0,onExpand:function(){var a=this.valueToVisible(this.getValue());this._expanding=!1;if(!this.isValid()){a=this.getRawValue();if(a){a=Ext.Date.parse(a,this.format)}}this.picker.setValue(Ext.isDate(a)?a:new Date())},createPicker:function(){var b=Ext.picker.Date;Ext.picker.Date=Gnt.widget.DatePickerWithDateHighlighting;var a=this.callParent(arguments);Ext.picker.Date=b;return a},applyKeptTimeToValue:function(a){if(this.keepTime&&!Ext.Date.formatContainsHourInfo(this.format)){this.applyTimeToValue(a,this.getTaskValue())}return a},applyTimeToValue:function(b,a){a=a||this.getTaskValue();if(Ext.isDate(b)&&a){b.setHours(a.getHours());b.setMinutes(a.getMinutes())}return b},onSelect:function(f,b){var a=this;if(this.keepTime||Ext.Date.formatContainsHourInfo(this.format)){a.applyTimeToValue(b,this.getTaskValue())}var e=a.getValue();var c=this.visibleToValue(b);var d=Ext.Date.format(b,this.format);if(e!=c){if(this.getErrors(d).length>0){a.setRawValue(d);a.collapse();a.validate()}else {a.setValue(c,!0);a.fireEvent('select',a,c);if(Ext.getVersion().isGreaterThan('6.0.1')){a.onTabOut(f)}else {a.inputEl.focus();a.collapse()}}}},setValue:function(c,d){if(this._expanding){return}this.callParent([c]);var a=this.task;if(!this.readOnly&&(d||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&a&&a.taskStore&&c&&(!(this.validateOnBlur||this.validateOnFocusLeave)||this.isValid())){this.applyChanges();if(this.reAssertValue){var b=this.getTaskValue();if(b-this.getValue()!==0){this.callParent([b])}}a.fireEvent('taskupdated',a,this)}},rawToValue:function(a){if(!a){return null}var b=this.applyKeptTimeToValue(this.parseDate(a));return this.visibleToValue(b)||a||null},valueToRaw:function(a){if(!a){return a}return Ext.Date.format(this.valueToVisible(a),this.format)},getValue:function(){return Ext.isEmpty(this.value)?null:this.value},visibleToValue:function(){throw 'Abstract visibleToValue method called'},valueToVisible:function(){throw 'Abstract valueToVisible method called'},checkChange:function(){if(!this.suspendCheckChange){var a=this,b=a.rawToValue(a.inputEl?a.inputEl.getValue():Ext.valueFrom(a.rawValue,'')),c=a.lastValue;if(!a.isEqual(b,c)&&!a.isDestroyed){a.lastValue=b;a.fireEvent('change',a,b,c);a.onChange(b,c)}}},assertValue:function(){var a=this,f=a.rawValue,d=a.getRawValue(),e=a.getValue(),c=a.rawToValue(d),b=a.focusTask;if(b){b.cancel()}if(f!=d||c-e!==0){if(!a.validateOnBlur||a.isValid()){a.setValue(c,!0)}}},applyChanges:function(a){a=a||this.task;var b=a.getTaskStore(!0)||this.taskStore;if(this.value){this.setTaskValue(a,this.value,this.keepDuration,b.skipWeekendsDuringDragDrop)}else {this.setTaskValue(a,null)}},expand:function(){this._expanding=!0;this.callParent(arguments)},beforeBlur:function(){this.assertValue()}});Ext.define('Gnt.field.EndDate',{extend:'Gnt.field.Date',requires:['Sch.util.Date'],alias:'widget.enddatefield',fieldProperty:'endDateField',getTaskValueMethod:'getEndDate',setTaskValueMethod:'setEndDate',validateStartDate:!0,isBaseline:!1,valueToVisible:function(b,a){a=a||this.task;return a&&a.getDisplayEndDate(this.format,this.adjustMilestones,b,!0,this.isBaseline)},visibleToValue:function(a,c){if(a){var b=this;c=c||b.task;if(a&&(!c.isMilestone(b.isBaseline)||b.adjustMilestones)&&a-Ext.Date.clearTime(a,!0)===0&&!Ext.Date.formatContainsHourInfo(b.format)){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)}}else {a=null}return a},isValidAgainstStartDate:function(b){var a=this.task;return !a||!b||(!a.getDuration()?b>=a.getStartDate():b>a.getStartDate())},getErrors:function(b){var a=this.callParent(arguments);if(a&&a.length){return a}if(this.validateStartDate){if(!this.isValidAgainstStartDate(this.rawToValue(b))){return [this.L('endBeforeStartText')]}}return []},onSetTask:function(b){var a=this.getPicker();a.calendar=b.getCalendar();this.callParent(arguments)}});Ext.define('Gnt.column.EndDate',{extend:'Ext.grid.column.Date',alias:['widget.enddatecolumn','widget.ganttcolumn.enddate'],requires:['Ext.grid.CellEditor','Gnt.field.EndDate'],mixins:['Gnt.column.mixin.TaskFieldColumn'],isEndDateColumn:!0,width:100,align:'left',editorFormat:null,adjustMilestones:!0,validateStartDate:!0,keepDuration:!1,fieldProperty:'endDateField',fieldConfigs:['instantUpdate','adjustMilestones','keepDuration','validateStartDate','fieldProperty'],editor:'enddatefield',defaultEditor:'enddatefield',initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},getValueToRender:function(a,c,b){return a&&Ext.Date.format(this.field.valueToVisible(a,b),this.format)||''},getRawData:function(a){var b=a.getEndDate();return b?Ext.Date.parse(this.getValueToRender(b,null,a),this.format):null},prepareNewEndDate:function(a,b){if(a){if(!(a instanceof Date)){a=Ext.Date.parse(a,this.format)}a=this.field.visibleToValue(a,b)}return a},putRawData:function(b,a){if(b){b=this.prepareNewEndDate(b,a);if(a.getStartDate()&&a.getStartDate()>b){a.setDuration(0)}}a.setEndDate(b,a.isMilestone(),!1)}});Ext.define('Gnt.field.BaselineEndDate',{extend:'Gnt.field.EndDate',alias:'widget.baselineenddatefield',fieldProperty:'baselineEndDateField',getTaskValueMethod:'getBaselineEndDate',setTaskValueMethod:'setBaselineEndDate',isBaseline:!0,isValidAgainstStartDate:function(a){return !this.task||!a||a>=this.task.getBaselineStartDate()},applyChanges:function(a,b){a=a||this.task;this.setTaskValue(a,this.value||null);if(!b){a.fireEvent('taskupdated',a,this)}},onSetTask:function(b){var a=this.getPicker();a.calendar=b.getCalendar();this.callParent(arguments)}});Ext.define('Gnt.column.BaselineEndDate',{extend:'Gnt.column.EndDate',requires:['Gnt.field.BaselineEndDate'],alias:['widget.baselineenddatecolumn','widget.ganttcolumn.baselineenddate'],width:100,fieldProperty:'baselineEndDateField',fieldConfigs:['instantUpdate','adjustMilestones','keepDuration','validateStartDate','fieldProperty'],editor:'baselineenddatefield',defaultEditor:'baselineenddatefield',getRawData:function(a){var b=a.getBaselineEndDate();return b?Ext.Date.parse(this.getValueToRender(b,null,a),this.format):null},putRawData:function(a,b){if(a){a=this.prepareNewEndDate(a,b)}b.setBaselineEndDate(a)}});Ext.define('Gnt.field.BaselineCost',{extend:'Gnt.field.Cost',alias:'widget.baselinecostfield',alternateClassName:'Gnt.widget.BaselineCostField',taskField:'baselineCostField',setTaskValueMethod:'setBaselineCost',getTaskValueMethod:'getBaselineCost'});Ext.define('Gnt.column.BaselineCost',{extend:'Gnt.column.Cost',alias:['widget.baselinecostcolumn','widget.ganttcolumn.baselinecost'],requires:['Gnt.field.BaselineCost'],fieldProperty:'baselineCostField',editor:'baselinecostfield',defaultEditor:'baselinecostfield'});Ext.define('Gnt.field.BaselineEffort',{extend:'Gnt.field.Effort',alias:'widget.baselineeffortfield',alternateClassName:'Gnt.widget.BaselineEffortField',taskField:'baselineEffortField',setTaskValueMethod:'setBaselineEffort',getTaskValueMethod:'getBaselineEffort'});Ext.define('Gnt.column.BaselineEffort',{extend:'Gnt.column.Duration',alias:['widget.baselineeffortcolumn','widget.ganttcolumn.baselineeffort'],requires:['Gnt.field.BaselineEffort'],fieldProperty:'baselineEffortField',editor:'baselineeffortfield',defaultEditor:'baselineeffortfield',getValueToRender:function(a,c,b){if(!Ext.isNumber(a)){return ''}return this.field.valueToVisible(a,b.getEffortUnit())},putRawData:function(a,b){b.setEffort(a)}});Ext.define('Gnt.field.StartDate',{extend:'Gnt.field.Date',alias:'widget.startdatefield',keepDuration:!0,fieldProperty:'startDateField',getTaskValueMethod:'getStartDate',setTaskValueMethod:'setStartDate',isBaseline:!1,valueToVisible:function(b,a){a=a||this.task;return a&&a.getDisplayStartDate(this.format,this.adjustMilestones,b,!0,this.isBaseline)},visibleToValue:function(a,b){b=b||this.task;if(b&&a){var c=!Ext.isDate(this.lastValue)||this.lastValue-Ext.Date.clearTime(this.lastValue,!0)===0;if(this.adjustMilestones&&b.isMilestone(this.isBaseline)&&a-Ext.Date.clearTime(a,!0)===0&&c&&!Ext.Date.formatContainsHourInfo(this.format)){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)}}return a},onSetTask:function(b){var a=this.getPicker();a.calendar=b.getCalendar();this.callParent(arguments)}});Ext.define('Gnt.column.StartDate',{extend:'Ext.grid.column.Date',alias:['widget.startdatecolumn','widget.ganttcolumn.startdate'],requires:['Gnt.field.StartDate'],mixins:['Gnt.column.mixin.TaskFieldColumn'],isStartDateColumn:!0,width:100,align:'left',editorFormat:null,adjustMilestones:!0,keepDuration:!0,fieldProperty:'startDateField',fieldConfigs:['instantUpdate','adjustMilestones','keepDuration','fieldProperty'],editor:'startdatefield',defaultEditor:'startdatefield',initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},getValueToRender:function(a,c,b){return a&&Ext.Date.format(this.field.valueToVisible(a,b),this.format)||''},putRawData:function(a,b){if(a&&!(a instanceof Date)){a=Ext.Date.parse(a,this.format)}b.setStartDate(a)}});Ext.define('Gnt.field.BaselineStartDate',{extend:'Gnt.field.StartDate',alias:'widget.baselinestartdatefield',fieldProperty:'baselineStartDateField',getTaskValueMethod:'getBaselineStartDate',setTaskValueMethod:'setBaselineStartDate',isBaseline:!0,applyChanges:function(a,b){a=a||this.task;this.setTaskValue(a,this.value);if(!b){a.fireEvent('taskupdated',a,this)}},onSetTask:function(b){var a=this.getPicker();a.calendar=b.getCalendar();this.callParent(arguments)}});Ext.define('Gnt.column.BaselineStartDate',{extend:'Gnt.column.StartDate',requires:['Gnt.field.BaselineStartDate'],alias:['widget.baselinestartdatecolumn','widget.ganttcolumn.baselinestartdate'],width:100,fieldProperty:'baselineStartDateField',fieldConfigs:['instantUpdate','adjustMilestones','fieldProperty'],editor:'baselinestartdatefield',defaultEditor:'baselinestartdatefield',putRawData:function(a,b){if(a&&!(a instanceof Date)){a=Ext.Date.parse(a,this.format)}b.setBaselineStartDate(a)}});Ext.define('Gnt.model.Calendar',{extend:'Sch.model.Customizable',requires:['Ext.data.NodeInterface'],idProperty:'Id',calendar:null,nameField:'Name',daysPerMonthField:'DaysPerMonth',daysPerWeekField:'DaysPerWeek',hoursPerDayField:'HoursPerDay',weekendsAreWorkdaysField:'WeekendsAreWorkdays',weekendFirstDayField:'WeekendFirstDay',weekendSecondDayField:'WeekendSecondDay',defaultAvailabilityField:'DefaultAvailability',daysField:'Days',calendarClassField:'CalendarClass',phantomIdField:'PhantomId',phantomParentIdField:'PhantomParentId',customizableFields:[{name:'Name'},{name:'DaysPerMonth',type:'number'},{name:'DaysPerWeek',type:'number'},{name:'HoursPerDay',type:'number'},{name:'WeekendsAreWorkdays',type:'boolean'},{name:'WeekendFirstDay',type:'integer'},{name:'WeekendSecondDay',type:'integer'},{name:'DefaultAvailability'},{name:'Days'},{name:'CalendarClass',defaultValue:'Gnt.data.Calendar'},{name:'PhantomId'},{name:'PhantomParentId'}],constructor:function(a,e,b){var c=a||b||{};var d=c.calendar||c.Days;a&&delete a.calendar;b&&delete b.calendar;this.rawConfig=Ext.apply({},a);this.callParent(arguments);this.setDays(d);this.data[this.phantomIdField]=this.getId()},get:function(a){if(a==='Days'){return this.getCalendar()||this.data[this.daysField]}else {return this.callParent(arguments)}},set:function(b,a){if(b==='Days'){if(a instanceof Gnt.data.Calendar){this.setCalendar(a)}else {this.data[this.daysField]=a}}else {return this.callParent(arguments)}},getCalendar:function(){return this.calendar},setCalendar:function(a){this.calendar=a},getCalendarConfig:function(){var a=this;var e={calendarId:a.getId(),parent:a.parentNode&&a.parentNode.getCalendar()};var d=['daysPerMonth','daysPerWeek','hoursPerDay','name','weekendFirstDay','weekendSecondDay','weekendsAreWorkdays','defaultAvailability'];for(var c=0,g=d.length;c<g;c++){var b=d[c];if(a[b+'Field'] in a.rawConfig){var f='get'+Ext.String.capitalize(b);e[b]=a[f]()}}return e},getModelConfig:function(a,c){var b={};if(!c){b.parentId=a.parent&&a.parent.calendarId;b.calendar=a}b[this.daysPerMonthField]=a.daysPerMonth;b[this.daysPerWeekField]=a.daysPerWeek;b[this.hoursPerDayField]=a.hoursPerDay;b[this.nameField]=a.name;b[this.weekendFirstDayField]=a.weekendFirstDay;b[this.weekendSecondDayField]=a.weekendSecondDay;if(a.hasOwnProperty('weekendsAreWorkdays')){b[this.weekendsAreWorkdaysField]=a.weekendsAreWorkdays}if(a.hasOwnProperty('defaultAvailability')){b[this.defaultAvailabilityField]=a.defaultAvailability}b[this.calendarClassField]=Ext.getClassName(a);return b},setCalendarManager:function(a){this.calendarManager=a},getCalendarManager:function(){return this.calendarManager},getParentCalendarClass:function(){var a=this.parentNode,b;while(a&&!b){b=a.getCalendarClass();a=a.parentNode}return b},fillDataFromPrototype:function(b){var d=b[this.calendarClassField]||this.treeStore&&this.treeStore.getCalendarClass()||this.getCalendarClass()||this.getParentCalendarClass()||this.getField(this.calendarClassField).getDefaultValue();if(d){if(!b[this.calendarClassField]){b[this.calendarClassField]=d}var a=b.children;if(a&&a.length){for(var c=0;c<a.length;c++){this.fillDataFromPrototype(a[c])}}}},prepareCalendarNode:function(a){if(a instanceof Gnt.data.Calendar){a=this.getModelConfig(a)}else {if(Ext.isObject(a)&&!(a instanceof Gnt.model.Calendar)){this.fillDataFromPrototype(a)}}a=this.createNode(a);if(this.phantom){if(this.getId()!==a.data[this.phantomParentIdField]){a.modified=a.modified||{};a.modified[this.phantomParentIdField]=a.data[this.phantomParentIdField];a.data[this.phantomParentIdField]=this.getId()}}return a}},function(){Ext.data.NodeInterface.decorate(this);this.override({insertBefore:function(a){a=this.prepareCalendarNode(a);return this.callParent(arguments)},appendChild:function(a){if(a instanceof Array){for(var b=0;b<a.length;b++){a[b]=this.prepareCalendarNode(a[b])}}else {a=this.prepareCalendarNode(a)}return this.callParent(arguments)}})});Ext.define('Gnt.model.CalendarDay',{extend:'Sch.model.CalendarDay',customizableFields:[{name:'Cls',defaultValue:'gnt-holiday'}]});Ext.define('Gnt.data.Calendar',{extend:'Sch.data.Calendar',model:'Gnt.model.CalendarDay',defaultNonWorkingTimeCssCls:'gnt-holiday'});Ext.define('Gnt.field.Calendar',{extend:'Ext.form.field.ComboBox',requires:['Ext.data.Store','Gnt.model.Calendar','Gnt.data.Calendar'],mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],alias:'widget.calendarfield',alternateClassName:'Gnt.widget.CalendarField',fieldProperty:'calendarIdField',getTaskValueMethod:'getCalendarId',setTaskValueMethod:'setCalendarId',pickerAlign:'tl-bl?',matchFieldWidth:!0,editable:!0,triggerAction:'all',valueField:'Id',displayField:'Name',queryMode:'local',forceSelection:!0,allowBlank:!0,initComponent:function(){var a=this,b=a.getInitialConfig();if(!b.store||a.store.isEmptyStore){a.store={xclass:'Ext.data.Store',autoDestroy:!0,model:'Gnt.model.Calendar'}}if(!(a.store instanceof Ext.data.Store)){a.store=Ext.create(a.store)}a.callParent(arguments);a.updateCalendarsStore();a.mon(Ext.data.StoreManager,{add:function(b,a,c){if(a instanceof Gnt.data.Calendar){this.updateCalendarsStore()}},remove:function(b,a,c){if(a instanceof Gnt.data.Calendar){this.updateCalendarsStore()}},scope:a});a.on({expand:a.updateCalendarsStore,show:function(){a.setReadOnly(a.readOnly)},change:a.onFieldChange,scope:a})},updateCalendarsStore:function(){var a=Ext.Array.map(Gnt.data.Calendar.getAllCalendars(),function(a){return {Id:a.calendarId,Name:a.name||a.calendarId}});this.store.loadData(a)},setReadOnly:function(a){this.updateCalendarsStore();a=a||this.store.count()===0;this.callParent([a])},onSetTask:function(c){this.setReadOnly(this.readOnly);var a=this.getTaskValue();if(!a&&typeof a!=='number'){var b=c.getProjectCalendar();a=b&&b.calendarId||a}this.setValue(a)},valueToVisible:function(d,e){var a=this,b=[];var c=this.findRecordByValue(d);if(c){b.push(c.data)}else {if(Ext.isDefined(a.valueNotFoundText)&&typeof a.valueNotFoundText=='string'){b.push(a.valueNotFoundText)}}return a.displayTpl.apply(b)},getValue:function(){return this.value||''},getErrors:function(a){if(a){var c=this.findRecordByDisplay(a);if(c){if(this.task&&!this.task.isCalendarApplicable(c.getId())){return [this.L('calendarNotApplicable')]}}}var b=this.callParent(arguments);if(b&&b.length){return b}if(!Ext.isEmpty(a)&&!(this.findRecordByDisplay(a)||this.findRecordByValue(a))){return [this.L('invalidText')]}else {return []}},onFieldChange:function(b,a){this.setValue(a)},setValue:function(a){this.callParent([a]);if(undefined===a||null===a||''===a){this.value=''}if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){if(this.getTaskValue()!=this.value){this.applyChanges()}}},assertValue:function(){var a=this.getRawValue();if(!a&&this.value){this.setValue('')}else {this.callParent(arguments)}}});Ext.define('Gnt.column.Calendar',{extend:'Ext.grid.column.Column',alias:['widget.calendarcolumn','widget.ganttcolumn.calendar'],requires:['Gnt.model.Calendar','Gnt.field.Calendar'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:100,align:'left',instantUpdate:!0,store:null,fieldProperty:'calendarIdField',fieldConfigs:['instantUpdate','store','fieldProperty'],editor:'calendarfield',defaultEditor:'calendarfield',initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},applyColumnCls:function(b,a,e,f,c,d){if(!b){a.tdCls=(a.tdCls||'')+' gnt-default'}},getValueToRender:function(a,e,c,f,d,b){a=a||(b.calendar?b.calendar.calendarId:'');return this.field.valueToVisible(a,c)||a}});Ext.define('Gnt.field.ConstraintDate',{extend:'Gnt.field.Date',alias:'widget.constraintdatefield',fieldProperty:'constraintDateField',getTaskValueMethod:'getConstraintDate',setTaskValueMethod:'setConstraintDate',reAssertValue:!1,constructor:function(a){a=a||{};this.format=a.format||this.L('format');return this.callParent(arguments)},valueToVisible:function(c,a){a=a||this.task;var e=this,b=a&&a.getConstraintClass(),d=e.format||Ext.Date.defaultFormat;if(b){return b.getDisplayableConstraintDateForFormat(c,d,a)}else {return c}},visibleToValue:function(a){var d=this,e=d.format||Ext.Date.defaultFormat,b=d.task,c=b&&b.getConstraintClass();if(c&&!Ext.isEmpty(a)){a=c.adjustConstraintDateFromDisplayableWithFormat(a,e,b)}return a}});Ext.define('Gnt.column.ConstraintDate',{extend:'Ext.grid.column.Date',alias:['widget.constraintdatecolumn','widget.ganttcolumn.constraintdate'],requires:['Gnt.field.ConstraintDate'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:100,align:'left',fieldProperty:'constraintDateField',editor:'constraintdatefield',defaultEditor:'constraintdatefield',initComponent:function(){this.format=this.format||this.L('format');this.initTaskFieldColumn({format:this.editorFormat||this.format,taskField:this.fieldProperty});this.callParent(arguments)},getValueToRender:function(a,c,b){return a&&Ext.Date.format(this.field.valueToVisible(a,b),this.format)||''}});Ext.define('Gnt.field.ConstraintType',{extend:'Ext.form.field.ComboBox',mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],uses:['Gnt.constraint.Base'],alias:'widget.constrainttypefield',alternateClassName:'Gnt.widget.ConstraintType.Field',fieldProperty:'constraintTypeField',getTaskValueMethod:'getConstraintType',setTaskValueMethod:'setConstraint',pickerAlign:'tl-bl?',matchFieldWidth:!1,forceSelection:!0,triggerAction:'all',initComponent:function(){var a=this;var b=a.L('none');a.store=a.store||Gnt.field.ConstraintType.buildDefaultConstraintTypeList(b);a.emptyText=a.emptyText||b;this.on('change',this.onFieldChange,this);a.callParent(arguments);this.optionsFilter=new Ext.util.Filter({id:a.getId()+'-filter',filterFn:a.filterOptions,scope:a});a.store.addFilter(this.optionsFilter)},filterOptions:function(c){var a=c.get(this.valueField),b=Gnt.constraint.Base.getConstraintClass(a);return !this.task||!a||b&&b.isApplicable(this.task)},onSetTask:function(a){a=a||this.task;this.store&&this.store.addFilter(this.optionsFilter);this.setValue(this.getTaskValue(a))},getErrors:function(b){var a=this.callParent(arguments);if(a&&a.length){return a}if(!Ext.isEmpty(b)&&!(this.findRecordByDisplay(b)||this.findRecordByValue(b))){return [this.L('invalidText')]}else {return []}},valueToVisible:function(d,e){var b=this,a=[];var c=this.findRecordByValue(!Ext.isEmpty(d)?d:null);if(c){a.push(c.data)}else {if(Ext.isDefined(b.valueNotFoundText)){a.push(b.valueNotFoundText||'')}}return b.displayTpl.apply(a)},applyChanges:function(a){var b=this,d=b.getValue(),c;a=a||b.task;c=Gnt.constraint.Base.getConstraintClass(d);b.setTaskValue(a,d,c&&c.getInitialConstraintDate(a)||null);a.fireEvent('taskupdated',a,b)},findRecordByDisplay:function(a){if(!a){return this.store.first()}return this.callParent(arguments)},onFieldChange:function(c,b){var a=this;if(!a.getSuppressTaskUpdate()&&a.task&&(b||this.getRawValue()==a.L('none')||!b&&!this.getRawValue())){a.applyChanges()}},statics:{buildDefaultConstraintTypeList:function(b){var a=[];Ext.Array.each(Ext.ClassManager.getNamesByExpression('gntconstraint.*'),function(d){var b=Ext.ClassManager.get(d),c=b.alias[0],e=c.split('.').pop();b&&a.push([e,b.L('name')])});a=Ext.Array.sort(a,function(a,b){return a[1]>b[1]?1:-1});b&&a.unshift([null,b]);return a}}});Ext.define('Gnt.column.ConstraintType',{extend:'Ext.grid.column.Column',requires:['Gnt.field.ConstraintType'],mixins:['Gnt.column.mixin.TaskFieldColumn'],alias:['widget.constrainttypecolumn','widget.ganttcolumn.constrainttype'],width:100,align:'left',data:null,fieldProperty:'constraintTypeField',editor:'constrainttypefield',defaultEditor:'constrainttypefield',initComponent:function(){this.initTaskFieldColumn({store:this.data,taskField:this.fieldProperty});this.callParent(arguments)},getValueToRender:function(a,c,b){return a&&this.field.valueToVisible(a,b)||''}});Ext.define('Gnt.column.CostVariance',{extend:'Ext.grid.column.Column',requires:['Ext.util.Format'],alias:['widget.costvariancecolumn','widget.ganttcolumn.costvariance'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:80,decimalPrecision:2,decimalSeparator:null,fieldProperty:'costVarianceField',currencySymbol:null,currencySymbolAlign:null,initComponent:function(){this.currencySymbol=this.currencySymbol||this.L('currencySymbol');this.currencySymbolAlign=this.currencySymbolAlign||this.L('currencySymbolAlign');this.initTaskFieldColumn();this.decimalSeparator=this.decimalSeparator||Ext.util.Format.decimalSeparator;this.callParent(arguments)},getValueToRender:function(b,c,d){var a='';if(Ext.isNumber(b)){a=Ext.Number.toFixed(b,this.decimalPrecision);if(this.currencySymbolAlign=='left'){a=this.currencySymbol+' '+a}else {a+=' '+this.currencySymbol}}return a}});Ext.define('Gnt.field.DeadlineDate',{extend:'Gnt.field.Date',requires:['Sch.util.Date'],alias:'widget.deadlinedatefield',fieldProperty:'deadlineDateField',getTaskValueMethod:'getDeadlineDate',setTaskValueMethod:'setDeadlineDate',valueToVisible:function(b,a){a=a||this.task;return a.getDisplayEndDate(this.format,!0,b,!0)},visibleToValue:function(a){if(a&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)}return a},onSetTask:function(b){var a=this.getPicker();a.calendar=b.getCalendar();this.callParent(arguments)}});Ext.define('Gnt.column.DeadlineDate',{extend:'Ext.grid.column.Date',requires:['Gnt.field.DeadlineDate'],alias:['widget.deadlinecolumn','widget.ganttcolumn.deadline'],mixins:['Gnt.column.mixin.TaskFieldColumn'],draggable:!0,fieldProperty:'deadlineDateField',editor:'deadlinedatefield',initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(a,c,b){return a&&Ext.Date.format(this.field.valueToVisible(a,b),this.format)||''}});Ext.define('Gnt.util.DependencyParser',{requires:['Sch.util.Date','Gnt.util.DurationParser'],mixins:['Gnt.mixin.Localizable'],separator:/\s*;\s*/,parseNumberFn:null,dependencyRegex:null,types:null,constructor:function(c){Ext.apply(this,c);this.initTypes();var b=this.L('typeText');for(var a=0;a<this.types.length;a++){this.types[a]=b[this.types[a]]||this.types[a]}var d='(-?\\d+)('+this.types.join('|')+')?([\\+\\-].*)?';this.dependencyRegex=this.dependencyRegex||new RegExp(d,'i');this.durationParser=new Gnt.util.DurationParser({parseNumberFn:this.parseNumberFn})},initTypes:function(){this.types=this.types||['SS','SF','FS','FF']},parse:function(h){if(!h){return []}var d=h.split(this.separator);var g=[];var j=this.dependencyRegex;for(var c=0;c<d.length;c++){var i=d[c];if(!i&&c==d.length-1){continue}var b=j.exec(i);var a={};if(!b){return null}a.taskId=parseInt(b[1],10);a.type=Ext.Array.indexOf(this.types,(b[2]||this.types[2]).toUpperCase());var f=b[3];if(f){var e=this.durationParser.parse(f);if(!e){return null}a.lag=e.value;a.lagUnit=e.unit||Sch.util.Date.DAY}g.push(a)}return g}});Ext.define('Gnt.field.Dependency',{extend:'Ext.form.field.Text',alternateClassName:'Gnt.widget.DependencyField',alias:'widget.dependencyfield',requires:['Sch.util.Date','Gnt.util.DependencyParser'],mixins:['Gnt.mixin.Localizable'],type:'predecessors',separator:';',task:null,dependencyParser:null,dependencyParserConfig:null,useSequenceNumber:!1,constructor:function(a){var b=this;Ext.apply(this,a);this.dependencyParser=new Gnt.util.DependencyParser(Ext.apply({parseNumberFn:function(){return Gnt.widget.DurationField.prototype.parseValue.apply(b,arguments)}},this.dependencyParserConfig));this.callParent(arguments);this.addCls('gnt-field-dependency')},isPredecessor:function(){return this.type==='predecessors'},setTask:function(a){this.task=a;this.setRawValue(this.getFieldDisplayValue(a))},getDependencies:function(){return this.dependencyParser.parse(this.getRawValue())},getTaskIdFromDependency:function(c){var d=this.task.getTaskStore(),a=c.taskId,b;if(this.useSequenceNumber){b=d.getBySequenceNumber(a);a=b&&b.getId()}return a},getErrors:function(o){if(!o){return []}var n=this.dependencyParser.parse(o);if(!n){return [this.L('invalidFormatText')]}var l=this.getDependencies(),h=this.isPredecessor(),g=this.task,b=g.getTaskStore().dependencyStore,p=g[h?'predecessors':'successors'],m=this.dependencyParser.types,k=b.allowedDependencyTypes,q=b.model.Type,f;var e=[];for(var a=0;a<l.length;a++){var c=l[a];f=this.getTaskIdFromDependency(c);if(!f){return [this.L('invalidDependencyText')]}if(b.allowedDependencyTypes&&!b.isValidDependencyType(c.type)){var i='';for(var j=0,r=k.length;j<r;j++){i+=m[q[k[j]]]+','}return [Ext.String.format(this.L('invalidDependencyType'),m[c.type],i.substring(0,i.length-1))]}var d=new b.model();d.setSourceId(h?f:g.getId());d.setTargetId(h?g.getId():f);d.setType(c.type);d.setLag(c.lag,c.lagUnit);e.push(d)}for(a=0;a<e.length;a++){if(!b.isValidDependency(e[a],e,p)){return [this.L('invalidDependencyText')]}}return this.callParent([n.value])},getFieldDisplayValue:function(i){var e=this.isPredecessor(),h=e?i.getIncomingDependencies(!0):i.getOutgoingDependencies(!0),l=this.dependencyParser.types,k=Gnt.model.Dependency.Type.EndToStart,g=[],b;for(var d=0;d<h.length;d++){var a=h[d];b=e?a.getSourceTask():a.getTargetTask();if(b&&a.isValid(!1)){var j=a.getType(),c=a.getLag(),f=a.getLagUnit();g.push(Ext.String.format('{0}{1}{2}{3}{4}',this.useSequenceNumber?b.getSequenceNumber():b.getId(),c||j!==k?l[j]:'',c>0?'+':'',c||'',c&&f!==Sch.util.Date.DAY?f:''))}}return g.join(this.separator)},isDirty:function(b){b=b||this.task;if(!b){return !1}var e=this.isPredecessor(),f=b.getTaskStore().dependencyStore,c=e?b.getIncomingDependencies():b.getOutgoingDependencies(),g=b.getId();for(var a=0,d=c.length;a<d;a++){if(c[a].dirty||c[a].phantom){return !0}}if(f){var h=e?'getTargetId':'getSourceId';c=f.getRemovedRecords();for(a=0,d=c.length;a<d;a++){if(c[a][h]()==g){return !0}}}return !1},applyChanges:function(c){c=c||this.task;var f=c.getTaskStore().dependencyStore,g=this.getDependencies(),e=this.isPredecessor(),h=e?c.getIncomingDependencies(!0):c.getOutgoingDependencies(!0),i=[],b;var l=Ext.Array.map(g,function(a){return this.getTaskIdFromDependency(a)},this);for(b=0;b<h.length;b++){if(!Ext.Array.contains(l,h[b][e?'getSourceId':'getTargetId']())){i.push(h[b])}}if(i.length>0){f.remove(i)}var k=[];for(b=0;b<g.length;b++){var d=g[b];var j=this.getTaskIdFromDependency(d);var a=f.getTasksLinkingDependency(j,c.getId());if(a){a.beginEdit();a.setType(d.type);a.setLag(d.lag,d.lagUnit);a.endEdit()}else {a=new f.model();a.setSourceId(e?j:c.getId());a.setTargetId(e?c.getId():j);a.setType(d.type);a.setLag(d.lag,d.lagUnit);k.push(a)}}if(k.length>0){f.add(k)}}});Ext.define('Gnt.column.Dependency',{extend:'Ext.grid.column.Column',requires:['Gnt.field.Dependency'],isDependencyColumn:!0,separator:';',type:'predecessors',field:null,useSequenceNumber:!1,constructor:function(a){a=a||{};var b=a.editor;delete a.editor;Ext.apply(this,a);a.editor=b||Ext.create('Gnt.field.Dependency',{type:this.type,separator:this.separator,useSequenceNumber:this.useSequenceNumber});if(!(a.editor instanceof Gnt.field.Dependency)){a.editor=Ext.ComponentManager.create(a.editor,'dependencyfield')}a.field=a.editor;this.scope=this;this.callParent([a])},afterRender:function(){var a=this.up('ganttpanel');a.registerLockedDependencyListeners();this.callParent(arguments)},getContainingPanel:function(){if(!this.panel){this.panel=this.up('tablepanel')}return this.panel},setDirtyClass:function(b,c){var a=this.getContainingPanel().getView();if(a.markDirty&&this.field.isDirty(c)){b.tdCls=a.dirtyCls}},isEditable:function(a){var b=this.gantt||this.up('ganttpanel');if(a.isProject){return !1}return !a.isProject&&(b&&b.allowParentTaskDependencies||a.isLeaf())},getRawData:function(b){var a;if(this.type==='predecessors'){a=b.getIncomingDependencies(!0)}else {a=b.getOutgoingDependencies(!0)}return Ext.Array.map(a,function(a){var b=a.copy(null).data;delete b[a.idProperty];return b})},renderer:function(c,b,a){if(!a.isEditable(this.dataIndex)||!this.isEditable(a)){b.tdCls=(b.tdCls||'')+' sch-column-readonly'}else {this.setDirtyClass(b,a)}return this.field.getFieldDisplayValue(a)}});Ext.define('Gnt.column.EarlyEndDate',{extend:'Ext.grid.column.Date',mixins:['Gnt.mixin.Localizable'],alias:['widget.earlyenddatecolumn','widget.ganttcolumn.earlyenddate'],isEarlyEndDateColumn:!0,width:100,align:'left',adjustMilestones:!0,earlyEndDateFnOptions:null,constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=!0},afterRender:function(){var a=this.up('ganttpanel');a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(f,d,a){var b='';d.tdCls=(d.tdCls||'')+' sch-column-readonly';var c=a.getTaskStore(!0),e=c&&c.isUndoingOrRedoing();if(!e){b=a.getDisplayEndDate(this.format,this.adjustMilestones,a.getEarlyEndDate(this.earlyEndDateFnOptions))}return b}});Ext.define('Gnt.column.EarlyStartDate',{extend:'Ext.grid.column.Date',mixins:['Gnt.mixin.Localizable'],alias:['widget.earlystartdatecolumn','widget.ganttcolumn.earlystartdate'],isEarlyStartDateColumn:!0,width:100,align:'left',adjustMilestones:!0,earlyStartDateFnOptions:null,constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=!0},afterRender:function(){var a=this.up('ganttpanel');a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(f,d,a){var b='';d.tdCls=(d.tdCls||'')+' sch-column-readonly';var c=a.getTaskStore(!0),e=c&&c.isUndoingOrRedoing();if(!e){b=a.getDisplayStartDate(this.format,this.adjustMilestones,a.getEarlyStartDate(this.earlyStartDateFnOptions))}return b}});Ext.define('Gnt.column.Effort',{extend:'Gnt.column.Duration',alias:['widget.effortcolumn','widget.ganttcolumn.effort'],requires:['Gnt.field.Effort'],isEffortColumn:!0,fieldProperty:'effortField',editor:'effortfield',defaultEditor:'effortfield',getValueToRender:function(a,c,b){if(!Ext.isNumber(a)){return ''}return this.field.valueToVisible(a,b.getEffortUnit())},putRawData:function(a,b){b.setEffort(a)},sorterFn:function(a,b){var c=a.getCalendar().convertDurationToMs(a.getEffort(),a.getEffortUnit()),d=b.getCalendar().convertDurationToMs(b.getEffort(),b.getEffortUnit());return c<d?-1:1}});Ext.define('Gnt.column.EffortVariance',{extend:'Ext.grid.column.Column',requires:['Ext.util.Format'],alias:['widget.effortvariancecolumn','widget.ganttcolumn.effortvariance'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:80,decimalPrecision:2,decimalSeparator:null,useAbbreviation:!1,fieldProperty:'effortVarianceField',initComponent:function(){this.initTaskFieldColumn();this.decimalSeparator=this.decimalSeparator||Ext.util.Format.decimalSeparator;this.callParent(arguments)},getValueToRender:function(a,f,d){if(!Ext.isNumber(a)){return ''}var c=parseInt(a,10),b=Ext.Number.toFixed(a,this.decimalPrecision),e=d.getEffortUnit();return String(c==b?c:b).replace('.',this.decimalSeparator)+' '+Sch.util.Date[this.useAbbreviation?'getShortNameOfUnit':'getReadableNameOfUnit'](e,a!==1)}});Ext.define('Gnt.column.LateEndDate',{extend:'Ext.grid.column.Date',mixins:['Gnt.mixin.Localizable'],alias:['widget.lateenddatecolumn','widget.ganttcolumn.lateenddate'],isLateEndDateColumn:!0,width:100,align:'left',adjustMilestones:!0,lateEndDateFnOptions:null,constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=!0},afterRender:function(){var a=this.up('ganttpanel');a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(f,d,a){var b='';d.tdCls=(d.tdCls||'')+' sch-column-readonly';var c=a.getTaskStore(!0),e=c&&c.isUndoingOrRedoing();if(!e){b=a.getDisplayEndDate(this.format,this.adjustMilestones,a.getLateEndDate(this.lateEndDateFnOptions))}return b}});Ext.define('Gnt.column.LateStartDate',{extend:'Ext.grid.column.Date',mixins:['Gnt.mixin.Localizable'],alias:['widget.latestartdatecolumn','widget.ganttcolumn.latestartdate'],isLateStartDateColumn:!0,width:100,align:'left',adjustMilestones:!0,lateStartDateFnOptions:null,constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=!0},afterRender:function(){var a=this.up('ganttpanel');a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(f,d,a){var b='';d.tdCls=(d.tdCls||'')+' sch-column-readonly';var c=a.getTaskStore(!0),e=c&&c.isUndoingOrRedoing();if(!e){b=a.getDisplayStartDate(this.format,this.adjustMilestones,a.getLateStartDate(this.lateStartDateFnOptions))}return b}});Ext.define('Gnt.field.ManuallyScheduled',{extend:'Ext.form.field.Checkbox',mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],alias:'widget.manuallyscheduledfield',alternateClassName:['Gnt.widget.ManuallyScheduledField'],fieldProperty:'manuallyScheduledField',setTaskValueMethod:'setManuallyScheduled',getTaskValueMethod:'getManuallyScheduled',instantUpdate:!0,valueToVisible:function(a){return a?this.L('yes'):this.L('no')},getValue:function(){return this.value},initEvents:function(){var a=this;a.on('change',a.onFieldValueChange,a);return a.callParent()},onFieldValueChange:function(a,b,c){if(a.instantUpdate&&!a.getSuppressTaskUpdate()&&a.task){a.applyChanges()}}});Ext.define('Gnt.column.ManuallyScheduled',{extend:'Ext.grid.Column',alias:['widget.manuallyscheduledcolumn','widget.ganttcolumn.manuallyscheduledcolumn'],requires:['Gnt.field.ManuallyScheduled'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:50,align:'center',instantUpdate:!1,fieldProperty:'manuallyScheduledField',editor:'manuallyscheduledfield',defaultEditor:'manuallyscheduledfield',initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(b,c,a){return this.field.valueToVisible(a.getManuallyScheduled())}});Ext.define('Gnt.field.Milestone',{extend:'Ext.form.field.ComboBox',requires:'Ext.data.JsonStore',mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],alias:'widget.milestonefield',instantUpdate:!1,allowBlank:!1,forceSelection:!0,displayField:'text',valueField:'value',queryMode:'local',constructor:function(a){Ext.apply(this,a);this.store=new Ext.data.JsonStore({fields:['value','text'],autoDestroy:!0,data:[{value:0,text:this.L('no')},{value:1,text:this.L('yes')}]});this.callParent(arguments);this.on('change',this.onFieldChange,this)},onSetTask:function(){this.setValue(this.task.isMilestone()?1:0)},valueToVisible:function(a){return a?this.L('yes'):this.L('no')},onFieldChange:function(a,b){if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){if(this.task.isMilestone()!=Boolean(this.value)){this.applyChanges()}}},getValue:function(){return this.value},applyChanges:function(a){a=a||this.task;if(this.getValue()){a.convertToMilestone()}else {a.convertToRegular()}a.fireEvent('taskupdated',a,this)}});Ext.define('Gnt.column.Milestone',{extend:'Ext.grid.column.Column',alias:['widget.milestonecolumn','widget.ganttcolumn.milestone'],requires:['Gnt.field.Milestone'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:50,align:'center',editor:'milestonefield',defaultEditor:'milestonefield',initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(b,c,a){return this.field.valueToVisible(a.isMilestone())},applyColumnCls:function(c,b,a){if(!a.isEditable(a.durationField)&&!a.isEditable(a.endDateField)){b.tdCls=(b.tdCls||'')+' sch-column-readonly'}}});Ext.define('Gnt.column.Name',{extend:'Ext.tree.Column',alias:['widget.namecolumn','widget.ganttcolumn.name'],mixins:['Gnt.column.mixin.TaskFieldColumn'],draggable:!0,fieldProperty:'nameField',editor:'textfield',initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},applyColumnCls:function(c,a,b){a.tdCls=(a.tdCls||'')+' sch-gantt-name-cell';if(b.isProject){a.tdCls+=' sch-gantt-project-name'}if(!b.isLeaf()){a.tdCls+=' sch-gantt-parent-cell'}}});Ext.define('Gnt.field.Note',{extend:'Ext.form.field.Picker',alias:['widget.notefield','widget.noteeditor'],alternateClassName:'Gnt.widget.NoteField',requires:['Ext.form.field.HtmlEditor'],mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],matchFieldWidth:!1,editable:!1,selectOnFocus:!1,pickerConfig:null,previewFn:null,previewFnScope:null,fieldProperty:'noteField',getTaskValueMethod:'getNote',setTaskValueMethod:'setNote',afterRender:function(){this.callParent(arguments);this.on('collapse',this.onPickerCollapse,this)},valueToVisible:function(a){if(this.previewFn){return this.previewFn.call(this.previewFnScope||this,a)}else {return Ext.util.Format.stripTags(a)}},createPicker:function(){var a=Ext.widget(Ext.apply({xtype:'htmleditor',frame:!0,shadow:!1,floating:!0,height:200,width:300,listeners:{change:this.onPickerChange,initialize:this.onPickerInit,scope:this}},this.pickerConfig||{}));return a},onPickerInit:function(a){var c=a.win.document.body;var b=this;a.win.document.onkeydown=function(c){var a=new Ext.event.Event(c);if(a.keyCode===a.ESC){b.collapse()}}},onPickerChange:function(d,b){var a=document.createElement('div');a.innerHTML=b;var c=a.innerText||a.textContent;this.setRawValue(this.valueToVisible(c))},getValue:function(){return this.getPicker().getValue()},setValue:function(a){this.callParent([this.valueToVisible(a)]);this.getPicker().setValue(a);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}},onFocusLeave:Ext.emptyFn,onPickerCollapse:function(){this.setValue(this.getPicker().getValue())},onTriggerClick:function(){var a=this;if(!a.readOnly&&!a.disabled){if(a.isExpanded){a.collapse()}else {a.expand()}}}});Ext.define('Gnt.column.Note',{extend:'Ext.grid.column.Column',requires:['Gnt.field.Note'],mixins:['Gnt.column.mixin.TaskFieldColumn'],alias:['widget.notecolumn','widget.ganttcolumn.note'],editor:'notefield',defaultEditor:'notefield',fieldProperty:'noteField',previewFn:null,previewFnScope:null,htmlEncode:!1,fieldConfigs:['instantUpdate','previewFn','previewFnScope','fieldProperty'],initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)}});Ext.define('Gnt.field.PercentDone',{extend:'Gnt.field.Percent',alias:'widget.percentdonefield',mixins:['Gnt.field.mixin.TaskField'],alternateClassName:'Gnt.widget.PercentDoneField',taskField:'percentDoneField',setTaskValueMethod:'setPercentDone',getTaskValueMethod:'getPercentDone',instantUpdate:!0,setValue:function(a){this.callParent([a]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define('Gnt.column.PercentDone',{extend:'Ext.grid.column.Number',requires:['Gnt.field.PercentDone'],alias:['widget.percentdonecolumn','widget.ganttcolumn.percentdone'],mixins:['Gnt.column.mixin.TaskFieldColumn'],width:90,format:'##0.##',align:'center',editor:'percentdonefield',defaultEditor:'percentdonefield',fieldProperty:'percentDoneField',useRenderer:!1,fieldConfigs:'instantUpdate,fieldProperty,decimalPrecision',decimalPrecision:2,initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)}});Ext.define('Gnt.column.Predecessor',{extend:'Gnt.column.Dependency',mixins:['Gnt.mixin.Localizable'],alias:['widget.predecessorcolumn','widget.ganttcolumn.predecessor'],isPredecessorColumn:!0,type:'predecessors',constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments)},putRawData:function(d,b){var a=b.getDependencyStore();var c=[];a.remove(b.getIncomingDependencies(!0));Ext.isArray(d)&&Ext.Array.each(d,function(e){if(b.getTaskStore().getById(e[a.model.prototype.fromField])){var d=new a.model(e);d.setTargetId(b.getId());if(a.isValidDependency(d)){c.push(d)}}});a.add(c)}});Ext.define('Gnt.column.ReadOnly',{extend:'Ext.grid.Column',alias:['widget.readonlycolumn','widget.ganttcolumn.readonly'],mixins:['Gnt.column.mixin.TaskFieldColumn'],fieldProperty:'readOnlyField',defaultEditor:'readonlyfield',editor:'readonlyfield',initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(a,b,c){return this.field.valueToVisible(a)}});Ext.define('Gnt.column.ResourceName',{extend:'Ext.grid.column.Column',alias:'widget.resourcenamecolumn',mixins:['Gnt.mixin.Localizable'],flex:1,align:'left',resourceStore:null,constructor:function(a){a=a||{};this.text=a.text||this.L('text');Ext.apply(this,a);this.scope=this.scope||this;this.sorter=this.sorter||new Ext.util.Sorter({sorterFn:Ext.Function.bind(this.sortFn,this)});this.callParent(arguments)},renderer:function(c,d,b){var a=b.getResource(this.resourceStore);return Ext.String.htmlEncode(a&&a.getName()||c)},sortFn:function(a,b){return a.getResourceName(this.resourceStore)<b.getResourceName(this.resourceStore)?-1:1}});Ext.define('Gnt.widget.AssignmentGrid',{extend:'Ext.grid.Panel',alias:'widget.assignmentgrid',requires:['Ext.data.Store','Ext.grid.plugin.CellEditing','Gnt.column.ResourceName','Gnt.column.AssignmentUnits'],assignmentStore:null,resourceStore:null,readOnly:!1,cls:'gnt-assignmentgrid',height:200,width:300,frame:!0,floating:!0,focusOnToFront:!1,taskId:null,cellEditing:null,sortResourcesFn:null,assignmentUnitsEditor:null,selModel:{selType:'checkboxmodel',mode:'MULTI',checkOnly:!0},viewConfig:{markDirty:!1},initComponent:function(b){var a=this;if(!this.readOnly){this.plugins=this.buildPlugins()}this.store=this.store||new Ext.data.Store({proxy:'memory',autoDestroy:!0,model:this.assignmentStore.getModel()});this.columns=this.columns||this.buildColumns();this.sortResourcesFn=this.sortResourcesFn||function(c,d){var b=c.getUnits(),e=d.getUnits();if(!b&&!e||b&&e){return c.getResource(a.resourceStore).getName()<d.getResource(a.resourceStore).getName()?-1:1}return b?-1:1};this.loadResources();this.mon(this.resourceStore,{datachanged:this.loadResources,scope:this});this.callParent(arguments);this.getSelectionModel().on({select:this.onSelect,deselect:this.onDeselect,scope:this})},onSelect:function(b,a){if((!this.cellEditing||!this.cellEditing.getActiveEditor())&&!a.getUnits()){a.setUnits(a.getField(a.unitsField).defaultValue)}},onDeselect:function(b,a){a.setUnits(0)},loadResources:function(){var a=this.assignmentStore.getModel().prototype.resourceIdField;var b=this.assignmentStore.getModel().prototype.unitsField;var c=Ext.Array.map(this.resourceStore.getRange(),function(d){var c={};c[a]=d.getId();c[b]='';return c});this.store.loadData(c)},buildPlugins:function(){this.cellEditing=Ext.create('Ext.grid.plugin.CellEditing',{clicksToEdit:1,listeners:{edit:this.onEditingDone,scope:this}});return [this.cellEditing]},hide:function(){this.cellEditing.cancelEdit();this.callParent(arguments)},onEditingDone:function(b,a){if(a.value){this.getSelectionModel().select(a.record,!0)}else {this.getSelectionModel().deselect(a.record);a.record.reject()}},buildColumns:function(){return [{xtype:'resourcenamecolumn',resourceStore:this.resourceStore},{xtype:'assignmentunitscolumn'}]},setEditableFields:function(d){if(!this.assignmentUnitsEditor){var b=this.down('assignmentunitscolumn');this.assignmentUnitsEditor=b&&b.getEditor()}if(this.assignmentUnitsEditor){var a=this.assignmentStore&&this.assignmentStore.getTaskStore(),c=a&&a.getModelById(d);if(c){switch(c.getSchedulingMode()){case 'DynamicAssignment':this.assignmentUnitsEditor.setReadOnly(!0);break;default:this.assignmentUnitsEditor.setReadOnly(!1);}}}},loadTaskAssignments:function(c){var b=this.store,e=this.getSelectionModel();this.taskId=c;e.deselectAll(!0);for(var d=0,g=b.getCount();d<g;d++){var a=b.getAt(d);a.data[a.unitsField]=0;a.data[a.idProperty]=null;delete a.__id__}var f=this.assignmentStore.getAssignmentsForTask(c);Ext.Array.each(f,function(a){var c=b.findRecord(a.resourceIdField,a.getResourceId(),0,!1,!0,!0);if(c){var d=Ext.apply({},a.data);delete d[a.idProperty];c.set(d);c.__id__=a.getId();e.select(c,!0,!0)}});b.sort({sorterFn:this.sortResourcesFn});b.getSorters().removeAll();this.setEditableFields(c)},saveTaskAssignments:function(){var a=this.assignmentStore,c=this.taskId;var d={};var b=[];a.fireEvent('beforetaskassignmentschange',a,c,b);this.getSelectionModel().selected.each(function(e){var i=e.getUnits();if(i>0){var g=e.__id__;if(g){var h=Ext.apply({},e.data);delete h[e.idProperty];d[g]=!0;a.getModelById(g).set(h)}else {var f=e.copy();f.setTaskId(c);d[f.internalId]=!0;b.push(f)}}});var e=[];a.each(function(a){if(a.getTaskId()==c&&!d[a.getId()||a.internalId]){e.push(a)}});a.suspendAutoSync();a.remove(e);a.add(b);a.resumeAutoSync();a.fireEvent('taskassignmentschanged',a,c,b);if(a.autoSync){a.sync()}},isDataChanged:function(){var a=this;return a.store&&a.store.getUpdatedRecords().length>0||a.store.getNewRecords().length>0||a.store.getRemovedRecords().length>0},isDataValid:function(){return this.store.findBy(function(a){return !a.isValid()})<0},isEditing:function(){return Boolean(this.cellEditing.getActiveEditor())},getTask:function(){var a=this.assignmentStore&&this.assignmentStore.getTaskStore();return this.taskId&&a&&a.getNodeById(this.taskId)||null}});Ext.define('Gnt.patches.CheckboxModel',{extend:'Sch.util.Patch',target:'Ext.selection.CheckboxModel',overrides:{renderer:function(f,b,d,c,a,e,g){return '<div class="'+Ext.baseCSSPrefix+'grid-row-checker" role="button" tabIndex="-1">&#160;</div>'}}});Ext.define('Gnt.patches.NavigationModel',{extend:'Sch.util.Patch',target:'Ext.grid.NavigationModel',maxVersion:'6.0.2',overrides:{onCellMouseDown:function(c,e,g,h,i,f,a){var b=Ext.Component.fromElement(a.target,e),d;if(c.actionableMode&&(a.getTarget(null,null,!0).isTabbable()||(d=Ext.ComponentManager.getActiveComponent())&&d.owns(a))){return}if(a.pointerType!=='touch'){a.preventDefault();this.setPosition(a.position,null,a)}if(b&&b.isFocusable&&b.isFocusable()){c.setActionableMode(!0,a.position);b.focus()}}}});Ext.define('Gnt.field.Assignment',{extend:'Ext.form.field.Picker',alias:['widget.assignmentfield','widget.assignmenteditor'],alternateClassName:'Gnt.widget.AssignmentField',requires:['Gnt.widget.AssignmentGrid','Gnt.patches.CheckboxModel','Gnt.patches.NavigationModel'],mixins:['Gnt.mixin.Localizable'],matchFieldWidth:!1,editable:!1,selectOnFocus:!1,task:null,focusTimer:null,assignmentStore:null,resourceStore:null,gridConfig:null,formatString:'{0} [{1}%]',unitDecimalPrecision:1,expandPickerOnFocus:!1,returnFocusToField:!0,initEvents:function(){var a=this;a.callParent();a.on({'expand':a.onExpandHandler,'collapse':a.onCollapseHandler,scope:a})},onFocusEnter:function(b){var a=this;a.callParent([b]);a.expandPickerOnFocus&&a.expand()},focusPickerView:function(){var b=this,a=b.getPicker().getView();a.focusCell((new Ext.grid.CellContext(a)).setPosition(0,0))},onExpandHandler:function(){var a=this,b=a.getPicker();b.loadTaskAssignments(this.task.getId());this.focusTimer=Ext.Function.defer(function(){a.focusPickerView()},10)},onCollapseHandler:function(){var a=this;a.picker.setActionableMode(!1);a.returnFocusToField&&a.hasFocus&&a.focus(!0)},createPicker:function(){var a=Ext.widget(Ext.apply({xclass:'Gnt.widget.AssignmentGrid',ownerCmp:this,resourceStore:this.task.getResourceStore(),assignmentStore:this.task.getAssignmentStore(),fbar:this.buildButtons(),listeners:{cellkeydown:function(e,h,d,g,i,f,b){var c=e.headerCt.getComponent(d);if(b.getKey()===b.ESC&&!a.isEditing()){this.collapse()}else {if(b.getKey()===b.ENTER&&!a.isEditing()&&!(c.field||c.editor)){this.onSaveClick()}}},scope:this}},this.gridConfig||{}));return a},buildButtons:function(){return ['->',{text:this.L('closeText'),handler:function(){this.saveTimer=Ext.Function.defer(this.onSaveClick,Ext.isIE&&!Ext.isIE9?60:30,this)},scope:this},{text:this.L('cancelText'),handler:function(){this.collapse()},scope:this}]},setTask:function(a){this.task=a;this.setRawValue(this.getFieldDisplayValue(a))},onSaveClick:function(){var b=this.picker.getSelectionModel(),a=b.selected;this.picker.saveTaskAssignments();this.collapse();this.setRawValue(this.getFieldDisplayValue(this.task));this.fireEvent('select',this,a)},isDirty:function(c){c=c||this.task;if(!c){return !1}var e=this.picker&&this.picker.assignmentStore||c.getAssignmentStore(),b=c.getAssignments();for(var a=0,d=b.length;a<d;a++){if(b[a].dirty||b[a].phantom){return !0}}if(e){b=e.getRemovedRecords();for(a=0,d=b.length;a<d;a++){if(b[a].getTaskId()==c.getId()){return !0}}}return !1},getFieldDisplayValue:function(a){a=a||this.task;var c=this.unitDecimalPrecision;var b=Ext.Array.map(a.getAssignments(),function(a){var d=parseFloat(Ext.Number.toFixed(a.getUnits(),c));var b=Ext.String.format(this.formatString,a.getResourceName(),d);return Ext.String.htmlEncode(b)},this);return b.join(', ')},destroy:function(){clearTimeout(this.focusTimer);clearTimeout(this.saveTimer);this.callParent(arguments)}});Ext.define('Gnt.column.ResourceAssignment',{extend:'Ext.grid.column.Column',alias:['widget.resourceassignmentcolumn','widget.ganttcolumn.resourceassignment'],requires:['Gnt.field.Assignment'],mixins:['Gnt.mixin.Localizable'],tdCls:'sch-assignment-cell',showUnits:!0,unitDecimalPrecision:1,field:null,dirtyCls:null,initComponent:function(){var a=this;a.text=a.L('text');a.editor=a.editor||{};if(!(this.editor instanceof Ext.form.Field)){a.editor=Ext.ComponentManager.create(Ext.applyIf(a.editor,{expandPickerOnFocus:!0,returnFocusToField:!0,unitDecimalPrecision:a.unitDecimalPrecision,formatString:'{0}'+(a.showUnits?' [{1}%]':'')}),'assignmentfield')}a.field=a.editor;a.callParent(arguments);a.scope=a},getTableView:function(){return this.up('tablepanel').getView()},sorterFn:function(d,e){var b=this;var a=b.field.getFieldDisplayValue(d),c=b.field.getFieldDisplayValue(e);return a&&a>c?-1:1},afterRender:function(){var a=this,b=a.getTableView();if(b.markDirty){a.dirtyCls=b.dirtyCls}a.callParent(arguments);if(a.field){a.field.on('collapse',function(){a.getTableView().setActionableMode(!1)})}a.setSorter(Ext.Function.bind(a.sorterFn,a))},getRawData:function(a){return Ext.Array.map(a.getAssignments(),function(a){var b=a.copy(null).data;delete b[a.idProperty];return b})},putRawData:function(d,b){var a=b.getAssignmentStore();var c=[];a.removeAssignmentsForTask(b);Ext.isArray(d)&&Ext.Array.each(d,function(d){if(b.getResourceStore().getById(d[a.model.prototype.resourceIdField])){d[a.model.prototype.taskIdField]=b.getId();c.push(Ext.clone(d))}});a.add(c)},renderer:function(c,b,a){if(this.dirtyCls&&this.field.isDirty(a)){b.tdCls=this.dirtyCls}return this.field.getFieldDisplayValue(a)}});Ext.define('Gnt.column.Rollup',{extend:'Ext.grid.Column',alias:['widget.rollupcolumn','widget.ganttcolumn.rollup'],mixins:['Gnt.column.mixin.TaskFieldColumn'],fieldProperty:'rollupField',editor:'combobox',defaultEditor:'combobox',initComponent:function(){this.initTaskFieldColumn({store:[[!1,this.L('no')],[!0,this.L('yes')]]});this.callParent(arguments)},getValueToRender:function(a,b,c){return this.L(a?'yes':'no')}});Ext.define('Gnt.field.SchedulingMode',{extend:'Ext.form.field.ComboBox',mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],alias:'widget.schedulingmodefield',alternateClassName:'Gnt.widget.SchedulingmodeField',fieldProperty:'schedulingModeField',setTaskValueMethod:'setSchedulingMode',getTaskValueMethod:'getSchedulingMode',pickerAlign:'tl-bl?',matchFieldWidth:!0,editable:!1,selectOnFocus:!1,forceSelection:!0,triggerAction:'all',constructor:function(a){a=a||{};if(!a.store){this.initStore(a)}this.callParent([a]);this.on('change',this.onFieldChange,this)},initStore:function(a){var b=this;a.store=b.getDefaultSchedulingModes()},getDefaultSchedulingModes:function(){var a=this;return [['Normal',a.L('Normal')],['FixedDuration',a.L('FixedDuration')],['EffortDriven',a.L('EffortDriven')],['DynamicAssignment',a.L('DynamicAssignment')]]},valueToVisible:function(d,e){var b=this,a=[];var c=this.findRecordByValue(d);if(c){a.push(c.data)}else {if(Ext.isDefined(b.valueNotFoundText)){a.push(b.valueNotFoundText)}}return b.displayTpl.apply(a)},getErrors:function(b){var a=this.callParent(arguments);if(a&&a.length){return a}if(!Ext.isEmpty(b)&&!(this.findRecordByDisplay(b)||this.findRecordByValue(b))){return [this.L('invalidText')]}else {return []}},getValue:function(){return this.value},onFieldChange:function(a,b){if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task&&this.value){this.applyChanges()}}});Ext.define('Gnt.column.SchedulingMode',{extend:'Ext.grid.column.Column',requires:['Gnt.field.SchedulingMode'],mixins:['Gnt.column.mixin.TaskFieldColumn'],alias:['widget.schedulingmodecolumn','widget.ganttcolumn.schedulingmode'],width:100,align:'left',data:null,fieldProperty:'schedulingModeField',editor:'schedulingmodefield',defaultEditor:'schedulingmodefield',instantUpdate:!1,initComponent:function(){this.initTaskFieldColumn({store:this.data});this.callParent(arguments)}});Ext.define('Gnt.column.Sequence',{extend:'Ext.grid.column.Column',alias:['widget.sequencecolumn','widget.ganttcolumn.sequence'],mixins:['Gnt.mixin.Localizable'],isSequenceColumn:!0,width:40,align:'right',sortable:!1,dataIndex:'index',constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments)},renderer:function(b,c,a){return a.getSequenceNumber()}});Ext.define('Gnt.column.Slack',{extend:'Ext.grid.column.Column',alternateClassName:['Gnt.column.FreeSlack'],requires:['Ext.Number','Sch.util.Date'],mixins:['Gnt.mixin.Localizable'],alias:['widget.slackcolumn','widget.freeslackcolumn','widget.ganttcolumn.slack'],isFreeSlackColumn:!0,decimalPrecision:2,useAbbreviation:!1,slackUnit:'d',width:100,align:'left',constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=!0},afterRender:function(){var a=this.up('ganttpanel');a.registerLockedDependencyListeners();this.callParent(arguments)},getSlackValue:function(a){return a.getSlack(this.slackUnit)},rendererFunc:function(a,b,c){b.tdCls=(b.tdCls||'')+' sch-column-readonly';a=this.getSlackValue(c);if(Ext.isNumber(a)){return parseFloat(Ext.Number.toFixed(a,this.decimalPrecision))+' '+Sch.util.Date[this.useAbbreviation?'getShortNameOfUnit':'getReadableNameOfUnit'](this.slackUnit,a!==1)}return ''}});Ext.define('Gnt.column.Successor',{extend:'Gnt.column.Dependency',mixins:['Gnt.mixin.Localizable'],alias:['widget.successorcolumn','widget.ganttcolumn.successor'],isSuccessorColumn:!0,type:'successors',constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments)},putRawData:function(d,b){var a=b.getDependencyStore();var c=[];a.remove(b.getOutgoingDependencies(!0));Ext.isArray(d)&&Ext.Array.each(d,function(e){if(b.getTaskStore().getById(e[a.model.prototype.toField])){var d=new a.model(e);d.setSourceId(b.getId());if(a.isValidDependency(d)){c.push(d)}}});a.add(c)}});Ext.define('Gnt.column.WBS',{extend:'Ext.grid.column.Column',alias:['widget.wbscolumn','widget.ganttcolumn.wbs'],mixins:['Gnt.mixin.Localizable'],isWBSColumn:!0,width:40,align:'left',sortable:!1,constructor:function(a){a=a||{};this.text=a.text||this.L('text');this.callParent(arguments);this.tdCls=(this.tdCls||'')+' gnt-wbs-cell'},renderer:function(b,c,a){return a.getWBSCode()}});Ext.define('Gnt.column.TotalSlack',{extend:'Gnt.column.Slack',isTotalSlackColumn:!0,alias:['widget.totalslackcolumn','widget.ganttcolumn.totalslack'],getSlackValue:function(a){return a.getTotalSlack(this.slackUnit)}});Ext.define('Gnt.column.AddNew',{extend:'Ext.grid.column.Column',alias:['widget.addnewcolumn','widget.ganttcolumn.addnew'],requires:['Ext.form.field.ComboBox','Ext.Editor','Gnt.column.ActualCost','Gnt.column.ActualEffort','Gnt.column.AssignmentUnits','Gnt.column.BaselineEndDate','Gnt.column.BaselineCost','Gnt.column.BaselineEffort','Gnt.column.BaselineStartDate','Gnt.column.Calendar','Gnt.column.ConstraintDate','Gnt.column.ConstraintType','Gnt.column.Cost','Gnt.column.CostVariance','Gnt.column.DeadlineDate','Gnt.column.Dependency','Gnt.column.Duration','Gnt.column.EarlyEndDate','Gnt.column.EarlyStartDate','Gnt.column.Effort','Gnt.column.EffortVariance','Gnt.column.EndDate','Gnt.column.LateEndDate','Gnt.column.LateStartDate','Gnt.column.ManuallyScheduled','Gnt.column.Milestone','Gnt.column.Name','Gnt.column.Note','Gnt.column.PercentDone','Gnt.column.Predecessor','Gnt.column.ReadOnly','Gnt.column.ResourceAssignment','Gnt.column.ResourceName','Gnt.column.Rollup','Gnt.column.SchedulingMode','Gnt.column.Sequence','Gnt.column.Slack','Gnt.column.StartDate','Gnt.column.Successor','Gnt.column.WBS','Gnt.column.TotalSlack'],mixins:['Gnt.mixin.Localizable'],text:'',width:100,resizable:!1,menuDisabled:!0,sortable:!1,draggable:!1,colEditor:null,colEditorStore:null,layout:'fit',ignoreInAddMenu:!0,ignoreInExport:!0,ignoreExport:!0,columnList:null,initComponent:function(){this.addCls('gnt-addnewcolumn');this.items=this.getColEditor();this.text=this.text||this.L('text');this.callParent(arguments)},getColEditor:function(){var a=this,b;if(!a.colEditor){b=a.colEditor=new Ext.form.field.ComboBox({itemId:'addNewEditor',displayField:'text',valueField:'clsName',hideTrigger:!0,queryMode:'local',multiSelect:!1,emptyText:this.L('text'),listConfig:{itemId:'addNewEditorComboList',minWidth:150},store:a.getColEditorStore(),pickerAlign:'tl-bl',listeners:{focus:a.onInputFocus,blur:a.onFieldBlur,select:a.onSelect,scope:a}});if(Ext.isIE8m){b.on('resize',function(a,e,b,d,c){a.inputEl.setStyle('line-height',+b+'px');a.setValue(a.getValue()+' ')})}}return a.colEditor},onFieldBlur:function(d,b){var a=d.getPicker();var c=a.el&&a.el.dom;if(!b.relatedTarget||b.relatedTarget!==c){this.resetField()}},resetField:function(){this.getColEditor().store.clearFilter();this.getColEditor().reset();this.getColEditor().getPicker().refresh();this.getColEditor().collapse()},getColEditorStore:function(){var a=this;if(!a.colEditorStore){a.columnList=a.columnList||Gnt.column.AddNew.buildDefaultColumnList();a.colEditorStore=new Ext.data.Store({fields:['text','clsName','config'],data:a.columnList,sorters:[{property:'text',direction:'ASC'}]})}return a.colEditorStore},onInputFocus:function(a,b){a.ownerCt.updateLayout();a.expand()},onSelect:function(b,a){this.resetField();this.getColEditor().blur();this.addColumn(Ext.isArray(a)?a[0]:a)},addColumn:function(f){var e=this;var b=f;var d=e.up('headercontainer');var g=b.get('text');var a=Ext.apply({},b.get('config'));var c=b.get('clsName')||a.xclass||'Ext.grid.column.Column';Ext.require(c,function(){a.xclass=c;a.text=g;a.lockable=!1;var b=Ext.create(a);d.insert(d.items.indexOf(e),b)})},destroy:function(){this.colEditorStore&&this.colEditorStore.destroy();this.callParent(arguments)},statics:{buildDefaultColumnList:function(){var a=[];Ext.Array.each(Ext.ClassManager.getNamesByExpression('widget.ganttcolumn.*'),function(c){var b=Ext.ClassManager.get(c);if(b&&!b.prototype.ignoreInAddMenu){a.push({clsName:c,text:b.prototype.localize?b.prototype.localize('text'):b.prototype.text})}});return a.sort(function(a,b){return a.text>b.text?1:-1})}}});Ext.define('Gnt.column.DragDrop',{extend:'Ext.grid.column.Column',alias:['widget.dragdropcolumn','widget.ganttcolumn.dragdrop'],width:35,tdCls:'sch-gantt-column-dragdrop',cls:'sch-gantt-column-dragdrop-header',ignoreInAddMenu:!0,ignoreExport:!0,ignoreInExport:!0,sortable:!1,resizable:!1,hideable:!1,menuDisabled:!0,draggable:!1,align:'center',processEvent:function(a){return a!=='click'}});Ext.define('Gnt.column.Scale',{extend:'Ext.grid.column.Template',alias:'widget.scalecolumn',sortable:!1,scalePoints:null,scaleStep:2,scaleLabelStep:4,scaleMin:0,scaleMax:24,width:40,scaleCellCls:'gnt-scalecolumn',tpl:'<div class="gnt-scalecolumn-wrap" style="height:{scaleHeight}px;">'+'<tpl for="scalePoints">'+'<tpl if="label !== \'\'">'+'<span class="gnt-scalecolumn-label-line {cls}" style="bottom:{bottom}px"><span class="gnt-scalecolumn-label">{label}</span></span>'+'<tpl else>'+'<span class="gnt-scalecolumn-line {cls}" style="bottom:{bottom}px"></span>'+'</tpl>'+'</tpl>'+'</div>',initComponent:function(){this.tdCls=(this.tdCls||'')+' '+this.scaleCellCls;this.callParent(arguments)},onAdded:function(){this.callParent(arguments);this.setAvailableHeight(this.up('timelinegrid').rowHeight,!0)},setAvailableHeight:function(b,a){this.availableHeight=b;if(!this.scalePoints){this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.scalePoints=this.buildScalePoints()}else {if(a){this.scalePoints.sort(function(a,b){return a.value-b.value});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.updateScalePoints()}},defaultRenderer:function(c,d,a){var b={record:Ext.apply({},a.data,a.getAssociatedData()),scaleHeight:this.availableHeight,scalePoints:this.scalePoints};return this.tpl.apply(b)},buildScalePoints:function(){var b=this.scaleMin,a=b,i=this.scaleStep,h=this.scaleLabelStep,g=this.scaleStepHeight,j=this.availableHeight,d=this.scaleCellCls,f=d+'-min',c=[];var e=function(c,a,d){return {bottom:Math.round((c-b)*g),value:c,label:a!='undefined'?a:'',cls:d||''}};while(a<this.scaleMax){if(a>0){c.push(e(a,a%h||a===b?'':a,f))}f='';a+=i}c.push(e(this.scaleMax,this.scaleMax,d+'-max'));return c},updateScalePoints:function(){var a=this.scaleStepHeight,b=this.availableHeight;Ext.Array.each(this.scalePoints,function(b){b.bottom=Math.round(b.value*a)})}});Ext.define('Gnt.constraint.Base',{requires:['Ext.String'],mixins:['Gnt.mixin.Localizable'],isConstraint:!0,getId:function(b){var a=this.alias&&this.alias[0];return a&&a.split('.')[1]},isSatisfied:function(b,a){throw 'Abstract method'},isApplicable:function(a){return !0},getResolution:function(l,a,d){var b=this,g=!1;d=d||a.getConstraintDate();var i=function(){if(!g){g=!0;l.apply(this,arguments)}};var c={title:b.L('name'),task:a,date:d,constraintClassName:Ext.getClassName(b),resolutions:this.getResolutionOptions(i,a,d),getCancelActionOption:function(){return this.resolutions[0]},cancelAction:function(){return this.getCancelActionOption().resolve()},proceedAction:function(){i()},getResolution:function(a){return Ext.Array.findBy(this.resolutions,function(b){return b.id==a})}};c.defaultAction=c.cancelAction;var h=a.getTaskStore(!0);if(h&&h.scheduleByConstraints&&b.hasThisConstraintApplied(a)&&a.propagating&&a.childNodes.length){var k=a.getUnprojected(a.constraintTypeField),f=a.getUnprojected(a.constraintDateField),j=a.getConstraintType(),e=a.getConstraintDate();if(k!=j||!f&&e||f&&!e||f-e){c.description=Ext.String.format(b.L('This action will cause a scheduling conflict'),a.getName(),b.L('name'))}}return c},getCanceResolutionOption:function(b,c,a){a=a||c.getConstraintDate();var d=this;return {id:'cancel',title:d.L('Cancel the change and do nothing'),resolve:function(){b(!0)}}},getRemoveConstraintResolutionOption:function(d,a,b){b=b||a.getConstraintDate();var c=this,e=a.getTaskStore(!0);return {id:'remove-constraint',title:Ext.String.format(c.L('Remove the constraint'),c.L('name')),resolve:function(){a.setConstraintWithoutPropagation('');if(e.scheduleByConstraints&&a.getEarlyStartDate()<a.getStartDate()){a.pinWithoutPropagation()}d()}}},getResolutionOptions:function(e,b,a){a=a||b.getConstraintDate();var c=this;var d=[c.getCanceResolutionOption(e,b,a)];c.hasThisConstraintApplied(b)&&d.push(c.getRemoveConstraintResolutionOption(e,b,a));return d},canResolve:function(b,a){return !1},resolve:function(b,a){},hasThisConstraintApplied:function(a){return a.getConstraintClass()===this},getInitialConstraintDate:function(a){return a.getConstraintDate()},getDisplayableConstraintDateForFormat:function(a,b,c){return a},adjustConstraintDateFromDisplayableWithFormat:function(a,b,c){return a},statics:{getConstraintClass:function(a){var b=!Ext.isEmpty(a)&&Ext.ClassManager.getByAlias('gntconstraint.'+a);return b||null}}});Ext.define('Gnt.constraint.AsLateAsPossible',{extend:'Gnt.constraint.Base',singleton:!0,isSatisfied:function(a){throw 'Abstract method'}});Ext.define('Gnt.constraint.AsSoonAsPossible',{extend:'Gnt.constraint.Base',singleton:!0,isSatisfied:function(a){throw 'Abstract method'}});Ext.define('Gnt.constraint.FinishNoEarlierThan',{extend:'Gnt.constraint.Base',alias:'gntconstraint.finishnoearlierthan',singleton:!0,requires:['Sch.util.Date'],isApplicable:function(a){return a.get('leaf')},isSatisfied:function(c,a){var b=c.getEndDate();a=a||c.getConstraintDate();return !a||!b||b>=a},getResolutionOptions:function(g,b,a){var e=this,c=e.callParent(arguments);var d=b.getTaskStore(!0),f=d&&d.scheduleByConstraints;if(!f){a=a||b.getConstraintDate();c.push({id:'move-task',title:e.L('Move the task to finish on {0}'),resolve:function(){b.setEndDateWithoutPropagation(a,!0);g()}})}return c},getInitialConstraintDate:function(a){return a.getEndDate()},getRestrictions:function(a){return this.hasThisConstraintApplied(a)&&{min:{endDate:a.getConstraintDate()}}},getDisplayableConstraintDateForFormat:function(a,b,c){if(a&&!Ext.Date.formatContainsHourInfo(b)&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1)}return a},adjustConstraintDateFromDisplayableWithFormat:function(a,b,c){if(a&&!Ext.Date.formatContainsHourInfo(b)&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)}return a}});Ext.define('Gnt.constraint.FinishNoLaterThan',{extend:'Gnt.constraint.Base',alias:'gntconstraint.finishnolaterthan',singleton:!0,requires:['Sch.util.Date'],isSatisfied:function(c,a){var b=c.getEndDate();a=a||c.getConstraintDate();return !a||!b||b<=a},getRemoveConstraintResolutionOption:function(c,b,d){var a=this.callParent(arguments);a.getTitleValues=function(){return [b.getEndDate()]};return a},getResolutionOptions:function(g,b,a){var e=this,d=b.getTaskStore(!0),f=d&&d.scheduleByConstraints,c=e.callParent(arguments);if(!f){a=a||b.getConstraintDate();c.push({id:'move-task',title:e.L('Move the task to finish on {0}'),resolve:function(){b.setEndDateWithoutPropagation(a,!0);g()}})}return c},getInitialConstraintDate:function(a){return a.getEndDate()},getRestrictions:function(a){return this.hasThisConstraintApplied(a)&&{max:{endDate:a.getConstraintDate()}}},getDisplayableConstraintDateForFormat:function(a,b,c){if(a&&!Ext.Date.formatContainsHourInfo(b)&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1)}return a},adjustConstraintDateFromDisplayableWithFormat:function(a,b,c){if(a&&!Ext.Date.formatContainsHourInfo(b)&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)}return a}});Ext.define('Gnt.constraint.MustFinishOn',{extend:'Gnt.constraint.Base',alias:'gntconstraint.mustfinishon',singleton:!0,requires:['Sch.util.Date'],isApplicable:function(a){return a.get('leaf')},isSatisfied:function(c,a){var b=c.getEndDate();a=a||c.getConstraintDate();return !a||!b||b.valueOf()==a.valueOf()},getResolutionOptions:function(g,b,a){var e=this,c=e.callParent(arguments);var d=b.getTaskStore(!0),f=d&&d.scheduleByConstraints;if(!f){a=a||b.getConstraintDate();c.push({id:'move-task',title:e.L('Move the task to finish on {0}'),resolve:function(){b.setEndDateWithoutPropagation(a,!0);g()}})}return c},getRemoveConstraintResolutionOption:function(c,b,d){var a=this.callParent(arguments);a.getTitleValues=function(){return [b.getEndDate()]};return a},getInitialConstraintDate:function(a){return a.getEndDate()},getRestrictions:function(a){return this.hasThisConstraintApplied(a)&&{endDate:a.getConstraintDate()}},getDisplayableConstraintDateForFormat:function(a,b,c){if(a&&!Ext.Date.formatContainsHourInfo(b)&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1)}return a},adjustConstraintDateFromDisplayableWithFormat:function(a,b,c){if(a&&!Ext.Date.formatContainsHourInfo(b)&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)}return a}});Ext.define('Gnt.constraint.MustStartOn',{extend:'Gnt.constraint.Base',alias:'gntconstraint.muststarton',singleton:!0,requires:['Sch.util.Date'],isApplicable:function(a){return a.get('leaf')},isSatisfied:function(c,a){var b=c.getStartDate();a=a||c.getConstraintDate();return !a||!b||b.valueOf()==a.valueOf()},getResolutionOptions:function(g,b,a){var e=this,c=e.callParent(arguments);var d=b.getTaskStore(!0),f=d&&d.scheduleByConstraints;if(!f){a=a||b.getConstraintDate();c.push({id:'move-task',title:e.L('Move the task to start at {0}'),resolve:function(){b.setStartDateWithoutPropagation(a,!0);g()}})}return c},getRemoveConstraintResolutionOption:function(c,b,d){var a=this.callParent(arguments);a.getTitleValues=function(){return [b.getStartDate()]};return a},getInitialConstraintDate:function(a){return a.getStartDate()},getRestrictions:function(a){return this.hasThisConstraintApplied(a)&&{startDate:a.getConstraintDate()}}});Ext.define('Gnt.constraint.StartNoEarlierThan',{extend:'Gnt.constraint.Base',alias:'gntconstraint.startnoearlierthan',singleton:!0,requires:['Sch.util.Date'],isSatisfied:function(c,a){var b=c.getStartDate();a=a||c.getConstraintDate();return !a||!b||b>=a},getResolutionOptions:function(g,b,a){var e=this,c=e.callParent(arguments);var d=b.getTaskStore(!0),f=d&&d.scheduleByConstraints;if(!f){a=a||b.getConstraintDate();c.push({id:'move-task',title:e.L('Move the task to start at {0}'),resolve:function(){b.setStartDateWithoutPropagation(a,!0);g()}})}return c},getInitialConstraintDate:function(a){return a.getStartDate()},getRestrictions:function(a){return this.hasThisConstraintApplied(a)&&{min:{startDate:a.getConstraintDate()}}}});Ext.define('Gnt.constraint.StartNoLaterThan',{extend:'Gnt.constraint.Base',alias:'gntconstraint.startnolaterthan',singleton:!0,requires:['Sch.util.Date'],isApplicable:function(a){return a.get('leaf')},isSatisfied:function(c,a){var b=c.getStartDate();a=a||c.getConstraintDate();return !a||!b||b<=a},getResolutionOptions:function(g,b,a){var e=this,c=e.callParent(arguments);var d=b.getTaskStore(!0),f=d&&d.scheduleByConstraints;if(!f){a=a||b.getConstraintDate();c.push({id:'move-task',title:e.L('Move the task to start at {0}'),resolve:function(){b.setStartDateWithoutPropagation(a,!0);g()}})}return c},getRemoveConstraintResolutionOption:function(c,b,d){var a=this.callParent(arguments);a.getTitleValues=function(){return [b.getStartDate()]};return a},getInitialConstraintDate:function(a){return a.getStartDate()},getRestrictions:function(a){return this.hasThisConstraintApplied(a)&&{max:{startDate:a.getConstraintDate()}}}});Ext.define('Gnt.constraint.implicit.Dependency',{extend:'Gnt.constraint.Base',singleton:!0,requires:['Ext.String'],getId:function(){return 'dependency'},getTaskDrivingDependenciesContexts:function(e){var a=e.getIncomingDependenciesConstraintContext({ignoreParents:!0,fetchAll:!0,skipNonWorkingTime:!0}),f=e.getEarlyStartDate(),c=[];if(a){for(var b=0;b<a.all.length;b++){var d=a.all[b];if(d.startDate-f===0){c.push(d)}}}return c},canResolve:function(a,e){var b=this.getTaskDrivingDependenciesContexts(a),d=a.getStartDate(),c=a.getEarlyStartDate();return d-c&&b.length>1&&(a.isPinned()||!a.getConstraintType())},resolve:function(a){if(a.isPinned()||!a.getConstraintType()){a.pinWithoutPropagation()}a.setStartDateWithoutPropagation(a.getEarlyStartDate())},isSatisfied:function(a,e){var c=this.getTaskDrivingDependenciesContexts(a),b=a.getStartDate(),d=a.getEarlyStartDate();return !b||a.isManuallyScheduled()||a.isReadOnly()||!c.length||b-d===0},hasThisConstraintApplied:function(a){return Boolean(a.getIncomingDependencies().length)},getResolution:function(f,a,m){var d=this,c=a.getIncomingDependenciesConstraintContext(),b=d.callParent([f,a,c]);b.dependenciesLimits=c;b.date=null;var e=c.constrainingDependency,k=e.getSourceTask(),l=e.getTargetTask();b.description=Ext.String.format(d.L(a.getStartDate()>c.startDate?'You moved the task away':'You moved the task before'),d.L('depType'+e.getType()),k.getName(),l.getName());b.defaultAction=function(){d.resolve(a)};var h=a.getTaskStore(!0),g=h&&h.scheduleByConstraints,i=a.getDependencyStore(),j=b.getResolution('remove-constraint');j.resolve=function(){g&&a.pinWithoutPropagation();i.remove(e);f()};if(a.getStartDate()>c.startDate){b.resolutions.push({id:'pin-task',title:d.L('Keep the dependency & move the task'),getTitleValues:function(){return [a.getStartDate()]},resolve:function(){g&&a.pinWithoutPropagation();f()}})}return b}});Ext.define('Gnt.constraint.implicit.PotentialConflict',{extend:'Gnt.constraint.Base',singleton:!0,requires:['Ext.String'],getId:function(){return 'potentialconflict'},isSatisfied:function(a){var c=!0;if(this.hasThisConstraintApplied(a)){var d=a.getUnprojected(a.constraintTypeField),b=a.getConstraintType();c=!(d!=b&&this.isConstraintTypeHandled(b))}return c},isConstraintTypeHandled:function(a){return Boolean(this.getConstraintTypeForReplacement(a))},hasThisConstraintApplied:function(a){var b=a.getTaskStore(!0);return Boolean(b&&b.scheduleByConstraints&&a.propagating&&a.getIncomingDependencies().length)},getConstraintTypeForReplacement:function(b){var a;switch(b){case 'startnolaterthan':case 'muststarton':a='startnoearlierthan';break;case 'finishnolaterthan':case 'mustfinishon':a='finishnoearlierthan';break;}return a},getResolution:function(j,b){var c=this,a=c.callParent(arguments);a.defaultAction=a.proceedAction;if(c.hasThisConstraintApplied(b)){var i=b.getUnprojected(b.constraintTypeField),d=b.getConstraintType();if(i!=d&&c.isConstraintTypeHandled(d)){var f=Gnt.constraint.Base.getConstraintClass(d).L('name'),g=a.getResolution('remove-constraint');a.description=Ext.String.format(c.L('This could result in a scheduling conflict'),f,b.getName());Ext.apply(g,{title:Ext.String.format(c.L('Remove the constraint'),f),resolve:a.proceedAction});var e=c.getConstraintTypeForReplacement(b.getConstraintType()),h=Gnt.constraint.Base.getConstraintClass(e).L('name');Ext.Array.insert(a.resolutions,Ext.Array.indexOf(a.resolutions,g),[{id:'replace-constraint',title:Ext.String.format(c.L('Replace the constraint'),h),resolve:function(){b.setConstraintWithoutPropagation(e);j()}}])}}return a}});Ext.define('Gnt.model.Assignment',{extend:'Sch.model.Assignment',uses:['Sch.util.Date'],customizableFields:[{name:'TaskId'},{name:'Units',type:'float',defaultValue:100}],taskIdField:'TaskId',eventIdField:'TaskId',unitsField:'Units',constructor:function(c,b){var a=this;a.eventIdField=a.taskIdField;a.callParent([c,b])},getEventId:function(){var a=this;return a.get(a.taskIdField)},setEventId:function(b){var a=this;return a.set(a.taskIdField,b)},getTaskStore:function(){return this.store&&this.store.getTaskStore()||null},getEventStore:function(){return this.getTaskStore()},getUnits:function(){var a=this;return Math.max(0,a.get(a.unitsField))},setUnits:function(b){var a=this;a.set(a.unitsField,b)},getTask:function(a){var b=this;return b.getEvent(a)},getTaskName:function(b){var a=this.getTask(b);return a&&a.getName()||''},getEffort:function(d){var c=this,a=c.getTask(),b=0;if(a&&a.getStartDate()){a.forEachAvailabilityIntervalWithResources({startDate:a.getStartDate(),endDate:a.getEndDate(),resources:[c.getResource()]},function(e,f,a){var d,c;for(d in a){c=a[d].units}b+=(f-e)*c/100});b=a.getProjectCalendar().convertMSDurationToUnit(b,d||a.getEffortUnit())}return b},getCost:function(){var a=this,b=a.getResource(),c=0;if(a.getTask()){c=b.getRate()*a.getEffort(b.getRateUnit())}return c},getEffortAtDate:function(d,h){var i=Sch.util.Date,g=this,a=g.getTask(),c=a&&a.getStartDate(),f=a&&a.getEndDate(),e=g.getResource(),b=0;if(a&&e&&c&&f){d=i.constrain(d,c,f);a.forEachAvailabilityIntervalWithResources({startDate:c,endDate:d,resources:[e]},function(d,e,a){var c=0;for(var f in a){c=a[f].units}b+=(e-d)*c/100});b=a.getCalendar().convertMSDurationToUnit(b,h||a.getEffortUnit())}return b}});Ext.define('Gnt.data.AssignmentStore',{extend:'Sch.data.AssignmentStore',requires:['Gnt.model.Assignment'],model:'Gnt.model.Assignment',alias:'store.gantt_assignmentstore',storeId:'assignments',attachToEventStore:Ext.emptyFn,attachToResourceStore:Ext.emptyFn,getTaskStore:function(){return this.getEventStore()},setTaskStore:function(a){return this.setEventStore(a)},mapAssignmentsForTask:function(b,c,a){return this.mapAssignmentsForEvent(b,c,a)},getAssignmentsForTask:function(a){return this.getAssignmentsForEvent(a)},removeAssignmentsForTask:function(a){return this.removeAssignmentsForEvent(a)},getResourcesForTask:function(a){return this.getResourcesForEvent(a)},getTasksForResource:function(a){return this.getEventsForResource(a)},assignTaskToResource:function(c,a,b){return this.assignEventToResource(c,a,function(a){a.setUnits(b);return a})},unassignTaskFromResource:function(b,a){return this.unassignEventFromResource(b,a)},isTaskAssignedToResource:function(b,a,c){return this.isEventAssignedToResource(b,a,c)},getAssignmentForTaskAndResource:function(b,a){return this.getAssignmentForEventAndResource(b,a)}},function(){if(Ext.getVersion().isLessThan('6.5.0')){Ext.override(this,{commitChanges:function(){this.callParent(arguments);this.fireEvent('commit',this)}})}});Ext.define('Gnt.data.CalendarManager',{extend:'Ext.data.TreeStore',requires:['Gnt.data.Calendar'],mixins:['Robo.data.Store','Sch.data.mixin.UniversalModelGetter'],model:'Gnt.model.Calendar',alias:'store.calendarmanager',storeId:'calendars',calendarClass:'Gnt.data.Calendar',calendarConfig:null,projectCalendar:null,myListeners:null,proxy:'memory',ownedCalendars:null,constructor:function(b){this.ownedCalendars=[];this.callParent(arguments);this.myListeners=this.on({idchanged:this.onChangeId,rootchange:this.onNewRoot,nodeappend:this.onNewNode,nodeinsert:this.onNewNode,noderemove:this.onRemoveNode,load:this.onNodesLoaded,destroyable:!0,scope:this});var a=this.getRoot();if(a){this.bindCalendars(a)}else {this.setRoot({expanded:!0})}},destroy:function(){var a=this;a.ownedCalendars=[];a.myListeners.destroy();var b=a.getRoot();b&&b.cascadeBy(function(b){b.getCalendar()&&a.destroyCalendar(b.calendar)});a.callParent(arguments)},onChangeId:function(f,e,d,c,a){if(!(e instanceof Gnt.model.Calendar)){return}var b=this.getCalendar(d||a);b.setCalendarId(c)},onNewNode:function(b,a){if(!b||b.getId()!==a.getId()){this.bindCalendars(a);if(a!==this.getRoot()){this.fixCalendarParent(a)}var c=this;a.cascadeBy(function(a){a.setCalendarManager(c)})}},onNewRoot:function(a){this.onNewNode(null,a);this.cleanupOwnedCalendars()},onNodesLoaded:function(){this.cleanupOwnedCalendars()},destroyCalendar:function(a){Ext.data.StoreManager.unregister(a);a.destroy();Ext.Array.remove(this.ownedCalendars,a)},onRemoveNode:function(d,b,c){if(!c){var a=b.calendar;if(a){this.unbindCalendarEvents(a);if(this.getProjectCalendar()==a){this.setProjectCalendar(null)}if(!this.__loading){this.destroyCalendar(a)}b.setCalendarManager(null)}}},cleanupOwnedCalendars:function(){var a=this;if(a.ownedCalendars.length){var b=a.ownedCalendars.slice(0);Ext.Array.each(b,function(b){if(!a.getNodeByCalendar(b)){a.destroyCalendar(b)}})}},suspendCalendarsEvents:function(b){var a=this.getRoot();a&&a.cascadeBy(function(c){var a=c.getCalendar();if(a){a.suspendEvents(b)}},this)},resumeCalendarsEvents:function(){var a=this.getRoot();a&&a.cascadeBy(function(b){var a=b.getCalendar();if(a){a.resumeEvents()}},this)},getCalendarClass:function(){return this.calendarClass},getProjectCalendar:function(){return this.projectCalendar},setProjectCalendar:function(a){if(this.settingProjectCalendar){return}if(typeof a!=='object'){a=this.getCalendar(a)||Gnt.data.Calendar.getCalendar(a)}if(this.getProjectCalendar()!==a){this.settingProjectCalendar=!0;this.projectCalendar=a;this.fireEvent('projectcalendarset',this,a);this.settingProjectCalendar=!1}},getCalendar:function(b){var a=this.getModelById(b);return a&&a.getCalendar()},getNodeByCalendar:function(a){if(!a){return this.getRoot()}var b=this.getModelById(a.calendarId);if(!b){var c=this.getRoot();c&&c.cascadeBy(function(c){var d=c.getCalendar();if(d===a){b=c;return !1}},this)}return b},onParentChange:function(b,d,c){var a=this.getNodeByCalendar(b);if(a&&!a.syncingCalendarParent){this.fixNodeParent(a)}},bindCalendarEvents:function(a){this.relayEvents(a,['load'],'calendar');this.relayEvents(a,['add','update','remove','bulkremove'],'day');this.relayEvents(a,['calendarchange']);a.on('parentchange',this.onParentChange,this);this.on({dayadd:this.onDayAdd,dayupdate:this.onDayUpdate,dayremove:this.onDayRemove,scope:this})},unbindCalendarEvents:function(a){this.un({dayadd:this.onDayAdd,dayupdate:this.onDayUpdate,dayremove:this.onDayRemove,scope:this});a&&a.un({parentchange:this.onParentChange,scope:this})},onDayAdd:function(a,b){this.getModelById(a.getCalendarId()).dirty=!0},onDayUpdate:function(a,b){this.getModelById(a.getCalendarId()).dirty=!0},onDayRemove:function(a,b){this.getModelById(a.getCalendarId()).dirty=!0},fixCalendarParent:function(a){if(a.syncingCalendarParent){return}var b=a.parentNode.getCalendar(),c=a.getCalendar();if(b!==c.parent){a.syncingCalendarParent=!0;c.setParent(b);a.syncingCalendarParent=!1}},fixNodeParent:function(a){var d=a.parentNode.getCalendar(),c=a.getCalendar().parent;if(d!==c){var b=this.getNodeByCalendar(c);b&&b.appendChild(a)}},bindCalendar:function(a){if(!a||this.getRoot()===a){return}var b=a.getCalendar();var c=a.getDays();var g=a.getId()||a.internalId;c=Ext.isArray(c)&&c;if(!b||c){if(!b){b=Gnt.data.Calendar.getCalendar(g)}if(!b){var f=a.parentNode&&a.parentNode.getCalendar();var e=Ext.ClassManager.get(a.getCalendarClass()||this.calendarClass);var d=Ext.applyIf(a.getCalendarConfig(),{data:c,parent:f});b=Ext.create(e,Ext.apply(d,this.calendarConfig));this.ownedCalendars.push(b)}a.setCalendar(b);this.bindCalendarEvents(b)}else {if(!this.getCalendar(b.calendarId)){this.bindCalendarEvents(b)}}this.fireEvent('calendarbound',this,b,a)},unbindCalendar:function(a){if(!a||this.getRoot()===a){return}var b=a.getCalendar();if(!b){return}this.unbindCalendarEvents(b);this.fireEvent('calendarunbound',this,b,a)},bindCalendars:function(a){var b=this;if(a){Ext.Array.each([].concat(a),function(a){a.cascadeBy(b.bindCalendar,b)})}},unbindCalendars:function(a){var b=this;if(a){Ext.Array.each([].concat(a),function(a){a.cascadeBy(b.unbindCalendar,b)})}}});Ext.define('Gnt.data.linearizator.CycleResolvers',function(a){function resolveCycleNone(){return !1}function resolveCycleByException(){Ext.Error.raise("Can't linearize dependent tasks, there's a cycle in the dependency chain!")}function resolveCycleByCuttingLinks$(e,c){var d=buildSourceTreeFromSourceSet(e,c),a={},b=function(b,c){(a[b]||(a[b]=[])).push(c)};traverseSourceTreePostOrder(d,function foldNode$(a){if(a.prevSibling){a.foldedDeps=foldDepsForNodesHorizontaly(a.prevSibling.foldedDeps,a.foldedDeps,b)}if(!a.nextSibling&&a.parentNode){a.parentNode.foldedDeps=foldDepsForNodesVerticaly(a.foldedDeps,a.parentNode.foldedDeps,b)}});cutCycles$(c.fromById,a);return !0}function buildSourceTreeFromSourceSet(c,g){var f,d=[],b={},a,e;for(a in c){if(c.hasOwnProperty(a)){e=b[a]=createRawSourceTreeNode(c[a].task,c,g);if(!c.hasOwnProperty(e.parentNode)){d.push(e)}}}for(a in b){if(b.hasOwnProperty(a)){b[a]=realizeRawSourceTreeNode$(b[a],b)}}if(d.length==1){f=d[0]}else {f={parentNode:null,prevSibling:null,nextSibling:null,children:d,foldedDeps:{}}}return f}function createRawSourceTreeNode(c,d,n){var p=Ext.Object,o=n.fromById,h={},i=c.internalId,k,l,a,b,j,g,f,e,m;k=p.getKeys(o[i]);if(k.length){h[i]=k}else {h[i]={}}l=c.parentNode&&d.hasOwnProperty(c.parentNode.internalId)&&c.parentNode.internalId;j=c.childNodes||[];f=[];for(e=0,m=j.length;e<m;e++){g=j[e].internalId;if(d.hasOwnProperty(g)){f.push(g)}}b=c.previousSibling;while(b&&!d.hasOwnProperty(b.internalId)){b=b.previousSibling}b=b&&b.internalId;a=c.nextSibling;while(a&&!d.hasOwnProperty(a.internalId)){a=a.nextSibling}a=a&&a.internalId;return {parentNode:l,prevSibling:b,nextSibling:a,children:f,foldedDeps:h}}function realizeRawSourceTreeNode$(a,c){var b,e,d=a.children;for(b=0,e=d.length;b<e;b++){d[b]=c[d[b]]}a.parentNode=(a.parentNode||a.parentNode===0)&&c[a.parentNode]||null;a.prevSibling=(a.prevSibling||a.prevSibling===0)&&c[a.prevSibling]||null;a.nextSibling=(a.nextSibling||a.nextSibling===0)&&c[a.nextSibling]||null;return a}function traverseSourceTreePostOrder(b,d){var c=b.children,a,e;for(a=0,e=c.length;a<e;a++){traverseSourceTreePostOrder(c[a],d)}d(b);return b}function foldDepsForNodesHorizontaly(e,f,g){var a=getHorizontalCrossDeps(e,f),h=a.fromAtoB,i=a.fromBtoA,c=a.fromAtoBtotal,d=a.fromBtoAtotal,b={};if(c>0&&d>0){b=c<d?h:i}collectCuts(b,g);return joinDeps(e,f,b)}function foldDepsForNodesVerticaly(c,d,e){var h=Ext.Object,b=getHorizontalCrossDeps(c,d),f=b.fromAtoB,g=b.fromBtoA,a;a=h.merge({},f,g);collectCuts(a,e);return joinDeps(c,d,a)}function getHorizontalCrossDeps(k,l){var n=Ext.Object,m=Ext.Array,e=n.getKeys(k),f=n.getKeys(l),i={},j={},g=0,h=0,b,d,c,a;for(b=0,d=e.length;b<d;++b){c=e[b];a=m.intersect(f,k[c]);if(a.length){i[c]=a;g+=a.length}}for(b=0,d=f.length;b<d;++b){c=f[b];a=m.intersect(e,l[c]);if(a.length){j[c]=a;h+=a.length}}return {fromAtoB:i,fromBtoA:j,fromAtoBtotal:g,fromBtoAtotal:h}}function collectCuts(c,f){var a,b,e,d;for(a in c){if(c.hasOwnProperty(a)){d=c[a];for(b=0,e=d.length;b<e;++b){f(a,d[b])}}}}function joinDeps(d,e,c){var g=Ext.Object,f=Ext.Array,b,a;b=g.merge({},d,e);for(a in c){if(c.hasOwnProperty(a)&&b.hasOwnProperty(a)){b[a]=f.difference(b[a],c[a])}}return b}function cutCycles$(e,c){var a,d,f,b,g;for(a in c){if(c.hasOwnProperty(a)){d=c[a];for(b=0,g=d.length;b<g;++b){f=d[b];e[a][f][0]='green'}}}return e}return {singleton:!0,'none':resolveCycleNone,'exception':resolveCycleByException,'cut':resolveCycleByCuttingLinks$}});Ext.define('Gnt.data.Linearizator',function(b){var a={};function linearWalkBySpecification(b,c,a){a=resolveWalkingSpecification(a);return linearWalk([].concat(b),c,a.tasksDepsCollectingFn,a.cycleSolverFn)}function linearWalk(j,k,i,h){var f=!1,c=!0,a,b,d,g,e;a=createEmptyTasksColorMap();b=createEmptyDepsColorMap();collectTasksAndDepsIntoColorMaps$(j,i,a,b);while(c){f=!1;while(!f){f=!0;c=!1;for(d in a){if(a.hasOwnProperty(d)&&a[d].color!='green'){g=a[d].task;e=calculateTaskColor(g,b);if(e!='red'){setCalculatedTaskColor$(e,g,a,b);k(g,e,a,b);f=!1}else {c=!0}}}}if(c){c=h&&h(a,b)}}}function resolveWalkingSpecification(c){var e=getWalkingSpecificationKey(c),f,b,d;d=a[e];if(!d){f=Gnt.data.linearizator.CycleResolvers[c.cycles||'none'];b=[];c.self&&b.push(selfTasksDepsCollector$);c.ancestors&&b.push(ancestorsTasksDepsCollector$);c.descendants&&b.push(descendantsTasksDepsCollector$);c.successors&&b.push(successorsTasksDepsCollector$);b=composeTasksDepsCollectors(b);d={tasksDepsCollectingFn:b,cycleSolverFn:f};a[e]=d}return d}function getWalkingSpecificationKey(b){var c=[],a;for(a in b){if(b.hasOwnProperty(a)){c.push(a,'=',String(b[a]))}}return c.join(';')}function composeTasksDepsCollectors(a){return function(e,c,d){var b=[];Ext.Array.each(a,function(a){b=b.concat(a(e,c,d))});return b}}function collectTasksAndDepsIntoColorMaps$(d,a,b,c){Ext.Array.each(d,function(e){var d=a(e,b,c);if(d.length>0){collectTasksAndDepsIntoColorMaps$(d,a,b,c)}})}function selfTasksDepsCollector$(a,c,e){var b=[],d=a.internalId;if(!c.hasOwnProperty(d)){c[d]={task:a,color:'red'};b=[a]}return b}function ancestorsTasksDepsCollector$(m,j,e){var i=[],d=e.downFromById,k=e.downToById,l=e.upFromById,f=e.upToById,b=m.internalId,c=m.parentNode,a=c&&c.internalId,g,h;if(c&&!j.hasOwnProperty(a)){j[a]={task:c,color:'red'};i.push(c)}if(c){g=['red'];h=['red'];!d[a]&&(d[a]={});!d[a][b]&&(d[a][b]=g);!k[b]&&(k[b]=g);!f[a]&&(f[a]={});!f[a][b]&&(f[a][b]=h);!l[b]&&(l[b]=h)}return i}function descendantsTasksDepsCollector$(e,g,c){var f=[],b=c.downFromById,h=c.downToById,i=c.upFromById,d=c.upToById,j=!e.isRoot()&&e.childNodes,a=e.internalId;j&&Ext.Array.each(j,function(e){var c=e.internalId,j,k;if(!g.hasOwnProperty(c)){g[c]={task:e,color:'red'};f.push(e)}j=['red'];k=['red'];!b[a]&&(b[a]={});!b[a][c]&&(b[a][c]=j);!h[c]&&(h[c]=j);!d[a]&&(d[a]={});!d[a][c]&&(d[a][c]=k);!i[c]&&(i[c]=k)});return f}function successorsTasksDepsCollector$(g,e,f){var d=[],b=f.fromById,c=f.toById,h=g.getSuccessors(),a=g.internalId;Ext.Array.each(h,function(g){var f=g.internalId,h;if(!e.hasOwnProperty(f)){e[f]={task:g,color:'red'};d.push(g)}h=['red'];!b[a]&&(b[a]={});!b[a][f]&&(b[a][f]=h);!c[f]&&(c[f]={});!c[f][a]&&(c[f][a]=h)});return d}function createEmptyTasksColorMap(){return {}}function createEmptyDepsColorMap(){return {fromById:{},toById:{},downFromById:{},downToById:{},upFromById:{},upToById:{}}}function hasRedDepsTo(e,d){var a=d.toById[e.internalId],c=!1,b;for(b in a){if(a.hasOwnProperty(b)&&a[b]&&a[b][0]=='red'){c=!0;break}}return c}function hasRedDepsFrom(e,d){var a=d.fromById[e.internalId],c=!1,b;for(b in a){if(a.hasOwnProperty(b)&&a[b]&&a[b][0]=='red'){c=!0;break}}return c}function hasRedDepsDownTo(d,c){var a=c.downToById,b=d.internalId;return a[b]&&a[b][0]=='red'}function hasRedDepsDownFrom(e,d){var a=d.downFromById[e.internalId],c=!1,b;for(b in a){if(a.hasOwnProperty(b)&&a[b]&&a[b][0]=='red'){c=!0;break}}return c}function hasRedDepsUpTo(e,d){var a=d.upToById[e.internalId],c=!1,b;for(b in a){if(a.hasOwnProperty(b)&&a[b]&&a[b][0]=='red'){c=!0;break}}return c}function hasRedDepsUpFrom(d,c){var b=d.internalId,a=c.upToById;return a[b]&&a[b][0]=='red'}function calculateTaskColor(b,a){var c='red';if(!hasRedDepsTo(b,a)&&!hasRedDepsDownTo(b,a)&&!hasRedDepsUpTo(b,a)){c='green'}else {if(!hasRedDepsTo(b,a)&&!hasRedDepsDownTo(b,a)&&hasRedDepsDownFrom(b,a)){c='yellow'}else {c='red'}}return c}function setCalculatedTaskColor$(c,i,h,f){var e=i.internalId,d=f.fromById[e],b=f.downFromById[e],g=f.upFromById[e],a;h[e].color=c;if(c=='green'){if(d){for(a in d){if(d.hasOwnProperty(a)){d[a][0]=c}}}if(b){for(a in b){if(b.hasOwnProperty(a)){b[a][0]=c}}}if(g){g[0]=c}}else {if(c=='yellow'){if(b){for(a in b){if(b.hasOwnProperty(a)){b[a][0]=c}}}}}}return {singleton:!0,requires:['Gnt.data.linearizator.CycleResolvers'],linearWalkBySpecification:linearWalkBySpecification}});Ext.define('Gnt.model.mixin.ProjectableModel',function(){function initProjectable(){}function getUnprojected(a){return this.data[a]}function isProjected(){var a=this,b=a.getTreeStore&&a.getTreeStore()||a.store,c=b&&b.getProjection&&b.getProjection();return c&&c.hasOwnProperty(a.internalId)?!0:!1}var a={record:null,projection:null,result:null};var b=Ext.Function.flexSetter(function(e,d){var m=this,f=a.record,i=a.projection,l=a.result,h=f.internalId,b=f.get(e),j=f.previousValues,c,g,k;c=d!==undefined&&d!==null?d.valueOf():d;g=b!==undefined&&b!==null?b.valueOf():b;if((c===undefined||c===null)&&c!==g||c!=g){k=i[h]=i.hasOwnProperty(h)&&i[h]||{};k[e]=d;(j||(f.previousValues=j={}))[e]=b;l.push(e)}});function makeOverridables(){var c={};c.get=function get(b){var a=this,e=a.getTreeStore&&a.getTreeStore()||a.store,d=e&&e.getProjection&&e.getProjection(),g=a.internalId,f,c;if(d&&d.hasOwnProperty(g)){f=d[g];if(b in f){c=f[b]}else {c=a.callParent([b])}}else {c=a.callParent([b])}return c};c.set=function set(g,h,j){var c=this,e=c.getTreeStore&&c.getTreeStore()||c.store,f=e&&e.getProjection&&e.getProjection(),i=c.internalId,d;if(f){a.record=c;a.projection=f;a.result=[];b(g,h);d=a.result;a.record=null;a.result=null;a.projection=null}else {d=c.callParent(arguments)}return d};return c}return {initProjectable:initProjectable,getUnprojected:getUnprojected,isProjected:isProjected,onClassMixedIn:function(a){Ext.override(a,makeOverridables())}}});Ext.define('Gnt.model.task.More',{propagating:!1,indent:function(a){var b=this,d=b.previousSibling,c;if(d){var e=b.getTaskStore();e.beginIndent();b.propagateChanges(function(){return b.indentWithoutPropagation(function(a){c=a})},function(b,f){if(b){c&&c()}else {d.expand()}e.endIndent();a&&a(b,f)})}else {a&&a(!1,{})}},indentWithoutPropagation:function(d){var a=this,b=a.previousSibling,c;if(b){var e={parentNode:a.parentNode,previousSibling:a.previousSibling,nextSibling:a.nextSibling};var f=b.childNodes?b.childNodes.length:0;c=b.insertSubtaskWithoutPropagation(f,a,d);a.removeContext=e}return c},outdent:function(a){var b=this,d=b.parentNode,c;if(d&&!d.isRoot()){var e=b.getTaskStore();e.beginIndent();b.propagateChanges(function(){return b.outdentWithoutPropagation(function(a){c=a})},function(b,d){b&&c&&c();e.endIndent();a&&a(b,d)})}else {a&&a(!1,{})}},outdentWithoutPropagation:function(g){var b=this,a=b.parentNode,e,f;if(a&&!a.isRoot()){var c=a.parentNode,d=a.nextSibling;e={parentNode:a,previousSibling:b.previousSibling,nextSibling:b.nextSibling};var h=d?c.indexOf(d):c.childNodes.length;f=c.insertSubtaskWithoutPropagation(h,b,g);b.removeContext=e}return f},removeInvalidDependencies:function(){var c=this.getDependencyStore(),b=this.getAllDependencies();for(var a=0;a<b.length;a++){if(!b[a].isValid()){c.remove(b[a])}}},removeDependenciesToParents:function(b){var a=this,c=a.getSuccessors().concat(a.getPredecessors());b.bubble(function(b){if(Ext.Array.indexOf(c,b)>=0){a.removeLinkToTask(b)}})},hasDependencies:function(){return this.hasIncomingDependencies()||this.hasOutgoingDependencies()},getAllDependencies:function(){return this.predecessors.concat(this.successors)},hasIncomingDependencies:function(){return this.predecessors.length>0},hasOutgoingDependencies:function(){return this.successors.length>0},getIncomingDependencies:function(a){return a?this.predecessors:this.predecessors.slice()},getParentsOutgoingDependencies:function(d){var a=this.parentNode,c=[],b;while(a){if(d){b=Ext.Array.filter(a.getOutgoingDependencies(!0),function(b){var a=b.getTargetTask();return a&&a.isAncestor(d)})}else {b=a.getOutgoingDependencies(!0)}c=c.concat(b);a=a.parentNode}return c},getParentsIncomingDependencies:function(d){var a=this.parentNode,c=[],b;while(a){if(d){b=Ext.Array.filter(a.getIncomingDependencies(!0),function(b){var a=b.getSourceTask();return a&&a.isAncestor(d)})}else {b=a.getIncomingDependencies(!0)}c=c.concat(b);a=a.parentNode}return c},getOutgoingDependencies:function(a){return a?this.successors:this.successors.slice()},alignByIncomingDependencies:function(b,a,c){var d=this.alignByIncomingDependenciesWithoutPropagation(b,a);this.propagateChanges(null,c,!0);return d},alignByIncomingDependenciesWithoutPropagation:function(c,a,b){return this.scheduleWithoutPropagation({taskStore:c,currentCascadeBatch:a,parentNode:b})},scheduleWithoutPropagation:function(a){a=a||{};var f=!1;this.isMarkedForRescheduling()&&this.unmarkForRescheduling();var e=a.taskStore=a.taskStore||this.getTaskStore(!0);if(e&&!this.isProject&&!this.isManuallyScheduled()&&!this.isReadOnly()){if(typeof a.shallow!=='boolean'){a.shallow=!e.scheduleByConstraints}if(!Ext.isNumber(this.getDuration())){this.set(this.durationField,1)}var b=this.getEarlyStartDate(a),c=this.getEarlyEndDate(a),d=a.currentCascadeBatch;if(b&&b-this.getStartDate()!==0||c&&c-this.getEndDate()!==0){d&&d.addAffected(this);this.setStartEndDateWithoutPropagation(b,c,!1);f=!0}}return f},schedule:function(c,b){var a=this;a.propagateChanges(function(){return a.scheduleWithoutPropagation(c)},b,!0)},getDependencyCalendar:function(d,b,c){if(!b){b=(c||this.getTaskStore()).dependenciesCalendar}var e=this.getProjectCalendar(),g=d.getSourceTask(c),f=d.getTargetTask(c),a;switch(b){case 'project':a=e;break;case 'source':a=g.getCalendar();break;case 'target':a=f.getCalendar();break;default:throw 'Unsupported value for `dependenciesCalendar` config option';}return a},getCriticalPaths:function(){var b=[this],f=[[this]],g;while(g=b.shift()){var d=g.getPredecessors(),a=[];for(var c=0;c<d.length;c++){var e=d[c];if(e.isCritical()){a.push(e)}}if(a.length){b=b.concat(a);f.push(a)}}return f},addSubtask:function(c,b){var a=this;return a.insertSubtask(a.childNodes?a.childNodes.length:0,c,b)},insertSubtask:function(f,e,c){var d=this,b,a;d.propagateChanges(function(){return d.insertSubtaskWithoutPropagation(f,e,function cancelAndResultFeedback(d,c){a=d;b=c})},function onPropagationComplete(b,d){b&&a&&a();c&&c(b,d)});return b},insertSubtaskWithoutPropagation:function(i,c,g){var a=this,b,h,e,d,f;b=c.parentNode;h=b&&b.indexOf(a);d=a.get('leaf');if(d){f=a.getSegments();a.markAsParent()}c=a.insertChild(i,c);a.expand();c.scheduleWithoutPropagation();g&&g(function(){if(b){b.insertChild(h,c)}else {a.removeChild(c)}d&&a.set('leaf',!0);d&&f&&a.setSegmentsWithoutPropagation(f)},c);if(!b){e=c}else {if(a!==b&&a.getTaskStore(!0)===b.getTaskStore(!0)){e=[c,b]}}return e},removeSubtask:function(d,a){var c=this,b;if(c.indexOf(d)!==-1){c.propagateChanges(function(){return c.removeSubtaskWithoutPropagation(d,function cancelFeedback(a){b=a})},function onPropagationComplete(c,d){c&&b&&b();a&&a(c,d)})}else {a&&a(!1,{})}},removeSubtaskWithoutPropagation:function(h,m){var g=this,n=g.indexOf(h),i,d,c,b,e,j,k,a,f,l;d=g.getDependencyStore();c=g.getAssignmentStore();b=h.getAllDependencies();e=c&&h.getAssignments();i=[];j=[];k=[];h.cascadeBy(function(a){i.push(a)});for(a=0,f=i.length;(d||c)&&a<f;a++){l=i[a];d&&(b=b.concat(l.getAllDependencies()));c&&(e=e.concat(l.getAssignments()))}b=d&&Ext.Array.unique(b);b=d&&Ext.Array.sort(b,function(a,b){return d.indexOf(a)<d.indexOf(b)?-1:1});for(a=0,f=b&&b.length;d&&a<f;a++){j.push(d.indexOf(b[a]))}e=c&&Ext.Array.sort(e,function(a,b){return c.indexOf(a)<c.indexOf(b)?-1:1});for(a=0,f=e&&e.length;c&&a<f;a++){k.push(c.indexOf(e[a]))}h=g.removeChild(h);c&&c.remove(e);d&&d.remove(b);if(g.childNodes.length===0&&g.convertEmptyParentToLeaf){g.set('leaf',!0)}m&&m(function(){g.insertChild(n,h);for(a=0,f=e&&e.length;c&&a<f;a++){c.insert(k[a],e[a])}for(a=0,f=b&&b.length;d&&a<f;a++){d.insert(j[a],b[a])}});return g},addSuccessor:function(e,c){var d=this,b,a;d.propagateChanges(function(){return d.addSuccessorWithoutPropagation(e,function cancelAndResultFeedback(d,c){a=d;b=c})},function onPropagationComplete(b,d){b&&a&&a();c&&c(b,d)});return b},addSuccessorWithoutPropagation:function(a,c){var b=this,f=b.parentNode,g=f.indexOf(b),d,e;a=a||new b.self();if(b.getEndDate()&&a.isUnscheduled()){a.beginEdit();a.set(b.startDateField,b.getEndDate());if(!Ext.isNumber(a.getDuration())){a.set(b.durationField,1)}if(!a.getEndDate()){a.set(b.endDateField,b.getCalendar().calculateEndDate(b.getEndDate(),a.getDuration(),a.getDurationUnit()))}a.endEdit()}f.insertSubtaskWithoutPropagation(g+1,a,function(c,b){d=c;a=b});b.linkToWithoutPropagation(a,Gnt.model.Dependency.Type.EndToStart,function(a){e=a});c&&c(function(){e();d()},a);return b},addMilestone:function(a,d){var b=this,c=b.getEndDate();if(!a){a=new b.self()}else {if(Ext.isObject(a)&&!(a instanceof Gnt.model.Task)){a=new b.self(a)}}if(c&&!a.isMilestone()){a.calendar=a.calendar||b.getCalendar();a.setStartEndDate(c,c)}return b.addTaskBelow(a,d)},addPredecessor:function(e,b){var d=this,a,c;d.propagateChanges(function(){return d.addPredecessorWithoutPropagation(e,function cancelAndResultFeedback(d,b){c=d;a=b})},function onPropagationComplete(a,d){a&&c();b&&b(a,d)});return a},addPredecessorWithoutPropagation:function(a,c){var b=this,f=b.parentNode,g=f.indexOf(b),d,e;a=a||new b.self();if(b.getStartDate()){a.beginEdit();if(!Ext.isNumber(a.getDuration())){a.set(b.durationField,1)}if(!a.getStartDate()){a.set(b.startDateField,b.getCalendar().calculateStartDate(b.getStartDate(),a.getDuration(),a.getDurationUnit()));a.set(b.endDateField,b.getCalendar().skipNonWorkingTime(b.getStartDate()))}a.endEdit()}f.insertSubtaskWithoutPropagation(g,a,function(c,b){d=c;a=b});a.linkToWithoutPropagation(b,Gnt.model.Dependency.Type.EndToStart,function(a){e=a});c&&c(function(){e();d()},a);return a},getSuccessors:function(){var b=this.successors,d=[];for(var a=0,e=b.length;a<e;a++){var c=b[a].getTargetTask();if(c){d.push(c)}}return d},getPredecessors:function(){var b=this.predecessors,d=[];for(var a=0,e=b.length;a<e;a++){var c=b[a].getSourceTask();if(c){d.push(c)}}return d},addTaskAbove:function(b,e){var a=this,d=a.parentNode,g=d.indexOf(a),c,f;b=b||new a.self();a.propagateChanges(function(){return d.insertSubtaskWithoutPropagation(g,b,function cancelAndResultFeedback(b,a){f=b;c=a})},function onPropagationComplete(a,b){a&&f();e&&e(a,b)});return c},addTaskBelow:function(b,e){var a=this,d=a.parentNode,g=d.indexOf(a)+1,c,f;b=b||new a.self();a.propagateChanges(function(){return d.insertSubtaskWithoutPropagation(g,b,function cancelAndResultFeedback(b,a){f=b;c=a})},function onPropagationComplete(a,b){a&&f();e&&e(a,b)});return c},isAbove:function(a){var d=this,c=Math.min(d.data.depth,a.data.depth);var b=this;while(b.data.depth>c){b=b.parentNode;if(b==a){return !1}}while(a.data.depth>c){a=a.parentNode;if(a==d){return !0}}while(a.parentNode!==b.parentNode){a=a.parentNode;b=b.parentNode}return a.data.index>b.data.index},cascadeChildren:function(e,c){var f=this;if(f.isLeaf()){return}var b=this.childNodes;for(var a=0,d=b.length;a<d;a++){b[a].cascadeBy(e,c)}},isCritical:function(){return this.getTotalSlack()<=0},getStartSlack:function(a){return this.calculateStartSlack({unit:a})},calculateSlackByDates:function(a,b,f){var e=this.getTaskStore(!0),c;if(e&&a&&b){var d=1;if(a>b){var g=a;a=b;b=g;d=-1}c=this.getCalendar().calculateDuration(a,b,f||Sch.util.Date.DAY);if(c){c*=d}}return c},calculateStartSlack:function(a){a=a||{};a.limitByConstraints=a.limitByConstraints===!0;return this.calculateSlackByDates(this.getEarlyStartDate(a),this.getLateStartDate(a),a.unit)},getEndSlack:function(a){return this.calculateEndSlack({unit:a})},calculateEndSlack:function(a){a=a||{};a.limitByConstraints=a.limitByConstraints===!0;return this.calculateSlackByDates(this.getEarlyEndDate(a),this.getLateEndDate(a),a.unit)},calculateSlack:function(a){a=a||{};var e=this.getTaskStore(!0),c;if(e){var b=this.calculateStartSlack(a),d=this.isLeaf()?b:this.calculateEndSlack(a);c=Math.min(b,d)}return c},getTotalSlack:function(a){return this.calculateSlack({unit:a||Sch.util.Date.DAY})},getFreeSlack:function(a){a=a||Sch.util.Date.DAY;var c=this,g=c.getTaskStore(!0),b;if(g){if(!c.hasOutgoingDependencies()){b=this.getTotalSlack(a)}else {var e={skipNonWorkingTime:!1,limitByConstraints:!1},f=this.getEarlyEndDate(e);var d=c.getOutgoingDependenciesConstraintContext(Ext.apply(e,{getLateStartDateFn:'getEarlyStartDate',getLateEndDateFn:'getEarlyEndDate'}));if(d){b=this.calculateSlackByDates(f,d.endDate,a)}}}return b},getSlack:function(a){return this.getFreeSlack(a)},endDateToStartDate:function(c){var a,b;if(this.getSchedulingMode()=='EffortDriven'){b=this.calculateEffortDrivenStartDate(c,this.getEffort())}else {if(this.isSegmented()){a=this.calculateDuration(this.getStartDate(),this.getEndDate(),null,{segments:!1})}else {a=this.getDuration()}b=this.calculateStartDate(c,a,null,{segments:!1})}return b},startDateToEndDate:function(c){var b,a;if(this.getSchedulingMode()=='EffortDriven'){b=this.calculateEffortDrivenEndDate(c,this.getEffort())}else {if(this.isSegmented()){a=this.calculateDuration(this.getStartDate(),this.getEndDate(),null,{segments:!1})}else {a=this.getDuration()}b=this.calculateEndDate(c,a,null,{segments:!1})}return b},getInheritedConstraintRestrictions:function(g){g=g||{};var c=this,b=g.translateTo||'startDate',e=b=='startDate'?'endDate':'startDate',h=b=='startDate'?c.endDateToStartDate:c.startDateToEndDate,f=Sch.util.Date.MAX_VALUE,d=Sch.util.Date.MIN_VALUE,a;c.bubble(function(m){var k=m.getConstraintClasses();for(var j=0;j<k.length;j++){var l=k[j],g=l&&l.getRestrictions(m),i;if(g){if(g.min){i=g.min[b]||g.min[e]&&h.call(c,g.min[e]);if(i&&i>d){d=i}}else {if(g.max){i=g.max[b]||g.max[e]&&h.call(c,g.max[e]);if(i&&i<f){f=i}}else {if(g.startDate||g.endDate){a=g;return !1}}}}}});if(!a){if(d-Sch.util.Date.MIN_VALUE){a={};a.min={};a.min[b]=d}if(f-Sch.util.Date.MAX_VALUE){a=a||{};a.max={};a.max[b]=f}}return a},getMaximalDateComparisonFn:function(a,b){return b>a||!a},getIncomingDependenciesConstraintContext:function(a){a=a||{};var b=this,t=!a.shallow,m=b.getIncomingDependencies(!0),l=Gnt.model.Dependency.Type,e=a.translateTo||'startDate',h=a.getEarlyStartDateFn||(t?b.getEarlyStartDate:b.getStartDate),i=a.getEarlyEndDateFn||(t?b.getEarlyEndDate:b.getEndDate),k=a.comparisonFn||b.getMaximalDateComparisonFn,w=e=='startDate'?b.endDateToStartDate:b.startDateToEndDate,n=a.parentNode,x=a.taskStore||b.getTaskStore(!0),s=a.fetchAll,d,r,c;if(typeof h=='string'){h=b[h]}if(typeof i=='string'){i=b[i]}if(typeof k=='string'){k=b[k]}a.fetchAll=!1;if(!a.ignoreParents){m=m.concat(b.getParentsIncomingDependencies(n))}for(var p=0,y=m.length;p<y;p++){var g=m[p],f=g.getSourceTask(),j=!1,q;if(f&&(!n||f.isAncestor(n))){q=b.getDependencyCalendar(g,null,x);switch(g.getType()){case l.StartToStart:c=h.call(f,a);j=e=='endDate';break;case l.StartToEnd:c=h.call(f,a);j=e=='startDate';break;case l.EndToStart:c=i.call(f,a);j=e=='endDate';break;case l.EndToEnd:c=i.call(f,a);j=e=='startDate';break;}if(c){var u=g.getLag();if(u){c=q.skipWorkingTime(c,u,g.getLagUnit())}if(j){c=w.call(b,c)}if(s){d=d||{all:[]};var o=c;var v={constrainingTask:f,constrainingDependency:g};if(a.skipNonWorkingTime&&!b.isMilestone()){o=b.skipNonWorkingTime(o,!0)}v[e]=o;d.all.push(v)}if(k(r,c)){r=c;d=d||{};d[e]=c;d.constrainingTask=f;d.constrainingDependency=g}}}}a.fetchAll=s;if(a.skipNonWorkingTime&&d&&!b.isMilestone()){d[e]=b.skipNonWorkingTime(d[e],!0)}return d},getMinimalDateComparisonFn:function(a,b){return !a||b<a},getOutgoingDependenciesConstraintContext:function(a){a=a||{};var b=this,p=!a.shallow,k=b.getOutgoingDependencies(!0),j=Gnt.model.Dependency.Type,g=a.getLateStartDateFn||(p?b.getLateStartDate:b.getStartDate),h=a.getLateEndDateFn||(p?b.getLateEndDate:b.getEndDate),i=a.comparisonFn||b.getMinimalDateComparisonFn,r=a.parentNode,s=a.taskStore||b.getTaskStore(!0),d,o,c;if(typeof g=='string'){g=b[g]}if(typeof h=='string'){h=b[h]}if(typeof i=='string'){i=b[i]}if(!a.ignoreParents){k=k.concat(b.getParentsOutgoingDependencies(r))}for(var m=0,t=k.length;m<t;m++){var e=k[m],f=e.getTargetTask(),l=!1,n;if(f){n=this.getDependencyCalendar(e,null,s);switch(e.getType()){case j.StartToStart:c=g.call(f,a);l=!0;break;case j.StartToEnd:c=h.call(f,a);l=!0;break;case j.EndToStart:c=g.call(f,a);break;case j.EndToEnd:c=h.call(f,a);break;}if(c){var q=e.getLag();if(q){c=n.skipWorkingTime(c,-q,e.getLagUnit())}if(l){c=b.startDateToEndDate(c)}if(i(o,c)){o=c;d=d||{};d.startDate=null;d.endDate=c;d.constrainingTask=f;d.constrainingDependency=e}}}}if(a.skipNonWorkingTime&&d){d.endDate=b.skipNonWorkingTime(d.endDate,!1)}return d},getEarlyLateDateCacheKey:function(b,a){if(typeof a=='string'){return a}return ''+b+'-'+this.internalId+'-'+(a.skipNonWorkingTime!==!1)+'-'+Boolean(a.ignoreCache)+'-'+Boolean(a.shallow)+'-'+(a.limitByConstraints!==!1)+'-'+Boolean(a.ignoreConstraint)+'-'+Boolean(a.ignoreParents)+'-'+(a.parentNode&&a.parentNode.getId())},getEarlyDateCachedValue:function(c,a){var b=this,d=a.taskStore||b.getTaskStore(!0);return d.getEarlyDateCachedValue(b.getEarlyLateDateCacheKey(c,a))},getLateDateCachedValue:function(c,a){var b=this,d=a.taskStore||b.getTaskStore(!0);return d.getLateDateCachedValue(b.getEarlyLateDateCacheKey(c,a))},processEarlyStartDateValue:function(a,c){var d=this,b=c.maxValue;if(c.options.skipNonWorkingTime&&d.getDuration()){a=d.skipNonWorkingTime(a,!0)}if(b&&a>=b){a=b}return a},getEarlyStartDate:function(b){b=b||{};delete b.translateTo;var c=this,t=b.skipNonWorkingTime!==!1,j=b.ignoreCache,g=b.taskStore||c.getTaskStore(!0),l=c.getEarlyLateDateCacheKey('es',b),p=g.getEarlyDateCachedValue(l);if(!j&&p){return p}if(!c.isMilestone()){b.skipNonWorkingTime=!1}var m=c.getEarlyDateCachedValue('es',b);var s=b.limitByConstraints!==!1,k=c.internalId,h=!1,d,f,e,q,a;if(!b.shallow){e=b.context||{calls:{}};e.calls.getEarlyStartDate=e.calls.getEarlyStartDate||{};if(e.calls.getEarlyStartDate[k]){return}e.calls.getEarlyStartDate[k]=!0;b.context=e}if(!g){a=c.getStartDate();h=!0}else {if(!j&&m){a=m}else {if(c.isProject||c.isManuallyScheduled()){a=c.getStartDate();h=!0}else {if(c.childNodes.length){Ext.each(c.childNodes,function(d){var c=d.getEarlyStartDate(b);if(c&&!a||c<a){a=c}})}else {var i=!1,n=b.ignoreConstraint===!0||!g.scheduleByConstraints;var r=c.getProject(),o=r?r.getStartDate():g.getProjectStartDate();if(!n){if(d=c.getInheritedConstraintRestrictions()){if(d.startDate){a=d.startDate;i=!0;h=!0}else {if(d.endDate){a=c.endDateToStartDate(d.endDate);i=!0}else {if(d.min){a=d.min.startDate}if(s&&d.max){q=d.max.startDate}}}}}if(!i){f=c.getIncomingDependenciesConstraintContext(b);if(n&&!f&&!a){a=c.getStartDate()||o}else {if(f&&(!a||f.startDate>a)){a=f.startDate}}}if(g.scheduleByConstraints&&!a){a=o}}}}}b.skipNonWorkingTime=t;if(a&&!h){a=c.processEarlyStartDateValue(a,{options:b,cacheKey:l,maxValue:q,dependencyLimits:f,constraintLimits:d})}!j&&g.setEarlyDateCachedValue(l,a);if(e){delete e.calls.getEarlyStartDate[k]}return a},processEarlyEndDateValue:function(g,d){var e=this,a=g,f=d.options,b=d.minValue,c=d.maxValue;if(c&&a>c){a=c}if(f.skipNonWorkingTime&&e.getDuration()&&(!b||a>b)){a=e.skipNonWorkingTime(a,!1)}if(b&&a<b){a=b}return a},getEarlyEndDate:function(a){a=a||{};delete a.translateTo;var c=this,s=a.skipNonWorkingTime!==!1,l=a.ignoreCache,i=a.taskStore||c.getTaskStore(!0),n=c.getEarlyLateDateCacheKey('ee',a),p=i.getEarlyDateCachedValue(n);if(!l&&p){return p}a.skipNonWorkingTime=!1;var o=c.getEarlyDateCachedValue('ee',a);var r=a.limitByConstraints!==!1,m=c.internalId,j=!1,d,g,b,e,f,h;if(!a.shallow){e=a.context||{calls:{}};e.calls.getEarlyEndDate=e.calls.getEarlyEndDate||{};if(e.calls.getEarlyEndDate[m]){return}e.calls.getEarlyEndDate[m]=!0;a.context=e}if(!i){b=c.getEndDate();j=!0}else {if(!l&&o){b=o}else {if(this.isProject||this.isManuallyScheduled()){b=this.getEndDate()}else {if(c.childNodes.length){Ext.each(c.childNodes,function(d){var c=d.getEarlyEndDate(a);if(c&&!b||c>b){b=c}})}else {var k=!1,t=a.ignoreConstraint===!0||!i.scheduleByConstraints;if(!t){if(d=c.getInheritedConstraintRestrictions({translateTo:'endDate'})){if(d.endDate){b=d.endDate;k=!0;j=!0}else {if(d.startDate){b=c.startDateToEndDate(d.startDate);k=!0}else {if(d.min){f=b=d.min.endDate}if(r&&d.max){h=d.max.endDate}}}}}if(!k){g=c.getIncomingDependenciesConstraintContext(Ext.apply({translateTo:'endDate'},a));if(g&&(!b||g.endDate>b)){f=b=g.endDate}}}}}}if(f&&h&&f>=h){f=null}if(!b){var q=c.getEarlyStartDate(a);if(q){b=c.startDateToEndDate(q)}}a.skipNonWorkingTime=s;if(b&&!j){b=c.processEarlyEndDateValue(b,{options:a,cacheKey:n,minValue:f,maxValue:h,dependencyLimits:g,constraintLimits:d})}!l&&i.setEarlyDateCachedValue(n,b);if(e){delete e.calls.getEarlyEndDate[m]}return b},processLateEndDateValue:function(f,c){var d=this,a=f,e=c.options,b=c.minValue;if(e.skipNonWorkingTime&&d.getDuration()){a=d.skipNonWorkingTime(a,!1)}if(b&&a<b){a=b}return a},getLateEndDate:function(b){b=b||{};var r=b.skipNonWorkingTime!==!1,c=this,g=b.taskStore||c.getTaskStore(!0),j=b.ignoreCache,q=b.limitByConstraints!==!1,l=c.getEarlyLateDateCacheKey('le',b),n=g.getLateDateCachedValue(l);if(!j&&n){return n}b.skipNonWorkingTime=!1;var m=c.getLateDateCachedValue('le',b);var k=c.internalId,h=!1,d,f,a,e,o;if(!b.shallow){e=b.context||{calls:{}};e.calls.getLateEndDate=e.calls.getLateEndDate||{};if(e.calls.getLateEndDate[k]){return}e.calls.getLateEndDate[k]=!0;b.context=e}if(!g){a=c.getEndDate();h=!0}else {if(!j&&m){a=m}else {if(this.isProject||this.isManuallyScheduled()){a=this.getEndDate();h=!0}else {if(c.childNodes.length){Ext.each(c.childNodes,function(d){var c=d.getLateEndDate(b);if(c&&!a||c>a){a=c}})}else {var s=b.ignoreConstraint===!0||!g.scheduleByConstraints,i=!1;var p=c.getProject(),t=p?p.getEndDate():g.getProjectEndDate();a=t;if(!s){if(d=c.getInheritedConstraintRestrictions({translateTo:'endDate'})){if(d.startDate){a=c.startDateToEndDate(d.startDate);i=!0}else {if(d.endDate){a=d.endDate;i=!0;h=!0}else {if(d.max){a=d.max.endDate}if(q&&d.min){o=d.min.endDate}}}}}if(!i){f=this.getOutgoingDependenciesConstraintContext(b);if(f&&(!a||f.endDate<a)){a=f.endDate}}}}}}b.skipNonWorkingTime=r;if(a&&!h){a=c.processLateEndDateValue(a,{options:b,cacheKey:l,minValue:o,dependencyLimits:f,constraintLimits:d})}!j&&g.setLateDateCachedValue(l,a);if(e){delete e.calls.getLateEndDate[k]}return a},processLateStartDateValue:function(e,c){var b=this,a=e,d=c.options;if(d.skipNonWorkingTime&&b.getDuration()){a=b.skipNonWorkingTime(a)}return a},getLateStartDate:function(a){a=a||{};var c=this,g=a.taskStore||c.getTaskStore(!0),k=a.skipNonWorkingTime!==!1,e=a.ignoreCache,f=c.getEarlyLateDateCacheKey('ls',a),i=g.getLateDateCachedValue(f),d=!1,b;if(!e&&i){return i}a.skipNonWorkingTime=!1;var h=c.getLateDateCachedValue('ls',a);if(!g){b=c.getStartDate();d=!0}else {if(!e&&h){b=h}else {if(this.isProject||this.isManuallyScheduled()){b=this.getStartDate();d=!0}else {if(c.childNodes.length){Ext.each(c.childNodes,function(d){var c=d.getLateStartDate(a);if(c&&!b||c<b){b=c}})}else {var j=this.getLateEndDate(a);if(j){b=this.endDateToStartDate(j)}}}}}a.skipNonWorkingTime=k;if(b&&!d){b=c.processLateStartDateValue(b,{options:a,cacheKey:f})}!e&&g.setLateDateCachedValue(f,b);return b},getTopParent:function(e){var d=this.getTaskStore().getRoot(),a=this,c=[this],b;while(a){if(a===d){return e?c:b}c.push(a);b=a;a=a.parentNode}},getInDepthWalker:function(e){var b=e?this:this.childNodes&&this.childNodes[0];var c=this;var a={};var d=function(f){var b=f;var e=b.internalId;if(b.isLeaf()||!b.childNodes.length){b=b.nextSibling}else {if(a[e]===!0){a[e]=!1;b=b.nextSibling}else {a[e]=!0;b=b.childNodes[0]}}if(!b){b=f;do{if(b===c){return null}b=b.parentNode;if(b===c){return null}}while(a[b.internalId]===!1);return d(b)}return b};return function(){var a=b;if(b){b=d(b)}return a}},initializePropagation:function(){var a=this.getTaskStore(!0),b;this.propagating=!0;if(a){a.suspendAutoSync();a.suspendEarlyDatesResetNotification();a.suspendLateDatesResetNotification();b=a.startBatchCascade();a.startProjection()}return {affectedTasks:{},cascadeBatch:b}},finalizePropagation:function(c,b,d){var a=this.getTaskStore(!0);if(a){if(c){a.rejectProjection();b={}}else {a.commitProjection()}a.endBatchCascade();a.resumeAutoSync(a.autoSync&&!c&&!Ext.Object.isEmpty(b));a.resumeEarlyDatesResetNotification();a.resumeLateDatesResetNotification()}this.propagating=!1;d&&d(c,b)},continutePropagateChanges:function(i,e,b,d,h){var a=this,c;c=a.getTaskStore(!0);if(c){if(b===!0){b=a.isProjected()&&[a]||!1}else {if(b){b=[].concat(b)}}if(b){var f=function(){a.propagateChangesThroughDependentTasks(c.getLinearWalkingSequenceForDependentTasks(b,{self:!0,ancestors:c.recalculateParents,descendants:c.moveParentAsGroup,successors:h,cycles:c.cycleResolutionStrategy}),c,i,b,h,e,function(c,b){a.finalizePropagation(c,b,d)})};var g=c.getPrePropagationConstraints(a);if(g.length){a.doVerifyConstraints(g,function onConstraintsVerifiedCallback(c,b){if(!b){f()}else {a.finalizePropagation(b,e,d)}})}else {f()}}else {a.finalizePropagation(!0,{},d&&function(){d(!1,{})})}}else {a.verifyConstraints(function(c,b){if(!b){e[a.getId()]=a}a.finalizePropagation(!!b,e,d)})}},propagateChanges:function(f,c,b,i){var a=this,g,e;e=a.getTaskStore(!0);if(typeof b!='boolean'){b=e&&e.cascadeChanges}if(a.propagating){c&&c(!0,{})}else {var d=a.initializePropagation(),h=[a];if(i){h.push(function(e){a.continutePropagateChanges(d.cascadeBatch,d.affectedTasks,e,c,b)})}try{g=f&&f!==Ext.emptyFn?f.apply(this,h):[a]}catch(j){a.finalizePropagation(!0);throw j}if(!i){a.continutePropagateChanges(d.cascadeBatch,d.affectedTasks,g,c,b)}}},propagateChangesThroughDependentTasks:function(b,i,h,g,f,l,j,d){var k=this,a,e,c;d=d||0;c=!0;for(a=d,e=b.length;c&&a<e;++a){c=k.processTaskConstraints(b,a,i,h,g,f,l,function(c,l,a,d){if(a||c==e-1){j(a,d)}else {if(!l){k.propagateChangesThroughDependentTasks(b,i,h,g,f,d,j,c+1)}}})}},processTaskConstraints:function(p,r,b,A,l,z,f,w){var B=this,x=p[r],a=x[0],c=x[1],e=a.hasChildNodes(),n=!e,u=a.isMarkedForRescheduling(),g=!(a.isManuallyScheduled()||a.isReadOnly()||Ext.Array.contains(l,a)),v=z||b.cascadeChanges,y=b.scheduleByConstraints,s=b.recalculateParents,t=b.moveParentAsGroup,d=a.parentNode,i=d&&d.getStartDate(),h=d&&d.getUnprojected(d.startDateField),q=d&&i-h,k=!1,j;function areIncomingDependenciesAffectedOrPropagationSourcesIncoming(i,h,g){var d=i.getIncomingDependencies(!0),c=!1,b,f,e,a;for(b=0,f=d.length;!c&&b<f;++b){e=d[b];a=e.getSourceTask();c=a&&h.hasOwnProperty(a.getId())||Ext.Array.contains(g,a)}return c}switch(!0){case g&&n&&c=='green'&&q&&t:case g&&e&&c=='yellow'&&q&&t:if(i){if(y){a.scheduleWithoutPropagation({taskStore:b})}else {var m=a.getStartDate();if(m>=h){j=a.calculateDuration(h,m,null,{segments:!1});a.setStartDateWithoutPropagation(a.calculateEndDate(i,j,null,{segments:!1}),!0,b.skipWeekendsDuringDragDrop)}else {j=a.calculateDuration(m,h,null,{segments:!1});a.setStartDateWithoutPropagation(a.calculateStartDate(i,j,null,{segments:!1}),!0,b.skipWeekendsDuringDragDrop)}areIncomingDependenciesAffectedOrPropagationSourcesIncoming(a,f,l)&&a.scheduleWithoutPropagation({taskStore:b,parentNode:d})}};break;case n&&c=='green'&&u:case e&&c=='yellow'&&u:a.scheduleWithoutPropagation({taskStore:b});break;case g&&n&&c=='green'&&v:case g&&e&&c=='yellow'&&v:if(areIncomingDependenciesAffectedOrPropagationSourcesIncoming(a,f,l)){a.scheduleWithoutPropagation({taskStore:b})}else {if(e&&s){k=!0}};break;case e&&c=='green'&&s:a.refreshCalculatedParentNodeData();break;}if(a.isProjected()){A.addAffected(a);f[a.getId()]=a}var o=function(d,h){var j,i;if(!d&&e&&g&&b.recalculateParents&&c=='green'){j=Ext.Array.findBy(p,function(b,e){var d=b[0],c=b[1];i=e;return a===d&&c=='yellow'});w(i,d,!!h,f)}else {w(r,d,!!h,f)}};if(k){o(!0,!1)}return k||a.verifyConstraints(o)},removeLinkToTask:function(d){var c=this.getDependencyStore();var a=this.getId();var b=d.getId();Ext.Array.each(this.getAllDependencies(),function(d){if(d.getSourceId()===a&&d.getTargetId()===b||d.getSourceId()===b&&d.getTargetId()===a){c.remove(d);return !1}})},convertEmptyParentToLeafTask:function(){this.beginEdit();this.set('leaf',!0);this.setDurationWithoutPropagation(1,this.getDurationUnit());this.endEdit()},hasEndPredecessorsButNoStartPredecessors:function(){var a=this.getIncomingDependencies();var b=a.length>0;var c=Gnt.model.Dependency.Type;Ext.Array.each(a,function(a){if(a.getType()===c.StartToStart||a.getType()===c.EndToStart){return b=!1}});return b},isCompleted:function(){return this.getPercentDone()>=100},isStarted:function(){return this.getPercentDone()>0},isInProgress:function(){return this.isStarted()&&!this.isCompleted()},autoCalculateLag:function(){var a=this.getDependencyStore();if(!a||!a.autoCalculateLag||!this.hasIncomingDependencies()){return}var c=this.getIncomingDependencies();for(var b=0;b<c.length;b++){a.updateAutoCalculatedLag(c[b])}}});Ext.define('Gnt.model.task.Constraints',{requires:['Gnt.constraint.Base','Gnt.constraint.StartNoEarlierThan','Gnt.constraint.StartNoLaterThan','Gnt.constraint.FinishNoEarlierThan','Gnt.constraint.FinishNoLaterThan','Gnt.constraint.MustStartOn','Gnt.constraint.MustFinishOn','Gnt.constraint.implicit.Dependency','Gnt.constraint.implicit.PotentialConflict'],setConstraint:function(f,e,d){var a=this,b=a.getTaskStore(!0),c=b&&b.scheduleByConstraints;function changer(){var b=a.setConstraintWithoutPropagation(f,e);c&&a.scheduleWithoutPropagation();return b}a.propagateChanges(changer,d)},setConstraintWithoutPropagation:function(e,c){var a=this,b=a.getTaskStore(!0),f=b&&b.scheduleByConstraints,d;if(e){d=Gnt.constraint.Base.getConstraintClass(e)}if(!c&&d){c=d.getInitialConstraintDate(a,c)}a.beginEdit();a.set(a.constraintTypeField,e||'');a.set(a.constraintDateField,c);if(f){b.resetEarlyDates();b.resetLateDates()}a.endEdit();return !0},setConstraintType:function(b,a){this.setConstraint(b,this.getConstraintDate(),a)},setConstraintTypeWithoutPropagation:function(b,a){this.setConstraintWithoutPropagation(b,this.getConstraintDate(),a)},setConstraintDate:function(b,a){this.setConstraint(this.getConstraintType(),b,a)},setConstraintDateWithoutPropagation:function(a){this.setConstraintWithoutPropagation(this.getConstraintType(),a)},hasConstraint:function(){return !!this.getConstraintType()},getConstraintClass:function(){return Gnt.constraint.Base.getConstraintClass(this.getConstraintType())},isConstraintSatisfied:function(){var a=this;return !a.hasConstraint()||a.getConstraintClass().isSatisfied(a,a.getConstraintDate())},getDependencyConstraintClass:function(){return Gnt.constraint.implicit.Dependency},getPotentialConflictConstraintClass:function(){return Gnt.constraint.implicit.PotentialConflict},isDependencyConstraintSatisfied:function(){var a=this.getTaskStore(!0),b=a&&a.checkDependencyConstraint;return !b||this.getDependencyConstraintClass().isSatisfied(this)},getConstraintClasses:function(){return [this.getConstraintClass()]},verifyConstraints:function(a){return this.doVerifyConstraints(this.getConstraintClasses(),a)},doVerifyConstraints:function(i,f,l){var a=this,g=a.getTaskStore(!0),k=g&&g.hasListener('constraintconflict'),e,c,b,j,d;for(var h=0;h<i.length;h++){b=i[h];if(b&&b.hasThisConstraintApplied(a)){c=b.isSatisfied(a,a.getConstraintDate());if(!c&&b.canResolve(a,a.getConstraintDate())){b.resolve(a,a.getConstraintDate());c=!0}}else {c=!0}if(f){d=l?f:Ext.Function.pass(f,[c])}if(!c&&b){j=d&&function(b){if(b){a._doVerifyConstraintsWatcher=null;d.apply(this,arguments)}else {a.doVerifyConstraints(a.getConstraintClasses(),d,!0)}};e=b.getResolution(j,a,null);a._doVerifyConstraintsWatcher=a._doVerifyConstraintsWatcher||{};if(a._doVerifyConstraintsWatcher[b.getId()]){e.cancelAction();break}a._doVerifyConstraintsWatcher[b.getId()]=!0;if(k){g.fireEvent('constraintconflict',a,e)}else {e.defaultAction()}break}}if(c){a._doVerifyConstraintsWatcher=null;d&&d(!1)}return c}});Ext.define('Gnt.model.task.Splittable',{uses:['Gnt.model.TaskSegment'],segmentsTrackingSuspended:0,changingTaskBySegments:!1,segmentsSnapshot:null,segmentsProjection:null,getFirstSegment:function(){var a=this.getSegments();return a&&a[0]},getLastSegment:function(){var a=this.getSegments();return a&&a[a.length-1]},normalizeSegments:function(){var a=this.getSegments();this.suspendSegmentsTracking();a.sort(function(a,b){if(!a.normalized){a.normalize()}if(!b.normalized){b.normalize()}return a.getStartDate()>b.getStartDate()?1:-1});this.mergeOverlappedSegments();if(this.getSegments()){this.data[this.durationField]=this.getSegmentsDuration()}this.resumeSegmentsTracking()},updateSegmentsDates:function(a){a=a||{};if(!this.isSegmented()){return}this.suspendSegmentsTracking();a=Ext.apply({useAbsoluteOffset:!1},a);a.isForward=a.isForward!==!1;var b=!1;this.forEachSegment(function(c){c.updateDatesByOffsets(a);b=b||Boolean(c.modified)},a.isForward);if(b){this.set(this.segmentsField,this.getSegments().slice())}this.resumeSegmentsTracking()},getSegmentIntervalsForRange:function(d,e,a){a=a||this.getSegments();if(!a){return}var c=Sch.util.Date,b=[];for(var f=0,j=a.length;f<j;f++){var i=a[f],g=i.getStartDate(),h=i.getEndDate();if(c.intersectSpans(d,e,g,h)){b.push([c.constrain(g,d,e)-0,c.constrain(h,d,e)-0])}}return b.length&&b||null},getSegmentByDate:function(d,a){a=a||this.getSegments();if(!a){return}for(var c=0,e=a.length;c<e;c++){var b=a[c];if(d>=b.getStartDate()&&d<b.getEndDate()){return b}}},constrainSegments:function(h){if(this.changingTaskBySegments){return}h=h||{};var b=this.getSegments();if(!b){return}var l=this.getDuration('MILLI'),o=h.unit||this.getDurationUnit(),a=h.duration,q=this.getStartDate(),d=this.getEndDate(),m=this.getUnitConverter();if(!q||!d&&!l&&!a){this.set(this.segmentsField,null);return}if(a){a=m.convertDurationToMs(a,o)}else {if(!d){a=l}}this.suspendSegmentsTracking();b[0].setStartDateWithoutPropagation(this.getStartDate(),!1);var f=[],e=a,g,r;var j;if(a){j=function(){return e<=0}}else {j=function(a){return a.getStartDate()>=d}}for(var i=0,s=b.length;i<s;i++){g=b[i];if(j(g)){f.push.apply(f,b.slice(i));break}e-=g.getDuration('MILLI');r=g}this.removeSegments(f);if(b.length<2){this.set(this.segmentsField,null)}else {var c=this.getLastSegment();var k=!1;if(a){if(e){c.setDurationWithoutPropagation(m.convertMSDurationToUnit(c.getEndOffset()-c.getStartOffset()+e,c.getDurationUnit()));k=!0}}else {if(c.getEndDate()-d){c.setEndDateWithoutPropagation(d,!1);k=!0}}var n=this.getTaskStore(!0),p=n&&n.isProjecting();if((f.length||k)&&(p||!this.modified||!this.modified[this.segmentsField])){this.set(this.segmentsField,this.getSegments().slice())}}this.resumeSegmentsTracking()},forEachSegment:function(e,f,d,c){if(!e){return}c=c||this;var b,a;if(f!==!1){b='getNextSegment';a=d||this.getFirstSegment()}else {b='getPrevSegment';a=d||this.getLastSegment()}while(a){if(e.call(c,a)===!1){return}a=a[b].call(a)}},split:function(f,e,g,d,b){var c=this,a;c.propagateChanges(function(){return c.splitWithoutPropagation(f,e,g,d,function cancelFeedback(b){a=b})},function(c,d){c&&a&&a();b&&b(c,d)})},splitWithoutPropagation:function(j,q,r,g,s){var a=this;if(g!==!0&&g!==!1){var u=a.getTaskStore(!0);g=u?u.skipWeekendsDuringDragDrop:!1}if(!j||!a.isLeaf()||a.isMilestone()){return}var l=a.getStartDate(),v=a.getEndDate();if(!l||!v||l>=j||j>=v){return}var d=a.getSegments(),b;var x=a.buildSegmentsSnapshot(d);if(d){b=a.getSegmentByDate(j);if(!b){return}}else {d=[]}q=q||1;r=r||this.getDurationUnit();var w=new Date(j),i=w,e=w,p=a.getUnitConverter().convertDurationToMs(q,r);if(g){e=a.skipNonWorkingTime(e,!0,!0);i=a.skipNonWorkingTime(i,!1,!0)}var k=a.getDurationUnit(),h=Ext.ClassManager.get(a.segmentClassName).prototype,f,n,c;a.suspendSegmentsTracking();var o=!0;if(!b){f=a.calculateDuration(l,i);n=a.getDuration()-f;c={task:a};c[h.startDateField]=l;c[h.durationField]=f;c[h.durationUnitField]=k;d.push(Ext.create(a.segmentClassName,c))}else {f=a.calculateDuration(b.getStartDate(),i,k);n=b.getDuration(k)-f;o=!!f;var m;if(o){b.setEndDateWithoutPropagation(i,!1,g);m=b.getNextSegment()}else {m=b}if(m){a.forEachSegment(function(a){a.setStartEndOffset(a.getStartOffset()+p,a.getEndOffset()+p);a.updateDatesByOffsets()},!0,m)}}if(o){e=a.skipWorkingTime(e,p);if(g){e=a.skipNonWorkingTime(e)}c={prevSegment:b||d[0],task:a};c[h.startDateField]=e;c[h.durationField]=n;c[h.durationUnitField]=k;var t=Ext.create(a.segmentClassName,c);if(b){Ext.Array.insert(d,Ext.Array.indexOf(d,b)+1,[t])}else {d.push(t)}}a.resumeSegmentsTracking();s&&s(function(){a.rollbackSegmentsToSnapshot(x);a.onSegmentsChanged(null,null)});if(!b){a.setSegmentsWithoutPropagation(d)}else {a.onSegmentsChanged(null,null)}return !0},merge:function(c,d,b){var a=this;a.propagateChanges(function(){return a.mergeWithoutPropagation(c,d)},b)},mergeWithoutPropagation:function(a,b){if(!this.isSegmented()||!a||!b){return}var d,c;if(a.getStartOffset()>b.getStartOffset()){d=b;c=a}else {d=a;c=b}d.setEndDateWithoutPropagation(c.getEndDate(),!1);return !0},suspendSegmentsTracking:function(){this.segmentsTrackingSuspended++},resumeSegmentsTracking:function(){this.segmentsTrackingSuspended--},getSegmentsDuration:function(a){a=a||this.getDurationUnit();var d=this.getSegments();var c=0;for(var b=0,f=d.length;b<f;b++){var e=d[b];c+=e.getEndOffset()-e.getStartOffset()}return this.getUnitConverter().convertMSDurationToUnit(c,a)},mergeOverlappedSegments:function(f){var b=this.getSegments();if(b){var e=[],c=b[0],a;for(var d=1,g=b.length;d<g;d++){a=b[d];if(a.getStartOffset()<=c.getEndOffset()){e.push(a);if(a.getEndOffset()>c.getEndOffset()){c.setEndDateWithoutPropagation(a.getEndDate(),!1)}}else {c=a}}this.removeSegments(e);if(b.length<2&&!f){this.setSegmentsWithoutPropagation(null)}}},onSegmentEditBegin:function(a){this.getTreeStore().onSegmentEditBegin(this,a);this.snapshotSegments()},onSegmentEditEnd:function(a){this.getTreeStore().onSegmentEditEnd(this,a)},onSegmentsChanged:function(c,a){if(this.segmentsTrackingSuspended){return}this.changingTaskBySegments=!0;this.suspendSegmentsTracking();this.mergeOverlappedSegments(!0);if(c&&a&&c.durationField in a){this.setDurationWithoutPropagation(this.getSegmentsDuration())}else {if(this.getSchedulingMode()=='EffortDriven'){this.setStartEndDateWithoutPropagation(this.getStartDate(),this.recalculateEndDate())}else {this.setStartDateWithoutPropagation(this.getStartDate())}}var b=this.getSegments();this.set(this.segmentsField,b&&b.slice()||null);this.resumeSegmentsTracking();this.changingTaskBySegments=!1},removeSegments:function(a){var c=this.getSegments();if(c&&a){if(!Ext.isArray(a)){a=[a]}if(a.length){for(var b=0,d=a.length;b<d;b++){Ext.Array.remove(c,a[b])}this.onSegmentsChanged()}}},setSegments:function(c,b){var a=this;a.propagateChanges(function(){return a.setSegmentsWithoutPropagation(c)},b)},setSegmentsWithoutPropagation:function(a){this.onSegmentEditBegin();this.suspendSegmentsTracking();this.set(this.segmentsField,this.processSegmentsValue(a));this.resumeSegmentsTracking();this.onSegmentsChanged();this.onSegmentEditEnd();return !0},processSegmentsValue:function(a){var c,b,e;if(a){a=[].concat(a);c=[];for(var d=0,f=a.length;d<f;d++){b=a[d];if(!(b instanceof Gnt.model.TaskSegment)){b=Ext.create(this.segmentClassName,Ext.apply(b,{task:this}))}c.push(b);e=b}a=c&&c.length>1&&c||null}return a},isSegmented:function(){return Boolean(this.getSegments())},getSegment:function(a){return this.getSegments()[a]},rejectSegmentsProjection:function(){var d=this.getTaskStore(!0).getProjectionLevel();var c,a;if(this.segmentsProjection){var b;for(a=d;a>=0;a--){if(c=this.segmentsProjection[a]){b=a;break}}if(b===d){delete this.segmentsProjection[b]}}if(c){this.rollbackSegmentsToSnapshot(c)}},commitSegmentsProjection:function(){var a=this.getTaskStore(!0),b=a&&a.getProjectionLevel();if(this.segmentsProjection){delete this.segmentsProjection[b]}},rollbackSegmentsToSnapshot:function(a){this.data[this.segmentsField]=a&&Ext.Array.map(a,function(a){return a&&a[0].readSnapshot(a)})},buildSegmentsSnapshot:function(a){a=a||this.getSegments();return a&&Ext.Array.map(a,function(a){return a&&a.buildSnapshot()})},getSegmentsSnapshot:function(){return this.segmentsSnapshot},setSegmentsSnapshot:function(a){this.segmentsSnapshot=a;this.hasSegmentsSnapshot=!0},resetSegmentsSnapshot:function(){this.segmentsSnapshot=null;this.hasSegmentsSnapshot=!1},snapshotSegments:function(){var c=this.getTaskStore(!0),d=this.getSegments(),b=c&&c.getProjectionLevel(),a;if(b){this.segmentsProjection=this.segmentsProjection||{};a=this.segmentsProjection[b-1];if(!a){a=this.buildSegmentsSnapshot(d);this.segmentsProjection[b-1]=a}}if(!this.hasSegmentsSnapshot){this.setSegmentsSnapshot(a||this.buildSegmentsSnapshot(d))}},commitSegments:function(){if(this.rejecting){return}this.resetSegmentsSnapshot();var a=this.getSegments();if(a){for(var b=0,c=a.length;b<c;b++){a[b].commit()}}},rejectSegments:function(){this.hasSegmentsSnapshot&&this.rollbackSegmentsToSnapshot(this.getSegmentsSnapshot());this.resetSegmentsSnapshot();var a=this.getSegments();if(a){for(var b=0,c=a.length;b<c;b++){a[b].reject()}}}});Ext.define('Gnt.model.task.Effort',{calculateActualEffort:function(){var a=this.get(this.effortField);return a!=null?a*this.getPercentDone()/100:null},calculateEffortVariance:function(){var a=this.get(this.effortField);return a!=null?a-this.getBaselineEffort():null},setBaselineEffort:function(c,d){var a=this,b=a.getEffortUnit();a.beginEdit();a.set(a.baselineEffortField,a.getUnitConverter().convertDuration(c,d||b,b));a.setEffortVariance(a.calculateEffortVariance());a.endEdit();return !0},setActualEffort:function(c,d,b){var a=this;a.propagateChanges(function(){return a.setActualEffortWithoutPropagation(c,d)},b)},processActualEffortValue:function(b){var a=this,c=a.getEffort();if(b>c){if(!c&&a.getPercentDone()){a.set(a.effortField,b*100/a.getPercentDone())}else {a.set(a.effortField,b)}a.setEffortVariance(a.calculateEffortVariance())}return b},setActualEffortWithoutPropagation:function(b,g){var a=this,c=a.getEffortUnit(),f=a.getUnitConverter();b=f.convertDuration(b,g||c,c);a.beginEdit();b=a.processActualEffortValue(b);a.set(a.actualEffortField,b);var d=a.getEffort(),e=d?Math.min(100,100*b/d):0;a.set(a.percentDoneField,e);a.recalculateCost();a.endEdit();return !0}});Ext.define('Gnt.model.task.Cost',{recalculateCost:function(){var a=this;if(!a.autoCalculateCost){return !1}a.beginEdit();a.setActualCost(a.calculateActualCost());a.setCost(a.calculateCost());a.endEdit();return !0},calculateActualCost:function(){var a=this.getEffort(),c=this.getActualEffort(),b=0;if(a){b=this.calculateResourcesCost(!0)*c/a+this.calculateResourcesPerUseCost()}return b},calculateCostVariance:function(){return this.getCost()-this.getBaselineCost()},calculateCost:function(){var d=this,a=d.getEffort(),c=0;if(a){var g=this.getActualEffort(),b=this.getActualCost();var e=a-g,f=d.calculateResourcesCost(!!b)*e/a;c=b+f}return c},setBaselineCost:function(b){var a=this;a.beginEdit();a.set(a.baselineCostField,b);a.setCostVariance(a.calculateCostVariance());a.endEdit();return !0},setCost:function(b){var a=this;a.beginEdit();a.set(a.costField,b);a.setCostVariance(a.calculateCostVariance());a.endEdit();return !0},calculateResourcesCost:function(h){var b=0,i=this.getEffort();if(i){var d=this.getAssignments(),g=0,e=0;for(var c=0;c<d.length;c++){var a=d[c],f=a.getResource();if(f&&a.getTask()){g+=a.getCost();e+=f.getPerUseCost()}}b=g;if(!h){b+=e}}return b},calculateResourcesPerUseCost:function(){var b=this.getAssignments(),d=0;for(var a=0;a<b.length;a++){var c=b[a].getResource();if(c){d+=c.getPerUseCost()}}return d}});Ext.define('Gnt.model.Task',{extend:'Sch.model.Range',alias:'gntmodel.event',requires:['Sch.util.Date','Ext.data.NodeInterface'],uses:['Gnt.model.TaskSegment'],mixins:['Gnt.model.mixin.ProjectableModel','Gnt.model.task.More','Gnt.model.task.Constraints','Gnt.model.task.Splittable','Gnt.model.task.Effort','Gnt.model.task.Cost'],segmentClassName:'Gnt.model.TaskSegment',idProperty:'Id',customizableFields:[{name:'Duration',type:'number',allowNull:!0},{name:'Effort',type:'number',allowNull:!0},{name:'EffortUnit',type:'string',defaultValue:'h'},{name:'ActualEffort',type:'number',allowNull:!0},{name:'EffortVariance',type:'number',allowNull:!0},{name:'CalendarId',type:'string'},{name:'Note',type:'string'},{name:'DurationUnit',type:'string',defaultValue:'d',convert:function(a){return a||Sch.util.Date.DAY}},{name:'PercentDone',type:'number',defaultValue:0},{name:'Cost',type:'number',allowNull:!0},{name:'ActualCost',type:'number',allowNull:!0},{name:'CostVariance',type:'number',allowNull:!0},{name:'ConstraintType',type:'string',defaultValue:''},{name:'ConstraintDate',type:'date',dateFormat:'c'},{name:'ManuallyScheduled',type:'boolean',defaultValue:!1},{name:'SchedulingMode',type:'string',defaultValue:'Normal'},{name:'BaselineStartDate',type:'date',dateFormat:'c'},{name:'BaselineEndDate',type:'date',dateFormat:'c'},{name:'BaselinePercentDone',type:'int',defaultValue:0},{name:'BaselineEffort',type:'number',allowNull:!0},{name:'BaselineCost',type:'number',allowNull:!0},{name:'Draggable',type:'boolean',persist:!1,defaultValue:!0},{name:'Resizable',persist:!1,defaultValue:''},{name:'ReadOnly',persist:!1,type:'bool',defaultValue:!1},{name:'Rollup',type:'boolean',defaultValue:!1},{name:'Segments',persist:!0,convert:function(b,a){return a.processSegmentsValue(b,a)},serialize:function(a){if(!a){return null}return Ext.Array.map([].concat(a),function(a){return a.serialize()})}},{name:'PhantomId',type:'string'},{name:'PhantomParentId',type:'string'},{name:'ShowInTimeline',type:'bool'},{name:'DeadlineDate',type:'date',dateFormat:'c'},{name:'index',type:'int',persist:!0}],fields:[{name:'needsRescheduling',type:'bool',persist:!1}],constraintTypeField:'ConstraintType',constraintDateField:'ConstraintDate',draggableField:'Draggable',resizableField:'Resizable',nameField:'Name',durationField:'Duration',durationUnitField:'DurationUnit',effortField:'Effort',effortUnitField:'EffortUnit',actualEffortField:'ActualEffort',effortVarianceField:'EffortVariance',costField:'Cost',actualCostField:'ActualCost',costVarianceField:'CostVariance',percentDoneField:'PercentDone',manuallyScheduledField:'ManuallyScheduled',schedulingModeField:'SchedulingMode',rollupField:'Rollup',calendarIdField:'CalendarId',baselineStartDateField:'BaselineStartDate',baselineEndDateField:'BaselineEndDate',baselinePercentDoneField:'BaselinePercentDone',baselineEffortField:'BaselineEffort',baselineCostField:'BaselineCost',noteField:'Note',segmentsField:'Segments',readOnlyField:'ReadOnly',calendar:null,dependencyStore:null,taskStore:null,phantomIdField:'PhantomId',phantomParentIdField:'PhantomParentId',showInTimelineField:'ShowInTimeline',deadlineDateField:'DeadlineDate',normalized:!1,recognizedSchedulingModes:['Normal','FixedDuration','EffortDriven','DynamicAssignment'],ignoreResourceCalendarsForSchedulingMode:null,convertEmptyParentToLeaf:!0,autoCalculateEffortForParentTask:!0,autoCalculatePercentDoneForParentTask:!0,autoCalculateCostForParentTask:!0,autoCalculateCost:!0,isHighlighted:!1,calendarWaitingListener:null,childTasksDuration:null,completedChildTasksDuration:null,totalCount:null,predecessors:null,successors:null,removeChildIsCalledFromReplaceChild:!1,savedDirty:null,useOwnCalendarAsConverter:!1,constructor:function(){this._singleProp={};this.initProjectable();this.callParent(arguments);if(this.phantom){this.data[this.phantomIdField]=this.getId()}if(this.id==='root'){this.convertEmptyParentToLeaf=!1}this.predecessors=[];this.successors=[]},normalize:function(){var f=this.getDurationUnit(),c=this.getStartDate(),a=this.getEndDate(),b=this.data,n=this.getTaskStore(!0),g=this.getSchedulingMode();if(g=='Manual'){g=b[this.schedulingModeField]='Normal';b[this.manuallyScheduledField]=!0}var e=this.endDateField;if(n&&this.isSegmented()){this.normalizeSegments();var m;if(m=this.getLastSegment()){a=b[e]=m.getEndDate()}}var d=this.getDuration();var i=this.effortField;if(a&&this.inclusiveEndDate){var l=this.getField(e).dateFormat;var o=l&&!Ext.Date.formatContainsHourInfo(l)||a.getHours()===0&&a.getMinutes()===0&&a.getSeconds()===0&&a.getMilliseconds()===0;if(o){if(Ext.isNumber(d)){a=b[e]=this.calculateEndDate(c,d,f)}else {a=b[e]=Ext.Date.add(a,Ext.Date.DAY,1)}}}if(d==null&&c&&a){d=b[this.durationField]=this.calculateDuration(c,a,f)}if((g=='Normal'||this.isManuallyScheduled())&&a==null&&c&&Ext.isNumber(d)){a=b[e]=this.calculateEndDate(c,d,f)}var h=this.get(i),j=this.getEffortUnit();switch(g){case 'FixedDuration':if(a==null&&c&&Ext.isNumber(d)){a=b[e]=this.calculateEndDate(c,d,f)};if(h==null&&c&&a){b[i]=this.calculateEffort(c,a,j)};break;case 'EffortDriven':if(h==null&&c&&a){b[i]=this.calculateEffort(c,a,j)};if(a==null&&c&&h){b[e]=this.calculateEffortDrivenEndDate(c,h,j);if(d==null){b[this.durationField]=this.calculateDuration(c,b[e],f)}};break;default:if(a==null&&c&&Ext.isNumber(d)){a=b[e]=this.calculateEndDate(c,d,f)};break;}if(this.getActualEffort()==null){b[this.actualEffortField]=this.calculateActualEffort()}if(this.autoCalculateCost){if(this.getActualCost()==null){b[this.actualCostField]=this.calculateActualCost()}if(this.getCost()==null){b[this.costField]=this.calculateCost()}}if(this.getCostVariance()==null){this.data[this.costVarianceField]=this.calculateCostVariance()}if(this.getEffortVariance()==null){this.data[this.effortVarianceField]=this.calculateEffortVariance()}var k=this.getCalendarId();if(k){this.setCalendarId(k,!0)}this.normalized=!0},getUnitConverter:function(){var b=this.getTaskStore(!0),c=this.getProject(),a=this.getCalendar();return this.useOwnCalendarAsConverter&&a||(b||c)&&this.getProjectCalendar()||a},normalizeParent:function(){var l=this.childNodes;var k=0;var c=0;var i=0;var q=0;var p=0;var e=this.autoCalculatePercentDoneForParentTask;var g=this.autoCalculateEffortForParentTask;var o=this.autoCalculateCostForParentTask;var f=l.length>0;var h=!1;for(var n=0;n<l.length;n++){var a=l[n];var m=a.isLeaf();if(!m){a.normalizeParent()}if(g){k+=a.getEffort('MILLI')}if(o){q+=a.getCost();p+=a.getActualCost()}if(e){var d=m?a.getDuration('MILLI')||0:a.childTasksDuration,j=a.getPercentDone()||0;c+=d;i+=m?d*j:a.completedChildTasksDuration;h=h||d===0&&j<100;f=f&&d===0&&j>=100}}if(e){var b=0;this.childTasksDuration=c;this.completedChildTasksDuration=i;if(c>0){b=i/c;if(b===100&&h){b=99}}else {if(f){b=100}}if(this.getPercentDone()!=b){this.data[this.percentDoneField]=b}}if(g){if(this.getEffort('MILLI')!=k){this.data[this.effortField]=this.getUnitConverter().convertMSDurationToUnit(k,this.getEffortUnit())}}if(e&&g){this.data[this.actualEffortField]=this.calculateActualEffort()}if(o){this.data[this.actualCostField]=p;this.data[this.costField]=q}this.data[this.costVarianceField]=this.calculateCostVariance();this.data[this.effortVarianceField]=this.calculateEffortVariance()},getCalendar:function(a){return a?this.getOwnCalendar():this.getOwnCalendar()||this.parentNode&&this.parentNode.getCalendar()||this.getProjectCalendar()},getOwnCalendar:function(){var a=this.get(this.calendarIdField);return a?Gnt.data.Calendar.getCalendar(a):this.calendar},getProject:function(){var b=this,a=null;if(this.isProject){return this}this.bubble(function(c){if(b!==c&&c.isProject){a=c;return !1}},this);return a},getProjectCalendar:function(c){var b=this.getTaskStore(!0);var a=b&&b.getCalendar()||this.parentNode&&this.parentNode.getProjectCalendar()||this.isRoot()&&this.calendar||c;if(!a){Ext.Error.raise("Can't find a project calendar in `getProjectCalendar`")}return a},setCalendar:function(a,c){var d=this,b=a instanceof Gnt.data.Calendar;if(b&&!a.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}return d.setCalendarId(b?a.calendarId:a,!1,c)},setCalendarId:function(c,a,d){var b=this;if(!a){b.propagateChanges(function(){return b.setCalendarIdWithoutPropagation(c,a)},d)}else {b.setCalendarIdWithoutPropagation(c,a)}},onCalendarChange:function(a){if(!this.isReadOnly()&&this.isTaskStored()){this.adjustToCalendarWithoutPropagation()}},setCalendarIdWithoutPropagation:function(a,f){var g=!1;if(a instanceof Gnt.data.Calendar){a=a.calendarId}var d=this.getCalendarId();if(d!=a||f){g=!0;if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var c={calendarchange:this.onCalendarChange,scope:this};var e=this.calendar||Gnt.data.Calendar.getCalendar(d);this.calendar=null;e&&e.un(c);this.set(this.calendarIdField,a);var b=Gnt.data.Calendar.getCalendar(a);if(b){b.on(c);if(!f){this.onCalendarChange()}}else {this.calendarWaitingListener=Ext.data.StoreManager.on('add',function onCalendarWaitingStoreManagerAdd(){b=Gnt.data.Calendar.getCalendar(a);if(this.isTaskStored()){if(b){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;b.on(c);this.onCalendarChange()}else {this.calendarWaitingListener=Ext.data.StoreManager.on('add',onCalendarWaitingStoreManagerAdd,this,{destroyable:!0,single:!0})}}},this,{destroyable:!0,single:!0})}}return g},getDependencyStore:function(){var a=this.getTaskStore(!0),b=a&&a.getDependencyStore();return b},getResourceStore:function(){var a=this.getTaskStore(!0);return a&&a.getResourceStore()},getAssignmentStore:function(){var a=this.getTaskStore(!0);return a&&a.getAssignmentStore()},getTaskStore:function(b){var a=this;if(!a.taskStore){a.taskStore=a.getTreeStore()||a.parentNode&&a.parentNode.getTaskStore(b)}if(!a.taskStore&&!b){Ext.Error.raise("Can't find a taskStore in `getTaskStore`")}return a.taskStore},getEventStore:function(){return this.getTaskStore()},setTaskStore:function(a){this.taskStore=a},isManuallyScheduled:function(){return this.get(this.manuallyScheduledField)||this.isCompleted()},isShowInTimeline:function(){return Boolean(this.getShowInTimeline())},setManuallyScheduled:function(c,b){var a=this;a.propagateChanges(function(){return a.setManuallyScheduledWithoutPropagation(c)},b)},setManuallyScheduledWithoutPropagation:function(b){var a=this;var c=a.isManuallyScheduled();if(a.getManuallyScheduled()!=b){this.set(a.manuallyScheduledField,b)}if(c&&!a.isManuallyScheduled()){a.markForRescheduling()}return !0},setSchedulingMode:function(c,b){var a=this;a.propagateChanges(function(){return a.setSchedulingModeWithoutPropagation(c)},b)},setSchedulingModeWithoutPropagation:function(c){var a=this,b;if(a.getSchedulingMode()!=c){a.set(this.schedulingModeField,c);switch(c){case 'FixedDuration':a.updateEffortBasedOnDuration();break;case 'EffortDriven':a.updateSpanBasedOnEffort();break;}var d=a.getPredecessors();if(d.length){b=d[0]}else {b=a}}return b},skipWorkingTime:function(a,i,b,j){if(!a){return a}var f;var c;b=b!==!1;var e=this,g=e.getSchedulingMode(),h=e.shouldUseResourceCalendarsForSchedulingMode(g);var d={isForward:b,segments:j||!1,resources:h&&e.hasResources(),fn:function(a,d){var e=d-a,g=(new Date(a)).getTimezoneOffset()-(new Date(d)).getTimezoneOffset();if(e>=c){f=new Date((b?a:d)-0+(b?1:-1)*c);return !1}else {c-=e+g*60*1000}}};if(Ext.isObject(a)){Ext.apply(d,a)}else {if(b){d.startDate=a}else {d.endDate=a}}c=i||d.duration;if(!c){return a}e.forEachAvailabilityInterval(d);return f},skipNonWorkingTime:function(a,b,h){if(!a){return a}var e=!1;b=b!==!1;var c=this,f=c.getSchedulingMode(),g=c.shouldUseResourceCalendarsForSchedulingMode(f);var d={isForward:b,segments:h||!1,resources:g&&c.hasResources(),fn:function(c,d){if(c!==d){a=b?c:d;e=!0;return !1}}};if(Ext.isObject(a)){Ext.apply(d,a)}else {if(b){d.startDate=a}else {d.endDate=a}}c.forEachAvailabilityInterval(d);return e?new Date(a):c.getCalendar().skipNonWorkingTime(a,b)},setStartDate:function(e,c,b,d){var a=this;a.propagateChanges(function(g,d){var f=a.setStartDateWithoutPropagation(e,c,b);a.maybePinWithoutPropagation(function(){d(f)})},d,null,!0)},setStartDateWithoutPropagation:function(b,f,c){var a=this,e=a.getTaskStore(!0),g,d;f=f!==!1;if(e&&c!==!0&&c!==!1){c=e.skipWeekendsDuringDragDrop}else {if(c!==!0&&c!==!1){c=!1}}a.autoCalculateLag();a.beginEdit();if(!b){a.set(a.durationField,null);a.set(a.startDateField,null);a.setSegmentsWithoutPropagation(null)}else {if(c&&!(a.isMilestone()&&e&&e.scheduleByConstraints)){b=a.skipNonWorkingTime(b,!a.isMilestone())}a.set(a.startDateField,b);if(e&&a.isSegmented()){a.updateSegmentsDates()}if(f!==!1){a.set(a.endDateField,a.recalculateEndDate(b))}else {d=this.getEndDate();if(d){this.constrainSegments();a.set(a.durationField,a.calculateDuration(b,d,a.getDurationUnit()))}}}g=a.getDuration();d=a.getEndDate();if(b&&d&&(g===undefined||g===null)){a.set(a.durationField,a.calculateDuration(b,d,a.getDurationUnit()))}a.onPotentialEffortChange();a.endEdit();return !0},getPinConstraintType:function(a){a=a||this.getTaskStore(!0);var b=a&&a.isBackwardScheduled();return b?'finishnolaterthan':'startnoearlierthan'},pinWithoutPropagation:function(d){var a=this,c=a.getTaskStore(!0),b=a.getPinConstraintType(c);a.setConstraintWithoutPropagation(b,d)},maybePinWithoutPropagation:function(b){var a=this,c=a.getTaskStore(!0);if(c&&c.scheduleByConstraints&&!c.isBackwardScheduled()&&a.getStartDate()){var d=a.getDependencyConstraintClass();if(c.checkDependencyConstraint&&d&&d.hasThisConstraintApplied(a)){a.doVerifyConstraints([d],b)}else {if(a.isPinned()||!a.getConstraintType()){a.pinWithoutPropagation()}b&&b()}}else {b&&b()}},isPinned:function(){return this.getConstraintType()==this.getPinConstraintType()},setEndDate:function(e,c,b,d){var a=this;a.propagateChanges(function(){return a.setEndDateWithoutPropagation(e,c,b)},d)},setEndDateWithoutPropagation:function(b,f,d){var a=this,g=a.getTaskStore(!0),e,c;f=f!==!1;if(d!==!0&&d!==!1&&g){d=g.skipWeekendsDuringDragDrop}else {if(d!==!0&&d!==!1){d=!1}}a.autoCalculateLag();a.beginEdit();var i=a.getEndDate();if(!b){a.set(a.durationField,null);a.set(a.endDateField,null);a.setSegments(null)}else {c=a.getStartDate();if(b<c&&f===!1){b=c}if(d){b=a.skipNonWorkingTime(b,!1)}if(f!==!1){e=a.getDuration();if(Ext.isNumber(e)){if(g&&a.isSegmented()&&b-i){a.updateSegmentsDates({isForward:!1,endDate:b})}a.set(a.startDateField,a.calculateStartDate(b,e,a.getDurationUnit()));a.set(a.endDateField,b)}else {a.set(a.endDateField,b)}}else {var j=a.isMilestone();if(b<c){a.set(a.startDateField,b)}a.set(a.endDateField,b);a.constrainSegments();if(c){a.set(a.durationField,a.calculateDuration(c,b,a.getDurationUnit()));if(j&&!a.isMilestone()){var h=a.skipNonWorkingTime(c,!0);if(h-c!==0){a.set(a.startDateField,h)}}}}}e=a.getDuration();c=a.getStartDate();if(b&&c&&(e===undefined||e===null)){a.set(a.durationField,a.calculateDuration(c,b,a.getDurationUnit()))}a.onPotentialEffortChange();a.endEdit();return !0},setStartEndDate:function(c,e,b,d){var a=this;a.propagateChanges(function(g,d){var f=a.setStartEndDateWithoutPropagation(c,e,b);a.maybePinWithoutPropagation(function(){d(f)})},d,null,!0)},setStartEndDateWithoutPropagation:function(c,b,d){var a=this,e=a.getTaskStore(!0),h=c&&b&&c-b===0;if(d!==!0&&d!==!1&&e){d=e.skipWeekendsDuringDragDrop&&(!h||!e.scheduleByConstraints)}else {if(d!==!0&&d!==!1){d=!1}}if(d){c=c&&a.skipNonWorkingTime(c,!0);b=b&&a.skipNonWorkingTime(b,!1);if(b<c){c=b}}var g=a.getStartDate(),f=a.getEndDate();a.beginEdit();a.set(a.startDateField,c);a.set(a.endDateField,b);if(a.getTaskStore(!0)&&a.isSegmented()&&(c-g||b-f)){a.updateSegmentsDates()}if(b-f){a.constrainSegments()}a.set(a.durationField,a.calculateDuration(c,b,a.getDurationUnit()));a.onPotentialEffortChange();a.endEdit();return !0},shift:function(e,d,f){var a=this,b=a.getStartDate(),c=a.getEndDate();a.setStartEndDate(b&&Sch.util.Date.add(b,e,d),c&&Sch.util.Date.add(c,e,d),!1,f)},getDuration:function(b){var a=this.get(this.durationField);if(a&&b){a=this.getUnitConverter().convertDuration(a,this.getDurationUnit(),b)}return a},getEffort:function(b){var a=this.get(this.effortField)||0;if(a&&b){a=this.getUnitConverter().convertDuration(a,this.getEffortUnit(),b)}return a},setEffort:function(c,d,b){var a=this;a.propagateChanges(function(){return a.setEffortWithoutPropagation(c,d)},b)},setEffortWithoutPropagation:function(c,b){var a=this;b=b||a.getEffortUnit();a.beginEdit();a.set(a.effortField,c);a.set(a.effortUnitField,b);switch(a.getSchedulingMode()){case 'EffortDriven':a.updateSpanBasedOnEffort();break;case 'DynamicAssignment':a.updateAssignments();break;}a.set(a.actualEffortField,a.calculateActualEffort());a.setEffortVariance(a.calculateEffortVariance());a.recalculateCost();a.endEdit();return !0},getCalendarDuration:function(a){return this.getUnitConverter().convertMSDurationToUnit(this.getEndDate()-this.getStartDate(),a||this.get(this.durationUnitField))},setDuration:function(c,d,b){var a=this;a.propagateChanges(function(){return a.setDurationWithoutPropagation(c,d)},b)},setDurationWithoutPropagation:function(b,c){var a=this;c=c||a.getDurationUnit();var m=a.isMilestone(),f=a.getTaskStore(!0),k=a.isManuallyScheduled(),h=!k&&a.hasEndPredecessorsButNoStartPredecessors(),d=a.getStartDate(),j=a.getEndDate(),e=null,g=null;a.beginEdit();if(f&&f.scheduleByConstraints){a.set(a.durationField,b);a.set(a.durationUnitField,c);if(k){if(d){a.set(a.endDateField,a.recalculateEndDate(d))}else {if(j){a.set(a.startDateField,a.recalculateStartDate(j))}}}else {a.markForRescheduling()}f.resetEarlyDates();f.resetLateDates();a.constrainSegments({duration:b,unit:c})}else {if(Ext.isNumber(b)&&!d){if(j){h=!0}else {g=f&&f.getProjectStartDate()||Ext.Date.clearTime(new Date());a.set(a.startDateField,g)}}a.constrainSegments({duration:b,unit:c});if(Ext.isNumber(b)){if(h&&a.getEndDate()){g=a.calculateStartDate(a.getEndDate(),b,c)}else {if(a.getStartDate()){e=a.calculateEndDate(a.getStartDate(),b,c)}}}if(!h&&(e||a.getStartDate())){a.set(a.endDateField,e)}if(h&&(g||a.getEndDate())){a.set(a.startDateField,g)}a.set(a.durationField,b);a.set(a.durationUnitField,c);if(a.isMilestone()!=m){if(m){d=a.getStartDate();if(d){var l=a.skipNonWorkingTime(d,!0);if(l-d!==0){a.set(a.startDateField,l)}}}else {if(e){var i=a.skipNonWorkingTime(e,!1);if(i-e!==0){a.set(a.startDateField,i);a.set(a.endDateField,i)}}}}}a.onPotentialEffortChange();a.endEdit();return !0},shouldUseResourceCalendarsForSchedulingMode:function(a){return !this.ignoreResourceCalendarsForSchedulingMode||!this.ignoreResourceCalendarsForSchedulingMode[a]},calculateStartDate:function(b,i,f,d){f=f||this.getDurationUnit();if(!i||!b){return b}var a=this,j=a.getSchedulingMode(),h=a.shouldUseResourceCalendarsForSchedulingMode(j)&&a.hasResources(),g=a.getUnitConverter().convertDurationToMs(i,f),e;if(a.getTaskStore(!0)&&(a.isSegmented()||h)){var c=g;d=Ext.apply({endDate:b,isForward:!1,offsetSegments:!0,resources:h},d);a.forEachAvailabilityInterval(d,function(d,a){var b=a-d;if(b>=c){e=new Date(a-c);return !1}else {var f=(new Date(a)).getTimezoneOffset()-(new Date(d)).getTimezoneOffset();c-=b+f*60*1000}})}else {e=a.getCalendar().calculateStartDate(b,g,'MILLI')}return e},recalculateEndDate:function(b){var a=this,c,d;b=b||a.getStartDate();if(b&&a.getSchedulingMode()=='EffortDriven'){c=a.calculateEffortDrivenEndDate(b,a.getEffort())}else {d=a.getDuration();if(b&&Ext.isNumber(d)){c=a.calculateEndDate(b,d,a.getDurationUnit())}else {c=a.getEndDate()}}return c},recalculateStartDate:function(b){var a=this,c,d;b=b||a.getStartDate();if(b&&a.getSchedulingMode()=='EffortDriven'){c=a.calculateEffortDrivenStartDate(b,a.getEffort())}else {d=a.getDuration();if(b&&Ext.isNumber(d)){c=a.calculateStartDate(b,d,a.getDurationUnit())}else {c=a.getStartDate()}}return c},calculateEndDate:function(b,i,f,d){f=f||this.getDurationUnit();if(!i||!b){return b}var a=this,j=a.getSchedulingMode(),h=a.shouldUseResourceCalendarsForSchedulingMode(j)&&a.hasResources(),g=a.getUnitConverter().convertDurationToMs(i,f),e;if(a.getTaskStore(!0)&&(a.isSegmented()||h)){var c=g;d=Ext.apply({startDate:b,offsetSegments:!0,resources:h},d);a.forEachAvailabilityInterval(d,function(a,d){var b=d-a;if(b>=c){e=new Date(a+c);return !1}else {var f=(new Date(a)).getTimezoneOffset()-(new Date(d)).getTimezoneOffset();c-=b+f*60*1000}})}else {e=a.getCalendar().calculateEndDate(b,g,'MILLI')}return e},calculateDuration:function(c,d,e,h){e=e||this.getDurationUnit();if(!c||!d){return 0}var a=this,g=a.getSchedulingMode(),f=a.shouldUseResourceCalendarsForSchedulingMode(g)&&a.hasResources(),b=0;if(a.getTaskStore(!0)&&(a.isSegmented()||f)){a.forEachAvailabilityInterval(Ext.apply({startDate:c,endDate:d,resources:f},h),function(a,c){var d=(new Date(a)).getTimezoneOffset()-(new Date(c)).getTimezoneOffset();b+=c-a+d*60*1000})}else {b=a.getCalendar().calculateDuration(c,d,'MILLI')}return a.getUnitConverter().convertMSDurationToUnit(b,e)},isCalendarApplicable:function(f){var b=this.getStartDate();if(!b){return !0}var c=this.getTaskStore(!0);if(!c){return !0}var h=Sch.util.Date.add(b,Sch.util.Date.DAY,c&&c.availabilitySearchLimit||5*365);var e=this.getAssignments();var a=[];Ext.Array.each(e,function(c){var b=c.getResource();if(b){a.push(b.getCalendar())}});if(!a.length){return !0}var g=Gnt.data.Calendar.getCalendar(f);for(var d=0,i=a.length;d<i;d++){if(g.isAvailabilityIntersected(a[d],b,h)){return !0}}return !1},forEachAvailabilityInterval:function(p,T,R){T=T||p.fn;R=R||p.scope||this;var W=this,i=p.startDate,j=p.endDate,X=p.includeEmptyIntervals,K=p.resources,ad=p.segments!==!1&&this.isSegmented(),ah=p.offsetSegments,v=p.isForward!==!1,G=Sch.util.Date,u,I,Q,k;var S=this.getTaskStore(!0);var g,h,U,F,b,c;if(v){if(!i){throw new Error('forEachAvailabilityInterval: `startDate` is required when `isForward` is true')}if(!j){j=G.add(i,Sch.util.Date.DAY,p.availabilitySearchLimit||S&&S.availabilitySearchLimit||5*365)}u=new Date(i);I=function(a,b){return a-b};Q=function(a,b){return a.type<b.type?1:-1};k=Array.prototype.shift}else {if(!j){throw new Error('forEachAvailabilityInterval: `endDate` is required when `isForward` is false')}if(!i){i=G.add(j,Sch.util.Date.DAY,-(p.availabilitySearchLimit||S&&S.availabilitySearchLimit||5*365))}u=new Date(j);I=function(a,b){return b-a};Q=function(a,b){return a.type>b.type?1:-1};k=Array.prototype.pop}var A=this.getOwnCalendar(),ag=this.getProjectCalendar(A),M={},V=[];if(K){var aa=!1;var ac=p.assignments;var _=function(b){var d=b.getId(),a=ac&&Ext.Array.findBy(ac,function(a){return a.getResourceId()==d})||W.getAssignmentFor(b),e=b.getCalendar(),c=e.getCalendarId();if(!M[c]){M[c]=[];V.push(e)}M[c].push({assignment:a,resourceId:d,units:a&&a.getUnits()});aa=!0};if(K!==!0){Ext.each(K,_)}else {Ext.Array.each(this.getAssignments(),function(b){var a=b.getResource();if(a){_(a)}})}if(!aa){return}}else {A=A||ag}var w=0,n=!0,N,O,H,J,q,r,L,s,t,m,o;if(ad){if(ah){H=[];J=[];W.forEachSegment(function collectSplitOffsets(b){var a=b.getNextSegment();if(a){H.push(b.getEndOffset());J.push(a.getStartOffset())}});q=k.call(H);r=k.call(J);L=this.getLastSegment().getEndOffset()}else {N=[];O=[];W.forEachSegment(function collectSplits(d){var c=d.getNextSegment();if(c){var a=d.getEndDate()-0,b=c.getStartDate()-0;if(a<i){n=!v}else {if(a<=j){N.push(a)}}if(b<i){n=v}else {if(b<=j){O.push(b)}}}});s=k.call(N);t=k.call(O)}}while(v?u<j:u>i){var a={};var f=[];var ae=u-(v?0:1);if(A){var ab=A.getAvailabilityIntervalsFor(ae);for(h=0,U=ab.length;h<U;h++){F=ab[h];b=F.startDate-0;c=F.endDate-0;if(!a[b]){a[b]=[];f.push(b)}a[b].push({type:'00-taskAvailailabilityStart'});f.push(c);a[c]=a[c]||[];a[c].push({type:'01-taskAvailailabilityEnd'})}}if(ad&&(s||t)){var P=v?G.getStartOfNextDay(u)-0:G.getEndOfPreviousDay(u)-1;while(s&&(v?s<P:s>P)){if(!a[s]){a[s]=[];f.push(s)}a[s].push({type:'05-taskSegmentEnd'});s=k.call(N)}while(t&&(v?t<P:t>P)){if(!a[t]){a[t]=[];f.push(t)}a[t].push({type:'04-taskSegmentStart'});t=k.call(O)}}var e;for(g=0,U=V.length;g<U;g++){var af=V[g],$=af.getAvailabilityIntervalsFor(ae);e=M[af.getCalendarId()];for(h=0;h<$.length;h++){F=$[h];b=F.startDate-0;c=F.endDate-0;if(!a[b]){a[b]=[];f.push(b)}a[b].push({type:'02-resourceAvailailabilityStart',resources:e});if(!a[c]){a[c]=[];f.push(c)}a[c].push({type:'03-resourceAvailailabilityEnd',resources:e})}}f.sort(I);var D=!1,B={},C=0,E=!1,l=null,x,y,d,z;if(v){for(g=0;g<f.length;g++){b=f[g];c=f[g+1];x=a[b];x.sort(Q);for(h=0;h<x.length;h++){y=x[h];switch(y.type){case '00-taskAvailailabilityStart':D=!0;break;case '01-taskAvailailabilityEnd':D=!1;break;case '02-resourceAvailailabilityStart':e=y.resources;for(d=0,z=e.length;d<z;d++){B[e[d].resourceId]=e[d];C++};break;case '03-resourceAvailailabilityEnd':e=y.resources;for(d=0,z=e.length;d<z;d++){delete B[e[d].resourceId];C--};break;case '04-taskSegmentStart':n=!0;break;case '05-taskSegmentEnd':n=!1;break;}}if(b>=j||c<=i){continue}E=(D||!A)&&(!K||C);if((q||r)&&E){var Z=w+c-b;l=[];while(q&&q<Z){m=b+q-w;if(!a[m]){a[m]=[];l.push(m)}a[m].push({type:'05-taskSegmentEnd'});if(m==b){n=!1}q=k.call(H)}while(r&&r<Z){o=b+r-w;if(!a[o]){a[o]=[];l.push(o)}a[o].push({type:'04-taskSegmentStart'});if(o==b){n=!0}r=k.call(J)}if(l.length){l.sort(I);f.splice.apply(f,[g+1,0].concat(l))}w+=c-b}if(E&&n||X){if(b<i){b=i-0}if(c>j){c=j-0}if(T.call(R,b,c,B)===!1){return !1}}}}else {for(g=0;g<f.length;g++){b=f[g+1];c=f[g];x=a[c];x.sort(Q);for(h=0;h<x.length;h++){y=x[h];switch(y.type){case '01-taskAvailailabilityEnd':D=!0;break;case '00-taskAvailailabilityStart':D=!1;break;case '03-resourceAvailailabilityEnd':e=y.resources;for(d=0,z=e.length;d<z;d++){B[e[d].resourceId]=e[d];C++};break;case '02-resourceAvailailabilityStart':e=y.resources;for(d=0,z=e.length;d<z;d++){delete B[e[d].resourceId];C--};break;case '05-taskSegmentEnd':n=!0;break;case '04-taskSegmentStart':n=!1;break;}}if(b>j||c<=i){continue}E=(D||!A)&&(!K||C);if((q||r)&&E){var Y=L-(w+c-b);l=[];while(q&&q>=Y){m=c-(L-w-q);if(!a[m]){a[m]=[];l.push(m)}a[m].push({type:'05-taskSegmentEnd'});if(m==c){n=!1}q=k.call(H)}while(r&&r>=Y){o=c-(L-w-r);if(!a[o]){a[o]=[];l.push(o)}a[o].push({type:'04-taskSegmentStart'});if(o==c){n=!0}r=k.call(J)}if(l.length){l.sort(I);f.splice.apply(f,[g+1,0].concat(l))}w+=c-b}if(E&&n||X){if(b<i){b=i-0}if(c>j){c=j-0}if(T.call(R,b,c,B)===!1){return !1}}}}u=v?G.getStartOfNextDay(u):G.getEndOfPreviousDay(u)}},forEachAvailabilityIntervalWithResources:function(a,c,b){if(!a.resources){a.resources=!0}this.forEachAvailabilityInterval.apply(this,arguments)},calculateEffortDrivenEndDate:function(b,d,e){if(!d){return b}var a=this.getUnitConverter().convertDurationToMs(d,e||this.getEffortUnit());var c=new Date(b);this.forEachAvailabilityIntervalWithResources({startDate:b},function(d,h,e){var g=0;for(var i in e){g+=e[i].units}var f=h-d;var b=g*f/100;if(b>=a){c=new Date(d+a/b*f);return !1}else {a-=b}});return c},calculateEffortDrivenStartDate:function(b,c,e){if(!c){return b}var a=this.getUnitConverter().convertDurationToMs(c,e||this.getEffortUnit());var d=new Date(b);this.forEachAvailabilityIntervalWithResources({endDate:b,isForward:!1},function(h,f,c){var g=0;for(var i in c){g+=c[i].units}var e=f-h;var b=g*e/100;if(b>=a){d=new Date(f-a/b*e);return !1}else {a-=b}});return d},refreshCalculatedParentNodeData:function(){this.beginEdit();var r=this.childNodes;var i=this.autoCalculatePercentDoneForParentTask;var k=this.autoCalculateEffortForParentTask;var l=this.autoCalculateCostForParentTask;var h=r.length;var e={};if(h>0&&(k||i||l)){var p=0;var f=0;var n=0;var A=0;var v=0;var j=!0;var m=!1;for(var u=0;u<h;u++){var c=r[u];if(c.parentNode){var z=c.isLeaf();if(k){p+=c.getEffort('MILLI')}if(l){A+=c.getCost();v+=c.getActualCost()}if(i){var g=z?c.getDuration('MILLI')||0:c.childTasksDuration,o=c.getPercentDone()||0;f+=g;n+=z?g*o:c.completedChildTasksDuration;m=m||g===0&&o<100;j=j&&g===0&&o>=100}}}if(k&&this.getEffort('MILLI')!=p){e.Effort=!0;this.setEffortWithoutPropagation(this.getUnitConverter().convertMSDurationToUnit(p,this.getEffortUnit()))}if(i){var d=0;this.childTasksDuration=f;this.completedChildTasksDuration=n;if(f>0){d=n/f;if(d===100&&m){d=99}}else {if(j){d=100}}if(this.getPercentDone()!=d){e.PercentDone=!0;this.setPercentDoneWithoutPropagation(d)}}if(l){this.setActualCost(v);this.setCost(A)}}var q,s;if(!this.isRoot()&&h>0&&!this.isManuallyScheduled()&&!this.isReadOnly()){var y=new Date(-8.64E15),x=new Date(+8.64E15),a=new Date(+8.64E15),b=new Date(-8.64E15),w=this.isProject;if(w){a=this.getStartDate()}for(var t=0;t<h;t++){var C=r[t];if(!w){a=Sch.util.Date.min(a,C.getStartDate()||a)}b=Sch.util.Date.max(b,C.getEndDate()||b)}if(b<a&&a<x&&b>y){var B;B=b;b=a;a=B}q=e.StartDate=a-x!==0&&this.getStartDate()-a!==0;s=e.EndDate=b-y!==0&&this.getEndDate()-b!==0;if(q&&s){this.setStartEndDateWithoutPropagation(a,b,!1)}else {if(q){this.setStartDateWithoutPropagation(a,!1,!1)}else {if(s){this.setEndDateWithoutPropagation(b,!1,!1)}}}}this.endEdit();return e},recalculateParents:function(){var a=this.parentNode;a&&(a.refreshCalculatedParentNodeData(),!this.getTaskStore().cascading&&a.recalculateParents())},isMilestone:function(c){if(c){return this.isBaselineMilestone()}if(!this.get('leaf')){var a=this.getStartDate(),b=this.getEndDate();if(a&&b){return b-a===0}}return this.getDuration()===0},convertToMilestone:function(b){var a=this;a.propagateChanges(function(){return a.convertToMilestoneWithoutPropagation()},b)},convertToMilestoneWithoutPropagation:function(){var a=this,b=!1;if(!a.isMilestone()){b=a.setStartDateWithoutPropagation(a.getEndDate(),!1);var c=a.getTaskStore(!0),d=c&&c.scheduleByConstraints;if(d){a.markForRescheduling()}}return b},convertToRegular:function(b){var a=this;a.propagateChanges(function(){return a.convertToRegularWithoutPropagation()},b)},convertToRegularWithoutPropagation:function(){var a=this,b=!1,c,f;if(a.isMilestone()){c=a.get(a.durationUnitField);var e=a.getTaskStore(!0),d=e&&e.scheduleByConstraints;if(!d){f=a.calculateStartDate(a.getStartDate(),1,c)}b=a.setDurationWithoutPropagation(1,c);if(!d){b=b&&a.setStartDateWithoutPropagation(f,!0,!1,!1)}}return b},isBaselineMilestone:function(){var a=this.getBaselineStartDate(),b=this.getBaselineEndDate();if(a&&b){return b-a===0}return !1},markAsParent:function(){var a=this;a.isSegmented()&&a.setSegmentsWithoutPropagation(null);a.set('leaf',!1)},getDurationUnit:function(){return this.get(this.durationUnitField)||Sch.util.Date.DAY},getEffortUnit:function(){return this.get(this.effortUnitField)||Sch.util.Date.HOUR},setPercentDone:function(b,c){var a=this;var e=!a.getManuallyScheduled()&&a.isCompleted()&&b<100;if(e){a.propagateChanges(function(){return a.setPercentDoneWithoutPropagation(b)},c)}else {a.setPercentDoneWithoutPropagation(b);var d={};d[a.getId()]=a;c&&c(!0,d)}},setPercentDoneWithoutPropagation:function(b){var a=this;if(b!=a.getPercentDone()){a.beginEdit();if(!a.getManuallyScheduled()&&a.isCompleted()&&b<100){a.markForRescheduling()}a.set(a.percentDoneField,b);a.set(a.actualEffortField,a.calculateActualEffort());a.recalculateCost();a.endEdit()}return !0},getBaselinePercentDone:function(){return this.get(this.baselinePercentDoneField)||0},isPersistable:function(){var a=this.parentNode;return !a||!a.phantom||a.isRoot()},getResources:function(){var b=this,a=b.getAssignmentStore();return a&&a.getResourcesForEvent(b)||[]},getAssignments:function(){var b=this,a=b.getAssignmentStore();return a&&a.getAssignmentsForTask(b)||[]},hasAssignments:function(){return this.getAssignments().length>0},hasResources:function(){var c=this.getAssignments(),b=!1,a,d;for(a=0,d=c.length;!b&&a<d;a++){b=!!c[a].getResource()}return b},getAssignmentFor:function(c){var b=this,a=b.getAssignmentStore();return a&&a.getAssignmentForEventAndResource(b,c)||null},isAssignedTo:function(c){var b=this,a=b.getAssignmentStore();return a&&a.isTaskAssignedToResource(b,c)||!1},assign:function(e,f,c){var d=this,b,a;d.propagateChanges(function(){return d.assignWithoutPropagation(e,f,function cancelAndResultFeedback(d,c){a=d;b=c})},function onPropagationComplete(b,d){b&&a&&a();c&&c(b,d)});return b},assignWithoutPropagation:function(a,f,g){var c=this,e=[],j=c.getTaskStore(),h=j.getAssignmentStore(),d=j.getResourceStore(),i,b;f=f||100;!c.getAssignmentFor(a)||Ext.Error.raise("Resource can't be assigned twice to the same task");if(a instanceof Gnt.model.Resource&&d.indexOf(a)==-1){b=a.getId();d.add(a);e.push(function(){d.remove(a)})}else {if(a instanceof Gnt.model.Resource){b=a.getId()}else {if(d.indexOfId(a)>=0){b=a}else {var k=!1}}}i=h.assignTaskToResource(c,b,f);e.push(function(){h.unassignTaskFromResource(c,b)});g&&g(function(){Ext.Array.each(e,function(a){a()})},i[0]);return [c]},unassign:function(){return this.unAssign.apply(this,arguments)},unAssign:function(d,b){var c=this,a;c.propagateChanges(function(){return c.unassignWithoutPropagation(d,function cancelFeedback(b){a=b})},function onPropagationComplete(c,d){c&&a&&a();b&&b(c,d)})},unassignWithoutPropagation:function(a,e){var b=this,g=a instanceof Gnt.model.Resource?a.getId():a,c=b.getAssignmentStore(),f=b.getAssignmentFor(g),d;d=c.indexOf(f);c.unassignTaskFromResource(b,a);e&&e(function(){c.insert(d,f)});return [b]},reassign:function(d,f,e){var a=this,b,c;a.propagateChanges(function(){var g=a.getAssignmentFor(d).getUnits();var e=!1;e=a.unassignWithoutPropagation(d,function unassignCancelFeedback(a){b=a});e=e&&a.assignWithoutPropagation(f,g,function assignCancelFeedback(a){c=a});return e},function onPropagationComplete(a,d){if(a){c&&c();b&&b()}e&&e(a,d)})},linkTo:function(e,f,b,d){var c=this,a;c.propagateChanges(function(){return c.linkToWithoutPropagation(e,f,function cancelFeedback(b){a=b},d)},function onPropagationComplete(c,d){c&&a&&a();b&&b(c,d)})},linkToWithoutPropagation:function(b,c,f){var d=this,i=d.getId(),k=d.getTaskStore(),e=d.getDependencyStore(),g=d,a;b=b instanceof Gnt.model.Task?b.getId():b;c=(c===null||c===undefined)&&Gnt.model.Dependency.Type.EndToStart||c;a=new e.model();a.setSourceId(i);a.setTargetId(b);a.setType(c);if(e.isValidDependency(a)){e.add(a);var h=a.getSourceTask(),j=a.getTargetTask();h.isUnscheduled()&&h.markForRescheduling();j.markForRescheduling();g=d}f&&f(function(){e.remove(a)});return g},unlinkFrom:function(d,b){var c=this,a;c.propagateChanges(function(){return c.unlinkFromWithoutPropagation(d,function cancelFeedback(b){a=b})},function onPropagationComplete(c,d){c&&a&&a();b&&b(c,d)})},unlinkFromWithoutPropagation:function(a,f){var d=this,g=d.getId(),b=d.getDependencyStore(),c,e;a=a instanceof Gnt.model.Task?a.getId():a;c=b.getTasksLinkingDependency(a,g);e=b.indexOf(c);b.remove(c);f&&f(function(){b.insert(e,c)});return d},calculateEffort:function(b,c,d){if(!b||!c){return 0}var a=0;this.forEachAvailabilityIntervalWithResources({startDate:b,endDate:c},function(d,e,b){var c=0;for(var f in b){c+=b[f].units}a+=(e-d)*c/100});return this.getUnitConverter().convertMSDurationToUnit(a,d||this.getEffortUnit())},updateAssignments:function(){if(!this._inUpdateAssignments){this._inUpdateAssignments=!0;var b=this.getStartDate(),c=this.getEndDate(),a=0;if(b&&c){this.forEachAvailabilityIntervalWithResources({startDate:b,endDate:c},function(c,d,b){for(var e in b){a+=d-c}});if(a){var d=this.getEffort(Sch.util.Date.MILLI);Ext.Array.each(this.getAssignments(),function(b){b.setUnits(d/a*100)})}}this._inUpdateAssignments=!1}},updateEffortBasedOnDuration:function(){this.setEffortWithoutPropagation(this.calculateEffort(this.getStartDate(),this.getEndDate()))},updateEffortBasedOnSpan:function(){this.updateEffortBasedOnDuration()},updateSpanBasedOnEffort:function(){this.setStartEndDateWithoutPropagation(this.getStartDate(),this.recalculateEndDate())},onPotentialEffortChange:function(){var a=this,b=a.getTaskStore(!0);if(a.isTaskStored()&&(!b||!b.isUndoingOrRedoing())){switch(a.getSchedulingMode()){case 'FixedDuration':a.updateEffortBasedOnDuration();break;case 'DynamicAssignment':a.updateAssignments();break;}}},onAssignmentMutation:function(){var a=this,c=a.getTaskStore(!0),b=a.autoCalculateCost;if(a.isTaskStored()&&(!c||!c.isUndoingOrRedoing())){switch(a.getSchedulingMode()){case 'FixedDuration':a.updateEffortBasedOnDuration();b=!1;break;case 'EffortDriven':a.updateSpanBasedOnEffort();break;case 'DynamicAssignment':a.updateAssignments();break;}if(b){a.recalculateCost()}}},onAssignmentStructureMutation:function(){var a=this,c=a.getTaskStore(!0),b=a.autoCalculateCost;if(a.isTaskStored()&&(!c||!c.isUndoingOrRedoing())){switch(a.getSchedulingMode()){case 'FixedDuration':a.updateEffortBasedOnDuration();b=!1;break;case 'EffortDriven':a.updateSpanBasedOnEffort();break;case 'DynamicAssignment':a.updateAssignments();break;}if(b){a.recalculateCost()}}},adjustToCalendar:function(b){var a=this;a.propagateChanges(function(){return a.adjustToCalendarWithoutPropagation()},b)},adjustToCalendarWithoutPropagation:function(){var a=this,c=a.getTaskStore(!0),b=!1;if(c){if(a.get('leaf')){a.setStartDateWithoutPropagation(a.getStartDate(),!0,c.skipWeekendsDuringDragDrop);a.scheduleWithoutPropagation({taskStore:c});b=a}else {if(a.getStartDate()&&a.getEndDate()){a.set(a.durationField,a.calculateDuration(a.getStartDate(),a.getEndDate(),a.getDurationUnit()));b=a}}}return b},isReadOnly:function(){var a=!1;this.bubble(function(b){if(b.getReadOnly()){a=!0;return !1}},this);return a},isEditable:function(a){if(!this.getReadOnly()&&this.isReadOnly()){return !1}if(a===this.readOnlyField){return !0}if(this.getReadOnly()){return !1}if(!this.isLeaf()){if(this.autoCalculateEffortForParentTask){if(a===this.effortField){return !1}if(a===this.actualEffortField){return !1}}if(this.autoCalculateCostForParentTask){if(a===this.costField){return !1}if(a===this.actualCostField){return !1}}if(a===this.percentDoneField&&this.autoCalculatePercentDoneForParentTask){return !1}}if(this.autoCalculateCost){if(a===this.costField){return !1}if(a===this.actualCostField){return !1}}if((a===this.durationField||a===this.endDateField)&&this.getSchedulingMode()==='EffortDriven'){return !1}if(a===this.effortField&&this.getSchedulingMode()==='FixedDuration'){return !1}return !0},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},getWBSCode:function(){var b=[],c,a=this;while(a.parentNode){c=a.parentNode.childNodes.indexOf(a);b.push(c+1);a=a.parentNode}return b.reverse().join('.')},resetTotalCount:function(b){var a=this;while(a){a.totalCount=b?-1:null;a=a.parentNode}},getTotalCount:function(){var a=this.totalCount;var d=a==-1;if(a==null||d){var b=this.childNodes;a=b.length;for(var c=0,e=b.length;c<e;c++){a+=b[c].getTotalCount()}if(d){return a}else {this.totalCount=a}}return a},getPreviousSiblingsTotalCount:function(){var a=this.previousSibling,b=this.parentNode.childNodes.indexOf(this);while(a){b+=a.getTotalCount();a=a.previousSibling}return b},getSequenceNumber:function(){var b=0,a=this;while(a.parentNode){b+=a.getPreviousSiblingsTotalCount()+1;a=a.parentNode}return b},getBySequenceNumber:function(a){var d=null,b,e;if(a===0){d=this}else {if(a>0&&a<=this.getTotalCount()){a--;for(var c=0,f=this.childNodes.length;c<f;c++){b=this.childNodes[c];e=b.getTotalCount();if(a>e){a-=e+1}else {b=this.childNodes[c];d=b.getBySequenceNumber(a);break}}}}return d},getDisplayStartDate:function(b,c,a,e,d){b=b||Ext.Date.defaultFormat;if(arguments.length<3){a=this.getStartDate();if(arguments.length<2){c=!0}}if(a&&c&&this.isMilestone(d)&&a-Ext.Date.clearTime(a,!0)===0&&!Ext.Date.formatContainsHourInfo(b)){a=Sch.util.Date.add(a,Sch.util.Date.MILLI,-1)}return e?a:a?Ext.util.Format.date(a,b):''},getDisplayEndDate:function(b,c,a,e,d){b=b||Ext.Date.defaultFormat;if(arguments.length<3){a=this.getEndDate();if(arguments.length<2){c=!0}}if(a&&(!this.isMilestone(d)||c)&&a-Ext.Date.clearTime(a,!0)===0&&!Ext.Date.formatContainsHourInfo(b)){a=Sch.util.Date.add(a,Sch.util.Date.MILLI,-1)}return e?a:a?Ext.util.Format.date(a,b):''},fullCopy:function(b){var a=this.callParent(arguments);a.taskStore=this.getTaskStore();return a},commit:function(){this.callParent(arguments);this.commitSegments()},reject:function(){this.callParent(arguments);this.rejectSegments()},isUnscheduled:function(){return !this.getStartDate()||!this.getEndDate()},isMarkedForRescheduling:function(){return this.get('needsRescheduling')},markForRescheduling:function(){this.set('needsRescheduling',!0)},unmarkForRescheduling:function(){this.set('needsRescheduling',!1)},isTaskStored:function(){return !!(this.getTreeStore()&&this.getTreeStore().getRoot()&&!this.getTreeStore().destroyed)},onRegisterTreeNode:function(a){if(a&&a.autoNormalizeNodes&&!this.normalized){this.normalize()}}},function(){Ext.data.NodeInterface.decorate(this);this.override({copy:function(){var c=this.callParent(arguments),a=c.getSegments();if(a){for(var b=0;b<a.length;b++){var d=a[b];a[b]=d.copy(d.getId(),!1,{task:c})}}return c},insertBefore:function(a,h){a=this.createNode(a);if(!a){return}var c=this.getTaskStore(!0),i=c&&c.getRoot(),b=this.phantomParentIdField,g=this!==i&&this.phantom,e=!!a.parentNode,d=this.getId();if(g){this.data[this.phantomIdField]=d}if(d!==a.data[b]){var f=g?d:null;if(!a.phantom&&a.data[b]!==f){a.modified=a.modified||{};a.modified[b]=a.data[b]}a.data[b]=f}var k=h&&h.get('index');this.resetTotalCount(e);if(e&&a.hasDependencies()&&!c.isUndoingOrRedoing()){a.removeDependenciesToParents(this)}var j=this.callParent(arguments);if(e){if(this.hasDependencies()){c.getDependencyStore().resetMethodsCache();if(!c.isUndoingOrRedoing()){this.removeInvalidDependencies()}}this.resetTotalCount()}return j},appendChild:function(b,k,l){b=b instanceof Array?b:[b];var a=this.getTaskStore(!0),m=a&&a.getRoot(),g=!1,d=this.phantomParentIdField,j=this!==m&&this.phantom,f=this.getId(),i=0;if(a&&b.length>1){a.suspendAutoRecalculateParents++}for(var e=0;e<b.length;e++){var c=this.createNode(b[e]);if(!c){continue}i++;b[e]=c;if(c.parentNode){g=!0;if(c.hasDependencies()&&a&&!a.isUndoingOrRedoing()){c.removeDependenciesToParents(this)}}if(f!==c.data[d]){var h=j?f:null;if(!c.phantom&&c.data[d]!==h){c.modified=c.modified||{};c.modified[d]=c.data[d]}c.data[d]=h}}if(!i){return}if(j){this.data[this.phantomIdField]=f}this.resetTotalCount(g);var n=this.callParent([b.length>1?b:b[0],k,l]);if(g){if(this.hasDependencies()){a.getDependencyStore().resetMethodsCache();if(a&&!a.isUndoingOrRedoing()){this.removeInvalidDependencies()}}this.resetTotalCount()}if(a&&!a.isUndoingOrRedoing()){this.beginEdit();this.markAsParent();this.set(this.schedulingModeField,'Normal');if(a&&b.length>1){a.suspendAutoRecalculateParents--}this.endEdit()}if(a&&a.recalculateParents&&!a.suspendAutoRecalculateParents&&!this.isRoot()&&!a.cascading&&!a.isUndoingOrRedoing()){b[0].recalculateParents()}return n},removeChild:function(h,g,f,e){var a=this,d=!a.removeChildIsCalledFromReplaceChild&&a.convertEmptyParentToLeaf&&a.childNodes.length==1,b=a.getTaskStore(!0),c;a.resetTotalCount();a.removeChildIsCalledFromReplaceChild=!1;c=a.callParent(arguments);if(e){a.resetTotalCount()}if(a.childNodes.length>0&&b&&b.recalculateParents&&!b.suspendAutoRecalculateParents&&!b.isUndoingOrRedoing()){a.childNodes[0].recalculateParents()}if(d&&!a.isRoot()&&b&&!b.isUndoingOrRedoing()){a.convertEmptyParentToLeafTask()}return c},replaceChild:function(){this.removeChildIsCalledFromReplaceChild=!0;this.callParent(arguments)},removeAll:function(){var b=this.isLeaf(),a=this.getTaskStore(!0);this.resetTotalCount();this.callParent(arguments);if(!b&&this.convertEmptyParentToLeaf&&a){this.convertEmptyParentToLeafTask()}},createNode:function(c){var f=this,a=f.getTaskStore(!0),e=a&&a.getRoot(),b;if(a){b=a.getProxy().getReader();var d=b.getChildType;b.getChildType=function(){return d.apply(this,arguments)||this.getModel()}}c=this.callParent(arguments);if(a&&b){delete b.getChildType}if(a&&e!==this&&c.isProject){return}return c}})});Ext.define('Gnt.model.Project',{extend:'Gnt.model.Task',alias:'gntmodel.project',isProject:!0,descriptionField:'Note',allowDependenciesField:'AllowDependencies',customizableFields:[{name:'Description',type:'string'},{name:'AllowDependencies',persist:!1,type:'bool',defaultValue:!1}],recognizedSchedulingModes:['Normal'],convertEmptyParentToLeaf:!1,isEditable:function(a){switch(a){case this.nameField:case this.startDateField:case this.readOnlyField:case this.durationField:case this.durationUnitField:case this.descriptionField:case this.allowDependenciesField:return this.callParent(arguments);case this.endDateField:return this.isManuallyScheduled()&&this.callParent(arguments);default:return !1;}},setStartDate:function(e,c,b,d){var a=this;a.propagateChanges(function(){var d=a.setStartDateWithoutPropagation(e,c,b);a.cascadeChildren(function(a){a.markForRescheduling()});return d},d)},setStartEndDate:function(c,e,b,d){var a=this;a.propagateChanges(function(){var d=a.setStartEndDateWithoutPropagation(c,e,b);a.cascadeChildren(function(a){a.markForRescheduling()});return d},d)},indent:Ext.emptyFn,outdent:Ext.emptyFn,maybePinWithoutPropagation:Ext.emptyFn});Ext.define('Gnt.data.util.TaskDependencyCache',function(a){function keyToTask(c,a){var b;if(!(a instanceof Ext.data.Model)){b=c.dependencyStore.getTaskStore();a=b&&b.getModelById(a)}return a}function fillSuccessors(a,b){var c=keyToTask(a,b);c&&(c.successors=a.getSuccessors(b))}function fillPredecessors(a,b){var c=keyToTask(a,b);c&&(c.predecessors=a.getPredecessors(b))}function clearSuccessorsPredecessors(c){var b=c.dependencyStore.getTaskStore(),a=b&&b.getRoot();a&&a.cascadeBy(function(a){a.successors=[];a.predecessors=[]})}function fillTasksWithDepInfo(a){var c=a.dependencyStore.getTaskStore(),b=c&&c.getRoot();b&&b.cascadeBy(function(b){b.successors=a.getSuccessors(b);b.predecessors=a.getPredecessors(b)})}return {extend:'Sch.data.util.EventDependencyCache',taskStoreDetacher:null,taskStoreDependencyStoreDetacher:null,constructor:function(b){var a=this,c;a.callParent([b]);function onTaskStoreRootChange(b){fillTasksWithDepInfo(a)}function onTaskStoreNodeAppend(c,b){fillSuccessors(a,b);fillPredecessors(a,b)}function onTaskStoreNodeInsert(c,b){fillSuccessors(a,b);fillPredecessors(a,b)}function onTaskStoreRefresh(b){fillTasksWithDepInfo(a)}function onDependencyStoreTaskStoreChange(b,a){attachToTaskStore(a)}function onDependencyStoreRefresh(b){fillTasksWithDepInfo(a)}function attachToTaskStore(b){Ext.destroy(a.taskStoreDetacher);a.taskStoreDetacher=b&&b.on({'rootchange':onTaskStoreRootChange,'nodeappend':onTaskStoreNodeAppend,'nodeinsert':onTaskStoreNodeInsert,'refresh':onTaskStoreRefresh,priority:99,destroyable:!0});fillTasksWithDepInfo(a)}a.taskStoreDependencyStoreDetacher=b.on({'eventstorechange':onDependencyStoreTaskStoreChange,'refresh':onDependencyStoreRefresh,priority:100,destroyable:!0});attachToTaskStore(b.getTaskStore())},destroy:function(){var a=this;a.callParent();Ext.destroyMembers(a,'taskStoreDetacher','taskStoreDependencyStoreDetacher')},addSuccessor:function(b,c){var a=this;a.callParent([b,c]);fillSuccessors(a,b)},addPredecessor:function(b,c){var a=this;a.callParent([b,c]);fillPredecessors(a,b)},setSuccessors:function(b,c){var a=this;a.callParent([b,c]);fillSuccessors(a,b)},setPredecessors:function(b,c){var a=this;a.callParent([b,c]);fillPredecessors(a,b)},removeSuccessor:function(b,c){var a=this;a.callParent([b,c]);fillSuccessors(a,b)},removePredecessor:function(b,c){var a=this;a.callParent([b,c]);fillPredecessors(a,b)},moveSuccessors:function(c,b,d){var a=this;a.callParent(arguments);fillSuccessors(a,c);fillSuccessors(a,b)},movePredecessors:function(c,b,d){var a=this;a.callParent(arguments);fillPredecessors(a,c);fillPredecessors(a,b)},clearSuccessors:function(b){var a=this;a.callParent([b]);fillSuccessors(a,b)},clearPredecessors:function(b){var a=this;a.callParent([b]);fillPredecessors(a,b)},clear:function(b){var a=this;a.callParent(arguments);if(b){fillSuccessors(a,b);fillPredecessors(a,b)}else {clearSuccessorsPredecessors(a)}}}});Ext.define('Gnt.model.Dependency',{extend:'Sch.model.DependencyBase',requires:['Sch.util.Date'],customizableFields:[{name:'Lag',type:'number',defaultValue:0},{name:'LagUnit',type:'string',defaultValue:'d',convert:function(a){return a||Sch.util.Date.DAY}}],lagField:'Lag',lagUnitField:'LagUnit',isHighlighted:!1,getTaskStore:function(){return Ext.isFunction(this.store.getTaskStore)?this.store.getTaskStore():this.store.taskStore},getEventStore:function(){return this.getTaskStore()},getSourceTask:function(a){return this.getSourceEvent(a)},setSourceTask:function(a){return this.setSourceEvent(a)},getTargetTask:function(a){return this.getTargetEvent(a)},setTargetTask:function(a){return this.setTargetEvent(a)},setLag:function(b,c){var a=this;a.beginEdit();a.set(a.lagField,b);if(arguments.length>1){a.setLagUnit(c)}a.endEdit()},getLagUnit:function(){var a=this;return a.get(a.lagUnitField)||Sch.util.Date.DAY},isValid:function(c){var a=this,b=a.callParent(arguments),d=a.getSourceId(),e=a.getTargetId(),f=a.getType();if(b&&c!==!1&&a.store){b=a.store.isValidDependency(d,e,f,null,null,a)}return b},getTypeFromSides:function(e,c,d){var a=this.self.Type,b=d?'end':'start',f=d?'start':'end';if(e===b){return c===b?a.StartToStart:a.StartToEnd}return c===f?a.EndToEnd:a.EndToStart}});Ext.define('Gnt.data.DependencyStore',{extend:'Sch.data.DependencyStore',requires:['Sch.util.Date','Gnt.data.util.TaskDependencyCache'],model:'Gnt.model.Dependency',alias:'store.gantt_dependencystore',taskStore:null,methodsCache:null,strictDependencyValidation:!1,transitiveDependencyValidation:!1,allowedDependencyTypes:null,allowParentTaskDependencies:!0,autoCalculateLag:!1,constructor:function(b){var a=this;a.callParent([b]);a.init()},createEventDependencyCache:function(){return new Gnt.data.util.TaskDependencyCache(this)},init:function(){var a=this;a.methodsCache={};a.on({add:a.onDependencyAdd,update:a.onDependencyUpdate,remove:a.onDependencyRemove,priority:100,scope:a})},updateAutoCalculatedLag:function(d){if(d.getLag()===0){var h=this.model.Type,i=d.getLagUnit(),b=d.getSourceTask(),a=d.getTargetTask(),c=Sch.util.Date,f=1,e,g;switch(d.getType()){case h.StartToStart:if(a.getStartDate()<b.getStartDate()){f=-1};e=c.min(b.getStartDate(),a.getStartDate());g=c.max(b.getStartDate(),a.getStartDate());break;case h.StartToEnd:if(a.getEndDate()<b.getStartDate()){f=-1};e=c.min(b.getStartDate(),a.getEndDate());g=c.max(b.getStartDate(),a.getEndDate());break;case h.EndToStart:if(a.getStartDate()<b.getEndDate()){f=-1};e=c.min(a.getStartDate(),b.getEndDate());g=c.max(a.getStartDate(),b.getEndDate());break;case h.EndToEnd:if(a.getEndDate()<b.getEndDate()){f=-1};e=c.min(a.getEndDate(),b.getEndDate());g=c.max(a.getEndDate(),b.getEndDate());break;}var j=a.calculateDuration(e,g,i);d.setLag(f*j)}},onDependencyAdd:function(a,b){Ext.Array.each(b,function(b){var c=b.getSourceTask(),d=b.getTargetTask();if(c&&d&&!a.isUndoingOrRedoing()){a.autoCalculateLag&&a.updateAutoCalculatedLag(b)}});a.resetMethodsCache()},onDependencyRemove:function(a,b){a.resetMethodsCache()},onDependencyUpdate:function(b,c,a){if(a!=Ext.data.Model.COMMIT){b.resetMethodsCache()}},reduceTaskDependencies:function(e,b,c,d,a){return this.reduceEventDependencies(e,b,c,d,a)},reduceTaskIncomingDependencies:function(d,a,b,c){return this.reduceEventIncomingDependencies(d,a,b,c)},reduceTaskOutgoingDependencies:function(d,a,b,c){return this.reduceEventOutgoingDependencies(d,a,b,c)},mapTaskDependencies:function(d,e,b,c,a){return this.mapEventDependencies(d,e,b,c,a)},mapTaskIncomingDependencies:function(c,d,a,b){return this.mapEventIncomingDependencies(c,d,a,b)},mapTaskOutgoingDependencies:function(c,d,a,b){return this.mapEventOutgoingDependencies(c,d,a,b)},getTaskDependencies:function(b,a){return this.getEventDependencies(b,a)},getTaskIncomingDependencies:function(b,a){return this.getEventIncomingDependencies(b,a)},getTaskOutgoingDependencies:function(b,a){return this.getEventOutgoingDependencies(b,a)},getTaskPredecessors:function(b,a){return this.getEventPredecessors(b,a)},getTaskSuccessors:function(b,a){return this.getEventSuccessors(b,a)},removeTaskDependencies:function(b,a){this.removeEventDependencies(b,a)},removeTaskIncomingDependencies:function(b,a){this.removeEventIncomingDependencies(b,a)},removeTaskOutgoingDependencies:function(b,a){this.removeEventOutgoingDependencies(b,a)},getKeyByDeps:function(b,e,f){if(!b||!b.length){return ''}var d='';for(var c=0,g=b.length;c<g;c++){var a=b[c];d+=(a.getSourceId&&a.getSourceId()||a[e])+':'+(a.getTargetId&&a.getTargetId()||a[f])+','}return d},buildCacheKey:function(h,i,b,c,a){var f=a.fromField||(a.fromField=this.model.prototype.fromField),g=a.toField||(a.toField=this.model.prototype.toField),d=a.ignoreDepKey,e=a.addDepKey;if(!a.hasOwnProperty('ignoreDepKey')){a.ignoreDepKey=d=b&&this.getKeyByDeps(b,f,g)||'';a.addDepKey=e=c&&this.getKeyByDeps(c,f,g)||''}return h+'-'+i+'-'+d+'-'+e},hasTransitiveDependency:function(d,l,g,e,a){a=a||{visitedTasks:{}};var i=this.buildCacheKey(d,l,g,e,a);var n=a.visitedTasks,b=a.extraSuccessors;if(this.isCachedResultAvailable('hasTransitiveDependency',i)){return this.methodsCache.hasTransitiveDependency[i]}var s=this,q=a.fromField,r=a.toField,o=this.getTaskById(d),c,k;if(n[d]){return !1}n[d]=!0;if(o){if(e&&!b){b=a.extraSuccessors={};for(c=0,k=e.length;c<k;c++){var j=e[c];var m=j.getSourceId&&j.getSourceId()||j[q];b[m]=b[m]||[];b[m].push(j)}}var f,h=o.successors;if(b&&b[d]){h=h.concat(b[d])}for(c=0,k=h.length;c<k;c++){f=h[c];var p=f.getTargetId&&f.getTargetId()||f[r];if((!g||Ext.Array.indexOf(g,f)==-1)&&(p===l||s.hasTransitiveDependency(p,l,g,e,a))){return this.setCachedResult('hasTransitiveDependency',i,!0)}}}return this.setCachedResult('hasTransitiveDependency',i,!1)},successorsHaveTransitiveDependency:function(d,e,a,b,f){f=f||{};var c=this.buildCacheKey(d,e,a,b,f);var i=e instanceof Gnt.model.Task?e:this.getTaskById(e);if(this.isCachedResultAvailable('successorsHaveTransitiveDependency',c)){return this.methodsCache.successorsHaveTransitiveDependency[c]}for(var h=0,j=i.successors.length;h<j;h++){var g=i.successors[h].getTargetId();if(this.hasTransitiveDependency(d,g,a,b)||this.predecessorsHaveTransitiveDependency(d,g,a,b)||this.successorsHaveTransitiveDependency(d,g,a,b,f)){return this.setCachedResult('successorsHaveTransitiveDependency',c,!0)}}return this.setCachedResult('successorsHaveTransitiveDependency',c,!1)},predecessorsHaveTransitiveDependency:function(d,e,a,b,f){f=f||{};var c=this.buildCacheKey(d,e,a,b,f);var i=d instanceof Gnt.model.Task?d:this.getTaskById(d);if(this.isCachedResultAvailable('predecessorsHaveTransitiveDependency',c)){return this.methodsCache.predecessorsHaveTransitiveDependency[c]}for(var h=0,j=i.predecessors.length;h<j;h++){var g=i.predecessors[h].getSourceId();if(this.hasTransitiveDependency(g,e,a,b)||this.successorsHaveTransitiveDependency(g,e,a,b)||this.predecessorsHaveTransitiveDependency(g,e,a,b,f)){return this.setCachedResult('predecessorsHaveTransitiveDependency',c,!0)}}return this.setCachedResult('predecessorsHaveTransitiveDependency',c,!1)},isPartOfTransitiveDependency:function(a,e,c,d){var b=a instanceof Gnt.model.Task?a:this.getTaskById(a);if(!b.predecessors.length&&!b.successors.length){return !1}if(b.predecessors.length){return this.predecessorsHaveTransitiveDependency.apply(this,arguments)}else {return this.successorsHaveTransitiveDependency.apply(this,arguments)}},getCycle:function(a){a=a||{};Ext.applyIf(a,{ignoreTasks:{},visitedTasks:{},path:[],task:this.getAt(0).getSourceTask()});var c=a.visitedTasks,i=a.ignoreTasks,d=a.path,e=a.task,b=e.getId();if(i[b]){return}d.push(e);if(c[b]){return d}c[b]=!0;var g=e.successors;for(var f=0,j=g.length;f<j;f++){a.task=g[f].getTargetTask();var h=this.getCycle(a);if(h){return h}}d.pop();delete c[b]},getCycles:function(){var c=this,b=[],a={};this.each(function(f){var d=c.getCycle({task:f.getSourceTask(),ignoreTasks:a});if(d){for(var e=0,g=d.length;e<g;e++){a[d[e]]=!0}b.push(d)}});return b},resetMethodsCache:function(){this.methodsCache={}},isCachedResultAvailable:function(a,b){return this.methodsCache[a]&&this.methodsCache[a].hasOwnProperty(b)},getCachedResult:function(a,b){return this.methodsCache[a][b]},setCachedResult:function(a,c,b){this.methodsCache[a]=this.methodsCache[a]||{};this.methodsCache[a][c]=b;return b},getGroupTopTasks:function(e,f){var g=e.length,h=f.length,c=g,d=h,a,b;do{a=e[c];b=f[d];c--;d--}while(a==b&&c>=0&&d>=0);return [a,b]},groupsHasTransitiveDependency:function(t,j,c,d,w){var a=w||{targets:null,visitedTasks:{}};var x=this.getTaskStore().getRootNode(),v=!1,y=this,m=this.getTaskById(t),n=this.getTaskById(j),r=a.visitedTasks,k=a.targets;if(!a.targetGroup){a.targetGroup=n.getTopParent(!0)}var h=a.fromField||(a.fromField=this.model.prototype.fromField),l=a.toField||(a.toField=this.model.prototype.toField),q=a.ignoreDepKey,s=a.addDepKey;var u=this.getGroupTopTasks(m.getTopParent(!0),a.targetGroup),g=u[0],e=u[1];if(g===m&&e===n&&m.isLeaf()&&n.isLeaf()){return this.hasTransitiveDependency(t,j,c)}if(!a.hasOwnProperty('ignoreDepKey')){a.ignoreDepKey=q=c&&this.getKeyByDeps(c,h,l)||'';a.addDepKey=s=d&&this.getKeyByDeps(d,h,l)||''}var i=g.getId()+'-'+e.getId()+'-'+q+'-'+s;if(this.isCachedResultAvailable('groupsHasTransitiveDependency',i)){return this.methodsCache.groupsHasTransitiveDependency[i]}if(e!==a.targetTopParent){a.targetTopParent=e;k=a.targets={};e.cascadeBy(function(a){k[a.getId()]=!0})}var b=a.extraSuccessors;if(d&&!b){b=a.extraSuccessors={};for(var p=0,z=d.length;p<z;p++){var f=d[p];var o=f.getSourceId&&f.getSourceId()||f[h];b[o]=b[o]||[];b[o].push(f)}}g.cascadeBy(function(h){if(h!==x){var g=h.getId();if(r[g]){return !1}r[g]=!0;var f=h.successors;if(b&&b[g]){f=f.concat(b[g])}for(var i=0,n=f.length;i<n;i++){var e=f[i],m=e.getTargetId&&e.getTargetId()||e[l];if((!c||Ext.Array.indexOf(c,e)==-1)&&(k[m]||y.groupsHasTransitiveDependency(m,j,c,d,a))){v=!0;return !1}}}});return this.setCachedResult('groupsHasTransitiveDependency',i,v)},getDependencyError:function(d,c,i,a,j,h){var b,f,g;var n=d instanceof Gnt.model.Dependency;if(n){b=d.getSourceId();f=this.getTaskById(b);a=c;j=i;if(a&&Ext.Array.contains(a,d)){a=a.slice();Ext.Array.remove(a,d)}i=d.getType();c=d.getTargetId();g=this.getTaskById(c);if(d.store){h=d}}else {b=d;f=this.getTaskById(b);g=this.getTaskById(c);if(i===undefined){var m=this.model.getField(this.model.prototype.typeField).defaultValue;i=m!==undefined?m:this.model.Type.EndToStart}}if(!h&&n&&!d.isValid()){return -1}else {if(!b||!c||b==c){return -1}}if(!f||!g){return -2}if(!this.isValidDependencyType(i)){return -10}if(f.contains(g)||g.contains(f)){return -9}var e;if(j||h){e=[];if(h){e.push(h)}if(j){e=e.concat(j)}}if(this.transitiveDependencyValidation){if(this.hasTransitiveDependency(b,c,e,a)){return -3}}else {if(this.areTasksLinkedForward(b,c,e,a)){return -3}}if(this.hasTransitiveDependency(c,b,e,a)){return -4}if(this.transitiveDependencyValidation&&this.isPartOfTransitiveDependency(b,c,e,a)){return -5}if(this.strictDependencyValidation){if(this.groupsHasTransitiveDependency(c,b,e,a)){return -7}if(this.transitiveDependencyValidation&&this.groupsHasTransitiveDependency(b,c,e,a)){return -8}}if(!this.allowParentTaskDependencies&&(!f.isLeaf()||!g.isLeaf())){return -11}if(g.isProject||f.isProject){return -12}var l=g.getProject(),k=f.getProject();if(l!=k){if(l&&!l.getAllowDependencies()||k&&!k.getAllowDependencies()){return -13}}return 0},isValidDependencyType:function(c){if(this.allowedDependencyTypes){var a=!1,b=this.model;Ext.each(this.allowedDependencyTypes,function(d){if(b.Type[d]==c){a=!0;return !1}});return a}return !0},isValidDependency:function(c,e,f,d,b,a){return !this.getDependencyError(c,e,f,d,b,a)},areTasksLinkedForward:function(j,l,h,d){var e=j instanceof Gnt.model.Task?j:this.getTaskById(j);var f=l instanceof Gnt.model.Task?l:this.getTaskById(l);if(!e||!f){return !1}var p=this.model.prototype,i=p.fromField,k=p.toField;var c=e.getId()+'-'+f.getId()+'-'+(this.getKeyByDeps(h,i,k)||'')+'-'+(this.getKeyByDeps(d,i,k)||'');if(this.isCachedResultAvailable('areTasksLinkedForward',c)){return this.methodsCache.areTasksLinkedForward[c]}var m=e.successors,q=f.predecessors,a,b,g;for(b=0,g=m.length;b<g;b++){a=m[b];if((!h||!Ext.Array.contains(h,a))&&Ext.Array.contains(q,a)){return this.setCachedResult('areTasksLinkedForward',c,!0)}}if(d){var n,o;for(b=0,g=d.length;b<g;b++){a=d[b];n=a.getSourceId&&a.getSourceId()||a[i];o=a.getTargetId&&a.getTargetId()||a[k];if(n==e.getId()&&o==f.getId()){return this.setCachedResult('areTasksLinkedForward',c,!0)}}}return this.setCachedResult('areTasksLinkedForward',c,!1)},areTasksLinked:function(d,e){var a=d instanceof Gnt.model.Task?d:this.getTaskById(d);var b=e instanceof Gnt.model.Task?e:this.getTaskById(e);if(!a||!b){return !1}var c=a.getId()+'-'+b.getId();if(this.isCachedResultAvailable('areTasksLinked',c)){return this.methodsCache.areTasksLinked[c]}return this.setCachedResult('areTasksLinked',c,this.areTasksLinkedForward(a,b)||this.areTasksLinkedForward(b,a))},getDependencyForSourceAndTargetTasks:function(a,b){return this.getDependencyForSourceAndTargetEvents(a,b)},getTasksLinkingDependency:function(a,b){return this.getEventsLinkingDependency(a,b)},getTaskById:function(b){var a=this.getTaskStore();return a&&a.getModelById(b)||null},getSourceTask:function(a){var b=a instanceof Gnt.model.Dependency?a.getSourceId():a;return this.getTaskById(b)},getTargetTask:function(a){var b=a instanceof Gnt.model.Dependency?a.getTargetId():a;return this.getTaskById(b)},getTaskStore:function(){return this.getEventStore()},setTaskStore:function(a){var b=this;b.taskStore=a;b.setEventStore(a)}});Ext.define('Gnt.model.Resource',{extend:'Sch.model.Resource',customizableFields:['CalendarId',{name:'Rate',type:'number',defaultValue:0},{name:'RateUnit',type:'string',defaultValue:'h'},{name:'PerUseCost',type:'number',defaultValue:0}],calendarIdField:'CalendarId',rateField:'Rate',rateUnitField:'RateUnit',perUseCostField:'PerUseCost',normalized:!1,calendarWaitingListener:null,isResource:!0,getTaskStore:function(){var a=this.store||this.getTreeStore&&this.getTreeStore();return a?a.getTaskStore():null},getEventStore:function(){return this.getTaskStore()},setRate:function(b,a){if(a){this.set(this.rateUnitField,a)}this.set(this.rateField,b);this.recalculateCost()},setRateUnit:function(a){this.set(this.rateUnitField,a);this.recalculateCost()},setPerUseCost:function(a){this.set(this.perUseCostField,a);this.recalculateCost()},recalculateCost:function(){this.forEachTask(function(a){a.recalculateCost()},this)},getTasks:function(){return this.getEvents()},getCalendar:function(b){var a=this;return b?a.getOwnCalendar():a.getOwnCalendar()||a.getProjectCalendar()},getOwnCalendar:function(){var a=this.getCalendarId();return a?Gnt.data.Calendar.getCalendar(a):null},getProjectCalendar:function(){return this.getTaskStore().getCalendar()},setCalendar:function(a){var b=a instanceof Gnt.data.Calendar;if(b&&!a.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}this.setCalendarId(b?a.calendarId:a)},setCalendarId:function(a,f){if(a instanceof Gnt.data.Calendar){a=a.calendarId}var d=this.getCalendarId();if(d!=a||f){if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var c={calendarchange:this.onCalendarChange,scope:this};var e=this.calendar||Gnt.data.Calendar.getCalendar(d);this.calendar=null;e&&e.un(c);this.set(this.calendarIdField,a);var b=Gnt.data.Calendar.getCalendar(a);if(b){b.on(c);if(!f){this.onCalendarChange()}}else {this.calendarWaitingListener=Ext.data.StoreManager.on('add',function(d,e,f){b=Gnt.data.Calendar.getCalendar(a);if(b){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;b.on(c);this.onCalendarChange()}},this,{destroyable:!0})}}},onCalendarChange:function(){this.inOnCalendarChange=!0;this.adjustToCalendar();this.inOnCalendarChange=!1},adjustToCalendar:function(){this.getTaskStore()&&this.forEachTask(function(a){a.adjustToCalendar()})},assignTo:function(a,c,b){var d=a instanceof Gnt.model.Task?a:this.getTaskStore().getModelById(a);return d.assign(this,c,b)},unAssignFrom:function(a,b){var c=a instanceof Gnt.model.Task?a:this.getTaskStore().getModelById(a);return c.unAssign(this,b)},unassignFrom:function(){return this.unAssignFrom.apply(this,arguments)},forEachAssignment:function(i,b){var h=this,f=h.getTaskStore(),d=f&&f.getAssignmentStore(),e=d&&d.getAssignmentsForResource(h)||[],a,g,c;b=b||this;for(c=!1,a=0,g=e.length;!c&&a<g;++a){c=!1===i.call(b,e[a])}},forEachTask:function(j,b){var i=this,g=i.getTaskStore(),e=g&&g.getAssignmentStore(),f=e&&e.getAssignmentsForResource(i)||[],a,h,c,d;b=b||this;for(c=!1,a=0,h=f.length;!c&&a<h;++a){d=f[a].getTask();d&&(c=!1===j.call(b,d))}},collectAvailabilityIntervalPoints:function(f,h,i,a,e){for(var d=0,j=f.length;d<j;d++){var g=f[d];var b=g.startDate-0;var c=g.endDate-0;if(!a[b]){a[b]=[];e.push(b)}a[b].push(h);if(!a[c]){a[c]=[];e.push(c)}a[c].push(i)}},forEachAvailabilityIntervalWithTasks:function(i,D,t){t=t||this;var c=i.startDate;var d=i.endDate;var z=i.task;if(!c||!d){throw 'Both `startDate` and `endDate` are required for `forEachAvailabilityIntervalWithTasks`'}var g=new Date(c);var x=i.includeAllIntervals;var w=i.includeResCalIntervals;var A=this.getCalendar();var B=[];var u=[];var q=[];var b=[c-0,d-0];var e={};e[c-0]=[{type:'00-intervalStart'}];e[d-0]=[{type:'00-intervalEnd'}];this.forEachAssignment(function(f){var a=f.getTask();if(!a||z&&a!==z){return}var j=a.getStartDate();var l=a.getEndDate();var g=a.getId();if(j>d||l<c){return}u.push(a);q.push(a.getOwnCalendar()||this.getCalendar());if(a.isSegmented()){for(var i=a.getSegments(),h=0,m=i.length;h<m;h++){var k=i[h];this.collectAvailabilityIntervalPoints([{startDate:k.getStartDate(),endDate:k.getEndDate()}],{type:'05-taskStart',assignment:f,taskId:g,units:f.getUnits()},{type:'04-taskEnd',taskId:g},e,b)}}else {this.collectAvailabilityIntervalPoints([{startDate:j,endDate:l}],{type:'05-taskStart',assignment:f,taskId:g,units:f.getUnits()},{type:'04-taskEnd',taskId:g},e,b)}B.push(f)});if(!u.length&&!x&&!w){return}var C=Sch.util.Date;var a,n,s,G={};while(g<d){this.collectAvailabilityIntervalPoints(A.getAvailabilityIntervalsFor(g),{type:'00-resourceAvailabilityStart'},{type:'01-resourceAvailabilityEnd'},e,b);for(a=0,n=q.length;a<n;a++){s=u[a].getId();this.collectAvailabilityIntervalPoints(q[a].getAvailabilityIntervalsFor(g),{type:'02-taskAvailabilityStart',taskId:s},{type:'03-taskAvailabilityEnd',taskId:s},e,b)}g=C.getStartOfNextDay(g)}b.sort(function(a,b){return a-b});var y=!1,h=!1,o={},l=0,m=0;var p={};for(a=0,n=b.length-1;a<n;a++){var r=e[b[a]];r.sort(function(a,b){return a.type<b.type?1:-1});for(var v=0,F=r.length;v<F;v++){var f=r[v];switch(f.type){case '00-resourceAvailabilityStart':h=!0;break;case '01-resourceAvailabilityEnd':h=!1;break;case '02-taskAvailabilityStart':l++;p[f.taskId]=!0;break;case '03-taskAvailabilityEnd':l--;delete p[f.taskId];break;case '05-taskStart':o[f.taskId]=f;m++;break;case '04-taskEnd':delete o[f.taskId];m--;break;case '00-intervalStart':y=!0;break;case '00-intervalEnd':return;}}if(y&&(x||w&&h||h&&l&&m)){var E={inResourceCalendar:!!h,inTasksCalendar:!!l,inTask:m,inTaskCalendarHash:Ext.apply({},p)};var j=b[a];var k=b[a+1];if(j>d||k<c){continue}if(j<c){j=c-0}if(k>d){k=d-0}if(D.call(t,j,k,o,E)===!1){return !1}}}},getAllocationInfo:function(b){var a=[];this.forEachAvailabilityIntervalWithTasks(b,function(h,j,c,d){var f=0,g=[],e={},k=0,m=[],i={},n=j-h,l=0;if(d.inResourceCalendar&&d.inTasksCalendar&&d.inTask){for(var b in c){if(d.inTaskCalendarHash[b]){l+=n*c[b].units*0.01;f+=c[b].units;e[b]=c[b].assignment;g.push(c[b].assignment)}k+=c[b].units;i[b]=c[b].assignment;m.push(c[b].assignment)}}a.push(Ext.apply({startDate:new Date(h),endDate:new Date(j),effectiveTotalAllocation:f,effectiveAssignmentsHash:e,effectiveAssignments:g,totalAllocationMS:l,totalAllocation:k,assignments:m,assignmentsHash:i},d))});return a},getUtilizationInfo:function(i,j,b,c){var k=this,f=0,e=!1,d=!1,a={},g={};if(arguments.length<3){b=c=100}var h=k.getAllocationInfo({includeResCalIntervals:!0,startDate:i,endDate:j});Ext.Array.each(h,function(h){f+=h.totalAllocationMS;if(h.effectiveTotalAllocation>c){e=!0;d=!1}else {if(!e&&h.effectiveTotalAllocation<b){d=!0}}Ext.Array.each(h.effectiveAssignments,function(i){var f=i.getId(),n=i.getTaskId(),e=i.getUnits(),m=Math.floor((h.endDate-h.startDate)*e/100),j=0,l=e>c,k=e<b,d;if(a[f]){d=a[f];d.allocationMs+=m;d.allocationDeltaMs+=j;d.isOverallocated=d.isOverallocated||l;d.isUnderallocated=d.isUnderallocated||k}else {d={isUtilized:!0,allocationMs:m,allocationDeltaMs:j,isOverallocated:l,isUnderallocated:k};a[f]=d;g[n]=d}})});return {isUtilized:f>0,allocationMs:f,allocationDeltaMs:0,isOverallocated:e,isUnderallocated:d,assignmentInfo:a,taskInfo:g}}});Ext.define('Gnt.data.mixin.ResourceStore',{extend:'Ext.Mixin',taskStore:null,mixinConfig:{after:{constructor:'constructor'}},constructor:function(){this.on(this.getStoreListeners())},getStoreListeners:function(){return {load:this.normalizeResources,remove:this.onResourceRemoved,priority:100}},normalizeResources:function(){this.each(function(a){if(!a.normalized){var b=a.getCalendarId();if(b){a.setCalendarId(b,!0)}a.normalized=!0}})},onResourceRemoved:function(c,b){var a=this.getAssignmentStore();Ext.Array.each(b,function(b){a.removeAssignmentsForResource(b)})},getTaskStore:function(){return this.taskStore},setTaskStore:function(a){this.taskStore=a},getAssignmentStore:function(){var a=this.getTaskStore();return a&&a.getAssignmentStore()||null},getDependencyStore:function(){var a=this.getTaskStore();return a&&a.getDependencyStore()||null}});Ext.define('Gnt.data.ResourceStore',{requires:['Gnt.model.Resource'],mixins:['Gnt.data.mixin.ResourceStore'],extend:'Sch.data.ResourceStore',storeId:'resources',model:'Gnt.model.Resource',alias:'store.gantt_resourcestore'});Ext.define('Gnt.patches.TaskStore',{extend:'Ext.Mixin',onClassMixedIn:function(a){Ext.override(a,{onTasksLoad:function(){if(!this._refreshCalled){this.onTasksLoaded()}this.un('refresh',this.onTaskStoreRefresh,this)},onTasksBeforeLoad:function(){this._refreshCalled=!1;this.on('refresh',this.onTaskStoreRefresh,this,{priority:1001})},onTaskStoreRefresh:function(){if(!this._refreshCalled){this._refreshCalled=!0;this.onTasksLoaded()}},setupListeners:function(){this.callParent(arguments);this.on('beforeload',this.onTasksBeforeLoad,this,{priority:100});this.un({load:this.onTasksLoaded,rootchanged:this.onTasksLoaded,scope:this});this.on({load:this.onTasksLoad,rootchanged:this.onTasksLoad,scope:this})}})}});Ext.define('Gnt.data.undoredo.mixin.TaskStoreHint',{extend:'Robo.data.Store',segmentsStateByTaskId:null,onSegmentEditBegin:function(a,b){var c=this;this.segmentsStateByTaskId=this.segmentsStateByTaskId||{};if(!this.segmentsStateByTaskId.hasOwnProperty(a.internalId)){this.segmentsStateByTaskId[a.internalId]=a.buildSegmentsSnapshot()}},onSegmentEditEnd:function(a,c){var b=this;if(!b.isInUndoRedoTransaction()){delete this.segmentsStateByTaskId[a.internalId]}},onUndoRedoTransactionEnd:function(b,a){var c=this;this.segmentsStateByTaskId=null;c.callParent([b,a])},getOriginalSegmentsState:function(a){var b=this.segmentsStateByTaskId&&this.segmentsStateByTaskId[a.internalId];if(!b){var c=(a.previous||a.previousValues)[a.segmentsField];if(c){b=a.buildSegmentsSnapshot(c)}}return b}});Ext.define('Gnt.data.mixin.ProjectableStore',function(){function getByInternalId(a,b){return a.byInternalIdMap&&a.byInternalIdMap[b]||a.getByInternalId(b)}function getProjection(){var b=this,a=b.projectionStack;return a&&a[a.length-1]}function getProjectionLevel(){var b=this,a=b.projectionStack;return a&&a.length||0}function isProjecting(){return this.getProjectionLevel()>0}function areProjected(a){var c,d,b;a=[].concat(a);for(b=!1,c=0,d=a.length;!b&&c<d;c++){b=a[c].isProjected()}return b}function startProjection(){var a=this,b=a.projectionStack,c,d;if(!b){a.projectionStack=[{}]}else {d=b[b.length-1];c={};Ext.Object.each(d,function(d,b){var a=function(){};a.prototype=b;c[d]=new a()});b.push(c)}a.fireEvent('projectionstart',a,a.getProjectionLevel())}function commitProjection(){var d=this,c=d.projectionStack,e,b,i,f,g,a,h;if(c.length===1){b=c[0];d.projectionStack=null;for(a in b){if(b.hasOwnProperty(a)){h=getByInternalId(d,a);if(h){f=b[a];g=!1;for(i in f){if(f.hasOwnProperty(i)){g=!0;break}}g&&h.set(f)}}}}else {b=c.pop();e=c[c.length-1];for(a in b){if(b.hasOwnProperty(a)){if(!e.hasOwnProperty(a)){e[a]=b[a]}else {e[a]=Ext.apply(e[a],b[a])}}}}d.fireEvent('projectioncommit',d,c&&c[c.length-1],b,d.getProjectionLevel())}function rejectProjection(){var b=this,a=b.projectionStack,c=a.pop();if(a.length===0){b.projectionStack=null}b.fireEvent('projectionreject',b,a&&a[a.length-1],c,b.getProjectionLevel())}return {projectionStack:null,getProjection:getProjection,isProjecting:isProjecting,areProjected:areProjected,getProjectionLevel:getProjectionLevel,startProjection:startProjection,commitProjection:commitProjection,rejectProjection:rejectProjection}});Ext.define('Gnt.data.TaskStore',{extend:'Ext.data.TreeStore',requires:['Sch.util.Date','Sch.patches.TreeStore','Sch.patches.TreeStoreInternalIdMap','Gnt.data.Linearizator','Gnt.model.Task','Gnt.model.Project','Gnt.data.Calendar','Gnt.data.DependencyStore','Gnt.data.ResourceStore','Gnt.data.AssignmentStore'],mixins:['Gnt.patches.TaskStore','Sch.data.mixin.FilterableTreeStore','Sch.data.mixin.UniversalModelGetter','Sch.data.mixin.CacheHintHelper','Sch.data.mixin.EventStore','Gnt.data.undoredo.mixin.TaskStoreHint','Gnt.data.mixin.ProjectableStore'],model:'Gnt.model.Task',alias:'store.gantt_taskstore',storeId:'tasks',typeProperty:'TaskType',calendarManager:null,calendar:null,calendarListeners:null,dependencyStore:null,resourceStore:null,assignmentStore:null,weekendsAreWorkdays:!1,cascadeChanges:!0,batchSync:!0,recalculateParents:!0,skipWeekendsDuringDragDrop:!0,cascadeDelay:0,moveParentAsGroup:!0,enableDependenciesForParentTasks:!0,availabilitySearchLimit:1825,cycleResolutionStrategy:'cut',autoNormalizeNodes:!0,projectStartDate:null,projectEndDate:null,cascading:!1,isFillingRoot:!1,isSettingRoot:!1,earlyDatesCache:null,lateDatesCache:null,earlyDatesResetNotificationSuspended:0,earlyDatesResetNotificationRequested:0,lateDatesResetNotificationSuspended:0,lateDatesResetNotificationRequested:0,lastTotalTimeSpan:null,suspendAutoRecalculateParents:0,suspendAutoCascade:0,currentCascadeBatch:null,batchCascadeLevel:0,defaultRootText:'',dependenciesCalendar:'target',pendingDataUpdates:null,tasksLoadStarted:0,checkDependencyConstraint:!1,checkPotentialConflictConstraint:!1,scheduleByConstraints:!1,projectDateFormat:'c',constructor:function(a){a=a||{};var i='calendarManager' in a?a.calendarManager:this.getCalendarManager();delete a.calendarManager;this.setCalendarManager(i);var b=a.calendar||this.calendar;if(!b){var f={};if(a.hasOwnProperty('weekendsAreWorkdays')){f.weekendsAreWorkdays=a.weekendsAreWorkdays}else {if(this.self.prototype.hasOwnProperty('weekendsAreWorkdays')&&this.self!=Gnt.data.TaskStore){f.weekendsAreWorkdays=this.weekendsAreWorkdays}}if(this.getCalendarManager()){b=this.getCalendarManager().getProjectCalendar()}b=b&&Ext.data.StoreManager.lookup(b)||new Gnt.data.Calendar(f)}var e=a.dependencyStore||this.dependencyStore;e=e&&Ext.data.StoreManager.lookup(e)||Ext.create('Gnt.data.DependencyStore');delete a.dependencyStore;var c=a.resourceStore||this.resourceStore;c=c&&Ext.data.StoreManager.lookup(c)||Ext.create('Gnt.data.ResourceStore');delete a.resourceStore;var d=a.assignmentStore||this.assignmentStore;d=d&&Ext.data.StoreManager.lookup(d)||Ext.create('Gnt.data.AssignmentStore',{resourceStore:c});delete a.assignmentStore;if(b){delete a.calendar;this.setCalendar(b,!0,!0)}this.resetEarlyDates(!0);this.resetLateDates(!0);this.pendingDataUpdates={recalculateParents:{}};var g=a.root||this.root;this.root=null;delete a.root;this.callParent([a]);this.setResourceStore(c);this.setAssignmentStore(d);this.setDependencyStore(e);g&&this.setRoot(g);this.setupListeners();var h=this.getRoot();if(h&&this.autoNormalizeNodes){h.normalizeParent()}if(this.autoSync&&this.batchSync){this.sync=Ext.Function.createBuffered(this.sync,500)}this.initTreeFiltering()},getCrudManager:function(){return this.crudManager},setCrudManager:function(a){this.crudManager=a},getCalendarManager:function(){return this.calendarManager},setCalendarManager:function(a){a=a&&Ext.data.StoreManager.lookup(a);if(a===this.calendarManager){return}if(this.calendarManagerListeners){this.calendarManagerListeners.destroy()}this.calendarManager=a;if(a){this.projectCalendarSet=Boolean(a.getProjectCalendar());this.calendarManagerListeners=a.on({projectcalendarset:function(b,a){if(!this.settingCalendar){this.setCalendar(a,!this.projectCalendarSet);this.projectCalendarSet=!0}},scope:this,destroyable:!0})}return a},onProjectionCommit:function(e,d,a){for(var b in a){if(a.hasOwnProperty(b)){var c=this.getModelByInternalId(b);c&&c.commitSegmentsProjection()}}},onProjectionReject:function(e,d,a){for(var b in a){if(a.hasOwnProperty(b)){var c=this.getModelByInternalId(b);c&&c.rejectSegmentsProjection()}}},setupListeners:function(){this.listenersAreInitialized=!0;this.on({nodeappend:this.onMyNodeAdded,nodeinsert:this.onMyNodeAdded,update:this.onTaskUpdated,projectioncommit:this.onProjectionCommit,projectionreject:this.onProjectionReject,beforesort:function(){var a=this.getModel().getField('index');a.oldPersist=a.persist;a.persist=!1},sort:function(){var a=this.getModel().getField('index');a.persist=a.oldPersist},scope:this});this.on({noderemove:this.onTaskRemoved,nodemove:this.onTaskMoved,write:this.onTaskStoreWrite,sort:this.onTasksSorted,load:this.onTasksLoaded,scope:this,priority:100})},createResourceEventsCache:Ext.emptyFn,createIdConsistencyManager:function(){var a=this;return new Sch.data.util.IdConsistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},createModelPersistencyManager:function(){var a=this;return new Sch.data.util.ModelPersistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},fillNode:function(a,b){if(a.isRoot()){this.isSettingRoot=!0}this.callParent(arguments);if(a.isRoot()){this.isSettingRoot=!1}},onTasksLoaded:function(){var a=this.getRoot();if(a&&this.autoNormalizeNodes){a.normalizeParent()}this.onTasksLoadEnd()},onTasksLoadStart:function(){this.tasksLoadStarted++;this.suspendAutoRecalculateParents++;this.un('noderemove',this.onTaskRemoved,this);this.un('nodeappend',this.onMyNodeAdded,this);this.un('update',this.onTaskUpdated,this)},onTasksLoadEnd:function(){this.resetTotalTimeSpanCache();this.tasksLoadStarted--;if(!this.tasksLoadStarted){this.on('noderemove',this.onTaskRemoved,this);this.on('nodeappend',this.onMyNodeAdded,this);this.on('update',this.onTaskUpdated,this)}this.suspendAutoRecalculateParents--},load:function(a){this.on('beforeload',this.onTasksLoadStart,this,{priority:-999,single:!0});this.callParent(arguments)},setProxy:function(){this.callParent(arguments);if(this.typeProperty){var b=this,a=b.getProxy()&&b.getProxy().getReader();if(a&&!a.getTypeProperty()){a.setTypeProperty(b.typeProperty)}}},setRoot:function(c){var a=this;var b=this.count()&&this.getRoot();this.isSettingRoot=!0;Ext.apply(c,{calendar:a.calendar,taskStore:a,dependencyStore:a.dependencyStore,phantom:!1,dirty:!1});if(a.listenersAreInitialized){a.onTasksLoadStart()}var d=this.callParent(arguments);this.isSettingRoot=!1;if(a.listenersAreInitialized){a.onTasksLoaded()}b&&b.cascadeBy(function(a){a.setTaskStore(null)});return d},setDependencyStore:function(c){var a=this,b=a.dependencyStore,d={add:a.onDependencyAdd,update:a.onDependencyUpdate,remove:a.onDependencyDelete,scope:a};if(b&&b.isStore){b.un(d);b.setTaskStore(null);a.idConsistencyManager&&a.idConsistencyManager.setDependencyStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setDependencyStore(null)}a.dependencyStore=c&&Ext.StoreMgr.lookup(c)||null;if(a.dependencyStore){a.modelPersistencyManager&&a.modelPersistencyManager.setDependencyStore(a.dependencyStore);a.idConsistencyManager&&a.idConsistencyManager.setDependencyStore(a.dependencyStore);a.dependencyStore.setTaskStore(a);a.dependencyStore.on(d)}if((b||c)&&b!==c){a.events&&a.fireEvent('dependencystorechange',a,c,b)}},getResourceStore:function(){return this.resourceStore||null},setResourceStore:function(b){var a=this,c=a.resourceStore;if(c&&c.isStore){a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(null)}a.resourceStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.resourceStore){a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(a.resourceStore);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(a.resourceStore);a.resourceStore.setTaskStore(a);a.resourceStore.normalizeResources()}if((c||b)&&c!==b){a.events&&a.fireEvent('resourcestorechange',a,b,c)}},getAssignmentStore:function(){return this.assignmentStore||null},setAssignmentStore:function(b){var a=this,c=a.assignmentStore,d={add:a.onAssignmentStructureMutation,update:a.onAssignmentUpdate,remove:a.onAssignmentStructureMutation,scope:a};if(c&&c.isStore){c.un(d);c.setTaskStore(null);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(null)}a.assignmentStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.assignmentStore){a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(a.assignmentStore);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(a.assignmentStore);b.setTaskStore(a);b.on(d)}if((c||b)&&c!==b){a.events&&a.fireEvent('assignmentstorechange',a,b,c)}},adjustToCalendar:function(a,c){var d=this;d.resetEarlyDates();d.resetLateDates();if(a instanceof Gnt.model.Task){a.adjustToCalendar(c)}else {if(Ext.isFunction(a)){c=a;a=[]}var b=d.getRoot(),f={},e=!1;if(!Ext.isArray(a)||!a.length){a=b&&b.childNodes||[];e=!0}b&&b.propagateChanges(function(){var c=[];for(var f=0,g=a.length;f<g;f++){var d=a[f];d.cascadeBy(function(a){if(a!==b){a.adjustToCalendarWithoutPropagation()}});if(!e||!d.hasIncomingDependencies()){c.push(d)}}return c.length&&c||!1},function(b,a){if(!b){Ext.apply(f,a)}c&&c.apply(this,arguments)})}},getCalendar:function(){return this.calendar||null},setCalendar:function(a,c,d){if(this.settingCalendar){return}this.settingCalendar=!0;var e={calendarchange:function(){this.adjustToCalendar()},destroyable:!0,scope:this};if(this.calendarListeners){this.calendarListeners.destroy();this.calendarListeners=null}this.calendar=a;if(a){this.calendarListeners=a.on(e);var b=this.getRoot();if(b){b.calendar=a}if(!c){this.adjustToCalendar()}if(!d){this.fireEvent('calendarset',this,a)}if(this.getCalendarManager()){this.getCalendarManager().setProjectCalendar(a)}}this.settingCalendar=!1},getCriticalPaths:function(){var a=this,b=[],c=a.getProjects(),d=c.length===0?[a.getRoot()]:c;Ext.Array.each(d,function(c){var d=c.isProject&&c.getEndDate()||a.getProjectEndDate();c.cascadeBy(function(a){if(!a.isRoot()&&a.getEndDate()-d===0&&!(!a.isLeaf()&&a.childNodes.length)){b.push(a)}})});return Ext.Array.map(b,function(a){return a.getCriticalPaths()})},onMyNodeAdded:function(f,b){var a=this;if(!b.isRoot()){if(a.lastTotalTimeSpan){var e=a.getTotalTimeSpan();if(b.getEndDate()>e.end||b.getStartDate()<e.start){a.resetTotalTimeSpanCache()}}if(b.getEndDate()-a.getProjectEndDate()===0){a.resetLateDates()}if(!a.isUndoingOrRedoing()){var d=this.getDependencyStore(),c=!0;if(a.cascadeChanges&&!a.suspendAutoCascade&&(a.scheduleByConstraints||b.getParentsIncomingDependencies().length)){d&&d.reduceTaskDependencies(b,function(e,a){var b=a.getSourceTask(),d=a.getTargetTask();if(b&&d){b.scheduleWithoutPropagation();d.scheduleWithoutPropagation();c=!1}},null,!1);c&&b.scheduleWithoutPropagation()}if(!a.cascading&&a.recalculateParents&&!a.suspendAutoRecalculateParents){if(a.updating){a.pendingDataUpdates.recalculateParents[b.getId()]=b}else {b.recalculateParents()}}}}},onTaskUpdated:function(j,a,i){var b=a.previous;if(this.lastTotalTimeSpan){var d=this.getTotalTimeSpan();if(b&&(b[a.endDateField]-d.end===0||b[a.startDateField]-d.start===0)||(a.getEndDate()>d.end||a.getStartDate()<d.start)){this.resetTotalTimeSpanCache()}}if(!this.cascading&&i!==Ext.data.Model.COMMIT&&b&&!this.isUndoingOrRedoing()){var g=a.parentNode&&a.parentNode.previous;var f=g&&g[a.idProperty];var e=a.percentDoneField in b;if(a.startDateField in b||a.endDateField in b||'parentId' in b&&(!f||f!=b.parentId)||a.effortField in b||b[a.schedulingModeField]==='Manual'||b[a.manuallyScheduledField]){var c=a;if(this.cascadeChanges&&!this.suspendAutoCascade){if(b[c.schedulingModeField]=='Manual'){var h=c.getIncomingDependencies(!0);if(h.length){c=h[0].getSourceTask()}}this.cascadeTimer=Ext.Function.defer(c.propagateChanges,this.cascadeDelay,c,[Ext.emptyFn,null,!0])}else {this.resetEarlyDates();this.resetLateDates()}e=!0}else {if((b[a.schedulingModeField]||a.manuallyScheduledField in b)&&a.isManuallyScheduled()){this.resetEarlyDates();this.resetLateDates()}}if(e&&this.recalculateParents&&!this.suspendAutoRecalculateParents){if(this.updating){this.pendingDataUpdates.recalculateParents[a.getId()]=a}else {a.recalculateParents()}}}},onEndUpdate:function(){var c=this,a={},b;if(!this.isUndoingOrRedoing()){Ext.Object.each(c.pendingDataUpdates.recalculateParents,function(c,b){b.parentNode&&(a[b.parentNode.getId()]=b.parentNode)});a=Ext.Array.sort(Ext.Object.getValues(a),function(a,b){return a.data.depth>b.data.depth?1:a.data.depth<b.data.depth?-1:0});while(a.length>0){b=a.pop();b.refreshCalculatedParentNodeData();b.recalculateParents()}}c.pendingDataUpdates.recalculateParents={};return c.callParent(arguments)},getEmptyCascadeBatch:function(){var a=this;return {nbrAffected:0,affected:{},visitedCounters:{},addVisited:function(b){var a=b.internalId;if(!this.visitedCounters[a]){this.visitedCounters[a]=1}else {this.visitedCounters[a]++}},addAffected:function(c,f){var d=c.internalId;if(this.affected[d]){return}else {this.affected[d]=c;this.nbrAffected++}if(!a.cascading&&this.nbrAffected>1){a.fireEvent('beforecascade',a);a.cascading=!0}if(!f){var e=this.affectedParentsbyInternalId;var g=this.affectedParentsArray;var b=c.isLeaf()?c.parentNode:c;while(b&&!b.data.root){if(e[b.internalId]){break}e[b.internalId]=b;g.push(b);this.addAffected(b,!0);b=b.parentNode}}},affectedParentsArray:[],affectedParentsbyInternalId:{},parentsStartDates:{}}},startBatchCascade:function(){if(!this.batchCascadeLevel){this.currentCascadeBatch=this.getEmptyCascadeBatch();this.suspendAutoRecalculateParents++;this.suspendAutoCascade++}this.batchCascadeLevel++;return this.currentCascadeBatch},endBatchCascade:function(){this.batchCascadeLevel--;if(!this.batchCascadeLevel){this.suspendAutoRecalculateParents--;this.suspendAutoCascade--;var a=this.currentCascadeBatch;this.currentCascadeBatch=null;this.resetEarlyDates();this.resetLateDates();if(this.cascading){this.cascading=!1;this.fireEvent('cascade',this,a)}}},removeTaskDependencies:function(c){var a=this.dependencyStore,b=c.getAllDependencies(a);if(b.length){a.remove(b)}},removeTaskAssignments:function(c){var b=this.getAssignmentStore(),a=c.getAssignments();if(a.length){b.remove(a)}},onTaskRemoved:function(i,a,h){var e=this.getDependencyStore();var b=this.getAssignmentStore();var c=!a.isReplace&&!h;if(e&&c){a.cascadeBy(this.removeTaskDependencies,this)}if(b&&c){b.fireEvent('beforetaskassignmentschange',b,a.getId(),[]);a.cascadeBy(this.removeTaskAssignments,this);b.fireEvent('taskassignmentschanged',b,a.getId(),[])}var d=this.getTotalTimeSpan();var f=a.getStartDate();var g=a.getEndDate();if(g-d.end===0||f-d.start===0){this.resetTotalTimeSpanCache()}if(c){a.setTaskStore(null)}this.resetEarlyDates();this.resetLateDates()},onTaskMoved:function(b,f,e,g){var a=this.getTotalTimeSpan();var c=b.getStartDate();var d=b.getEndDate();if(d-a.end===0||c-a.start===0){this.resetTotalTimeSpanCache()}this.resetEarlyDates();this.resetLateDates()},onAssignmentUpdate:function(n,a,m){var i=this,h=a.previous,c=!0,j=a.resourceIdField,k=a.taskIdField,l=a.unitsField,d,e,b,f;for(var g in h){switch(g){case j:d=a.getResource();e=d&&d.previous;c=e&&e[d.idProperty]==h[g];break;case k:b=a.getTask();f=b&&b.previous;c=f&&f[b.idProperty]==h[g];break;case l:c=!1;break;}if(c){break}}if(!c&&!i.isUndoingOrRedoing()&&m!==Ext.data.Model.COMMIT){b=a.getTask(i);if(b){b.onAssignmentMutation(a)}}},onAssignmentStructureMutation:function(c,a){var b=this;if(!this.isUndoingOrRedoing()){Ext.Array.each([].concat(a),function(a){var c=a.getTask(b);if(c){c.onAssignmentStructureMutation(a)}})}},skipPropagationOnDependencyUpdate:function(a,m){var f=a.previous,b=!0,i=a.fromField,l=a.toField,j=a.typeField,k=a.lagField;for(var e in f){switch(e){case i:var c=a.getSourceTask();var g=c&&c.previous;b=c&&g&&g[c.idProperty]==f[e];break;case l:var d=a.getTargetTask();var h=d&&d.previous;b=d&&h&&h[d.idProperty]==f[e];break;case j:case k:b=!1;break;}if(!b){break}}return b},onDependencyUpdate:function(i,a,h,d){if(h!==Ext.data.Model.COMMIT&&!this.skipPropagationOnDependencyUpdate(a,d)){var b=this;b.resetTotalTimeSpanCache();b.resetEarlyDates();b.resetLateDates();var e,c=[];if(d&&Ext.Array.contains(d,a.toField)){var f=a.modified,g=f&&f[a.toField];e=g&&b.getNodeById(g);e&&c.push(e)}b.scheduleLinkedTasks([a],{extraTasksToReschedule:c.length&&c})}},onDependencyAdd:function(c,b){var a=this;a.resetTotalTimeSpanCache();a.resetEarlyDates();a.resetLateDates();a.scheduleLinkedTasks(b)},onDependencyDelete:function(f,c){var a=this;a.resetTotalTimeSpanCache();a.resetEarlyDates();a.resetLateDates();var d,b=[];for(var e=0;e<c.length;e++){d=c[e].getTargetTask(a);d&&b.push(d)}a.scheduleLinkedTasks(c,{extraTasksToReschedule:b.length&&b})},scheduleLinkedTasks:function(f,d){d=d||{};var a=this,e=d.extraTasksToReschedule||[];if(a.cascadeChanges&&!a.suspendAutoCascade&&!a.isUndoingOrRedoing()){var b=[],c=[].concat(e);Ext.Array.each(f,function(e){var d=e.getSourceTask(a),f=e.getTargetTask(a);if(d&&f){b.push(d);d.isUnscheduled()&&c.push(d);c.push(f)}});b=b.concat(e);b.length&&a.getRoot().propagateChanges(function(){Ext.Array.each(c,function(a){a.markForRescheduling()});return b})}},onTaskStoreWrite:function(e,c){var b=this,d=c.getRecords(),a;Ext.Array.each(d,function(b){Ext.each(b.childNodes,function(b){if(b.phantom){a=!0;return !1}})});if(a&&!this.autoSync){b.syncTimer=setTimeout(function(){b.sync()},1)}},forEachTaskUnordered:function(c,b){var a=this.getRoot();if(a){a.cascadeBy(function(d){if(d!==a){return c.call(b||this,d)}})}},getTimeSpanForTasks:function(c){var a=Sch.util.Date.MAX_VALUE,b=Sch.util.Date.MIN_VALUE;var d=function(e){var c=e.getStartDate();var d=e.getEndDate();if(c&&c<a){a=c}if(c&&d&&d>b){b=d}};if(c){if(!Ext.isArray(c)){c=[c]}Ext.Array.each(c,d)}else {this.forEachTaskUnordered(d)}a=a<Sch.util.Date.MAX_VALUE?a:null;b=b>Sch.util.Date.MIN_VALUE?b:null;return {start:a,end:b||a&&Ext.Date.add(a,Ext.Date.DAY,1)||null}},resetTotalTimeSpanCache:function(){this.lastTotalTimeSpan=null},getTotalTimeSpan:function(){if(this.lastTotalTimeSpan){return this.lastTotalTimeSpan}this.lastTotalTimeSpan=this.getTimeSpanForTasks();return this.lastTotalTimeSpan},applyMetaData:function(a){var b=a.projectStartDate,c=a.projectEndDate;if(b){if('string'==typeof b){a.projectStartDate=this.parseProjectDate(b)}this.setProjectStartDate(a.projectStartDate,!0)}if(c){if('string'==typeof c){a.projectEndDate=this.parseProjectDate(c)}this.setProjectEndDate(a.projectEndDate)}},parseProjectDate:function(a){return Ext.Date.parse(a,this.projectDateFormat)},setProjectStartDate:function(d,e){var a=this,c=a.crudManager,b=a.projectStartDate;if(!b||b-d){a.projectStartDate=d;a.fireEvent('projectstartdateset',a,null,d,b);if(!e){if(c&&c.isLoading()){c.on({load:function(){a.schedule(!0)},single:!0})}else {if(a.isLoading()){a.on({load:function(){a.schedule(!0)},single:!0})}else {a.schedule(!0)}}}}},setProjectEndDate:function(b){var a=this.projectEndDate;if(!a||a-b){this.projectEndDate=b;this.fireEvent('projectenddateset',this,null,b,a)}},getProjectStartDate:function(){return this.projectStartDate||this.getTotalTimeSpan().start},getProjectEndDate:function(){return this.projectEndDate||this.getTotalTimeSpan().end},schedule:function(d,e){var a=this,b=a.getRoot(),c=[].concat(b.childNodes);if(c.length){if(d){a.resetEarlyDates();a.resetLateDates()}a.forEachTaskUnordered(function(a){a.markForRescheduling()});b&&b.propagateChanges(function(){return c},e)}},getProjects:function(){var d=this.getRoot(),c=[],b=d.childNodes;for(var a=0,e=b.length;a<e;a++){if(b[a].isProject){c.push(b[a])}}return c},getTotalTaskCount:function(b){var a=b===!1?1:0;this.forEachTaskUnordered(function(){a++});return a},toArray:function(){var a=[];this.getRoot().cascadeBy(function(b){a.push(b)});return a},beginIndent:function(b,a){this.fireEvent('beforeindentationchange',this,b,a)},endIndent:function(b,a){this.fireEvent('indentationchange',this,b,a)},indent:function(a,f){var c=this,g=!1,b={},e,d;a=Ext.isArray(a)?a.slice():[a];a=Ext.Array.filter(a,function(b){var c;c=!!b.previousSibling;while(c&&!b.isRoot()){c=!Ext.Array.contains(a,b.parentNode);b=b.parentNode}return c});a=Ext.Array.sort(a,function(a,b){return a.get('index')-b.get('index')});a=Ext.Array.filter(a,function(a){return !(a instanceof Gnt.model.Project)});e=Ext.Array.reduce(a,function(b,a){b[a.getId()]={parentNode:a.parentNode,index:a.get('index')};return b},{});c.beginIndent(a,e);c.suspendEvent('beforeindentationchange','indentationchange');d=a.slice();(function processStep(){if(d.length){d.shift().indent(function(c,a){if(!c){b=Ext.apply(b,a);processStep()}else {g=!0;b={}}})}else {c.resumeEvent('beforeindentationchange','indentationchange');c.endIndent(a,e);f&&f(g,b)}})()},outdent:function(a,f){var c=this,g=!1,b={},e,d;a=Ext.isArray(a)?a.slice():[a];a=Ext.Array.filter(a,function(b){var c;c=b.parentNode&&!b.parentNode.isRoot();while(c&&!b.isRoot()){c=!Ext.Array.contains(a,b.parentNode);b=b.parentNode}return c});a=Ext.Array.sort(a,function(a,b){return b.get('index')-a.get('index')});e=Ext.Array.reduce(a,function(b,a){b[a.getId()]={parentNode:a.parentNode,index:a.get('index')};return b},{});c.beginIndent(a,e);c.suspendEvent('beforeindentationchange','indentationchange');d=a.slice();(function processStep(){if(d.length){d.shift().outdent(function(c,a){if(!c){b=Ext.apply(b,a);processStep()}else {g=!0;b={}}})}else {c.resumeEvent('beforeindentationchange','indentationchange');c.endIndent(a,e);f&&f(g,b)}})()},getTasksForResource:function(a){return this.getEventsForResource(a)},getResourcesForTask:function(a){return this.getResourcesForEvent(a)},forEachScheduledEvent:function(b,a){a=a||this;this.forEachTaskUnordered(function(c){var d=c.getStartDate(),e=c.getEndDate();if(d&&e){return b.call(a,c,d,e)}})},onTasksSorted:function(){if(this.lastTreeFilter){this.filterTreeBy(this.lastTreeFilter)}},append:function(a){return this.getRoot().appendChild(a)},notifyEarlyDatesReset:function(){this.fireEvent('earlydatesreset')},suspendEarlyDatesResetNotification:function(){this.earlyDatesResetNotificationSuspended++},resumeEarlyDatesResetNotification:function(a){this.earlyDatesResetNotificationSuspended&&this.earlyDatesResetNotificationSuspended--;if(!this.earlyDatesResetNotificationSuspended&&this.earlyDatesResetNotificationRequested){if(!a){this.notifyLateDatesReset()}this.earlyDatesResetNotificationRequested=0}},resetEarlyDates:function(a){this.earlyDatesCache={};if(!a){if(!this.earlyDatesResetNotificationSuspended){this.notifyEarlyDatesReset()}else {this.earlyDatesResetNotificationRequested++}}},notifyLateDatesReset:function(){this.fireEvent('latedatesreset')},suspendLateDatesResetNotification:function(){this.lateDatesResetNotificationSuspended++},resumeLateDatesResetNotification:function(a){this.lateDatesResetNotificationSuspended&&this.lateDatesResetNotificationSuspended--;if(!this.lateDatesResetNotificationSuspended&&this.lateDatesResetNotificationRequested){if(!a){this.notifyLateDatesReset()}this.lateDatesResetNotificationRequested=0}},resetLateDates:function(a){this.lateDatesCache={};if(!a){if(!this.lateDatesResetNotificationSuspended){this.notifyLateDatesReset()}else {this.lateDatesResetNotificationRequested++}}},setEarlyDateCachedValue:function(b,a){this.earlyDatesCache[b]=a},getEarlyDateCachedValue:function(a){return this.earlyDatesCache[a]},setLateDateCachedValue:function(b,a){this.lateDatesCache[b]=a},getLateDateCachedValue:function(a){return this.lateDatesCache[a]},afterUndoRedo:function(){this.resetEarlyDates();this.resetLateDates();this.mixins['Gnt.data.undoredo.mixin.TaskStoreHint'].afterUndoRedo.call(this)},getBySequenceNumber:function(a){return this.getRoot().getBySequenceNumber(a)},destroy:function(){this.setCalendar(null);this.setCalendarManager(null);this.setAssignmentStore(null);this.setDependencyStore(null);this.setResourceStore(null);if(this.calendarManagerListeners){this.calendarManagerListeners.destroy()}clearTimeout(this.cascadeTimer);clearTimeout(this.syncTimer);this.callParent(arguments)},moveSeveralTasks:function(d){var c=this.startBatchCascade();var b;while(b=d()){var a=b.task;if(a.isLeaf()||!a.childNodes.length){if(!c.affected[a.internalId]){c.addAffected(a);b.method&&a[b.method].apply(a,b.args);if(this.cascadeChanges){a.propagateChanges(Ext.emptyFn,null,!0)}}}else {if(this.recalculateParents){c.addAffected(a)}}}this.endBatchCascade()},linearWalkDependentTasks:function(c,d,b){var a=this;b=b||{self:!0,ancestors:a.recalculateParents,descendants:a.moveParentAsGroup,successors:a.cascadeChanges,cycles:a.cycleResolutionStrategy};return Gnt.data.Linearizator.linearWalkBySpecification(c,d,b)},getLinearWalkingSequenceForDependentTasks:function(c,b){var a=[];this.linearWalkDependentTasks(c,function(e,d,b,c){a.push(Array.prototype.slice.call(arguments))},b);return a},isVisible:function(c){var a=c.parentNode,b=c.get('visible'),d=this.getRoot();while(b&&a){b=a.get('expanded')&&a.get('visible');a=a.parentNode}return b&&!(c===d&&!this.getRootVisible())},removeTasks:function(a){a=[].concat(a);a=Ext.Array.filter(a,function(a){return !a.parentNode||!a.parentNode.isReadOnly()});a=Ext.Array.sort(a,function(a,b){return b.getDepth()-a.getDepth()});this.fireEvent('beforebatchremove',this,a);Ext.Array.forEach(a,function(a){a.remove()});this.fireEvent('batchremove',this,a);return a},isBackwardScheduled:function(){return this.backwardScheduling},getPrePropagationConstraints:function(b){var a=[];if(this.prePropagationConstraints){a=this.prePropagationConstraints}else {a=[];this.checkPotentialConflictConstraint&&b.getPotentialConflictConstraintClass()&&a.push(b.getPotentialConflictConstraintClass());this.prePropagationConstraints=a}return a},pinHangingTasks:function(){var a=this.getRoot();a&&a.cascadeBy(function(b){if(b!==a){if(b.getStartDate()>b.getEarlyStartDate()){b.pinWithoutPropagation()}}})}});Ext.define('Gnt.data.CrudManager',{extend:'Sch.crud.AbstractManager',mixins:['Sch.crud.encoder.Json','Sch.crud.transport.Ajax'],requires:['Gnt.data.CalendarManager','Gnt.data.TaskStore'],calendarManager:null,taskStore:null,dependencyStore:null,resourceStore:null,assignmentStore:null,addRelatedStores:!0,constructor:function(a){a=a||{};var b=a.calendarManager||this.calendarManager,h=a.taskStore||this.taskStore||new Gnt.data.TaskStore({proxy:'memory'}),c=a.assignmentStore||this.assignmentStore,e=a.resourceStore||this.resourceStore,d=a.dependencyStore||this.dependencyStore,g=[];if(a.addRelatedStores!==!1){var j=this.getTaskStoreInfo(h,a);b=b||j.calendarManager;c=c||j.assignmentStore;e=e||j.resourceStore;d=d||j.dependencyStore}if(!b){b=new Gnt.data.CalendarManager()}this.mixins.observable.constructor.call(this,a);this.addCalendarManager(b,g);if(e){g.push(e)}if(c){g.push(c)}if(d){g.push(d)}if(h){g.push(h)}if(g.length){var f=[];if(b){f.push(b)}if(e){f.push(e)}if(h){f.push(h)}if(c){f.push(c)}if(d){f.push(d)}if(f.length){a.syncApplySequence=(a.syncApplySequence||a.stores||[]).concat(f)}var i=a.stores||this.stores;if(i&&!Ext.isArray(i)){i=[i]}a.stores=(i||[]).concat(g)}this.callParent([a]);this.calendarManager=this.getStoreDescriptor(b);this.resourceStore=this.getStoreDescriptor(e);this.assignmentStore=this.getStoreDescriptor(c);this.dependencyStore=this.getStoreDescriptor(d);this.taskStore=this.getStoreDescriptor(h);this.taskStore.store.setCalendarManager(b)},onBeforeIndentationChange:function(){this.suspendChangesTracking()},onIndentationChange:function(){this.resumeChangesTracking(!0)},onBeforeBatchRemove:function(){this.suspendChangesTracking()},onBatchRemove:function(){this.resumeChangesTracking(!0)},bindStoreListeners:function(a,c){if(a instanceof Gnt.data.TaskStore){var b={beforeindentationchange:this.onBeforeIndentationChange,indentationchange:this.onIndentationChange,beforebatchremove:this.onBeforeBatchRemove,batchremove:this.onBatchRemove,scope:this};if(c){this.mun(a,b)}else {this.mon(a,b)}}return this.callParent(arguments)},getTaskStoreInfo:function(a,c){if(!a.isStore){if(typeof a=='string'){a=Ext.data.StoreManager.get(a)}else {a=a.store}}var b={},e=c.calendarManager,d=c.assignmentStore,g=c.resourceStore,f=c.dependencyStore;if(!e){b.calendarManager=a.calendarManager}if(!d){b.assignmentStore=a.getAssignmentStore()}if(!g){b.resourceStore=a.getResourceStore()}if(!f){b.dependencyStore=a.getDependencyStore()}return b},addCalendarManager:function(a,e){var b,c;if(a.isStore){b=a;c={store:a}}else {if(typeof a=='object'){b=a.store;c=a}else {a=Ext.data.StoreManager.get(a);b=a;c={store:a}}}var d=(b.getModel&&b.getModel()||b.model).prototype;if(!c.stores){c.stores=[{storeId:d.daysField,idProperty:d.idProperty}]}this.calendarManager=c;b.on('load',this.onCalendarManagerLoad,this);this.mon(b,{dayadd:this.onStoreChange,dayupdate:this.onStoreChange,dayremove:this.onStoreChange,daybulkremove:this.onStoreChange,scope:this});e.push(c)},onCalendarManagerLoad:function(a){var b=a.getProjectCalendar(),d=b&&b.getCalendarId(),c=a.metaData&&a.metaData.projectCalendar;if(d!=c){a.setProjectCalendar(c)}},applyLoadResponse:function(){var a=this.getCalendarManager();a&&a.suspendCalendarsEvents();this.callParent(arguments);if(a){a.resumeCalendarsEvents();Ext.Array.each(a.getRoot().childNodes,function(b){var a=b.getCalendar();if(a){a.resetCache()}})}},getCalendarManager:function(){return this.calendarManager&&this.calendarManager.store},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},getDependencyStore:function(){return this.dependencyStore&&this.dependencyStore.store},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store},getTaskStore:function(){return this.taskStore&&this.taskStore.store},getEventStore:function(){return this.taskStore&&this.taskStore.store},prepareUpdated:function(a,l,k){if(a[0] instanceof Gnt.model.Task){a=Ext.Array.filter(a,function(a){return !a.isRoot()});var c=this.callParent([a,l,k]);if(this.resetIdsBeforeSync){var i=a[0].segmentsField,g=Ext.ClassManager.get(a[0].segmentClassName).prototype,j=g.idProperty,h=g.phantomIdField;for(var d=0;d<c.length;d++){var b=c[d][i];if(b){for(var e=0;e<b.length;e++){var f=b[e];if(f[h]){delete f[j]}}}}}return c}return this.callParent(arguments)},prepareAdded:function(c){var b=this.callParent(arguments);if(this.resetIdsBeforeSync&&c[0] instanceof Gnt.model.Task){var f=c[0].segmentsField,g=Ext.ClassManager.get(c[0].segmentClassName).prototype.idProperty;for(var d=0;d<b.length;d++){var a=b[d][f];if(a){for(var e=0;e<a.length;e++){delete a[e][g]}}}}return b},applyChangesToTask:function(f,e){if(e.hasOwnProperty(f.segmentsField)){var a=f.getSegments(),j=f.segmentsField,i=a&&a[0].phantomIdField,k=a&&a[0].idProperty,c=e[j];if(a){if(c){for(var g=c.length-1;g>=0;g--){var d=c[g],l=d[i],m=d[k],b=null;for(var h=0;h<a.length;h++){b=a[h];if(b.get(i)==l||b.getId()==m){this.applyChangesToRecord(b,d);break}}}}delete e[j]}}},applyChangesToRecord:function(a,b,c){if(a instanceof Gnt.model.Task){this.ignoreUpdates++;this.applyChangesToTask.apply(this,arguments);this.ignoreUpdates--}this.callParent(arguments)}});Ext.define('Gnt.data.calendar.BusinessTime',{extend:'Gnt.data.Calendar',daysPerMonth:20,daysPerWeek:5,hoursPerDay:8,defaultAvailability:['08:00-12:00','13:00-17:00']});Ext.define('Gnt.data.undoredo.Manager',{extend:'Robo.Manager',uses:['Gnt.data.TaskStore','Gnt.data.undoredo.action.taskstore.Update'],getStoreTypeListeners:function(c){var b=this,a=b.callParent([c]);if(c instanceof Gnt.data.TaskStore){a.update=b.onTaskStoreUpdate;a.projectionstart=b.onTaskStoreProjectionStart;a.projectioncommit=b.onTaskStoreProjectionEnd;a.projectionreject=b.onTaskStoreProjectionEnd}return a},onTaskStoreUpdate:function(d,b,c,a){if(!this.onAnyChangeInAnyStore(d)||c!='edit'||!a||!a.length||!this.hasPersistableChanges(b,a)){return}this.currentTransaction.addAction(new Gnt.data.undoredo.action.taskstore.Update({record:b,fieldNames:a}))},onTaskStoreProjectionStart:function(c,b){var a=this;if(b==1&&a.transactionBoundary==='timeout'){if(!a.currentTransaction){a.onAnyChangeInAnyStore(c)}if(a.currentTransaction){a.hold()}}},onTaskStoreProjectionEnd:function(d,c,e,b){var a=this;if(b===0&&a.transactionBoundary==='timeout'&&a.currentTransaction){a.release()}}});Ext.define('Gnt.data.undoredo.action.taskstore.Update',{extend:'Robo.action.tree.Update',uses:['Ext.Array'],processSavingOldValue:function(c,a){var d=this,b;if(c==a.segmentsField){b=a.getTaskStore().getOriginalSegmentsState(a)}else {b=d.callParent([c,a])}return b},processSavingNewValue:function(c,a){var d=this,b;if(c===a.segmentsField){b=a.buildSegmentsSnapshot()}else {b=d.callParent([c,a])}return b},processRestoringValue:function(a,c,b){var d=this;if(c==b.segmentsField){b.rollbackSegmentsToSnapshot(a);a=d.self.CUSTOMLY_PROCESSED}else {a=d.callParent([a,c,b])}return a}});Ext.define('Gnt.feature.DragCreator',{requires:['Ext.Template','Sch.util.DragTracker','Gnt.Tooltip'],disabled:!1,showDragTip:!0,tooltipConfig:null,dragTolerance:2,template:'<div class="sch-gantt-dragcreator-proxy"></div>',validatorFn:Ext.emptyFn,validatorFnScope:null,start:null,end:null,constructor:function(a){Ext.apply(this,a||{});this.init()},init:function(){var b=this.ganttView,c=b.el,a=Ext.Function.bind;b.on({destroy:this.onGanttDestroy,scope:this});this.tracker=new Sch.util.DragTracker({el:c,tolerance:this.dragTolerance,onBeforeStart:a(this.onBeforeDragStart,this),onStart:a(this.onDragStart,this),onDrag:a(this.onDrag,this),onEnd:a(this.onDragEnd,this)});if(this.showDragTip){this.dragTip=new Gnt.Tooltip(Ext.apply({mode:'duration',cls:'gnt-dragcreate-tip',gantt:b},this.tooltipConfig))}},setDisabled:function(a){this.disabled=a;if(this.dragTip){this.dragTip.setDisabled(a)}},getProxy:function(){if(!this.proxy){var a=this.ganttView.up('tablepanel').el;if(!(this.template instanceof Ext.Template)){this.template=new Ext.Template(this.template)}this.proxy=this.template.append(a,{},!0)}return this.proxy},onBeforeDragStart:function(c){var a=this.ganttView,e=c.getTarget('.'+a.timeCellCls,2);if(e&&!this.disabled){var b=a.resolveTaskRecord(e);var d=a.getDateFromDomEvent(c);if(!b.isReadOnly()&&b.isLeaf()&&!b.getStartDate()&&!b.getEndDate()&&a.fireEvent('beforedragcreate',a,b,d,c)!==!1){c.stopEvent();this.record=b;this.originalStart=d;this.rowRegion=a.getScheduleRegion(this.record,this.originalStart);this.dateConstraints=a.getDateConstraints(this.resourceRecord,this.originalStart);return !0}}return !1},onDragStart:function(){var a=this,c=a.ganttView,b=a.getProxy();a.start=a.originalStart;a.end=a.start;a.rowBoundaries={top:a.rowRegion.top,bottom:a.rowRegion.bottom};b.setBox({x:a.tracker.startXY[0],y:a.rowBoundaries.top,height:a.rowBoundaries.bottom-a.rowBoundaries.top});b.show();c.fireEvent('dragcreatestart',c);if(a.showDragTip){a.dragTip.enable();a.dragTip.updateContent(a.start,a.end,!0,a.record);a.dragTip.showBy(b)}},onDrag:function(f){var a=this,e=a.ganttView,c=a.tracker.getRegion().constrainTo(a.rowRegion),d=e.getStartEndDatesFromRegion(c,'round');if(!d){return}a.start=d.start||a.start;a.end=d.end||a.end;var b=a.dateConstraints;if(b){a.end=Sch.util.Date.constrain(a.end,b.start,b.end);a.start=Sch.util.Date.constrain(a.start,b.start,b.end)}a.valid=a.validatorFn.call(a.validatorFnScope||a,a.record,a.start,a.end,f)!==!1;if(a.showDragTip){a.dragTip.updateContent(a.start,a.end,a.valid,a.record);a.dragTip.showBy(a.getProxy())}Ext.apply(c,a.rowBoundaries);a.getProxy().setBox(c)},onDragEnd:function(c){var a=this,d=a.ganttView,b=!0;a.createContext={start:a.start,end:a.end,e:c,record:a.record,finalize:function(){a.finalize.apply(a,arguments)}};if(a.showDragTip){a.dragTip.disable()}if(!a.start||!a.end||a.end<a.start){a.valid=!1}if(a.valid){b=d.fireEvent('beforedragcreatefinalize',a,a.createContext,c)!==!1}if(b){a.finalize(a.valid)}},finalize:function(d){var c=this,a=c.createContext,b=c.ganttView;if(d){a.record.setStartEndDate(a.start,a.end,a.record.getTaskStore().skipWeekendsDuringDragDrop);b.fireEvent('dragcreateend',b,a.record,a.e)}c.proxy.hide();b.fireEvent('afterdragcreate',b)},onGanttDestroy:function(){this.start=this.end=null;if(this.tracker){this.tracker.destroy()}if(this.dragTip){this.dragTip.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}}});Ext.define('Gnt.feature.LabelEditor',{extend:'Ext.Editor',labelPosition:'',triggerEvent:'dblclick',delegate:null,dataIndex:null,shadow:!1,completeOnEnter:!0,cancelOnEsc:!0,ignoreNoChange:!0,ganttView:null,constructor:function(b,a){this.ganttView=b;this.ganttView.on({afterrender:this.onGanttRender,destroy:this.onGanttDestroy,scope:this});if(Ext.getVersion().isGreaterThan('6.2.0')){this.ganttView.on({itemclick:this.onGanttItemClick,scope:this})}Ext.apply(this,a);if(this.labelPosition==='left'){this.alignment='r-r'}else {if(this.labelPosition==='right'){this.alignment='l-l'}else {this.alignment='c-c'}}this.delegate='.sch-gantt-label-'+this.labelPosition;this.callParent([a])},onGanttItemClick:function(){this.completeEdit()},edit:function(a){if(!a.isEditable(this.dataIndex)){return}var b=this.ganttView.getElementsFromEventRecord(a),c=b&&b[0];if(c){var d=c.up(this.ganttView.eventWrapSelector);this.record=a;if(!this.rendered){this.render(this.ganttView.getEl())}this.startEdit(d.down(this.delegate),this.dataIndex?a.get(this.dataIndex):'')}},onGanttRender:function(a){if(!this.field.width){this.autoSize='width'}this.on({beforestartedit:function(b,d,c){return a.fireEvent('labeledit_beforestartedit',a,this.record,c,b)},beforecomplete:function(c,d,b){return a.fireEvent('labeledit_beforecomplete',a,d,b,this.record,c)},complete:function(d,b,c){this.record.set(this.dataIndex,b);a.fireEvent('labeledit_complete',a,b,c,this.record,d)},scope:this});a.el.on(this.triggerEvent,function(c,b){this.edit(a.resolveTaskRecord(b))},this,{delegate:this.delegate})},onGanttDestroy:function(){this.destroy()}});Ext.define('Gnt.feature.ProgressBarResize',{requires:['Ext.ToolTip','Ext.resizer.Resizer'],useTooltip:!0,increment:10,tip:null,resizable:null,ganttView:null,constructor:function(b){Ext.apply(this,b||{});var a=this.ganttView;a.on({destroy:this.cleanUp,scope:this});a.el.on('mousedown',this.onMouseDown,this,{delegate:'.sch-gantt-progressbar-handle'});this.callParent(arguments)},onMouseDown:function(d,e){var a=this.ganttView,b=a.resolveTaskRecord(e);if(a.fireEvent('beforeprogressbarresize',a,b)!==!1){var c=Ext.fly(e).prev('.sch-gantt-progress-bar');d.stopEvent();c.addCls('sch-progress-bar-resizing');this.resizable=this.createResizable(c,b,d);a.fireEvent('progressbarresizestart',a,b);Ext.getBody().on('mouseup',this.onBodyMouseUp,this,{single:!0,delay:1})}},createResizable:function(a,c,h){var f=this.ganttView.rtl,e=a.up(this.ganttView.eventSelector),d=e.getWidth()-2*this.ganttView.eventBorderWidth,g=d*this.increment/100;var b=Ext.create('Ext.resizer.Resizer',{target:a,taskRecord:c,handles:f?'w':'e',minWidth:0,maxWidth:d,minHeight:1,widthIncrement:g,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}});b.resizeTracker.onMouseDown(h,b[f?'west':'east'].dom);e.addCls('sch-gantt-resizing');if(this.useTooltip){this.tip=Ext.create('Ext.ToolTip',{autoHide:!1,anchor:'b',html:'%'});this.tip.setTarget(a);this.tip.update(c.getPercentDone()+'%');this.tip.show()}return b},partialResize:function(c,a){var b=Math.round(a*100/(c.maxWidth*this.increment))*this.increment;if(this.tip){this.tip.body.update(b+'%')}},afterResize:function(a,c,g,f){var e=a.taskRecord;if(this.tip){this.tip.destroy();this.tip=null}var d=a.taskRecord.getPercentDone();if(Ext.isNumber(c)){var b=Math.round(c*100/(a.maxWidth*this.increment))*this.increment;b=Math.min(100,Math.max(0,b));a.taskRecord.setPercentDone(b)}if(d===a.taskRecord.getPercentDone()){this.ganttView.refreshNode(this.ganttView.indexOf(a.taskRecord))}a.destroy();this.resizable=null;this.ganttView.fireEvent('afterprogressbarresize',this.ganttView,e)},onBodyMouseUp:function(){if(this.resizable){this.afterResize(this.resizable)}},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define('Gnt.feature.TaskDragDrop',{extend:'Ext.dd.DragZone',requires:['Gnt.Tooltip','Ext.dd.StatusProxy'],useTooltip:!0,tooltipConfig:null,validatorFn:function(b,c,a,d){return !0},validatorFnScope:null,showExactDropPosition:!1,containerScroll:!1,dropAllowed:'sch-gantt-dragproxy',dropNotAllowed:'sch-gantt-dragproxy',gantt:null,lastXY:null,onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,tip:null,skipWeekendsDuringDragDrop:!1,taskSelector:null,deadlineSelector:null,invalidTargetSelector:['.'+Ext.baseCSSPrefix+'resizable-handle','.sch-resizable-handle','.sch-terminal','.sch-gantt-progressbar-handle','.sch-rollup-task','.sch-gantt-baseline-item .sch-gantt-item','.sch-gantt-baseline-item .sch-gantt-item img'].join(','),constructor:function(d,c){if(Ext.isIE&&(Ext.isIE8||Ext.ieVersion<9)&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=!0}this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:!1,dropAllowed:'sch-gantt-dragproxy',dropNotAllowed:'sch-gantt-dragproxy',ensureAttachedToBody:Ext.emptyFn});c.gantt.rtl&&this.proxy.addCls('sch-rtl');var a=this,b=c.gantt;a.callParent([d,Ext.apply(c,{ddGroup:b.id+'-task-dd'})]);if(a.useTooltip){a.tip=new Gnt.Tooltip(Ext.apply({gantt:b,constrainTo:b.el,cls:'gnt-dragdrop-tip'},a.tooltipConfig))}a.scroll=!1;a.isTarget=!0;a.ignoreSelf=!1;d.appendChild(a.proxy.el)},destroy:function(){if(this.tip){this.tip.destroy()}clearTimeout(this.validDropTimer);this.callParent(arguments)},getDragData:function(g){if(Ext.fly(g.getTarget()).is(this.invalidTargetSelector)){return}var e=g.getTarget(this.taskSelector);var r=!e&&g.getTarget(this.deadlineSelector);var c=e||r;this.lastXY=null;if(c){var b=this.gantt;var j=e&&g.getTarget('.sch-gantt-task-segment');var a=b.resolveTaskRecord(c);var h=0;var l,k,i;if(!a||a.isReadOnly()){return}if(j){h=Number(j.getAttribute('data-segmentIndex'));if(h>0){c=j;a=a.getSegment(h)}}if(e&&b.fireEvent('beforetaskdrag',b,a,g)===!1){return}var p=g.getXY();var f=c.cloneNode(!0),s=this.showExactDropPosition?0:b.getSnapPixelAmount(),o=Ext.fly(c).getXY();var d=[p[0]-o[0],p[1]-o[1]];f.id=Ext.id();var m=Ext.fly(c).getHeight();var t=Ext.fly(c).getWidth();Ext.fly(f).setHeight(m);if(Ext.isIE8m&&e&&a.isMilestone()){Ext.fly(f).setSize(m+5,m+5)}if(!b.rtl){f.style.left=-d[0]+'px'}else {f.style.left=t-d[0]+'px'}if(h>0){var u=a.getPrevSegment();var q=a.getNextSegment();l=Sch.util.Date.max(u.getEndDate(),b.timeAxis.getStart());k=q?Sch.util.Date.min(q.getStartDate(),b.timeAxis.getEnd()):b.timeAxis.getEnd();i={left:b.getCoordinateFromDate(l,!1)+d[0],right:b.getCoordinateFromDate(k,!1)-t+d[0]}}else {var n=Ext.fly(b.findItemByChild(c));if(Ext.isIE10&&Ext.getVersion().isGreaterThan('6.2.0')){n=n.down('tbody')}i=n.getRegion()}this.constrainTo(i,Ext.fly(c).getRegion(),d[0],d[1]);if(s>=1){this.setXConstraint(this.leftConstraint,this.rightConstraint,s)}return {sourceNode:c,repairXY:o,offsetX:d[0],ddel:f,record:a,prevScroll:b.getScroll(),duration:Sch.util.Date.getDurationInMinutes(a.getStartDate(),a.getEndDate()),startPointDate:b.getDateFromCoordinate(p[0]),minDate:l,maxDate:k,start:null,isTaskDrag:Boolean(e),originalStart:e?a.getStartDate():a.getDeadlineDate(),valid:Boolean(r)}}},onDragOver:function(d){var a=this.dragData,g=a.record,e=a.originalStart,c=this.gantt,j=d?d.getXY():this.lastXY;if(!j){return}var b=c.getDateFromCoordinate(j[0]);if(!a.hidden){Ext.fly(a.sourceNode).hide();a.hidden=!0}if(!b){return}var h=b-a.startPointDate;var f=new Date(e-0+h);var i=this.proxy.el;if(a.minDate){f=Sch.util.Date.constrain(new Date(e-0+h),a.minDate,a.maxDate)}if(c.timeAxis.isContinuous()){b=c.timeAxis.roundDate(f,c.snapRelativeToEventStartDate?e:!1)}else {var k=i.getX()+(c.rtl?i.getWidth():0)+c.getXOffset(g)-a.offsetX;b=c.getDateFromXY([k,0],'round')}if(a.isTaskDrag){this.onTaskDrag(g,d,b,f)}else {if(b&&b-e!==0){this.onCustomElementDrag(g,d,b)}}if(d){this.lastXY=[d.browserEvent.clientX+document.body.scrollLeft,d.getY()]}a.start=b},onTaskDrag:function(a,j,b,f){var c=this.dragData;var d=this.gantt;if(this.showExactDropPosition&&this.skipWeekendsDuringDragDrop){var g=0;var e=a.skipNonWorkingTime(b,!a.isMilestone());var h=a.recalculateEndDate(e);if(f.getTime()!=e.getTime()){g=d.timeAxisViewModel.getDistanceBetweenDates(f,e)}if(f>d.timeAxis.getStart()){Ext.fly(c.ddel.id).setWidth(d.timeAxisViewModel.getDistanceBetweenDates(e,Sch.util.Date.min(h,d.timeAxis.getEnd())));if(g){this.proxy.setX(this.proxy.getX()+g)}}}if(b&&b-c.start!==0){c.valid=this.validatorFn.call(this.validatorFnScope||d,a,b,c.duration,j)!==!1;if(this.tip){var i=a.calculateEndDate(b,a.getDuration(),a.getDurationUnit());this.updateTip(a,b,i,c.valid)}}},onCustomElementDrag:function(b,c,a){if(this.tip){this.updateTip(b,a,a,!0)}},alignElWithMouse:function(b,f,g){this.callParent(arguments);var d=this.getTargetCoord(f,g),h=b.dom?b:Ext.fly(b,'_dd'),e=this.tip;this.setLocalXY(h,d.x+this.deltaSetXY[0],d.y+this.deltaSetXY[1]);if(e){var a=this.dragData;var c=this.proxy.el.down('#'+a.ddel.id);c&&e.showBy(c,a.repairXY[0]+a.offsetX)}},onStartDrag:function(){var c=this.dragData;var a=c.record;var b=this.tip;if(b){b.enable();this.updateTip(a,this.dragData.originalStart,a.getEndDate());b.showBy(this.getProxy().getGhost(),c.repairXY[0]+c.offsetX)}if(this.dragData.isTaskDrag){this.gantt.fireEvent('taskdragstart',this.gantt,a)}this.gantt.getScrollable().on('scroll',this.onViewScroll,this);if(Ext.versions.extjs.isGreaterThan('6.2.0')){this.gantt.up('timelinetree,timelinegrid').getScrollable().on('scroll',this.onViewScroll,this)}},onViewScroll:function(){var j=this.proxy,g=this.gantt,a=this.dragData,i=g.getScroll(),b=i.left,c=i.top,h=g.rtl&&!g.up('[isViewport]');var e=j.getXY();var f;if(h){f=[e[0]-b+a.prevScroll.left,e[1]+c-a.prevScroll.top]}else {f=[e[0]+b-a.prevScroll.left,e[1]+c-a.prevScroll.top]}var d=this.deltaSetXY;if(h){this.deltaSetXY=[d[0]-b+a.prevScroll.left,d[1]+c-a.prevScroll.top]}else {this.deltaSetXY=[d[0]+b-a.prevScroll.left,d[1]+c-a.prevScroll.top]}a.prevScroll={left:b,top:c};j.setXY(f);this.onDragOver()},updateTip:function(b,a,c){if(this.dragData.isTaskDrag){if(b.isMilestone()&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.MILLI,-1);c=Sch.util.Date.add(c,Sch.util.Date.MILLI,-1)}this.tip.updateContent(a,c,!0,b)}else {this.tip.updateContent(null,a,!0,b)}},afterRepair:function(){Ext.fly(this.dragData.sourceNode).show();if(this.tip){this.tip.hide()}this.dragging=!1},getRepairXY:function(){this.dragData.isTaskDrag&&this.gantt.fireEvent('aftertaskdrop',this.gantt);return this.dragData.repairXY},onDragDrop:function(h,g){var b=this,i=b.cachedTarget||Ext.dd.DragDropMgr.getDDById(g),a=b.dragData,e=b.gantt,f=a.start,c=!0,d=a.valid&&f&&a.originalStart-f!==0;a.ddCallbackArgs=[i,h,g];if(this.tip){this.tip.disable()}if(a.isTaskDrag&&d){a.finalize=function(){b.finalize.apply(b,arguments)};c=e.fireEvent('beforetaskdropfinalize',e,a,h)!==!1}if(c){this.finalize(d)}},finalize:function(h){var a=this,b=this.dragData,c=this.gantt,d=b.record,g=b.start,e,f;if(h){e=b.originalStart;if(b.isTaskDrag){d.setStartDate(g,!0,this.skipWeekendsDuringDragDrop,function(){f=d.getStartDate();if(e-f!==0){c.fireEvent('taskdrop',c,d);if(Ext.isIE9){a.proxy.el.setStyle('visibility','hidden');a.validDropTimer=Ext.Function.defer(a.onValidDrop,10,a,b.ddCallbackArgs)}else {a.onValidDrop.apply(a,b.ddCallbackArgs)}}else {a.onInvalidDrop.apply(a,b.ddCallbackArgs)}c.fireEvent('aftertaskdrop',c,d)})}else {d.setDeadlineDate(g);a.onValidDrop.apply(a,b.ddCallbackArgs)}}else {a.onInvalidDrop.apply(a,b.ddCallbackArgs);b.isTaskDrag&&c.fireEvent('aftertaskdrop',c,d)}},onInvalidDrop:function(a,b,c){if(!b){b=a;a=a.getTarget()||document.body}if(this.tip){this.tip.disable()}return this.callParent([a,b,c])},autoOffset:function(){this.setDelta(0,0)},setXConstraint:function(c,b,a){this.leftConstraint=c;this.rightConstraint=b;this.minX=c;this.maxX=b;if(a){this.setXTicks(this.initPageX,a)}this.constrainX=!0},setYConstraint:function(c,b,a){this.topConstraint=c;this.bottomConstraint=b;this.minY=c;this.maxY=b;if(a){this.setYTicks(this.initPageY,a)}this.constrainY=!0},constrainTo:function(a,b,c,d){this.resetConstraints();this.initPageX=a.left+c;this.initPageY=b.top+d;this.setXConstraint(a.left,a.right,this.xTickSize);this.setYConstraint(b.top-1,b.top-1,this.yTickSize)},startDrag:function(){this.gantt.el.ddScrollConfig={increment:Ext.dd.ScrollManager.increment,hthresh:Ext.dd.ScrollManager.hthresh,vthresh:-1};return this.callParent(arguments)},endDrag:function(){this.gantt.getScrollable().un('scroll',this.onViewScroll,this);if(Ext.versions.extjs.isGreaterThan('6.2.0')){this.gantt.up('timelinetree,timelinegrid').getScrollable().un('scroll',this.onViewScroll,this)}delete this.gantt.el.ddScrollConfig;return this.callParent(arguments)}});Ext.define('Gnt.patches.ResizeTracker',{extend:'Sch.util.Patch',target:'Ext.resizer.ResizeTracker',minVersion:'6.5.0',overrides:{resize:function(b,f){var a=this,e=a.activeResizeHandle.region,c,d=a.setPosition;if(a.dynamic||!a.dynamic&&f){if(d){a.target.setBox(b)}else {if(e==='east'){a.target.setWidth(b.width)}else {if(e==='south'){a.target.setHeight(b.height)}else {a.target.setSize(b.width,b.height)}}}}if(!f){c=a.getProxy();if(c&&c!==a.target){if(d||a.hideProxy){c.setBox(b)}else {c.setSize(b.width,b.height)}}}}}});Ext.define('Gnt.feature.TaskResize',{requires:['Ext.resizer.Resizer','Gnt.patches.ResizeTracker','Gnt.Tooltip'],constructor:function(b){Ext.apply(this,b);var a=this.ganttView;a.on({destroy:this.onDestroy,scope:this});a.mon(a.el,'mousedown',this.onMouseDown,this,{delegate:'.sch-resizable-handle'});this.callParent(arguments)},showDuration:!0,showExactResizePosition:!1,useTooltip:!0,tooltipConfig:null,validatorFn:Ext.emptyFn,validatorFnScope:null,taskRec:null,taskEl:null,isStart:null,ganttView:null,resizable:null,mouseDownEvent:null,handlePos:null,onMouseDown:function(a,g){var c=this.ganttView;var f=a.getTarget('.sch-gantt-task-segment');var d=a.getTarget(c.eventSelector);var b=c.resolveTaskRecord(d);if(f){d=f;b=b.getSegment(parseInt(f.getAttribute('data-segmentIndex'),10))}var e=b.isResizable();if(a.button!==0||e===!1||typeof e==='string'&&!d.className.match(e)){return}if(c.fireEvent('beforetaskresize',c,b,a)===!1){return}a.stopEvent();this.mouseDownEvent=a;this.handlePos=this.getHandlePosition(g);this.taskEl=Ext.get(d);this.taskRec=b;this.isStart=!!g.className.match('sch-resizable-handle-start');c.el.on({mousemove:this.onMouseMove,mouseup:this.onMouseUp,scope:this,single:!0})},onMouseMove:function(k,n){var j=this.ganttView,b=this.taskRec,a=this.taskEl,i=j.rtl,g=this.isStart,d=i&&!g||!i&&g,c=j.getSnapPixelAmount(),l=a.getWidth(),m,h;c=Math.max(1,c);var f={otherEdgeX:d?a.getRight():a.getLeft(),target:a,record:b,isStart:g,isWest:d,handles:d?'w':'e',minHeight:1,minWidth:c,widthIncrement:c,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};if(b instanceof Gnt.model.TaskSegment&&(h=this.taskEl.next('.sch-gantt-task-segment'))){f.maxWidth=i?h.getRight()-a.getRight():h.getLeft()-a.getLeft()}f.constrainRegion=a.up(j.getItemSelector()).getRegion();a.addCls('sch-gantt-resizing');this.ganttView.fireEvent('taskresizestart',this.ganttView,this.taskRec);var e=a.down('.sch-gantt-progress-bar',!0);if(e){Ext.fly(e).setWidth(100*Ext.fly(e).getWidth()/a.getWidth()+'%')}this.resizable=Ext.create('Ext.resizer.Resizer',f);this.resizable.resizeTracker.onMouseDown(this.mouseDownEvent,this.resizable[d?'west':'east'].dom);this.resizable.resizeTracker.onMouseMove(k,this.resizable[this.handlePos].dom);if(this.useTooltip){if(!this.tip){this.tip=Ext.create('Gnt.Tooltip',Ext.apply({mode:this.showDuration?'duration':'startend',gantt:this.ganttView,constrainTo:this.ganttView.up('grid').el,cls:'gnt-resize-tip'},this.tooltipConfig))}else {this.tip.enable()}this.tip.updateContent(b.getStartDate(),b.getEndDate(),!0,b);this.tip.showBy(a,k.getX());Ext.getBody().on('mouseup',function(){this.tip.disable()},this,{single:!0})}},onMouseUp:function(b,c){var a=this.ganttView;a.el.un({mousemove:this.onMouseMove,mouseup:this.onMouseUp,scope:this,single:!0});this.mouseDownEvent=null;if(this.resizable){this.resizable.east&&this.resizable.east.destroy();this.resizable.west&&this.resizable.west.destroy()}},partialResize:function(b,m,r,q){var d=this.ganttView,n=b.isWest,a=b.record,c;if(n){c=d.getDateFromCoordinate(b.otherEdgeX-Math.min(m,this.resizable.maxWidth),!this.showExactResizePosition?'round':null)}else {c=d.getDateFromCoordinate(b.otherEdgeX+Math.min(m,this.resizable.maxWidth),!this.showExactResizePosition?'round':null)}if(!c||b.date-c===0){return}var e,f,i;if(this.showExactResizePosition){var g=d.timeAxis.roundDate(c,d.snapRelativeToEventStartDate?a.getStartDate():!1);g=a.skipNonWorkingTime(g,!a.isMilestone());var j=b.target.el,h;if(n){e=a.skipNonWorkingTime(g,!a.isMilestone());i=e;h=d.timeAxisViewModel.getDistanceBetweenDates(e,a.getEndDate());j.setWidth(h);var o=d.timeAxisViewModel.getDistanceBetweenDates(c,e);j.setX(j.getX()+o)}else {var k=Gnt.util.Data.cloneModelSet([a])[0];var l=a.getTaskStore();k.setTaskStore(l);k.setCalendar(a.getCalendar());k.setEndDateWithoutPropagation(g,!1,l.skipWeekendsDuringDragDrop);f=k.getEndDate();i=f;h=d.timeAxisViewModel.getDistanceBetweenDates(a.getStartDate(),f);j.setWidth(h)}}else {e=b.isStart?c:b.record.getStartDate();f=b.isStart?b.record.getEndDate():c;i=c}b.date=i;d.fireEvent('partialtaskresize',d,a,e,f,b.el,q);if(this.useTooltip&&this.tip){var p=this.validatorFn.call(this.validatorFnScope||this,a,e,f)!==!1;this.tip.updateContent(e,f,p,a)}},afterResize:function(b,m,l,k){if(this.useTooltip){this.tip.disable()}var a=this,c=b.record,i=c.getStartDate(),j=c.getEndDate(),d=b.isStart?b.date:i,e=b.isStart?j:b.date,g=a.ganttView,h=!1,f=!0;a.resizeContext={record:c,start:d,end:e,oldStart:c.getStartDate(),finalize:function(){a.finalize.apply(a,arguments)}};if(d&&e&&(d-i||e-j)&&a.validatorFn.call(a.validatorFnScope||a,c,d,e,k)!==!1){f=g.fireEvent('beforetaskresizefinalize',a,a.resizeContext,k)!==!1;h=!0}else {g.refreshKeepingScroll()}if(f){a.finalize(h)}},finalize:function(i){var g=this,a=g.ganttView,b=g.resizeContext,d=b.record,f=d.task||d,h=a.taskStore.skipWeekendsDuringDragDrop,e,c;if(i){if(b.start-b.oldStart!==0){e=d.getStartDate();c=b.start<=b.end?b.start:b.end;d.setStartDate(c,!1,h,function(g,b){c=d.getStartDate();if(!(c<e||c>e)){a.refreshNode(a.store.indexOf(f))}a.fireEvent('aftertaskresize',a,f)})}else {e=d.getEndDate();c=b.start<=b.end?b.end:b.start;d.setEndDate(c,!1,h,function(g,b){c=d.getEndDate();if(!(c<e||c>e)){a.refreshNode(a.store.indexOf(f))}a.fireEvent('aftertaskresize',a,f)})}}else {a.refreshNode(a.store.indexOf(f));a.fireEvent('aftertaskresize',a,f)}g.resizable.destroy();g.resizable=null;g.resizeContext=null},getHandlePosition:function(b){var a=b.className.match('start');if(this.ganttView.rtl){return a?'east':'west'}return a?'west':'east'},onDestroy:function(){if(this.tip){this.tip.destroy()}this.mouseDownEvent=null}});Ext.define('Gnt.feature.taskdd.AsyncDropHandler',{$resolveFn:null,$rejectFn:null,$processFn:null,$canceled:!1,$waiting:!1,$done:!1,constructor:function(c,d,b){var a=this;a.$resolveFn=c;a.$rejectFn=d;a.$processFn=b},isWaiting:function(){return this.$waiting},wait:function(){this.$waiting=!0},isDone:function(){return this.$done},done:function(b){var a=this;if(!a.$done&&!a.$canceled){a.$waiting=!1;a.$done=!0;a.$resolveFn(b)}},isCanceled:function(){return this.$canceled},cancel:function(b){var a=this;if(!a.$canceled&&!a.$done){a.$waiting=!1;a.$canceled=!0;a.$rejectFn(b)}},process:function(){return this.$processFn()}});Ext.define('Gnt.feature.taskdd.Proxy',{extend:'Ext.dd.StatusProxy',alias:'widget.gnt-task-ddproxy',config:{forceAttachTo:null},shadow:!1,forceStatusProc:null,lastRecievedStatus:null,destroy:function(){var a=this;a.callParent();if(a.forceStatusProc){clearTimeout(a.forceStatusProc);a.forceStatusProc=null}},applyForceAttachTo:function(a){if(a){a=Ext.get(a);if(a.dom==Ext.getBody().dom){a=null}}return a},updateForceAttachTo:function(a,b){this.forceAttach(a)},forceAttach:function(b){var c=this,a,e,d;if(c.rendered){a=c.getEl();b=b||Ext.getBody();e=c.getXY();d=b.translatePoints(e);a.hide();b.appendChild(a);a.setLocalXY(d.left,d.top);!c.hidden&&a.show()}},ensureAttachedToBody:function(a){},afterRender:function(){var a=this;a.callParent();a.forceAttach(a.getForceAttachTo())},getTaskGhostEl:function(){return Ext.fly(this.getGhost()).first(null,!0)},setStatus:function(b){var a=this;if(a.forceStatusProc){a.lastRecievedStatus=b}else {a.callParent([b])}},reset:function(b){var a=this;if(a.forceStatusProc){clearTimeout(a.forceStatusProc);a.lastRecievedStatus=null;a.forceStatusProc=null}a.callParent([b])},forceStatus:function(c,b){var a=this;if(!a.forceStatusProc){a.lastRecievedStatus=a.dropStatus;a.setStatus(c);a.forceStatusProc=Ext.Function.defer(function(){a.forceStatusProc=null;a.setStatus(a.lastRecievedStatus)},b||100)}}});Ext.define('Gnt.feature.taskdd.DropZone',function(a){function withCanHandleDropQuery(g,b,f,i,e,d){var c=0,a=[],h=function(b){++c;b&&a.push(b)};b.hasListeners[f]&&b.fireEvent.apply(b,[].concat(f,i,h));a=a.length&&a.join(' ')||g.dropAllowed;return c>0?e?e(a):a:d?d():g.dropNotAllowed}return {extend:'Ext.dd.DropZone',config:{gantt:null,ownerDragZone:null},scrollDetacher:null,lastOverEvent:null,constructor:function(c,a){var b=this;b.callParent([c,a]);b.initConfig(a)},destroy:function(){var a=this;a.setOwnerDragZone(null);a.callParent()},updateOwnerDragZone:function(b,c){var a=this;if(a.scrollDetacher){Ext.destroy(a.scrollDetacher);a.scrollDetacher=null}if(b){a.scrollDetacher=Ext.fly(a.getEl()).on('scroll',a.onDropZoneElementScroll,a,{destroyable:!0})}},onDropZoneElementScroll:function(c){var b=this,a=b.getOwnerDragZone();if(a.dragging&&b.lastOverNode){a.getProxy().setStatus(b.notifyOver(a,b.lastOverEvent,a.dragData))}},getTargetFromEvent:function(a){return a.getTarget(this.getGantt().getItemSelector())},onNodeEnter:function(c,b,f,d){var e=this,a=e.getGantt();a.hasListeners['task-row-drag-enter']&&a.fireEvent('task-row-drag-enter',a,c,b,d,f)},onNodeOut:function(f,c,b,d){var e=this,a=e.getGantt();a.hasListeners['task-row-drag-out']&&a.fireEvent('task-row-drag-out',a,f,c,d,b);if(!e.getEl().contains(b.getTarget())){a.hasListeners['schedule-drag-out']&&a.fireEvent('schedule-drag-out',a,c,d,b)}},onNodeOver:function(e,d,c,f){var a=this,b=a.getGantt();a.lastOverEvent=c;return withCanHandleDropQuery(a,b,'task-row-drag-over',[b,e,d,f,c])},onNodeDrop:function(d,b,g,e){var f=this,a=f.getGantt(),c=!1;withCanHandleDropQuery(f,a,'task-row-drag-over',[a,d,b,e,g],function onCanHandleDrop(){a.hasListeners['task-row-drag-drop']&&a.fireEvent('task-row-drag-drop',a,d,b,e,g);c=!0});return c},onContainerOver:function(c,e,d){var b=this,a=b.getGantt();return withCanHandleDropQuery(b,a,'schedule-drag-over',[a,c,d,e])},onContainerDrop:function(b,f,d){var e=this,a=e.getGantt(),c=!1;withCanHandleDropQuery(e,a,'schedule-drag-over',[a,b,d,f],function onCanHandleDrop(){a.hasListeners['schedule-drag-drop']&&a.fireEvent('schedule-drag-drop',a,b,d,f);c=!0});return c}}});Ext.define('Gnt.feature.taskdd.plugin.InRowTaskDragDrop',function(a){function positionTaskElement(c,b,d,e){var a=c.getCoordinateFromDate(d,!1),f=c.getCoordinateFromDate(e,!1);Ext.fly(b).setX(a);Ext.fly(b).setWidth(f-a)}function withSnappedTaskCoordinates(q,p,c,b,i,m,n,o,r){var l=!1,j,k,f,d,a,e,g,h;j=b.getDateFromCoordinate(q);k=j-p;a=Sch.util.Date.add(c.getStartDate(),Sch.util.Date.MILLI,k);if(i){a=b.timeAxis.roundDate(a,m?c.getStartDate():!1);if(n){a=o.call(this,c,a)}e=c.recalculateEndDate(a)}else {if(c.isSegmented()){e=Sch.util.Date.add(a,Sch.util.Date.MILLI,c.getLastSegment().getEndOffset())}else {e=Sch.util.Date.add(a,c.getDurationUnit(),c.getDuration())}}f=b.timeAxis.getStart();d=b.timeAxis.getEnd();if(Sch.util.Date.betweenLesser(a,f,d)){g=b.getCoordinateFromDate(a,!1)-b.getXOffset(c)}else {if(i&&d<=a){g=b.getCoordinateFromDate(d,!1)}else {g=b.getCoordinateFromDate(f,!1)}}if(Sch.util.Date.betweenLesser(e,f,d)){h=b.getCoordinateFromDate(e,!1)}else {h=b.getCoordinateFromDate(d,!1)}l=(r||Ext.returnTrue)(a,e,g,h);return l}function doProcessDrop(j,a,i,b,d,e,h,c,g,f){(new Ext.Promise(function(k,l){var h=new Gnt.feature.taskdd.AsyncDropHandler(k,l,f),i,j;if(a.hasListeners.beforetaskdropfinalize){j=Ext.apply({},c,{start:d,end:e,finalize:function(d){if(d){h.process();h.done()}else {positionTaskElement(a,c.ddel,b.getStartDate(),b.getEndDate());h.cancel()}}});i=!1===a.fireEvent('beforetaskdropfinalize',a,j,g);if(i){positionTaskElement(a,c.ddel,d,e)}}if(!i&&!h.isWaiting()&&!(h.isDone()||h.isCanceled())){h.process();h.done()}})).then(function(c){a.hasListeners.taskdrop&&a.fireEvent('taskdrop',a,b)}).then(undefined,function(c){a.hasListeners.taskdropcancel&&a.fireEvent('taskdropcancel',a,b)})}function doDefaultDropProcessing(d,c,a,b){c.setStartEndDate(a,b)}return {extend:'Ext.plugin.Abstract',alias:'plugin.gantt_inrowtaskdragdrop',id:'inrowtaskdragdrop',requires:['Ext.Promise','Sch.util.Date','Gnt.Tooltip','Gnt.feature.taskdd.AsyncDropHandler'],config:{gantt:null,tooltip:null,validatorFn:Ext.returnTrue,showExactDropPosition:!1,snapRelativeToEventStartDate:!1,skipWeekendsDuringDragDrop:!1,constrainDragToTaskRow:!0,dropAllowedCls:'sch-gantt-dragproxy'},ganttDetacher:null,skipWeekends:function(a,d){var b=a.getTaskStore(!0),c=b&&b.scheduleByConstraints;return a.skipNonWorkingTime(d,c?!0:!a.isMilestone())},destroy:function(){var a=this;a.setTooltip(null);a.setGantt(null);a.callParent()},enable:function(){var a=this;if(a.disabled){a.callParent();a.attachToGantt()}},disable:function(){var a=this;if(!a.disabled){a.callParent();a.detachFromGantt()}},updateGantt:function(c,b){var a=this;b&&a.detachFromGantt();c&&!a.disabled&&a.attachToGantt()},attachToGantt:function(){var a=this;a.ganttDetacher=a.getGantt().on({scope:a,destroyable:!0,'taskdragstart':a.onTaskDragStart,'task-row-drag-enter':a.onTaskRowDragEnter,'task-row-drag-out':a.onTaskRowDragOut,'task-row-drag-over':a.onTaskRowDragOver,'task-row-drag-drop':a.onTaskRowDragDrop,'schedule-drag-over':a.onTaskContainerOver,'aftertaskdrop':a.onAfterTaskDrop})},detachFromGantt:function(){var a=this;a.ganttDetacher&&(Ext.destroy(a.ganttDetacher),a.ganttDetacher=null)},applyTooltip:function(a){var b=this;if(a&&!(a instanceof Gnt.Tooltip)){a=Ext.create(Ext.apply({},a===!0?{}:a,{xclass:'Gnt.Tooltip',gantt:b.getGantt(),constrainTo:b.getGantt().getEl(),cls:'gnt-dragdrop-tip',hidden:!0,avoidPointer:!0,$ownedBy:b}))}return a},updateTooltip:function(c,a){var b=this;if(a&&a.$ownedBy===b){Ext.destroy(a)}},updateTipContent:function(e,c,a,b,d){a=a||c.getStartDate();b=b||c.getEndDate();if(c.isMilestone()&&a-Ext.Date.clearTime(a,!0)===0){a=Sch.util.Date.add(a,Sch.util.Date.MILLI,-1);b=Sch.util.Date.add(b,Sch.util.Date.MILLI,-1)}e.updateContent(a,b,d,c)},constrainProxyToInitialTaskRow:function(g,f,e,a){var h=a.getProxy(),b,c,d;h.setForceAttachTo(g.getSecondaryCanvasEl());Ext.fly(f).hide();b=Ext.fly(f).getXY();b=new Ext.util.Point(b[0],b[1]);c=Ext.fly(a.getEl()).getXY();c=new Ext.util.Point(c[0],c[1]);d=b.getOffsetsTo(c);a.setInitPosition(-d.x,-d.y);a.setDelta(e.x,e.y);a.setYConstraint(0,0)},onTaskDragStart:function(d,e,f,a,c){var b=this;if(a.isTaskDrag&&b.getConstrainDragToTaskRow()){b.constrainProxyToInitialTaskRow(d,a.ddel,a.startOffsets,c)}},onTaskRowDragEnter:function(f,e,d,a,g){var c=this,b;if(a.isTaskDrag&&Ext.fly(a.item).contains(e)){c.constrainProxyToInitialTaskRow(f,a.ddel,a.startOffsets,d);b=c.getTooltip();b&&c.updateTipContent(b,a.record);b&&b.showBy(d.getProxy().getGhost())}},onTaskRowDragOut:function(f,e,a,b,g){var d=this,c;if(b.isTaskDrag&&!d.getConstrainDragToTaskRow()&&Ext.fly(b.item).contains(e)){a.getProxy().setForceAttachTo(null);a.getProxy().removeCls(d.getDropAllowedCls());c=d.getTooltip();c&&c.hide();a.setDelta(0,0);a.clearConstraints();Ext.fly(b.ddel).show()}},onTaskRowDragOver:function(j,i,e,b,g,h){var a=this,f,c,d;if(b.isTaskDrag&&(a.getConstrainDragToTaskRow()||Ext.fly(b.item).contains(i))){h(a.getDropAllowedCls());d=b.record;f=g.getXY();withSnappedTaskCoordinates(f[0],b.startPointDate,d,j,a.getShowExactDropPosition(),a.getSnapRelativeToEventStartDate(),a.getSkipWeekendsDuringDragDrop(),a.skipWeekends,function(h,l,i,n){var m=!0,j,k;j=i+b.startOffsets.x;k=f[1]+b.startOffsets.y;e.setDragElPos(j,k);if(a.getShowExactDropPosition()){Ext.fly(e.getProxy().getTaskGhostEl()).setWidth(n-i)}if(a.getValidatorFn()){m=!1!==a.getValidatorFn()(d,h,l-h,g)}c=a.getTooltip();c&&a.updateTipContent(c,d,h,l,m);c&&c.showBy(e.getProxy().getGhost());return !0})}},onTaskRowDragDrop:function(f,e,h,c,d){var a=this,g,b;if(c.isTaskDrag&&(a.getConstrainDragToTaskRow()||Ext.fly(c.item).contains(e))){b=c.record;g=d.getXY();withSnappedTaskCoordinates(g[0],c.startPointDate,b,f,!0,a.getSnapRelativeToEventStartDate(),a.getSkipWeekendsDuringDragDrop(),a.skipWeekends,function(g,i,k,l){var j=!0;if(b.getStartDate()-g){if(a.getValidatorFn()){j=!1!==a.getValidatorFn()(b,g,i-g,d)}j&&a.processDrop(f,e,b,g,i,h,c,d,function(){doDefaultDropProcessing(a,b,g,i)})}})}},onTaskContainerOver:function(e,d,c,f,b){var a=this;if(c.isTaskDrag&&a.getConstrainDragToTaskRow()){b(a.getDropAllowedCls())}},onAfterTaskDrop:function(f,e,g,c,b){var d=this,a;if(c.isTaskDrag){b.getProxy().setForceAttachTo(null);a=d.getTooltip();a&&a.hide();b.clearConstraints();Ext.fly(c.ddel).show()}},processDrop:function(f,e,h,b,d,c,g,i,a){return doProcessDrop(this,f,e,h,b,d,c,g,i,a)}}});Ext.define('Gnt.feature.taskdd.plugin.SegmentDragDrop',function(a){function getSegmentAvailableTimespan(g,h,e){var i=h.getTask(),f=i.getSegments(),c,d,b,a;b=e>0&&f[e-1];a=e<f.length-1&&f[e+1];c=g.timeAxis.getStart();d=g.timeAxis.getEnd();return {prevSegment:b||null,nextSegment:a||null,startDate:b?b.getEndDate():null,endDate:a?a.getStartDate():null,timeAxisStartDate:c,timeAxisEndDate:d,startDateWithinAxis:b&&Sch.util.Date.betweenLesser(b.getEndDate(),c,d)||!1,endDateWithinAxis:a&&Sch.util.Date.betweenLesser(a.getStartDate(),c,d)||!1}}function withSnappedTaskSegmentCoordinates(r,p,c,q,e,j,n,o,s){var m=!1,k,l,a,d,g,i,b,f=!1,h=!1;k=e.getDateFromCoordinate(r);l=k-p;b=getSegmentAvailableTimespan(e,c,q);a=Sch.util.Date.add(c.getStartDate(),Sch.util.Date.MILLI,l);if(j){a=e.timeAxis.roundDate(a,n?c.getStartDate():!1);if(o){a=c.skipNonWorkingTime(a,!c.isMilestone())}}f=b.startDate&&a<b.startDate||!1;a=f?b.startDate:a;if(j){d=c.recalculateEndDate(a)}else {d=Sch.util.Date.add(a,c.getDurationUnit(),c.getDuration())}h=b.endDate&&d>b.endDate||!1;d=h?b.endDate:d;if(h){a=Sch.util.Date.add(d,c.getDurationUnit(),-c.getDuration());f=b.startDate&&a<b.startDate||!1;a=f?b.startDate:a}if(Sch.util.Date.betweenLesser(a,b.timeAxisStartDate,b.timeAxisEndDate)){g=e.getCoordinateFromDate(a,!1)}else {g=e.getCoordinateFromDate(b.timeAxisStartDate,!1)}if(Sch.util.Date.betweenLesser(d,b.timeAxisStartDate,b.timeAxisEndDate)){i=e.getCoordinateFromDate(d,!1)}else {i=e.getCoordinateFromDate(b.timeAxisEndDate,!1)}m=(s||Ext.returnTrue)(a,d,g,i);return m}function processDrop(f,a,i,b,c,d,h,e,g){(new Ext.Promise(function(k,l){var h=new Gnt.feature.taskdd.AsyncDropHandler(k,l,function(){doDefaultDropProcessing(f,b,c,d)}),i,j;if(a.hasListeners.beforetaskdropfinalize){j=Ext.apply({},e,{start:c,end:d,finalize:function(a){if(a){h.process();h.done()}else {h.cancel()}}});i=!1===a.fireEvent('beforetaskdropfinalize',a,j,g)}if(!i&&!h.isWaiting()&&!(h.isDone()||h.isCanceled())){h.process();h.done()}})).then(function(c){a.hasListeners.taskdrop&&a.fireEvent('taskdrop',a,b)}).then(undefined,function(c){a.hasListeners.taskdropcancel&&a.fireEvent('taskdropcancel',a,b)})}function doDefaultDropProcessing(c,b,a,d){b.setStartDate(a,!0,c.getSkipWeekendsDuringDragDrop())}function setDraggingHorizontalMovementConstrains(f,b,i,h,e,g){var a,c,d;a=getSegmentAvailableTimespan(b,i,h);if(a.startDateWithinAxis&&a.endDateWithinAxis){c=b.getCoordinateFromDate(a.startDate,!1);d=b.getCoordinateFromDate(a.endDate,!1);f.setXConstraint(e.x-c,d-e.x-g)}else {if(a.startDateWithinAxis){c=b.getCoordinateFromDate(a.startDate,!1);f.setXConstraint(e.x-c,Ext.Number.MAX_SAFE_INTEGER)}else {if(a.endDateWithinAxis){d=b.getCoordinateFromDate(a.endDate,!1);f.setXConstraint(Ext.Number.MAX_SAFE_INTEGER,d-e.x-g)}}}}return {extend:'Ext.plugin.Abstract',alias:'plugin.gantt_segmentdragdrop',id:'segmentdragdrop',requires:['Ext.Number','Ext.Promise','Sch.util.Date','Gnt.Tooltip','Gnt.feature.taskdd.AsyncDropHandler'],config:{gantt:null,tooltip:null,validatorFn:Ext.returnTrue,showExactDropPosition:!1,snapRelativeToEventStartDate:!1,skipWeekendsDuringDragDrop:!1,dropAllowedCls:'sch-gantt-dragproxy'},ganttDetacher:null,lastValidDragElX:null,lastValidDragElY:null,destroy:function(){var a=this;a.setTooltip(null);a.setGantt(null);a.callParent()},enable:function(){var a=this;if(a.disabled){a.callParent();a.attachToGantt()}},disable:function(){var a=this;if(!a.disabled){a.callParent();a.detachFromGantt()}},updateGantt:function(c,b){var a=this;b&&a.detachFromGantt();c&&!a.disabled&&a.attachToGantt()},attachToGantt:function(){var a=this;a.ganttDetacher=a.getGantt().on({scope:a,destroyable:!0,'task-row-drag-enter':a.onTaskRowDragEnter,'task-row-drag-over':a.onTaskRowDragOver,'task-row-drag-drop':a.onTaskRowDragDrop,'schedule-drag-over':a.onTaskContainerOver,'schedule-drag-out':a.onTaskContainerOut,'aftertaskdrop':a.onAfterTaskDrop})},detachFromGantt:function(){var a=this;a.ganttDetacher&&(Ext.destroy(a.ganttDetacher),a.ganttDetacher=null)},applyTooltip:function(a){var b=this;if(a&&!(a instanceof Gnt.Tooltip)){a=Ext.create(Ext.apply({},a===!0?{}:a,{xclass:'Gnt.Tooltip',gantt:b.getGantt(),constrainTo:b.getGantt().ownerGrid.getEl(),cls:'gnt-dragdrop-tip',hidden:!0,avoidPointer:!0,$ownedBy:b}))}return a},updateTooltip:function(c,a){var b=this;if(a&&a.$ownedBy===b){Ext.destroy(a)}},updateTipContent:function(d,a,b,c){b=b||a.getStartDate();c=c||a.getEndDate();d.updateContent(b,c,!0,a)},onTaskRowDragEnter:function(i,o,a,b,p){var c=this,d,e,g,n,m,j,k,l,h,f;if(b.isTaskSegmentDrag){a.getProxy().setForceAttachTo(i.getSecondaryCanvasEl());Ext.fly(b.ddel).hide();d=Ext.fly(b.ddel).getXY();d=new Ext.util.Point(d[0],d[1]);e=Ext.fly(a.getEl()).getXY();e=new Ext.util.Point(e[0],e[1]);g=d.getOffsetsTo(e);a.setInitPosition(-g.x,-g.y);a.setDelta(b.startOffsets.x,b.startOffsets.y);a.setYConstraint(0,0);h=Ext.fly(a.getProxy().getTaskGhostEl()).getWidth();setDraggingHorizontalMovementConstrains(a,i,b.record,b.segmentIndex,d,h);c.lastValidDragElX=c.lastValidDragElX!==null?c.lastValidDragElX:d.x+b.startOffsets.x;c.lastValidDragElY=c.lastValidDragElY!==null?c.lastValidDragElY:d.y+b.startOffsets.y;a.unlockDragProxyPosition();a.setDragElPos(c.lastValidDragElX,c.lastValidDrarElY);f=c.getTooltip();f&&c.updateTipContent(f,b.record);f&&f.showBy(a.getProxy().getGhost())}},onTaskRowDragOver:function(j,p,f,b,k,l){var a=this,i,e,d,h,c,n,m,o,g;if(b.isTaskSegmentDrag){l(a.getDropAllowedCls());d=b.record;h=b.segmentIndex;i=k.getXY();withSnappedTaskSegmentCoordinates(i[0],b.startPointDate,d,h,j,a.getShowExactDropPosition(),a.getSnapRelativeToEventStartDate(),a.getSkipWeekendsDuringDragDrop(),function(l,p,m,r){var n,o,q;a.lastValidDragElX=n=m+b.startOffsets.x;a.lastValidDragElY=o=i[1]+b.startOffsets.y;f.setDragElPos(n,o);if(a.getShowExactDropPosition()){g=r-m;Ext.fly(f.getProxy().getTaskGhostEl()).setWidth(g);c=Ext.fly(b.ddel).getXY();c=new Ext.util.Point(c[0],c[1]);setDraggingHorizontalMovementConstrains(f,j,d,h,c,g)}if(a.getValidatorFn()){q=!1!==a.getValidatorFn()(d,l,p-l,k)}e=a.getTooltip();e&&a.updateTipContent(e,d,l,p,q);e&&e.showBy(f.getProxy().getGhost())})}},onTaskRowDragDrop:function(f,i,h,b,d){var c=this,a,e,g;if(b.isTaskSegmentDrag){a=b.record;e=b.segmentIndex;g=d.getXY();withSnappedTaskSegmentCoordinates(g[0],b.startPointDate,a,e,f,!0,c.getSnapRelativeToEventStartDate(),c.getSkipWeekendsDuringDragDrop(),function(e,g,k,l){var j=!0;if(a.getStartDate()-e){if(c.getValidatorFn()){j=!1!==c.getValidatorFn()(a,e,g-e,d)}j&&processDrop(c,f,i,a,e,g,h,b,d)}})}},onTaskContainerOver:function(e,b,d,f,c){var a=this;if(d.isTaskSegmentDrag){c(a.getDropAllowedCls());b.setDragElPos(a.lastValidDragElX,a.lastValidDragElY);b.lockDragProxyPosition()}},onTaskContainerOut:function(d,a,c,e){var b=this;if(c.isTaskSegmentDrag){a.setDragElPos(b.lastValidDragElX,b.lastValidDragElY);a.lockDragProxyPosition()}},onAfterTaskDrop:function(f,e,g,d,a){var c=this,b;if(d.isTaskSegmentDrag){a.getProxy().setForceAttachTo(null);b=c.getTooltip();b&&b.hide();a.clearConstraints();Ext.fly(d.ddel).show();c.lastValidDragElX=c.lastValidDragElY=null;a.unlockDragProxyPosition()}}}});Ext.define('Gnt.feature.taskdd.plugin.DeadlineDragDrop',function(a){function withSnappedDeadlineCoordinate(i,e,b,h,f,g,j){var d=!1,a,c;a=b.getDateFromCoordinate(i);if(a){if(h){a=b.timeAxis.roundDate(a,f?e.getDeadlineDate():!1);if(g){a=e.skipNonWorkingTime(a,!1)}a=Sch.util.Date.max(a,b.timeAxis.getStart());a=Sch.util.Date.min(a,b.timeAxis.getEnd())}c=b.getCoordinateFromDate(a,!1);d=(j||Ext.returnTrue)(a,c)}return d}function processDrop(h,a,d,g,b,c,e,f){(new Ext.Promise(function(k,l){var i=new Gnt.feature.taskdd.AsyncDropHandler(k,l,function(){doDefaultDropProcessing(h,g,b)}),j;if(a.hasListeners['before-deadline-drop-finalize']){j=!1===a.fireEvent('before-deadline-drop-finalize',a,d,b,c,e,f,i)}if(j&&!i.isWaiting()&&(!i.isDone()||!i.isCanceled())){i.cancel()}else {if(!i.isWaiting()&&(!i.isDone()||!i.isCanceled())){i.process();i.done()}}})).then(function(g){a.hasListeners['deadline-drop-done']&&a.fireEvent('deadline-drop-done',a,d,b,c,e,f,g)}).then(undefined,function(g){a.hasListeners['deadline-drop-cancel']&&a.fireEvent('deadline-drop-cancel',a,d,b,c,e,f,g)})}function doDefaultDropProcessing(c,b,a){b.setDeadlineDate(a)}return {extend:'Ext.plugin.Abstract',alias:'plugin.gantt_deadlinedragdrop',id:'deadlinedragdrop',requires:['Ext.Promise','Sch.util.Date','Gnt.Tooltip','Gnt.feature.taskdd.AsyncDropHandler'],config:{gantt:null,tooltip:null,validatorFn:Ext.returnTrue,showExactDropPosition:!1,snapRelativeToEventStartDate:!1,skipWeekendsDuringDragDrop:!1,dropAllowedCls:'sch-gantt-dragproxy'},ganttDetacher:null,destroy:function(){var a=this;a.setTooltip(null);a.setGantt(null);a.callParent()},enable:function(){var a=this;if(a.disabled){a.callParent();a.attachToGantt()}},disable:function(){var a=this;if(!a.disabled){a.callParent();a.detachFromGantt()}},updateGantt:function(c,b){var a=this;b&&a.detachFromGantt();c&&!a.disabled&&a.attachToGantt()},attachToGantt:function(){var a=this;a.ganttDetacher=a.getGantt().on({scope:a,destroyable:!0,'task-row-drag-enter':a.onTaskRowDragEnter,'task-row-drag-over':a.onTaskRowDragOver,'task-row-drag-drop':a.onTaskRowDragDrop,'schedule-drag-over':a.onTaskContainerOver,'aftertaskdrop':a.onAfterTaskDrop})},detachFromGantt:function(){var a=this;a.ganttDetacher&&(Ext.destroy(a.ganttDetacher),a.ganttDetacher=null)},applyTooltip:function(a){var b=this;if(a&&!(a instanceof Gnt.Tooltip)){a=Ext.create(Ext.apply({},a===!0?{}:a,{xclass:'Gnt.Tooltip',gantt:b.getGantt(),constrainTo:b.getGantt().getEl(),cls:'gnt-dragdrop-tip',hidden:!0,avoidPointer:!0,$ownedBy:b}))}return a},updateTooltip:function(c,a){var b=this;if(a&&a.$ownedBy===b){Ext.destroy(a)}},updateTipContent:function(d,a,c,b){d.updateContent(null,c||a.getDeadlineDate(),b===undefined?!0:b,a)},onTaskRowDragEnter:function(h,i,a,b,j){var g=this,c,d,f,e;if(b.isDeadlineDrag){a.getProxy().setForceAttachTo(h.getSecondaryCanvasEl());Ext.fly(b.ddel).hide();c=Ext.fly(b.ddel).getXY();c=new Ext.util.Point(c[0],c[1]);d=Ext.fly(a.getEl()).getXY();d=new Ext.util.Point(d[0],d[1]);f=c.getOffsetsTo(d);a.setInitPosition(-f.x,-f.y);a.setDelta(b.startOffsets.x,b.startOffsets.y);a.setYConstraint(0,0);e=g.getTooltip();e&&g.updateTipContent(e,b.record);e&&e.showBy(a.getProxy().getGhost())}},onTaskRowDragOver:function(i,j,f,b,g,h){var a=this,e,c,d;if(b.isDeadlineDrag){h(a.getDropAllowedCls());d=b.record;e=g.getXY();withSnappedDeadlineCoordinate(e[0]-b.startOffsets.x,d,i,a.getShowExactDropPosition(),a.getSnapRelativeToEventStartDate(),a.getSkipWeekendsDuringDragDrop(),function(j,l){var k=!0,h,i;h=l+b.startOffsets.x;i=e[1]+b.startOffsets.y;f.setDragElPos(h,i);if(a.getValidatorFn()){k=!1!==a.getValidatorFn()(d,j,g)}c=a.getTooltip();c&&a.updateTipContent(c,d,j,k);c&&c.showBy(f.getProxy().getGhost());return !0})}},onTaskRowDragDrop:function(e,h,g,c,d){var a=this,f,b;if(c.isDeadlineDrag){b=c.record;f=d.getXY();withSnappedDeadlineCoordinate(f[0]-c.startOffsets.x,b,e,a.getShowExactDropPosition(),a.getSnapRelativeToEventStartDate(),a.getSkipWeekendsDuringDragDrop(),function(f,j){var i=!0;if(b.getDeadlineDate()-f){if(a.getValidatorFn()){i=!1!==a.getValidatorFn()(b,f,d)}i&&processDrop(a,e,h,b,f,g,c,d)}})}},onTaskContainerOver:function(e,d,b,f,a){var c=this;if(b.isDeadlineDrag){a(c.getDropAllowedCls())}},onAfterTaskDrop:function(f,e,g,b,c){var d=this,a;if(b.isDeadlineDrag){c.getProxy().setForceAttachTo(null);a=d.getTooltip();a&&a.hide();Ext.fly(b.ddel).show()}}}});Ext.define('Gnt.feature.taskdd.plugin.OutOfRowTaskDragDrop',function(d){var a='into',b='before',c='after';function calcSnappedDropMarkerCoordinate(j,h){var e=!1,d,g,i,f;j=Ext.fly(j);d=j.getRegion();i=d.getHeight();g=Ext.util.Region.from(d).adjust(i*0.25,0,-i*0.25,0).round();f=new Ext.util.Region(h,d.right,h,d.left);if(f.bottom<g.top){e={coord:d.top,pos:b}}else {if(f.top>g.bottom){e={coord:d.bottom,pos:c}}else {e={coord:h,pos:a}}}return e}function withSnappedDropMarkerCoordinate(d,c,b){var a;b=b||Ext.returnTrue;a=calcSnappedDropMarkerCoordinate(d,c);return b(a.coord,a.pos)}function isValidTarget(f,c,g,e,h){var d=!1,b,a;if(!Ext.fly(e.item).contains(c)){b=e.record;a=f.getRecord(c);d=a?!a.isAncestor(b):!1}return d}function doProcessDrop(a,d,c,b,e,f,g){(new Ext.Promise(function(j,k){var h=new Gnt.feature.taskdd.AsyncDropHandler(j,k,g),i;if(a.hasListeners['before-task-outrow-drop-finalize']){i=!1===a.fireEvent('before-task-outrow-drop-finalize',a,d,c,b,e,f,h)}if(i&&!h.isWaiting()&&(!h.isDone()||!h.isCanceled())){h.cancel()}else {if(!h.isWaiting()&&(!h.isDone()||!h.isCanceled())){h.process();h.done()}}})).then(function(g){a.hasListeners['task-outrow-drop-done']&&a.fireEvent('task-outrow-drop-done',a,d,c,b,e,f,g)}).then(undefined,function(g){a.hasListeners['task-outrow-drop-canceled']&&a.fireEvent('task-outrow-drop-canceled',a,d,c,b,e,f,g)})}function doDefaultDropProcessing(i,h,f,e){var d,g;d=h&&i.getRecord(h)||i.getTaskStore().getRoot();if(d){g=d.isLeaf();if(d.getTaskStore()!==e.getTaskStore()){e=e.copy(null)}if(f==a){d.appendChild(e)}else {if(f==b){d.parentNode.insertBefore(e,d)}else {if(f==c){d.parentNode.insertChild(d.parentNode.indexOf(d)+1,e)}}}if(g&&!d.isLeaf()){d.expand()}}}return {extend:'Ext.plugin.Abstract',alias:'plugin.gantt_outofrowtaskdragdrop',id:'outofrowtaskdragdrop',requires:['Ext.util.Region','Ext.util.Point','Ext.Promise','Gnt.feature.taskdd.AsyncDropHandler'],config:{gantt:null,dropMarkerCls:'gnt-taskdd-dropmarker',expandTimeout:2000,validatorFn:null},ganttDetacher:null,dropMarkerEl:null,lastOverTarget:null,animating:!1,expandProcId:null,destroy:function(){var a=this;a.destroyDropMarkerEl();a.stopScheduledExpanding();a.setGantt(null);a.callParent()},enable:function(){var a=this;if(a.disabled){a.callParent();a.attachToGantt()}},disable:function(){var a=this;if(!a.disabled){a.callParent();a.detachFromGantt()}},updateGantt:function(c,b){var a=this;b&&a.detachFromGantt();c&&!a.disabled&&a.attachToGantt()},attachToGantt:function(){var a=this;a.ganttDetacher=a.getGantt().on({scope:a,destroyable:!0,'task-row-drag-enter':a.onTaskRowDragEnter,'task-row-drag-out':a.onTaskRowDragOut,'task-row-drag-over':a.onTaskRowDragOver,'task-row-drag-drop':a.onTaskRowDragDrop,'schedule-drag-over':a.onTaskContainerOver,'schedule-drag-out':a.onTaskContainerOut,'schedule-drag-drop':a.onTaskContainerDrop,'aftertaskdrop':a.onAfterTaskDrop})},detachFromGantt:function(){var a=this;a.ganttDetacher&&(Ext.destroy(a.ganttDetacher),a.ganttDetacher=null)},hasDropMarkerEl:function(){return !!this.dropMarkerEl},getDropMarkerEl:function(){var a=this,b=a.dropMarkerEl;if(!b){b=a.dropMarkerEl=a.getGantt().getItemCanvasEl().createChild({tag:'div',cls:a.getDropMarkerCls(),style:{display:'none',width:a.getGantt().getEl().getWidth()+'px'}})}return b},reAttachDropMarkerEl:function(){var b=this,a=b.dropMarkerEl;if(a){a=b.getGantt().getItemCanvasEl().appendChild(a)}},destroyDropMarkerEl:function(){var a=this;a.dropMarkerEl&&(Ext.destroy(a.dropMarkerEl),a.dropMarkerEl=null,a.animating=!1)},stopScheduledExpanding:function(){var a=this;if(a.expandProcId){clearTimeout(a.expandProcId);a.expandProcId=null}},onTaskRowDragEnter:function(d,c,e,f,g){var a=this,b;a.lastOverTarget=c;b=d.getRecord(c);if(!b.isLeaf()&&!b.isExpanded()&&a.getExpandTimeout()){a.expandProcId=Ext.Function.defer(function(){a.stopScheduledExpanding();b.expand(!1,function(){a.reAttachDropMarkerEl()})},a.getExpandTimeout())}},onTaskRowDragOut:function(d,c,b,e,f){var a=this;a.lastOverTarget=null;a.stopScheduledExpanding()},onTaskRowDragOver:function(j,e,i,d,k,g){var b=this,f,c,h=b.getValidatorFn()||isValidTarget;if(d.isTaskDrag&&!Ext.fly(d.item).contains(e)){f=k.getXY();c=b.getDropMarkerEl();withSnappedDropMarkerCoordinate(e,f[1],function(l,k){if(!b.animating){b.animating=!0;if(k!=a&&!c.isVisible(!0)){c.show()}c.animate({to:{y:l,opacity:k==a?0:1},listeners:{afteranimate:function(){k==a&&c.hide();b.animating=!1}}})}if(h(j,e,i,d,f[1],isValidTarget)){g()}})}else {if(d.isTaskDrag&&b.hasDropMarkerEl()){b.getDropMarkerEl().hide()}}},onTaskRowDragDrop:function(c,a,f,b,e){var g=this,d,h;if(b.isTaskDrag&&!Ext.fly(b.item).contains(a)){d=e.getXY();withSnappedDropMarkerCoordinate(a,d[1],function(h,d){g.processDrop(c,a,d,f,b,e,function(){doDefaultDropProcessing(c,a,d,b.record)})})}},onTaskContainerOver:function(d,c,b,f,a){var e=this;if(b.isTaskDrag){a()}},onTaskContainerOut:function(c,b,d,e){var a=this;a.destroyDropMarkerEl()},onTaskContainerDrop:function(d,e,b,f){var c=this;if(b.isTaskDrag&&c.lastOverTarget){c.onTaskRowDragDrop(d,c.lastOverTarget,e,b,f)}else {if(b.isTaskDrag){c.processDrop(d,null,a,e,b,f,function(){doDefaultDropProcessing(d,null,a,b.record)})}}},onAfterTaskDrop:function(d,c,f,e,b){var a=this;if(a.hasDropMarkerEl()){a.destroyDropMarkerEl()}},processDrop:function(e,d,c,b,f,g,a){return doProcessDrop(e,d,c,b,f,g,a)}}});Ext.define('Gnt.feature.taskdd.plugin.ResourceDrop',function(a){function toArray(a){return a?!Ext.isArray(a)?[a]:a:[]}function isResourceAlike(a){return a.isResource||a.isUtilizationResource&&a.isSurrogateResource()}function extractResource(a){return a.isUtilizationResource?a.getOriginalResource():a}function canExtractResourcesFrom(a){return Ext.Array.some(toArray(a),function(a){return isResourceAlike(a)})}function extractResourcesFrom(a){return Ext.Array.reduce(toArray(a),function(a,b){if(isResourceAlike(b)){a.push(extractResource(b))}return a},[])}function filterOutAssignedResources(b,a){return Ext.Array.filter(toArray(a),function(a){return !b.getAssignmentFor(a)})}function canAssignResourcesTo(b,a){return filterOutAssignedResources(b,a).length>0}function assignResourcesTo(b,a){Ext.Array.each(toArray(a),function(a){b.assign(a)})}function getTargetTask(b,a){return b.ownerGrid.resolveTaskRecord(a)}return {extend:'Ext.plugin.Abstract',alias:'plugin.gantt_resourcedrop',id:'resourcedrop',config:{gantt:null},ganttDetacher:null,destroy:function(){var a=this;a.setGantt(null);a.callParent()},enable:function(){var a=this;if(a.disabled){a.callParent();a.attachToGantt()}},disable:function(){var a=this;if(!a.disabled){a.callParent();a.detachFromGantt()}},updateGantt:function(c,b){var a=this;b&&a.detachFromGantt();c&&!a.disabled&&a.attachToGantt()},attachToGantt:function(){var a=this;a.ganttDetacher=a.getGantt().on({scope:a,destroyable:!0,'task-row-drag-over':a.onTaskRowDragOver,'task-row-drag-drop':a.onTaskRowDragDrop})},detachFromGantt:function(){var a=this;a.ganttDetacher&&(Ext.destroy(a.ganttDetacher),a.ganttDetacher=null)},onTaskRowDragOver:function(e,d,f,a,g,c){var b;if(a.records&&canExtractResourcesFrom(a.records)){b=getTargetTask(e,d);if(b&&canAssignResourcesTo(b,extractResourcesFrom(a.records))){c()}}},onTaskRowDragDrop:function(e,d,f,b,g){var c,a;if(b.records&&canExtractResourcesFrom(b.records)){a=getTargetTask(e,d);if(a){c=filterOutAssignedResources(a,extractResourcesFrom(b.records));assignResourcesTo(a,c)}}}}});Ext.define('Gnt.feature.taskdd.DragZone',{extend:'Ext.dd.DragZone',requires:['Ext.mixin.Pluggable','Ext.util.Point','Ext.dd.StatusProxy','Ext.dd.DropZone','Sch.patches.DragZoneDupIds','Gnt.feature.taskdd.Proxy','Gnt.feature.taskdd.DropZone','Gnt.feature.taskdd.plugin.InRowTaskDragDrop','Gnt.feature.taskdd.plugin.SegmentDragDrop','Gnt.feature.taskdd.plugin.DeadlineDragDrop','Gnt.feature.taskdd.plugin.OutOfRowTaskDragDrop','Gnt.feature.taskdd.plugin.ResourceDrop'],mixins:{pluggable:'Ext.mixin.Pluggable'},config:{gantt:null,taskSelector:null,deadlineSelector:null,useTooltip:!0,tooltipConfig:null,validatorFn:Ext.returnTrue,validatorFnScope:null,showExactDropPosition:!1,skipWeekendsDuringDragDrop:!1,constrainDragToTaskRow:!0,rtlProxyCls:'scr-rtl',invalidTargetSelector:['.'+Ext.baseCSSPrefix+'resizable-handle','.sch-resizable-handle','.sch-terminal','.sch-gantt-progressbar-handle','.sch-rollup-task','.sch-gantt-baseline-item .sch-gantt-item'].join(','),initialProxyCls:'sch-gantt-dragproxy',inRowTaskDragDrop:!0,segmentDragDrop:!0,deadlineDragDrop:!0,outOfRowTaskDragDrop:!1,resourceDrop:!1,taskDropZone:null},containerScroll:!1,dragProxyPositionLocked:!1,constructor:function(d,b){var a=this,c;b=b||{};if(Ext.isIE&&(Ext.isIE8||Ext.ieVersion<9)&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=!0}c=a.proxy||b.proxy||{};if(!(c instanceof Ext.dd.StatusProxy)){a.proxy=Ext.create(Ext.apply({},c,{xclass:'Gnt.feature.taskdd.Proxy',$ownedBy:a}));delete b.proxy}else {a.proxy=c}b=Ext.applyIf(b,{ddGroup:b.gantt.id+'-task-dd'});a.callParent([d,b]);a.initConfig(b);a.view=a.getGantt();if(a.getGantt().rtl){a.proxy.addCls(a.getRtlProxyCls())}if(!a.getTaskDropZone()){a.setTaskDropZone({'xclass':'Gnt.feature.taskdd.DropZone',gantt:a.getGantt(),ddGroup:a.ddGroup})}if(a.getInRowTaskDragDrop()){a.addPlugin(Ext.apply({type:'gantt_inrowtaskdragdrop',gantt:a.getGantt(),tooltip:a.getUseTooltip()&&(a.getTooltipConfig()||!0),validatorFn:a.getValidatorFn()&&Ext.Function.bind(a.getValidatorFn(),a.getValidatorFnScope()||a.getGantt()),showExactDropPosition:a.getShowExactDropPosition(),skipWeekendsDuringDragDrop:a.getSkipWeekendsDuringDragDrop(),snapRelativeToEventStartDate:a.getGantt().snapRelativeToEventStartDate,constrainDragToTaskRow:a.getConstrainDragToTaskRow(),dropAllowedCls:a.getInitialProxyCls()},a.getInRowTaskDragDrop()))}if(a.getSegmentDragDrop()){a.addPlugin(Ext.apply({type:'gantt_segmentdragdrop',gantt:a.getGantt(),tooltip:a.getUseTooltip()&&(a.getTooltipConfig()||!0),validatorFn:a.getValidatorFn()&&Ext.Function.bind(a.getValidatorFn(),a.getValidatorFnScope()||a.getGantt()),showExactDropPosition:a.getShowExactDropPosition(),skipWeekendsDuringDragDrop:a.getSkipWeekendsDuringDragDrop(),snapRelativeToEventStartDate:a.getGantt().snapRelativeToEventStartDate,dropAllowedCls:a.getInitialProxyCls()},a.getSegmentDragDrop()))}if(a.getDeadlineDragDrop()){a.addPlugin(Ext.apply({type:'gantt_deadlinedragdrop',gantt:a.getGantt(),tooltip:a.getUseTooltip()&&(a.getTooltipConfig()||!0),showExactDropPosition:a.getShowExactDropPosition(),skipWeekendsDuringDragDrop:a.getSkipWeekendsDuringDragDrop(),snapRelativeToEventStartDate:a.getGantt().snapRelativeToEventStartDate,dropAllowedCls:a.getInitialProxyCls()},a.getDeadlineDragDrop()))}if(a.getOutOfRowTaskDragDrop()){a.setConstrainDragToTaskRow(!0);a.addPlugin(Ext.apply({type:'gantt_outofrowtaskdragdrop',gantt:a.getGantt()},a.getOutOfRowTaskDragDrop()))}if(a.getResourceDrop()){a.addPlugin(Ext.apply({type:'gantt_resourcedrop',gantt:a.getGantt()},a.getResourceDrop()))}},destroy:function(){var a=this;a.setPlugins(null);a.proxy&&a.proxy.$ownedBy==a&&Ext.destroy(a.proxy);a.taskDropZone&&a.taskDropZone.getOwnerDragZone()==a&&Ext.destroy(a.taskDropZone);a.callParent()},applyTaskDropZone:function(a){var b=this;if(!(a instanceof Ext.dd.DropZone)){a=Ext.apply({},a||{},{'xclass':'Gnt.feature.taskdd.DropZone',gantt:b.getGantt(),ddGroup:b.ddGroup,ownerDragZone:b});a=Ext.create(a.xclass,b.getEl(),a)}return a},isValidHandleChild:function(a){var b=this;return b.callParent([a])&&!Ext.fly(a).is(b.getInvalidTargetSelector())},getPointFromEvent:function(a){return Ext.util.Point.from(Ext.isIE9m?{x:a.browserEvent.clientX,y:a.browserEvent.clientY}:{x:a.pageX,y:a.pageY})},getDragData:function(c){var a=this,o=a.getGantt(),f=null,i,b,d,l,h,q,e,n,p,g,m,j,k;i=c.getTarget(a.taskSelector);b=i&&c.getTarget('.sch-gantt-task-segment');d=Number(b&&b.getAttribute('data-segmentIndex'));l=!i&&c.getTarget(a.deadlineSelector);q=c.getTarget(o.getItemSelector());h=b&&d>0&&b||i||l;e=h&&o.resolveTaskRecord(h);if(e&&b&&d>0){e=e.getSegment(d)}m=!!i&&(!b||d===0);j=!!b&&d>0;k=!!l;if(e&&(m&&(a.getInRowTaskDragDrop()||a.getOutOfRowTaskDragDrop())||j&&a.getSegmentDragDrop()||k&&a.getDeadlineDragDrop())){n=a.getPointFromEvent(c);p=o.getDateFromDomEvent(c);g=n.getOffsetsTo(Ext.fly(h).getRegion());g=new Ext.util.Point(g.x,g.y);f={ddel:h,record:e,records:[e],item:q,segmentIndex:d,startPoint:n,startPointDate:p,startOffsets:g,isTaskDrag:m,isTaskSegmentDrag:j,isDeadlineDrag:k}}else {f=Ext.Array.reduce(a.getPlugins(),function(a,b){if(!a&&Ext.isFunction(b.getDragData)){a=b.getDragData(c)}return a},null)}if(f){f=Ext.Array.reduce(a.getPlugins(),function(a,b){if(Ext.isFunction(b.extendDragData)){a=b.extendDragData(c,a)}return a},f)}return f},onBeforeDrag:function(c,d){var a=this,b=!0;if(a.gantt.hasListeners.beforetaskdrag){b=!1!==a.gantt.fireEvent('beforetaskdrag',a.gantt,c.record,d,c,a)}if(b){a.cachedViewportSize={width:Ext.Element.getViewportWidth(),height:Ext.Element.getViewportHeight()}}return b},onStartDrag:function(d,e){var a=this,b=a.dragData,c=a.getProxy();c.forceStatus(a.getInitialProxyCls());a.prepareProxyForDragging(c,b,d,e);a.setDelta(b.startOffsets.x,b.startOffsets.y);a.alignElWithMouse(c.getEl(),d,e);return a.gantt.hasListeners.taskdragstart&&a.gantt.fireEvent('taskdragstart',a.gantt,b.record,{x:d,y:e},a.dragData,a)},onEndDrag:function(b,c){var a=this;return a.gantt.hasListeners.aftertaskdrop&&a.gantt.fireEvent('aftertaskdrop',a.gantt,b.record,c,b,a)},afterRepair:function(){this.dragging=!1},prepareProxyForDragging:function(b,a,d,e){var c=Ext.fly(a.ddel).getHeight();Ext.fly(b.getTaskGhostEl()).setHeight(c);if(a.isTaskDrag&&a.record.isMilestone()){Ext.fly(b.getTaskGhostEl()).setWidth(Ext.fly(a.ddel).getWidth())}},lockDragProxyPosition:function(){this.dragProxyPositionLocked=!0},unlockDragProxyPosition:function(){this.dragProxyPositionLocked=!1},alignElWithMouse:function(j,h,i){var c=this,b=c.getTargetCoord(h,i),e=c.getProxy(),d=e.getSize(),g=e.getForceAttachTo(),f=c.cachedViewportSize,a;if(!c.dragProxyPositionLocked){a=e.translatePoints(b.x,b.y);if(!g){if(a.left<0){b.x=a.left=c.lastPageX||0}else {if(a.left>=f.width-d.width){b.x=a.left=c.lastPageX||f.width-d.width}}if(a.top<0){b.y=a.top=c.lastPageY||0}else {if(a.top>=f.height-d.height){b.y=a.top=c.lastPageY||f.height-d.height}}}e.setLocalXY(a.left,a.top);c.cachePosition(b.x,b.y);if(!e.getForceAttachTo()){c.autoScroll(b.x,b.y,d.width,d.height)}}return b}});Ext.define('Gnt.field.ReadOnly',{extend:'Ext.form.field.Checkbox',mixins:['Gnt.field.mixin.TaskField','Gnt.mixin.Localizable'],alias:'widget.readonlyfield',alternateClassName:['Gnt.widget.ReadOnlyField'],fieldProperty:'readOnlyField',setTaskValueMethod:'setReadOnly',getTaskValueMethod:'getReadOnly',instantUpdate:!0,initEvents:function(){var a=this;a.on('change',a.onFieldValueChange,a);return a.callParent()},valueToVisible:function(a){return a?this.L('yes'):this.L('no')},onFieldValueChange:function(a,b,c){if(a.instantUpdate&&!a.getSuppressTaskUpdate()&&a.task){a.applyChanges()}}});Ext.define('Gnt.model.TaskSegment',{extend:'Gnt.model.Task',task:null,customizableFields:[{name:'StartOffset',type:'int',defaultValue:null},{name:'EndOffset',type:'int',defaultValue:null}],startOffsetField:'StartOffset',endOffsetField:'EndOffset',taskNotifyingSuspended:0,constructor:function(a){a=a||{};a.leaf=!0;if(!a.task){throw "'task' has to be specified"}this.task=a.task;this.callParent(arguments);Ext.override(this,this.overridables);if(this.getTask().normalized&&this.getTaskStore(!0)&&!this.normalized){this.normalize()}},overridables:{set:function(){var a=this.getTask();if(a&&!this.__editCounter&&!this.taskNotifyingSuspended){a.onSegmentEditBegin(this)}this.callParent(arguments);if(a&&!this.__editCounter&&!this.taskNotifyingSuspended){a.onSegmentEditEnd(this)}}},serialize:function(){var a={};if(this.getId()){a[this.idProperty]=this.getId()}a[this.phantomIdField]=this.getPhantomId();a[this.startDateField]=this.getStartDate();a[this.endDateField]=this.getEndDate();a[this.durationField]=this.getDuration();a[this.durationUnitField]=this.getDurationUnit();a[this.clsField]=this.getCls();return a},setStartOffset:function(a){var c=this.getTask().getProjectCalendar();var b=c.convertMSDurationToUnit(this.getEndOffset()-a,this.getDurationUnit());this.beginEdit();this.set(this.startOffsetField,a);this.set(this.durationField,b);this.endEdit()},setEndOffset:function(a){var c=this.getTask().getProjectCalendar();var b=c.convertMSDurationToUnit(a-this.getStartOffset(),this.getDurationUnit());this.beginEdit();this.set(this.endOffsetField,a);this.set(this.durationField,b);this.endEdit()},setStartEndOffset:function(a,b){var d=this.getTask().getProjectCalendar();var c=d.convertMSDurationToUnit(b-a,this.getDurationUnit());this.beginEdit();this.set(this.startOffsetField,a);this.set(this.endOffsetField,b);this.set(this.durationField,c);this.endEdit()},normalize:function(){this.callParent(arguments);var c=this.getStartDate();if(!Ext.isNumber(this.getStartOffset())&&c){var d=this.getTask();var a=this.calculateDuration(d.getStartDate(),c,'MILLI');var b=a+this.getDuration('MILLI');var f=d.getProjectCalendar();var e=f.convertMSDurationToUnit(b-a,this.getDurationUnit());this.data[this.startOffsetField]=a;this.data[this.endOffsetField]=b;this.data[this.durationField]=e}},updateOffsetsByDates:function(){if(!this.getTaskStore(!0)){return}if(this.updatingOffsets||this.updatingDates){return}this.updatingOffsets=!0;var a=this.calculateDuration(this.getTask().getStartDate(),this.getStartDate(),'MILLI');this.setStartEndOffset(a,a+this.getDuration('MILLI'));this.updatingOffsets=!1},updateDatesByOffsets:function(b){b=b||{};if(this.updatingDates||this.updatingOffsets){return}var f=b.isForward!==!1,d=b.useAbsoluteOffset!==!1,g=b.startDate,h=b.endDate,e=this.getTaskStore(!0);if(!e){return}this.updatingDates=!0;var c,a;if(f){a=this.getPrevSegment();if(a&&!d){c=this.skipWorkingTime(a.getEndDate(),this.getStartOffset()-a.getEndOffset())}else {c=this.skipWorkingTime(g||this.getTask().getStartDate(),this.getStartOffset())}}else {a=this.getNextSegment();if(a&&!d){c=this.skipWorkingTime(a.getStartDate(),a.getStartOffset()-this.getEndOffset()+this.getDuration('MILLI'),!1)}else {c=this.skipWorkingTime(h||this.getTask().getEndDate(),this.getDuration('MILLI'),!1)}}this.setStartDateWithoutPropagation(c,!0,e.skipWeekendsDuringDragDrop);this.updatingDates=!1},getPrevSegment:function(){var a=this.task.getSegments();return a[Ext.Array.indexOf(a,this)-1]},getNextSegment:function(){var a=this.task.getSegments();return a[Ext.Array.indexOf(a,this)+1]},buildSnapshot:function(){return [this,Ext.apply({},this.data)]},readSnapshot:function(a){var b=a;if(a){Ext.apply(this.data,a[1]);b=this}return b},suspendTaskNotifying:function(){this.taskNotifyingSuspended++},resumeTaskNotifying:function(){this.taskNotifyingSuspended--},setStartDateWithoutPropagation:function(f,b,e){this.beginEdit();this.callParent(arguments);b=b!==!1;this.updateOffsetsByDates();if(b){if(!this.inShifting&&this.getNextSegment()){var a=this.getNextSegment();var d=this.getEndOffset()-a.getStartOffset();if(a&&d>0){a.suspendTaskNotifying();a.shiftWithoutPropagation(d,!0);a.resumeTaskNotifying()}}}else {if(!this.getDuration()){var c=this.getTask();c.suspendSegmentsTracking();c.removeSegments(this);c.resumeSegmentsTracking()}}this.endEdit();return !0},shiftWithoutPropagation:function(c,d){var a=this,b;if(c){a.beginEdit();a.inShifting=!0;a.setStartEndOffset(a.getStartOffset()+c,a.getEndOffset()+c);a.updateDatesByOffsets();if(d){b=c>0?a.getNextSegment():a.getPrevSegment();if(b){b.suspendTaskNotifying();b.shiftWithoutPropagation(c,!0);b.resumeTaskNotifying()}}a.inShifting=!1;a.endEdit()}return !0},setEndDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);if(!this.getDuration()){var a=this.getTask();a.suspendSegmentsTracking();a.removeSegments(this);a.resumeSegmentsTracking()}this.updateOffsetsByDates();this.endEdit();return !0},setStartEndDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);if(!this.getDuration()){var a=this.getTask();a.suspendSegmentsTracking();a.removeSegments(this);a.resumeSegmentsTracking()}this.updateOffsetsByDates();this.endEdit();return !0},setDurationWithoutPropagation:function(c,b){var a=this,d,e;b=b||a.getDurationUnit();a.beginEdit();if(Ext.isNumber(c)){if(a.getStartDate()){e=a.calculateEndDate(a.getStartDate(),c,b)}else {if(a.getEndDate()){d=a.calculateStartDate(a.getEndDate(),c,b)}}}a.set(a.durationField,c);a.set(a.durationUnitField,b);if(e){a.set(a.endDateField,e)}if(d){a.set(a.startDateField,d)}if(!a.getDuration()){var f=a.getTask();f.suspendSegmentsTracking();f.removeSegments(a);f.resumeSegmentsTracking()}a.updateOffsetsByDates();a.endEdit();return !0},getTask:function(){return this.task},beginEdit:function(){var a=this.getTask();if(a&&!this.__editCounter&&!this.taskNotifyingSuspended){a.onSegmentEditBegin(this)}this.callParent(arguments)},endEdit:function(){var a=this.previous,b=this.getTask();this.callParent(arguments);if(b&&!this.__editCounter&&!this.taskNotifyingSuspended){if(this.startDateField in a||this.endDateField in a||this.startOffsetField in a||this.endOffsetField in a||this.durationField in a){b.onSegmentsChanged(this,a)}b.onSegmentEditEnd(this)}},setSegments:Ext.emptyFn,setSegmentsWithoutPropagation:Ext.emptyFn,getSegments:Ext.emptyFn,callTask:function(d){var c=this.task;var b=this.callTask.caller;var a=b&&c[b.$name];if(a){return a.apply(c,d)}},getSchedulingMode:function(){return 'Normal'},getCalendar:function(){return this.callTask(arguments)},getOwnCalendar:function(){return this.callTask(arguments)},getProjectCalendar:function(){return this.callTask(arguments)},getDependencyStore:function(){return this.callTask(arguments)},getResourceStore:function(){return this.callTask(arguments)},getAssignmentStore:function(){return this.callTask(arguments)},getTaskStore:function(){return this.callTask(arguments)},forEachAvailabilityInterval:function(a){a.segments=a.segments||!1;return this.callTask(arguments)},propagateChanges:function(){return this.callTask(arguments)},rejectSegmentsProjection:function(){return this.callTask(arguments)},commitSegmentsProjection:function(){return this.callTask(arguments)},getAssignments:function(){return this.callTask(arguments)},getAssignmentFor:function(){return this.callTask(arguments)},isAssignedTo:function(){return this.callTask(arguments)},getResources:function(){return this.callTask(arguments)},autoCalculateCost:!1,recalculateCost:Ext.emptyFn,copy:function(a,f,e){var c=this,b=Ext.apply({},e,c.data),d=c.idProperty,g=c.self;if(a||a===0){b[d]=a}else {if(a===null){delete b[d]}}return new g(b,f)}});Ext.define('Gnt.model.Week',{extend:'Ext.data.Model',idProperty:'Id',fields:[{name:'Id'},{name:'name',type:'string'},{name:'startDate',type:'date'},{name:'endDate',type:'date'},{name:'mainDay'},{name:'weekAvailability'}],set:function(a,b){if(a==='name'){Ext.Array.each(this.get('weekAvailability').concat(this.get('mainDay')),function(a){if(a){a.setName(b)}})}this.callParent(arguments)}});Ext.define('Gnt.view.dependency.Painter',{extend:'Sch.view.dependency.Painter',alias:'schdependencypainter.ganttdefault',getIndexForCache:function(a,b){return a.getTaskStore().indexOf(b)},createLineDef:function(f,b,n,g,j,c,i){var k=b.self.Type,h=this,d=h.pathFinder.getHorizontalMargin(),e=f.getRowHeight(),a=h.callParent([f,b,n,g,j,c,i]);var m=a.endBox;var l=a.endSide;a.startArrowSize=a.endArrowSize;a.startArrowMargin=a.endArrowMargin;a.endArrowSize=0;a.endArrowMargin=0;a.endBox=a.startBox;a.endSide=a.startSide;a.startBox=m;a.startSide=l;a.boxesReversed=!0;a.startVerticalMargin=Math.floor((e-(a.startBox.bottom-a.startBox.top))/2)+1;a.endVerticalMargin=Math.floor((e-(a.endBox.bottom-a.endBox.top))/2)-1;if(b.getType()==k.EndToStart&&a.endBox.bottom<a.startBox.top&&a.endBox.end-a.startBox.start<d){a.startShift=g.isMilestone()?0:d-(c.end-c.start)/2;a.startVerticalMargin=a.startHorizontalMargin=a.startArrowMargin=a.endArrowMargin=0;a.startSide='top'}return a}});Ext.define('Gnt.view.dependency.View',{extend:'Sch.view.dependency.View',alias:'schdependencyview.basegantt',requires:['Gnt.view.dependency.Painter'],config:{painterConfig:{type:'ganttdefault'}},constructor:function(b){var a=this;a.callParent(arguments);if(a.painter.getUseDependencyRowIntersectionCache()){if(a.getPrimaryView().taskStore){a.getPrimaryView().mon(a.getPrimaryView().taskStore,{rootchange:a.resetPainterCache,add:a.resetPainterCache,remove:a.resetPainterCache,clear:a.resetPainterCache,refresh:a.resetPainterCache,scope:a})}}if(a.getEnableDependencyDragDrop()){a.configureAllowedSourceTerminals();if(a.getDependencyStore().allowedDependencyTypes){a.dragZone.on('dragstart',a.configureAllowedTargetTerminals,a)}else {a.getPrimaryView().el.addCls(['sch-terminal-allow-target-start','sch-terminal-allow-target-end'])}a.dragZone.on('drop',a.hideTargetTerminals,a)}},configureAllowedSourceTerminals:function(){var a=this.getDependencyStore().allowedDependencyTypes,b=['sch-terminal-allow-source-start','sch-terminal-allow-source-end'];if(a){b=[];if(Ext.Array.contains(a,'EndToEnd')||Ext.Array.contains(a,'EndToStart')){b.push('sch-terminal-allow-source-end')}if(Ext.Array.contains(a,'StartToStart')||Ext.Array.contains(a,'StartToEnd')){b.push('sch-terminal-allow-source-start')}}this.dragZone.view.el.addCls(b)},configureAllowedTargetTerminals:function(){var a=this.getDependencyStore().allowedDependencyTypes,b=[],c=this.dragZone.view.el;c.removeCls(['sch-terminal-allow-target-start','sch-terminal-allow-target-end']);if(Ext.Array.contains(a,'EndToEnd')||Ext.Array.contains(a,'StartToEnd')){b.push('sch-terminal-allow-target-end')}if(Ext.Array.contains(a,'StartToStart')||Ext.Array.contains(a,'EndToStart')){b.push('sch-terminal-allow-target-start')}c.addCls(b)},hideTargetTerminals:function(){this.getDependencyStore().allowedDependencyTypes&&this.getPrimaryView().el.removeCls(['sch-terminal-allow-target-start','sch-terminal-allow-target-end'])},onPrimaryViewItemUpdate:function(a,c,b){this.updateDependencies(a.getAllDependencies()).then(null,Ext.emptyFn)}});Ext.define('Gnt.view.dependency.Mixin',{extend:'Sch.view.dependency.Mixin',requires:['Gnt.view.dependency.View'],enableDependencyDragDrop:!0,createDependencyView:function(b,a){return Sch.view.dependency.View.create(Ext.apply({},b,{primaryView:a,type:'basegantt'}))}});Ext.define('Gnt.patches.CellEditor',{extend:'Sch.util.Patch',target:'Ext.grid.CellEditor',minVersion:'6.0.0',maxVersion:'6.0.2',overrides:{destroy:function(){clearTimeout(this.restoreTimer);this.callParent(arguments)},onViewRefresh:function(d){var a=this,e=a.el&&a.el.dom,c,b=a.context;if(e){c=d.getCellByPosition(b,!0);if(!c){a.allowBlur=a.wasAllowBlur;a.completeEdit();Ext.getDetachedBody().dom.appendChild(e);return}b.node=d.getNode(b.record);b.row=d.getRow(b.record);b.cell=c;b.rowIdx=d.indexOf(b.row);c.insertBefore(e,c.firstChild);a.boundEl=a.container=Ext.get(c);a.realign(!0);if(a.editing){if(Ext.isIE){a.restoreTimer=Ext.defer(function(){if(!a.destroyed){a.allowBlur=a.wasAllowBlur;a.editingPlugin.getActiveEditor()===a&&a.field.focus()}},10)}else {a.allowBlur=a.wasAllowBlur;a.field.focus()}}}}}});Ext.define('Gnt.patches.CellEditor_2',{extend:'Sch.util.Patch',target:'Ext.grid.CellEditor',minVersion:'6.0.2',maxVersion:'6.0.3',overrides:{completeEdit:function(b){var a=this;if(a.editing){a.context.value=a.field.value}a.callParent(arguments)}}});Ext.define('Gnt.patches.CellEditing',{extend:'Sch.util.Patch',target:'Ext.grid.plugin.CellEditing',minVersion:'5.1.1',maxVersion:'6.0.1.250',overrides:{showEditor:function(a,b,c){if(a.context&&a.context.record!==b.record&&a.field instanceof Ext.form.field.ComboBox){a.field.lastSelectedRecords=null}this.callParent(arguments)},cancelEdit:function(a){var b=this,d=b.context;if(a&&a.isCellEditor){b.context.value=a.context.value='editedValue' in a?a.editedValue:a.getValue();var c=b.context;b.context=a.context;b.callParent(arguments);b.context=c;if(a.context===d){b.setActiveEditor(null);b.setActiveColumn(null);b.setActiveRecord(null)}else {b.editing=!0}}else {a=b.getActiveEditor();if(a&&a.field){a.cancelEdit()}}}}});Ext.define('Gnt.patches.Rows',{extend:'Sch.util.Patch',target:'Ext.grid.selection.Rows',minVersion:'6.5.2',maxVersion:'6.5.3.57',overrides:{getCount:function(){var d=this,b=d.selectedRecords,e=b?b.getCount():0,f=d.getRange(),a,c=d.view.dataSource;for(a=f[0];a<=f[1];a++){if(!b||a<c.getCount()&&!b.byInternalId.get(c.getAt(a)&&c.getAt(a).internalId)){e++}}return e}}});Ext.define('Gnt.patches.SpreadsheetModel',{extend:'Sch.util.Patch',target:'Ext.grid.selection.SpreadsheetModel',minVersion:'6.0.0',applyFn:function(){var a={privates:{onMouseMove:function(b,a){if(!Ext.fly(a).up('.sch-ganttview')){this.callParent(arguments)}},handleMouseDown:function(d,c,e,a){if(!(d instanceof Gnt.view.Gantt)){var b=c.className.indexOf('sch-gantt-column-dragdrop')>=0;if(b){this.selectRows([a],this.isSelected(a))}else {this.callParent(arguments)}}}}};if(Ext.getVersion().isLessThan('6.0.2')){a.select=function(d,j,i){var c=this,a=c.selected,f=c.view,k=f.dataSource,h,e,b,g=!1;if(!a||!a.isRows||a.view!==f){c.resetSelection(!0);a=c.selected=new Ext.grid.selection.Rows(f)}else {if(!j){a.clear()}}if(!Ext.isArray(d)){d=[d]}h=d.length;for(e=0;e<h;e++){b=d[e];if(typeof b==='number'){b=k.getAt(b)}if(!a.contains(b)){a.add(b);g=!0}}if(g){c.updateHeaderState();if(!i){c.fireSelectionChange()}}}}Ext.override(Ext.grid.selection.SpreadsheetModel,a)}});Ext.define('Gnt.patches.SpreadsheetModel_2',{extend:'Sch.util.Patch',target:'Ext.grid.selection.SpreadsheetModel',minVersion:'6.2.1',overrides:{privates:{onMouseUp:function(c,g,f){var a=this,b=f.view,d,e;a.checkCellClicked=null;if(b&&!b.destroyed){if(!c.position){d=c.getTarget(b.cellSelector);if(d){e=b.getRecord(d);if(e){c.position=(new Ext.grid.CellContext(b)).setPosition(e,b.getHeaderByCell(d))}}}if(a.extensible&&c.position&&!c.position.isEqual(a.mousedownPosition)){a.extensible.disable()}b.el.un('mousemove',a.onMouseMove,a);if(a.selected.isRows){a.selected.addRange()}if(!c.position||!c.position.isEqual(a.mousedownPosition)){a.fireSelectionChange()}}}}}});Ext.define('Gnt.patches.SpreadsheetModel_3',{extend:'Sch.util.Patch',target:'Ext.grid.selection.SpreadsheetModel',minVersion:'6.0.2',overrides:{privates:{onSelectionFinish:function(g,f,a){var c=this.view;if(a&&c instanceof Gnt.view.Gantt){var d=c.ownerGrid.lockedGrid.view,e=d.getHeaderCt(),b=e.getVisibleGridColumns();if(Ext.Array.indexOf(b,a.column)===-1&&a.record!==null){a=(new Ext.grid.CellContext(c)).setPosition(a.record,b[b.length-1])}}this.callParent(arguments)}}}});Ext.define('Gnt.patches.SpreadsheetModel_4',{extend:'Sch.util.Patch',target:'Ext.grid.selection.SpreadsheetModel',minVersion:'6.0.2',overrides:{privates:{onStoreRemove:function(){var a=this.getSelected();if(a&&!a.isCells){this.callParent(arguments)}}},deselect:function(a,h){var c=this,e=c.selected,i=c.view.dataSource,g,d,b,f=!1;if(e&&e.isRows){if(!Ext.isArray(a)){a=[a]}g=a.length;for(d=0;d<g;d++){b=a[d];if(typeof b==='number'){b=i.getAt(b)}if(e.remove(b)){f=!0}}}if(f){c.updateHeaderState();if(!h){c.fireSelectionChange()}}}}});Ext.define('Gnt.patches.SpreadsheetModel_5',{extend:'Sch.util.Patch',target:'Ext.grid.selection.SpreadsheetModel',minVersion:'6.2.1',applyFn:function(){var a={privates:{}};if(Ext.getVersion().isGreaterThan('6.5.0')){a.privates.onViewChanged=function(b,k){var e=this,a=e.selected,j=b.store,c=!1,i,h,f,g,d;if(a){b=a.view;if(k){if(a.isCells){d=new Ext.grid.CellContext(b);i=a.getRowRange();h=b.ownerGrid.getColumnManager().getColumns().length;if(h){for(g=i[0];g<=i[1];g++){d.setRow(g);for(f=0;f<h;f++){d.setColumn(f);if(d.column){b.onCellDeselect(d)}if(e.maybeClearSelection(d)){c=!0}}}}else {e.clearSelections();c=!0}}else {if(a.isColumns){c=!1;a.eachColumn(function(a,d){if(!a.isVisible()||!b.ownerGrid.isAncestor(a)){this.remove(a);if(e.maybeClearSelection({column:a})){c=!0}}})}}}else {if(a.isRows&&j.isFiltered()){a.eachRow(function(a){if(!j.contains(a)){this.remove(a);if(e.maybeClearSelection({rowIdx:b.indexOf(a)})){c=!0}}})}}}return c}}else {a.privates.onColumnsChanged=function(){var c=this,a=c.selected,i,h,e,f,b,d,g;if(a){b=a.view;if(a.isCells){d=new Ext.grid.CellContext(b);i=a.getRowRange();h=b.getVisibleColumnManager().getColumns().length;if(h){for(f=i[0];f<=i[1];f++){d.setRow(f);for(e=0;e<h;e++){d.setColumn(e);b.onCellDeselect(d)}}}else {c.clearSelections()}}else {if(a.isColumns){g=!1;a.eachColumn(function(a,c){if(!a.isVisible()||!b.ownerGrid.isAncestor(a)){this.remove(a);g=!0}})}}}Ext.on('idle',g?c.fireSelectionChange:c.updateSelectionExtender,c,{single:!0})}}Ext.override(Ext.grid.selection.SpreadsheetModel,a)}});Ext.define('Gnt.patches.TablePanel',{extend:'Sch.util.Patch',target:'Ext.panel.Table',minVersion:'6.2.1',overrides:{initScrollContainer:function(){Ext.grid.locking.Lockable.prototype.initScrollContainer.call(this);this.fireEvent('scrollersinitialized',this)}}});Ext.define('Gnt.patches.TreeView',{extend:'Sch.util.Patch',target:'Ext.tree.View',minVersion:'6.0.2',overrides:{onFocusLeave:function(b){var a=this,c;if(!a.destroying&&!a.refreshing){c=!b.isScroll&&(!a.lockingPartner||!b.toComponent||b.toComponent!==a.lockingPartner&&!a.lockingPartner.isAncestor(b.toComponent));if(a.cellFocused){if(c){a.getNavigationModel().setPosition(null,null,b.event,null,!0)}a.cellFocused=!1;a.focusEl=a.el;a.focusEl.dom.setAttribute('tabIndex',0)}if(c){if(a.ownerGrid.actionableMode){a.lastFocused=a.actionPosition;a.ownerGrid.setActionableMode(!1)}}else {a.actionPosition=null}Ext.Component.prototype.onFocusLeave.call(a,b)}}}});Ext.define('Gnt.patches.TreeViewDragDrop',{extend:'Sch.util.Patch',target:'Ext.tree.plugin.TreeViewDragDrop',minVersion:'6.0.0',overrides:{init:function(a){Ext.applyIf(a,{copy:this.copy,allowCopy:this.allowCopy});if(this.containerScroll&&a.ownerGrid.lockable){a.ownerGrid.on('scrollersinitialized',this.onLockingScrollersInitialized,this,{single:!0})}else {a.on('render',this.onViewRender,this,{single:!0})}},onLockingScrollersInitialized:function(a){this.cmp._registeredScrollableElement=a.getScrollable().getElement();Ext.dd.ScrollManager.register(this.cmp._registeredScrollableElement);this.onViewRender(this.cmp)},destroy:function(){this.cmp._registeredScrollableElement&&Ext.dd.ScrollManager.unregister(this.cmp._registeredScrollableElement);delete this.cmp._registeredScrollableElement;this.callParent()},disable:function(){this.callParent(arguments);this.dragZone&&this.dragZone.lock();this.dropZone&&this.dropZone.lock()},enable:function(){this.callParent(arguments);this.dragZone&&this.dragZone.unlock();this.dropZone&&this.dropZone.unlock()}}});Ext.define('Gnt.patches.SelectionExtender2',{extend:'Sch.util.Patch',target:'Ext.grid.selection.SelectionExtender',minVersion:'6.0.0',overrides:{setHandle:function(a,b){if(this.view.lockedView&&this.view.lockedView.getNodes().length===0||a&&b&&(!a.record||!b.record)){this.disable();return}return this.callParent(arguments)}}});Ext.define('Gnt.patches.LockingView',{extend:'Sch.util.Patch',target:'Ext.grid.locking.View',minVersion:'6.0.0',overrides:{getCellByPosition:function(a,b){if(a&&!a.column){return null}return this.callParent(arguments)},onCellDeselect:function(a){if(a&&!a.column){return}return this.callParent(arguments)},onDataRefresh:function(){Ext.suspendLayouts();this.relayFn('onDataRefresh',arguments);Ext.resumeLayouts(!0)}}});Ext.define('Gnt.patches.NavigationModel_6_2_0',{extend:'Sch.util.Patch',target:'Ext.grid.NavigationModel',minVersion:'6.2.0',overrides:{focusPosition:function(b,a){if(this.view instanceof Gnt.view.Gantt){!a&&this.callParent(arguments)}else {this.callParent(arguments)}}}});Ext.define('Gnt.patches.TableView',{extend:'Sch.util.Patch',target:'Ext.view.Table',minVersion:'6.2.1',applyFn:function(){if(Ext.isIE9){Ext.define(null,{override:'Ext.view.Table',getRow:function(a){var b;if(!a&&a!==0||!this.rendered){return null}if(a.target){a=a.target}if(Ext.isString(a)){return Ext.fly(a).down(this.rowSelector,!0)}if(Ext.isNumber(a)){b=this.all.item(a);return b&&b.down(this.rowSelector,!0)}if(a.isModel){return this.getRowByRecord(a)}a.setAttribute('class',a.className);b=Ext.fly(a);if(b.is(this.itemSelector)){return this.getRowFromItem(b)}return b.findParent(this.rowSelector,this.getTargetEl())}})}}});Ext.define('Gnt.template.Template',{extend:'Ext.XTemplate',disableFormats:!0,isLegacyIE:Ext.isIE8m,getInnerTpl:Ext.emptyFn,innerTpl:null,dependencyTerminalMarkup:'<div class="sch-terminal sch-terminal-start"></div><div class="sch-terminal sch-terminal-end"></div>',terminalSides:null,terminalTpl:'<div class="sch-terminal sch-terminal-SIDE"></div>',constructor:function(a){Ext.apply(this,a);var c=a.rtl?'right':'left';var b=this.getInnerTpl(a)||'';this.callParent(['<div class="sch-event-wrap {ctcls} '+Ext.baseCSSPrefix+'unselectable" style="'+c+':{offset}px">','<tpl if="isRollup">',b,a.rollupLabel?'<label class="sch-gantt-rollup-label">{rollupLabel}</label>':'','<tpl else>',a.leftLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-left"><label class="sch-gantt-label sch-gantt-label-left">{leftLabel}</label></div>':'',a.rightLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-right" style="left:{width}px"><label class="sch-gantt-label sch-gantt-label-right">{rightLabel}</label></div>':'',a.topLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-top"><label class="sch-gantt-label sch-gantt-label-top">{topLabel}</label></div>':'',b,a.bottomLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-bottom"><label class="sch-gantt-label sch-gantt-label-bottom">{bottomLabel}</label></div>':'','</tpl>','</div>'])}});Ext.define('Gnt.template.Task',{extend:'Gnt.template.Template',innerTpl:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}" unselectable="on">&#160;</div>',getInnerTpl:function(a){var b=a.rtl?'right':'left';return '<div id="'+a.prefix+'{id}" {attr} class="sch-gantt-item sch-gantt-task-bar {cls}" unselectable="on" style="width:{width}px;{style}">'+'<tpl if="isRollup">'+'<tpl else>'+'<tpl if="segments">'+'<div class="sch-gantt-segment-connector"></div>'+'</tpl>'+(a.taskResizeHandles==='both'||a.taskResizeHandles==='left'?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-start"></div>':'')+'<tpl for="segments">'+'<div id="'+a.prefix+'{parent.Id}-segment-{[xindex-1]}" class="sch-gantt-task-segment {cls}" style="'+b+':{left}px;width:{width}px;{style}"'+' data-segmentIndex="{[xindex-1]}">'+this.innerTpl+(a.taskResizeHandles==='both'||a.taskResizeHandles==='right'?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-end"></div>':'')+'</div>'+'</tpl>'+this.innerTpl+(a.taskResizeHandles==='both'||a.taskResizeHandles==='right'?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-end"></div>':'')+(a.enableProgressBarResize?'<div style="'+b+':{progressBarWidth}px" class="sch-gantt-progressbar-handle"></div>':'')+(a.enableDependencyDragDrop?this.dependencyTerminalMarkup:'')+'</tpl>'+'</div>'}});Ext.define('Gnt.template.ParentTask',{extend:'Gnt.template.Template',innerTpl:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}">&#160;</div>',getInnerTpl:function(a){return '<div id="'+a.prefix+'{id}" {attr} class="sch-gantt-item sch-gantt-parenttask-bar {cls}" style="width:{width}px; {style}">'+this.innerTpl+(a.enableDependencyDragDrop&&a.allowParentTaskDependencies?this.dependencyTerminalMarkup:'')+'</div>'}});Ext.define('Gnt.template.Milestone',{extend:'Gnt.template.Template',innerTpl:Ext.isIE8m?'<div style="border-width:{[Math.floor(values.side*0.7)]}px;{style}" class="sch-gantt-milestone-diamond-top {cls}" unselectable="on"></div>'+'<div style="border-width:{[Math.floor(values.side*0.7)]}px;{style}" class="sch-gantt-milestone-diamond-bottom {cls}" unselectable="on"></div>':'<img style="{[values.print ? "height:" + values.side + "px;border-left-width:" + values.side + "px" : ""]};{style}" src="'+Ext.BLANK_IMAGE_URL+'" class="sch-gantt-milestone-diamond {cls}" unselectable="on"/>',getInnerTpl:function(a){return '<div '+(this.isLegacyIE?'style="width:{[Math.floor(values.side*0.7)]}px"':'')+' id="'+a.prefix+'{id}" {attr} class="sch-gantt-item sch-gantt-milestone-diamond-ct">'+this.innerTpl+'<tpl if="isRollup">'+'<tpl else>'+(a.enableDependencyDragDrop?this.dependencyTerminalMarkup:'')+'</tpl>'+'</div>'}});Ext.define('Gnt.template.RollupTask',{extend:'Ext.XTemplate',text:'<div class="sch-rollup-wrap">'+'<tpl for=".">'+'{[values.tpl.apply(values)]}'+'</tpl>'+'</div>',constructor:function(a){this.callParent([this.text])}});Ext.define('Gnt.template.Deadline',{extend:'Ext.XTemplate',mixins:['Gnt.mixin.Localizable'],disableFormats:!0,markup:'<div data-qtip="__DEADLINE__:  {date}" data-qalign="b-tl" class="gnt-deadline-indicator {cls}" style="{dir}:{offset}px"></div>',constructor:function(){this.markup=this.markup.replace(/__DEADLINE__/,this.L('deadline'));this.callParent([this.markup])}});Ext.define('Gnt.tooltip.EventTip',{extend:'Sch.tooltip.EventTip',onTipBeforeShow:function(b){if(!b.triggerElement||!b.triggerElement.id){return !1}var a=b.getView();var f=Ext.all('window[modal=true]{isVisible()}');var g=Ext.Array.findBy(f,function(b){return a!==b&&!a.isDescendantOf(b)});if(g){return !1}var d=a.resolveEventRecord(b.triggerElement);if(!d||a.fireEvent('beforetooltipshow',a,d)===!1){return !1}var e=a.getDataForTooltipTpl(d,b.triggerElement,b.pointerEvent),c;if(!e){return !1}c=a.tooltipTpl.apply(e);if(!c){return !1}b.update(c)}});Ext.define('Gnt.view.Gantt',{extend:'Sch.view.TimelineGridView',alias:['widget.ganttview'],requires:['Sch.patches.DragDropManager','Sch.patches.NavigationModel','Sch.util.Date','Sch.util.ScrollManager','Gnt.patches.NavigationModel_6_2_0','Gnt.patches.TableView','Gnt.model.Task','Gnt.template.Task','Gnt.template.ParentTask','Gnt.template.Milestone','Gnt.template.RollupTask','Gnt.template.Deadline','Gnt.tooltip.EventTip','Gnt.feature.taskdd.DragZone','Gnt.feature.ProgressBarResize','Gnt.feature.TaskResize','Sch.view.Horizontal','Gnt.feature.LabelEditor','Gnt.feature.DragCreator'],uses:['Gnt.patches.LabelEditor'],mixins:['Sch.mixin.GridViewCanvas','Sch.mixin.FilterableTreeView'],_cmpCls:'sch-ganttview',scheduledEventName:'task',trackOver:!1,toggleOnDblClick:!1,eventSelector:'.sch-gantt-item',eventWrapSelector:'.sch-event-wrap',barMargin:4,progressBarResizer:null,taskResizer:null,taskDragDrop:null,dragCreator:null,resizeConfig:null,createConfig:null,dragDropConfig:null,progressBarResizeConfig:null,externalGetRowClass:null,baselineVisible:!1,outsideLabelsGatherWidth:200,constructor:function(a){a=a||{};if(a){this.externalGetRowClass=a.getRowClass;delete a.getRowClass}this.callParent(arguments);this.on({itemupdate:this.onRowUpdate,scope:this});this.mon(this.taskStore,{update:this.onTaskStoreUpdate,scope:this});this.initTreeFiltering()},setupTooltip:function(){var a=this,b=a.getEl();a.callParent(arguments);a.tip.destroy();a.tip=new Gnt.tooltip.EventTip(Ext.apply({view:a,delegate:a.eventSelector,target:b,dismissDelay:0,constrainTo:a.grid.getEl(),rtl:a.rtl},a.tipCfg))},onBeforeIndentationChange:function(){var a=this.getNavigationModel().getPosition();if(a&&a.record){this._lastNavigatedRecord=a.record}},onIndentationChange:function(){this._lastNavigatedRecord&&this.getNavigationModel().setPosition(this._lastNavigatedRecord);delete this._lastNavigatedRecord},onRender:function(){this.mon(this.getTaskStore(),{beforeindentationchange:this.onBeforeIndentationChange,indentationchange:this.onIndentationChange,scope:this});this.configureLabels();this.setupGanttEvents();this.setupTemplates();this.callParent(arguments)},getDependencyStore:function(){return this.dependencyStore},configureFeatures:function(){if(this.enableProgressBarResize!==!1){this.progressBarResizer=Ext.create('Gnt.feature.ProgressBarResize',Ext.apply({ganttView:this},this.progressBarResizeConfig||{}));this.on({beforeprogressbarresize:this.onBeforeTaskProgressBarResize,progressbarresizestart:this.onTaskProgressBarResizeStart,afterprogressbarresize:this.onTaskProgressBarResizeEnd,scope:this})}if(this.taskResizeHandles!=='none'){this.taskResizer=Ext.create('Gnt.feature.TaskResize',Ext.apply({ganttView:this,validatorFn:this.resizeValidatorFn||Ext.emptyFn,validatorFnScope:this},this.resizeConfig||{}));this.on({beforedragcreate:this.onBeforeDragCreate,beforetaskresize:this.onBeforeTaskResize,taskresizestart:this.onTaskResizeStart,aftertaskresize:this.onTaskResizeEnd,progressbarresizestart:this.onTaskResizeStart,afterprogressbarresize:this.onTaskResizeEnd,scope:this})}if(this.enableTaskDragDrop){this.taskDragDrop=Ext.create(this.dragDropConfig&&this.dragDropConfig.xclass||'Gnt.feature.taskdd.DragZone',this.getEl(),Ext.apply({gantt:this,taskSelector:this.eventSelector,deadlineSelector:'.gnt-deadline-indicator',validatorFn:this.dndValidatorFn||Ext.emptyFn,validatorFnScope:this,skipWeekendsDuringDragDrop:this.taskStore.skipWeekendsDuringDragDrop,snapRelativeToEventStartDate:this.snapRelativeToEventStartDate},this.dragDropConfig));this.on({beforetaskdrag:this.onBeforeTaskDrag,taskdragstart:this.onDragDropStart,aftertaskdrop:this.onDragDropEnd,scope:this})}if(this.enableDragCreation){this.dragCreator=Ext.create('Gnt.feature.DragCreator',Ext.apply({ganttView:this,validatorFn:this.createValidatorFn||Ext.emptyFn,validatorFnScope:this},this.createConfig))}},getTemplateForTask:function(a,b){if(a.isMilestone(b)){return this.milestoneTemplate}if(a.isLeaf()){return this.eventTemplate}return this.parentEventTemplate},refreshNotReadOnlyChildNodes:function(a){a.cascadeBy({before:function(b){return b==a||!b.getReadOnly()},after:function(b){if(b!==a){this.refreshNode(b)}},scope:this})},setShowRollupTasks:function(c){this.showRollupTasks=c;var a={};this.taskStore.getRootNode().cascadeBy(function(c){if(c.getRollup()){var b=c.parentNode;a[b.internalId]=b}});for(var d in a){var b=this.store.indexOf(a[d]);if(b>=0){this.refreshNode(b)}}},getRollupTasks:function(a){return Ext.Array.filter(a.childNodes,function(a){return a.getRollup()})},getRollupRenderData:function(r){var n=[];var q=this.timeAxis,i=q.getStart(),g=q.getEnd(),m=this.getRollupTasks(r);for(var j=0;j<m.length;j++){var b=m[j];var d=b.getStartDate();var f=b.getEndDate()||d&&Sch.util.Date.add(d,b.getDurationUnit(),1);if(d&&f){if(Sch.util.Date.intersectSpans(d,f,i,g)){var a={},e=b.isMilestone(),c;a.isRollup=!0;a.id=Ext.id();a.attr='rolluptaskid="'+b.getId()+'"';var l=f>g,k=Sch.util.Date.betweenLesser(d,i,g),h=this.getCoordinateFromDate(k?d:i),o=this.getCoordinateFromDate(l?g:f),s=e?0:o-h;a.offset=e?o||h:h;a.tpl=e?this.milestoneTemplate:this.eventTemplate;a.cls=b.getCls();a.ctcls='';a.record=b;if(c=this.rollupLabelField){var p=b.data[c.dataIndex||c];a.rollupLabel=c.renderer?c.renderer.call(c.scope||this,p,b):Ext.util.Format.htmlEncode(p)}if(e){a.side=Ext.isIE8m?Math.round(0.3*this.getRowHeight()):Math.round(0.5*this.getRowHeight());a.ctcls+=' sch-gantt-milestone'}else {a.width=Math.max(1,s);if(l){a.ctcls+=' sch-event-endsoutside '}if(!k){a.ctcls+=' sch-event-startsoutside '}a.ctcls+=' sch-gantt-task'}if(b.isReadOnly()){a.ctcls+=' sch-gantt-task-readonly'}if(b.isProject){a.ctcls+=' sch-gantt-project-task'}a.cls+=' sch-rollup-task';n.push(a)}}}return n},getLabelRenderData:function(b){var e=this.leftLabelField,d=this.rightLabelField,f=this.topLabelField,c=this.bottomLabelField,a,g={labelRendered:!0};if(e){a=e.dataIndex?b.data[e.dataIndex]:undefined;g.leftLabel=e.renderer?e.renderer.call(e.scope||this,a,b):Ext.util.Format.htmlEncode(a)}if(d){a=d.dataIndex?b.data[d.dataIndex]:undefined;g.rightLabel=d.renderer?d.renderer.call(d.scope||this,a,b):Ext.util.Format.htmlEncode(a)}if(f){a=f.dataIndex?b.data[f.dataIndex]:undefined;g.topLabel=f.renderer?f.renderer.call(f.scope||this,a,b):Ext.util.Format.htmlEncode(a)}if(c){a=c.dataIndex?b.data[c.dataIndex]:undefined;g.bottomLabel=c.renderer?c.renderer.call(c.scope||this,a,b):Ext.util.Format.htmlEncode(a)}return g},getSegmentsRenderData:function(t,s,u){var j=Sch.util.Date,n=t.getSegments(),f=this.timeAxis.getStart(),d=this.timeAxis.getEnd(),i=[],k=0,c,o,b,e,g,h,a,q,m,p,l,r;for(c=0,o=n.length;c<o;c++){b=n[c];k+=(b.getEndDate()-b.getStartDate())*s}for(c=0,o=n.length;c<o;c++){b=n[c];q=b.getCls()||'';a=b.getEndDate()||t.getStartDate();h=b.getStartDate();if(j.betweenLesser(h,f,d)){e=this.getCoordinateFromDate(h);if(j.betweenLesser(a,f,d)){g=this.getCoordinateFromDate(a)}else {g=this.getCoordinateFromDate(d)}}else {e=this.getCoordinateFromDate(f);if(j.betweenLesser(a,f,d)){g=this.getCoordinateFromDate(a)}else {if(h>d&&a>d){e=g=this.getCoordinateFromDate(d)+100}else {if(h<f&&a<f){e=g=this.getCoordinateFromDate(f)-100}else {g=this.getCoordinateFromDate(d)}}}}p=g-e;if(!l){k-=a-h;if(k<=0){l=j.add(a,j.MILLI,k);q+=' sch-segment-in-progress';r=this.getCoordinateFromDate(l);m=Math.min(Math.abs(r-e),p)}else {m=b.width}}else {m=0}i.push(Ext.applyIf({left:e-u,width:p,cls:q,percentDone:s*100,SegmentIndex:c,progressBarWidth:m},b.data))}i[0].cls+=' sch-gantt-task-segment-first';i[i.length-1].cls+=' sch-gantt-task-segment-last';return {percentDoneAtDate:l,segments:i}},buildTaskCls:function(b,d,g,h){var c='',a='';if(b.isMilestone()){d.side=Math.round((this.enableBaseline?0.4:0.5)*this.getRowHeight());a+=' sch-gantt-milestone'}else {var f=8;if(d.width<f){a+='sch-gantt-parent-noarrows'}if(h){a+=' sch-event-endsoutside '}if(!g){a+=' sch-event-startsoutside '}if(b.isLeaf()){var e=b.getResizable();a+=' sch-gantt-task';if(typeof e==='boolean'||typeof e==='string'){c+=' sch-event-resizable-'+e}}else {a+=' sch-gantt-parent-task'}}if(b.isReadOnly()){a+=' sch-gantt-task-readonly'}if(b.isProject){a+=' sch-gantt-project-task'}if(b.dirty){c+=' sch-dirty '}if(b.isDraggable()===!1){c+=' sch-event-fixed '}c+=b.isSegmented()?' sch-event-segmented ':' sch-event-notsegmented ';d.cls+=' '+c;d.ctcls+=' '+a},columnRenderer:function(G,D,a){var c=a.getStartDate(),r=this.timeAxis,j=Sch.util.Date,f={},k='',d=r.getStart(),b=r.getEnd(),w=a.isMilestone(),i,l,n;if(c){var h=a.getEndDate()||j.add(c,a.getDurationUnit()||j.DAY,1),E=r.getAt(0),q=(E.getEndDate()-E.getStartDate())/this.timeAxisViewModel.getTickWidth(),z=q*this.outsideLabelsGatherWidth,B=j.intersectSpans(c,h,d,b),v=this.outsideLabelsGatherWidth>0,x=v&&j.intersectSpans(c,h,b,new Date(b.getTime()+z)),F=v&&j.intersectSpans(c,h,new Date(d.getTime()-z),d);if(B||x||F){n=h>b;l=j.betweenLesser(c,d,b);var e,p,m;if(B){e=this.getCoordinateFromDate(l?c:d);p=this.getCoordinateFromDate(n?b:h);m=w?0:p-e}else {l=!0;m=0;if(x){e=Math.floor(this.getCoordinateFromDate(b)+(c-b)/q)}else {e=Math.floor(this.getCoordinateFromDate(d)-(d-h)/q)}}var o=Math.min(a.getPercentDone()||0,100)/100,g,u,t,C;if(a.isSegmented()){var s=this.getSegmentsRenderData(a,o,e);g=s.percentDoneAtDate;C=s.segments}else {g=new Date((h-c)*o+c.getTime());if(g<d){g=d}else {if(g>b){g=b}}}u=this.getCoordinateFromDate(g);t=Math.min(Math.abs(u-e),m);f={id:a.internalId+'-x-x',offset:w?(p||e)-this.getXOffset(a):e,width:Math.max(1,m),ctcls:'',cls:a.getCls()||'',print:this._print,record:a,percentDone:o*100,progressBarWidth:Math.max(0,t-2*this.eventBorderWidth),segments:C};Ext.apply(f,this.getLabelRenderData(a));i=this.eventRenderer&&this.eventRenderer.call(this.eventRendererScope||this,a,f,a.store,D)||{};if(i){Ext.apply(f,i)}this.buildTaskCls(a,f,l,n);if(this.showRollupTasks){var y=this.getRollupRenderData(a);if(y.length>0){k+=this.rollupTemplate.apply(y)}}k+=this.getTemplateForTask(a).apply(f)}}if(this.enableBaseline){if(!i){i=this.eventRenderer&&this.eventRenderer.call(this,a,f,a.store,D)||{}}k+=this.baselineRenderer(a,i,d,b,f.labelRendered)}var A=a.getDeadlineDate();if(A){k+=this.deadlineRenderer(a,A)}return k},deadlineRenderer:function(b,a){return this.deadlineTemplate.apply({dir:this.rtl?'right':'left',offset:this.getCoordinateFromDate(a),date:this.getFormattedEndDate(a),cls:new Date()>a&&!b.isCompleted()?'gnt-deadline-indicator-late':''})},baselineRenderer:function(a,c,j,f,p){var o=Sch.util.Date,d=a.getBaselineStartDate(),e=a.getBaselineEndDate();if(d&&e&&o.intersectSpans(d,e,j,f)){var l=e>f;var k=o.betweenLesser(d,j,f);c=c||{};var h=a.isBaselineMilestone(),i=this.getCoordinateFromDate(k?d:j),n=this.getCoordinateFromDate(l?f:e),m=Math.max(1,h?0:n-i),q=this.getTemplateForTask(a,!0),g={progressBarStyle:c.baseProgressBarStyle||'',id:'base-'+a.internalId,progressBarWidth:Math.min(100,a.getBaselinePercentDone())*m/100,percentDone:a.getBaselinePercentDone(),offset:h?(n||i)-this.getXOffset(a,!0):i,print:this._print,width:Math.max(1,m),style:c.baseStyle||'',baseline:!0};var b='';if(h){g.side=Math.round(0.4*this.getRowHeight());b='sch-gantt-milestone-baseline sch-gantt-baseline-item'}else {if(a.isLeaf()){b='sch-gantt-task-baseline sch-gantt-baseline-item'}else {b='sch-gantt-parenttask-baseline sch-gantt-baseline-item'}}if(l){b+=' sch-event-endsoutside '}if(!k){b+=' sch-event-startsoutside '}g.ctcls=b+' '+(c.basecls||'');if(!p){Ext.apply(g,this.getLabelRenderData(a))}return q.apply(g)}return ''},getTemplateConfig:function(){return {leftLabel:this.leftLabelField,rightLabel:this.rightLabelField,topLabel:this.topLabelField,bottomLabel:this.bottomLabelField,rollupLabel:this.rollupLabelField,prefix:this.eventPrefix,taskResizeHandles:this.taskResizeHandles,enableDependencyDragDrop:this.enableDependencyDragDrop!==!1,allowParentTaskDependencies:this.allowParentTaskDependencies!==!1,enableProgressBarResize:this.enableProgressBarResize,rtl:this.rtl}},setupTemplate:function(a,c,b){if(!a||!a.isTemplate){a=Ext.create(Ext.apply({xclass:c},a,b))}return a},setupTemplates:function(){var b=this.getTemplateConfig();var a=Ext.apply({},this.taskBodyTemplate&&{innerTpl:this.taskBodyTemplate},b);this.eventTemplate=this.setupTemplate(this.eventTemplate,'Gnt.template.Task',a);a=Ext.apply({},this.parentTaskBodyTemplate&&{innerTpl:this.parentTaskBodyTemplate},b);this.parentEventTemplate=this.setupTemplate(this.parentEventTemplate,'Gnt.template.ParentTask',a);a=Ext.apply({},this.milestoneBodyTemplate&&{innerTpl:this.milestoneBodyTemplate},b);this.milestoneTemplate=this.setupTemplate(this.milestoneTemplate,'Gnt.template.Milestone',a);this.rollupTemplate=this.setupTemplate(this.rollupTemplate,'Gnt.template.RollupTask');this.deadlineTemplate=this.setupTemplate(this.deadlineTemplate,'Gnt.template.Deadline')},getTaskStore:function(){return this.taskStore},getEventStore:function(){return this.getTaskStore()},setupGanttEvents:function(){var a=this,b=this.taskStore;if(this.toggleParentTasksOnClick){this.on({taskclick:function(h,c,g){if(g.getTarget('.sch-rollup-wrap')){return}var d=this.ownerGrid.dependencyView,f=d&&d.dragZone&&d.dragZone.dragging;if(!f&&!c.isLeaf()&&(!b.isTreeFiltered()||b.allowExpandCollapseWhileFiltered)){var e=function(){a.fireEvent.apply(this,['taskdblclick'].concat(Array.prototype.slice.apply(arguments)))};a.on('taskclick',e);a.unbindListenerTimer=setTimeout(function(){a.un('taskclick',e)},300);c.isExpanded()?c.collapse():c.expand()}}})}},configureLabels:function(){Ext.Array.each(['left','right','top','bottom'],function(c){var a=this[c+'LabelField'];if(a){a=Ext.isObject(a)?Ext.apply({},a):a;if(Ext.isString(a)){a=this[c+'LabelField']={dataIndex:a}}if(a.editor){var b=a.editor;if(!b.isComponent){b=Ext.clone(b)}a.editor=Ext.create('Gnt.feature.LabelEditor',this,{labelPosition:c,field:b,dataIndex:a.dataIndex})}this[c+'LabelField']=a}},this);this.on('labeledit_beforestartedit',this.onBeforeLabelEdit,this)},onBeforeTaskDrag:function(b,a){return !this.readOnly&&a.isDraggable()!==!1&&!a.isReadOnly()&&(this.allowParentTaskMove||a.isLeaf())},falseReturningFn:function(){return !1},onDragDropStart:function(){if(this.tip){this.tip.on('beforeshow',this.falseReturningFn)}var a=this.taskDragDrop.getConstrainDragToTaskRow&&this.taskDragDrop.getConstrainDragToTaskRow();Sch.util.ScrollManager.activate(this,a?'horizontal':'both');if(!this.taskDragDrop.outOfRowTaskDragDrop&&this.taskDragDrop.dragging){this._oldVThresh=Ext.dd.ScrollManager.vthresh;Ext.dd.ScrollManager.vthresh=-1}},onDragDropEnd:function(){if(this.tip){this.tip.un('beforeshow',this.falseReturningFn)}Sch.util.ScrollManager.deactivate(this);if(!this.taskDragDrop.outOfRowTaskDragDrop&&this.taskDragDrop.dragging){Ext.dd.ScrollManager.vthresh=this._oldVThresh;delete this._oldVThresh}},onTaskProgressBarResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onTaskProgressBarResizeEnd:function(){if(this.tip){this.tip.enable()}},onTaskResizeStart:function(){var a=this.getScrollable();if(this.tip){this.tip.hide();this.tip.disable()}a.setDisabled&&a.setDisabled(!0)},onTaskResizeEnd:function(){var a=this.getScrollable();if(this.tip){this.tip.enable()}a.setDisabled&&a.setDisabled(!1)},onBeforeDragCreate:function(){return !this.readOnly},onBeforeTaskResize:function(b,a){return !this.readOnly&&a.getSchedulingMode()!=='EffortDriven'},onBeforeTaskProgressBarResize:function(){return !this.readOnly},onBeforeLabelEdit:function(){return !this.readOnly},afterRender:function(){this.callParent(arguments);this.getEl().on('mousemove',this.configureFeatures,this,{single:!0})},resolveTaskRecord:function(b){var a=this.findItemByChild(b);if(a){return this.getRecord(a)}return null},resolveEventRecord:function(a){return this.resolveTaskRecord(a)},resolveEventRecordFromResourceRow:function(a){return this.resolveTaskRecord(a)},triggerHighlightTask:function(a,b,d){if(!(a instanceof Ext.data.Model)){a=this.taskStore.getModelById(a)}if(a){a.isHighlighted=b;var f=this.getRow(a);if(f){Ext.fly(f)[b?'addCls':'removeCls']('sch-gantt-task-highlighted')}if(d!==!1){for(var c=0,g=a.successors.length;c<g;c++){var e=a.successors[c];this[(b?'':'un')+'highlightDependency'](e);this[(b?'':'un')+'highlightTask'](e.getTargetTask(),d)}}}},highlightTask:function(b,a){this.triggerHighlightTask(b,!0,a)},unhighlightTask:function(b,a){this.triggerHighlightTask(b,!1,a)},highlightTasksBy:function(c,a){var b=this;a=a||b;b.taskStore.getRoot().cascadeBy(function(d){c.call(a,d)&&b.highlightTask(d,!1)})},clearHighlightedTasks:function(){var a=this,b=a.ownerGrid.getDependencyView();a.taskStore.getRoot().cascadeBy(function(b){a.unhighlightTask(b,!1)});Ext.Array.each(b.getHighlightedDependencies(),b.unhighlightDependency)},getRowClass:function(b){var a='';if(b.isHighlighted){a='sch-gantt-task-highlighted'}if(this.externalGetRowClass){a+=' '+(this.externalGetRowClass.apply(this,arguments)||'')}return a},clearSelectedTasksAndDependencies:function(){this.ownerGrid.getDependencyView().clearSelectedDependencies();this.el.select('.sch-gantt-task-highlighted').removeCls('sch-gantt-task-highlighted');this.taskStore.getRootNode().cascadeBy(function(a){a.isHighlighted=!1})},getCriticalPaths:function(){return this.taskStore.getCriticalPaths()},highlightCriticalPaths:function(){var a=this;a.clearSelectedTasksAndDependencies();var d=a.getCriticalPaths(),c=a.ownerGrid.getDependencyView(),b={};Ext.Array.each(d,function(d){Ext.Array.each(d,function(i){for(var f=0,k=i.length;f<k;f++){var d=i[f];if(d.isLeaf()){d.bubble(function(b){if(!b.isRoot()&&!b.isProject&&(b===d||b.isCritical())){a.highlightTask(b,!1)}})}else {d.cascadeBy(function(b){if(b===d||b.isCritical()){a.highlightTask(b,!1)}})}var h=d.getOutgoingDependencies(),j=h.length,e;for(var g=0;g<j;g++){e=h[g];if(b[e.getTargetId()]){c.highlightDependency(e)}}b[d.getId()]=!0}})});a.addCls('sch-gantt-critical-chain')},unhighlightCriticalPaths:function(){this.removeCls('sch-gantt-critical-chain');this.clearSelectedTasksAndDependencies()},getXOffset:function(c,b){var a=0;if(c.isMilestone(b)){a=Math.floor(this.getRowHeight()/4)}return a},onDestroy:function(){if(this.rendered){Ext.dd.ScrollManager.unregister(this.el)}clearTimeout(this.scrollTimer);clearTimeout(this.unbindListenerTimer);this.taskDragDrop&&Ext.destroy(this.taskDragDrop);this.callParent(arguments)},highlightDependency:function(a){this.ownerGrid.getDependencyView().highlightDependency(a)},unhighlightDependency:function(a){this.ownerGrid.getDependencyView().unhighlightDependency(a)},getLeftEditor:function(){return this.leftLabelField&&this.leftLabelField.editor},getRightEditor:function(){return this.rightLabelField&&this.rightLabelField.editor},getTopEditor:function(){return this.topLabelField&&this.topLabelField.editor},getBottomEditor:function(){return this.bottomLabelField&&this.bottomLabelField.editor},editLeftLabel:function(b){var a=this.getLeftEditor();if(a){a.edit(b)}},editRightLabel:function(b){var a=this.getRightEditor();if(a){a.edit(b)}},editTopLabel:function(b){var a=this.getTopEditor();if(a){a.edit(b)}},editBottomLabel:function(b){var a=this.getBottomEditor();if(a){a.edit(b)}},onRowUpdate:function(d,c){var a=this.store.getAt(c);if(a&&a.previous){var b=a.previous;if(a.parentNode&&(a.rollupField in b||a.getRollup())){this.refreshNode(a.parentNode)}if(a.readOnlyField in b){this.refreshNotReadOnlyChildNodes(a)}}},onTaskStoreUpdate:function(b,a,e,d,f){var c=a.previous;if(c&&a.getRollup()&&a.parentNode&&!a.parentNode.expanded&&b.isUndoingOrRedoing()){this.refreshNode(a.parentNode)}},handleScheduleEvent:function(a){var b=a.getTarget('.'+this.timeCellCls,3);if(b){var c=this.findRowByChild(b);if(a.type.indexOf('pinch')>=0){this.fireEvent('schedule'+a.type,this,a)}else {this.fireEvent('schedule'+a.type,this,this.getDateFromDomEvent(a,'floor'),this.indexOf(c),a)}}},scrollEventIntoView:function(b,g,n,d,e){e=e||this;var f=this;var o=this.taskStore;var k=function(a,b){f.up('panel').scrollTask.cancel();f.scrollElementIntoView(a,b,n);if(g){if(typeof g==='boolean'){a.highlight()}else {a.highlight(null,g)}}d&&d.call(e)};if(!b.isVisible()){b.bubble(function(a){a.expand()})}var a;var h=b.getStartDate(),j=b.getEndDate(),l=Boolean(h&&j),i;if(l){var c=this.timeAxis;if(!c.dateInAxis(h)||!c.dateInAxis(j)){var m=c.getEnd()-c.getStart();c.setTimeSpan(new Date(h.getTime()-m/2),new Date(j.getTime()+m/2))}i=this.getElementsFromEventRecord(b);a=i&&i[0]}else {a=this.getNode(b);if(a){a=Ext.fly(a).down(this.getCellSelector())}}if(a){k(a,l)}else {if(this.bufferedRenderer){this.scrollTimer=Ext.Function.defer(function(){f.bufferedRenderer.scrollTo(b,!1,function(){var c=f.getElementsFromEventRecord(b);a=c&&c[0];if(a){k(a,!0)}else {d&&d.call(e)}})},10)}}},isElementRenderedAndDisplayed:function(a){if(a instanceof Gnt.model.Task){a=this.view.getRowNode(a)}return !!(a&&Ext.fly(a).getHeight())},getItemBox:function(c){var g=Sch.util.Date,a=this,b=null,i=a.getViewStartDate(),k=a.getViewEndDate(),h=c.isMilestone()&&c.getEndDate()||c.getStartDate(),j=c.getEndDate(),s=a.getTaskStore(),f,l,d,z,e,x,t,o,n,r;b=h&&j&&a.store.indexOf(c)>=0&&(!s.isTreeFiltered()||s.lastTreeFilter.filter.call(s.lastTreeFilter.scope||s,c))||null;if(b){d=a.getNode(c);if(d&&a.isElementRenderedAndDisplayed(d)){var q,u;var y=a.getNodeContainer();var m=40;if(c.isMilestone()){var w=a.getRowHeight()*0.16,B=Ext.fly(d).getOffsetsTo(y)[1],p,v;q=B+w;u=B+a.getRowHeight()-w;p=Ext.fly(d).down('.sch-gantt-milestone-diamond')||Ext.fly(d).down('.sch-gantt-milestone-diamond-ct');if(p){v=p.getOffsetsTo(d)[0];f=v;l=v+p.getWidth()}}else {var A=Ext.fly(d).down('.'+Ext.baseCSSPrefix+'grid-cell-inner > .sch-event-wrap .sch-gantt-item',!0)||d;q=Ext.fly(A).getOffsetsTo(y)[1];u=q+Ext.fly(A).getHeight()}if(!f){f=a.getCoordinateFromDate(g.min(g.max(h,i),k));l=a.getCoordinateFromDate(g.max(g.min(j,k),i))}if(i.getTime()>h.getTime()){f-=m}if(i.getTime()>j.getTime()){l-=m}if(k.getTime()<h.getTime()){f+=m}if(k.getTime()<j.getTime()){l+=m}b={rendered:!0,start:f,end:l,top:Math.round(q),bottom:Math.round(u)}}else {b={rendered:!1,start:a.getCoordinateFromDate(g.max(h,i)),end:a.getCoordinateFromDate(g.min(j,k))};x=a.all.startIndex;t=a.getRecord(x);o=a.all.endIndex;n=a.getRecord(o);if(t&&n){e=a.getRowHeight();if(c.isAbove(t)){b.top=-e;b.bottom=b.top+e;b.relPos='before'}else {if(c==n||c.isAbove(n)){z=a.indexOf(c);b.top=z*e;b.bottom=b.top+e}else {r=a.getNode(o);if(a.isElementRenderedAndDisplayed(r)){b.top=Ext.fly(r).getOffsetsTo(a.getNodeContainer())[1]+Ext.fly(r).getHeight()}else {b.top=(o+1)*e}b.bottom=b.top+e;b.relPos='after'}}}else {b=null}}if(b){b=a.adjustItemBox(c,b)}}return b},adjustItemBox:function(b,c){var a=c;if(b.isMilestone()){a.bottom++}return a},getDataForTooltipTpl:function(f,a,h){var g=a.getAttribute('rolluptaskid'),b=f,d=[],c;if(g){var e=this.getTaskStore().getNodeById(g);if(e){b=e;d=this.getAdjacentRollupRecords(f,b,a,h)}}c=Ext.Array.map([b].concat(d),function(a){return Ext.apply({_record:a},a.data)});return Ext.apply(c[0],{_useBaselineData:Boolean(Ext.fly(a).up('.sch-gantt-baseline-item')),records:c})},getAdjacentRollupRecords:function(h,d,b,g){var f=this.getTaskStore(),c=[],a=this.rollupIntersectThreshold,e=g.getPoint();Ext.fly(b).up('.sch-rollup-wrap').select('.sch-gantt-item').each(function(h){if(b!=h.dom){var k=h.getRegion();var i;if(d.isMilestone()){var g=Ext.fly(b).getRegion(),l=Ext.util.Region.from({top:g.top-a,right:g.right+a,bottom:g.bottom+a,left:g.left-a});i=l.intersect(k)}else {i=k.contains(e)}if(i){var m=h.getAttribute('rolluptaskid');var j=f.getNodeById(m);if(j){c.push(j)}}}});return c},showBaseline:function(){var a=this;if(!a.baselineVisible){a.baselineVisible=!0;a.addCls('sch-ganttview-showbaseline');a.fireEvent('baseline-show',a)}},hideBaseline:function(){var a=this;if(a.baselineVisible){a.baselineVisible=!1;a.removeCls('sch-ganttview-showbaseline');a.fireEvent('baseline-hide',a)}},toggleBaseline:function(){var a=this;a.baselineVisible?a.hideBaseline():a.showBaseline()}});Ext.define('Gnt.patches.RightClick',{extend:'Sch.util.Patch',target:'Gnt.view.Gantt',maxVersion:'6.0.1',overrides:{handleScheduleBarEvent:function(a){if(Ext.isGecko&&a.type==='click'&&a.button===2){return !1}return this.callParent(arguments)}}});Ext.define('Gnt.widget.ConstraintResolutionForm',{extend:'Ext.form.Panel',requires:['Ext.form.RadioGroup','Ext.form.field.Display'],mixins:['Gnt.mixin.Localizable'],alias:'widget.constraintresolutionform',legacyMode:!1,config:{resolutionContext:null,dateFormat:null},bodyPadding:10,autoScroll:!0,initComponent:function(){var a=this;a.setupItemsFromResolutionContext(a.resolutionContext);a.setupFooterFromResolutionContext(a.resolutionContext);a.callParent(arguments)},setupItemsFromResolutionContext:function(a){var b=this,c;c=Ext.Array.map(a.resolutions,function(d,c){return {xtype:'radio',boxLabel:b.getResolutionOptionDescription(d,a),name:'resolutionOption',checked:d===a.getCancelActionOption(),inputValue:c,tabIndex:c}});b.items=[{xtype:'displayfield',itemId:'description',value:b.getConstraintViolationDescription(a),anchor:'-0'},{xtype:'radiogroup',itemId:'options',columns:1,title:b.L('Resolution options'),allowBlank:!1,items:c,anchor:'-0'}]},setupFooterFromResolutionContext:function(b){var a=this;a.fbar={itemId:'footer-tb',items:[{xtype:'checkbox',itemId:'dont-ask-cb',boxLabel:a.L("Don't ask again"),tabIndex:b.resolutions.length+1},'->',{text:a.L('OK'),itemId:'ok-btn',formBind:!0,tabIndex:b.resolutions.length+2,handler:a.onUserActionOk,scope:a},{text:a.L('Cancel'),itemId:'cancel-btn',tabIndex:b.resolutions.length+3,handler:a.onUserActionCancel,scope:a}]}},getDontAskValue:function(){var a=this;return a.down('#dont-ask-cb').getValue()},getConstraintViolationDescription:function(a){var b=this,f,g,e,d,i,h,c;f=a.title;d=a.task;i=d.getName()||'';e=d.getConstraintClass();h=b.dateFormat||b.L('dateFormat')||Ext.Date.defaultFormat;g=e&&e.getDisplayableConstraintDateForFormat(a.date,h,d)||a.date;if(a.description){c=a.description}else {if(a.getConstraintViolationDescription){c=a.getConstraintViolationDescription(a,b)}else {c=g?Ext.String.format(b.L('Task {0} violates constraint {1} {2}'),i,f,Ext.Date.format(g,h)):Ext.String.format(b.L('Task {0} violates constraint {1}'),i,f)}}return c},getResolutionOptionDescription:function(h,c){var j=this,e=Ext.String,i,g,f,d;i=c.task;f=i.getConstraintClass();d=j.dateFormat||j.L('dateFormat')||Ext.Date.defaultFormat;g=f&&f.getDisplayableConstraintDateForFormat(c.date,d,i)||c.date;var a=[h.title];if(h.getTitleValues){a=a.concat(h.getTitleValues(c,j));for(var b=a.length-1;b>=0;b--){if(a[b] instanceof Date){a[b]=Ext.Date.format(a[b],d)}}}else {a=a.concat([g&&Ext.Date.format(g,d)||''])}e.format.apply(e,a);return e.format.apply(e,a)},onUserActionOk:function(c){var a=this,b;b=a.getValues();b.dontAsk=a.getDontAskValue();a.fireEvent('ok',a,b)},onUserActionCancel:function(b){var a=this;a.fireEvent('cancel',a)},getOptimalHeight:function(c){var a=this,g,f,b,d,e,h;if(c){g=a.getXY();f=a.getWidth();a.setXY([-10000,-10000]);a.setWidth(c)}b=a.getComponent('options');d=b.getEl().getOffsetsTo(a.body);h=a.getDockedComponent('footer-tb');e=d[1]+Ext.getDom(b.getEl()).scrollHeight+2*a.bodyPadding+h.getHeight()+10;if(c){a.setWidth(f);a.setXY(g)}return e}});Ext.define('Gnt.widget.ConstraintResolutionWindow',{extend:'Ext.window.Window',alias:'widget.constraintresolutionwindow',requires:['Gnt.widget.ConstraintResolutionForm'],mixins:['Gnt.mixin.Localizable'],modal:!0,closable:!0,resizable:!0,collapsible:!1,border:!1,bodyBorder:!1,config:{resolutionContext:null,dateFormat:null},form:null,minWidth:300,initComponent:function(){var a=this;a.title=a.L('Constraint violation');a.setupItems();a.height=Math.round(Ext.dom.Element.getViewportHeight()/3);a.width=Math.round(Ext.dom.Element.getViewportWidth()/4);a.callParent(arguments);a.on('afterlayout',a.onAfterOptimalLayout,a,{single:!0})},setupItems:function(){var a=this;a.layout='fit';a.form=new Gnt.widget.ConstraintResolutionForm({resolutionContext:a.getResolutionContext(),dateFormat:a.getDateFormat(),bubbleEvents:['ok','cancel']});a.items=a.form},onAfterOptimalLayout:function(){var a=this,b,d,e,c;b=a.getHeight();d=a.form.getHeight();e=a.form.getOptimalHeight();c=e+b-d;b!=c&&a.setHeight(c)}});Ext.define('Gnt.plugin.ConstraintResolutionGui',{extend:'Ext.AbstractPlugin',alias:'plugin.constraintresolutiongui',requires:['Gnt.widget.ConstraintResolutionWindow'],config:{dateFormat:null},cmpDetacher:null,storeDetacher:null,storedResolutions:null,window:null,init:function(b){var a=this;a.callParent(arguments);if(!a.disabled){a.enable()}},destroy:function(){this.window&&this.window.destroy();this.callParent(arguments)},enable:function(){var a=this,b=a.getCmp();a.callParent();if(b.rendered){a.attachToTaskStore()}else {a.cmpDetacher=b.on('afterrender',function(){a.attachToTaskStore()},null,{destroyable:!0,single:!0})}},disable:function(){var a=this,b=a.getCmp();a.callParent();if(b.rendered){a.detachFromTaskStore()}else {a.cmpDetacher&&Ext.destroy(a.cmpDetacher);a.cmpDetacher=null}},attachToTaskStore:function(){var a=this,b,c;if(!a.storeDetacher){b=a.getCmp();c=b.getTaskStore();a.storeDetacher=b.mon(c,'constraintconflict',a.onConstraintConflict,a,{destroyable:!0})}},detachFromTaskStore:function(){var a=this;a.storeDetacher&&Ext.destroy(a.storeDetacher);a.storeDetacher=null},onConstraintConflict:function(h,b){var a=this,c=a.getCmp(),i=c.lockedGrid.getView(),f=c.normalGrid.getView(),j=c.getDependencyView(),e=f.indexOf(h),g,d={destroy:function(){Ext.destroy(g)}};function redrawTask(){if(e!=-1){i.refreshNode(e);f.refreshNode(e);j.updateDependencies(h.getAllDependencies()).then(null,Ext.emptyFn)}}redrawTask();if(!a.hasStoredResolutionForContext(b)){a.window=new Gnt.widget.ConstraintResolutionWindow({dateFormat:a.getDateFormat(),resolutionContext:b});g=a.window.on({'ok':Ext.Function.bind(a.onUserActionOk,a,[b,redrawTask,a.window,d],!0),'cancel':Ext.Function.bind(a.onUserActionCancel,a,[b,redrawTask,a.window,d],!0),'close':Ext.Function.bind(a.onUserActionClose,a,[b,redrawTask,d],!0),destroyable:!0});c.completeEdit();a.window.show()}else {a.resolveSilently(b,redrawTask)}},getStoredResolutions:function(){var a=this;if(!a.storedResolutions){a.storedResolutions={}}return a.storedResolutions},getStoredResolutionKeyForContext:function(a){return a.constraintClassName+a.resolutions.length},hasStoredResolutionForContext:function(b){var a=this,d=a.getStoredResolutionKeyForContext(b),c=a.getStoredResolutions();return Ext.isDefined(c[d])},getStoredResolutionForContext:function(b){var a=this,d=a.getStoredResolutionKeyForContext(b),c=a.getStoredResolutions();return c[d]},storeResolutionForContext:function(b,c){var a=this,d=a.getStoredResolutionKeyForContext(b),e=a.storedResolutions;a.storedResolutions[d]=c},resolveSilently:function(a,b){var d=this,c=d.getStoredResolutionForContext(a);a.resolutions[c].resolve();b()},onUserActionOk:function(h,a,g,b,c,e,d){var f=this;Ext.destroy(d);e.close();if(a.dontAsk){f.storeResolutionForContext(b,a.resolutionOption)}b.resolutions[a.resolutionOption].resolve();c()},onUserActionCancel:function(f,e,a,b,d,c){var g=this;Ext.destroy(c);d.close();a.cancelAction();b()},onUserActionClose:function(e,d,a,b,c){var f=this;Ext.destroy(c);a.cancelAction();b()}});Ext.define('Gnt.plugin.ProjectLines',{extend:'Sch.plugin.Lines',alias:'plugin.gantt_projectlines',requires:['Ext.data.Store'],innerTpl:'<span class="sch-gantt-project-line-text" style="{Style}">{Text}</span>',labelHeight:25,showHeaderElements:!0,taskStore:null,linesFor:'both',init:function(a){this.taskStore=this.taskStore||a.getTaskStore();this.bindTaskStore(this.taskStore);if(!this.store){this.store=new Ext.data.Store({fields:[{name:'Id'},{name:'ProjectId'},{name:'Date',type:'date'},{name:'Cls',type:'string'},{name:'Text',type:'string'}]})}this.callParent(arguments);this.onTaskStoreLoad()},bindTaskStore:function(a){var b={nodeappend:this.onTaskStoreNodeAppend,noderemove:this.onTaskStoreNodeRemove,update:this.onUpdate,load:this.onTaskStoreLoad,scope:this};if(this.taskStore){this.taskStore.un(b)}if(a){a.on(b)}this.taskStore=a},onUpdate:function(f,a,c,b){b=b||[];if(a&&a.isProject&&c==Ext.data.Model.EDIT){var e=Ext.Array.some([a.startDateField,a.endDateField,a.nameField],function(a){return Ext.Array.indexOf(b,a)!==-1});if(e){var d=a.modified&&a.modified.Id||a.getId();this.store.remove(this.getProjectLines(d));this.store.add(this.retrieveProjectLines(a))}}},onTaskStoreNodeAppend:function(b,a){if(a&&a.isProject&&!this.taskStore.isSettingRoot){this.store.add(this.retrieveProjectLines(a))}},onTaskStoreNodeRemove:function(b,a){if(a&&a.isProject){this.store.remove(this.getProjectLines(a.getId()))}},onTaskStoreLoad:function(){this.refreshAllProjects()},refreshAllProjects:function(){this.store.removeAll(!0);this.store.add(this.retrieveProjectLines())},getProjectLines:function(b){var a=[];this.store.each(function(c){if(c.get('ProjectId')==b){a.push(c)}});return a},prepareProjectStartLine:function(a,b){return {Date:a.getStartDate(),Text:'Start of: '+a.getName(),Cls:'sch-gantt-project-line sch-gantt-project-line-start sch-gantt-project-line-'+a.getId(),ProjectId:a.getId(),Style:'margin-top:'+b*this.labelHeight+'px'}},prepareProjectEndLine:function(a,b){return {Date:a.getEndDate(),Text:'End of: '+a.getName(),Cls:'sch-gantt-project-line sch-gantt-project-line-end sch-gantt-project-line-'+a.getId(),ProjectId:a.getId(),Style:'margin-top:'+b*this.labelHeight+'px'}},retrieveProjectLines:function(b){var e=this,d=Ext.isArray(b)?b:b&&[b]||this.taskStore.getProjects(),c=[],f=e.linesFor;for(var a=0;a<d.length;a++){f!='end'&&c.push(e.prepareProjectStartLine(d[a],a));f!='start'&&c.push(e.prepareProjectEndLine(d[a],a))}return c},destroy:function(){this.bindTaskStore(null);this.store.destroy();this.callParent(arguments)}});Ext.define('Gnt.plugin.Replicator',{extend:'Ext.grid.selection.Replicator',alias:'plugin.gantt_selectionreplicator',init:function(a){this.gantt=a;this.callParent(arguments)},replicateSelection:function(t,n,e){var i=this;if(e.columns||n.isColumns||this.gantt.isReadOnly()){return}var j=n.getFirstRowIndex(),o=n.getLastRowIndex(),r=o-j+1,d=n.view.dataSource,l,m,h,f,p=i.columns,k=p.length,q,g,c,b,a;if(r===1){g=i.getColumnValuesWithMetaData(d.getAt(j))}else {g=new Array(k);if(e.rows<0){c=[d.getAt(j+1),d.getAt(j)]}else {c=[d.getAt(o-1),d.getAt(o)]}c[0]=i.getColumnValuesWithMetaData(c[0]);c[1]=i.getColumnValuesWithMetaData(c[1]);for(a=0;a<k;a++){g[a]=this.calculateDifference(c[0][a],c[1][a])}}if(e.rows<0){l=e.end.rowIdx;m=e.start.rowIdx-1;h=-1}else {l=e.start.rowIdx;m=e.end.rowIdx+1;h=1}this.disableListeners();if(r===1){for(b=l;b!==m;b+=h){f=d.getAt(b);if(!f.isReadOnly()){for(a=0;a<k;a++){q=p[a];if(this.isEditable(q,f)){this.copyDataTo(g[a],g[a].value,q,f)}}}}}else {var s;for(b=l;b!==m;b+=h){f=d.getAt(b);if(!f.isReadOnly()){s=i.getColumnValuesWithMetaData(d.getAt(b-h));for(a=0;a<k;a++){this.sumUpDifference(p[a],f,s[a],g[a])}}}}this.enableListeners()},isEditable:function(a,b){if(a.dataIndex&&!b.isEditable(a.dataIndex)){return !1}else {return !0}},calculateDifference:function(e,a){var c=e.value,d=a.value,b=Ext.clone(a);if(!isNaN(c)&&!isNaN(d)){switch(a.dataIndex){case a.record.durationField:break;case a.record.effortField:break;default:b.value=Number(d)-Number(c);}return b}},sumUpDifference:function(e,b,g,c){var a=g.value,f=c&&c.value,d;if(this.isEditable(e,b)){if(!isNaN(a)&&!Ext.isEmpty(a)){switch(c.dataIndex){case b.durationField:break;case b.effortField:break;default:if(a instanceof Date){d=Sch.util.Date.add(a,'ms',f)}else {d=Ext.coerce(Number(a)+f,a)};this.copyDataTo(c,d,e,b);}}}},copyDataTo:function(a,c,d,b){switch(a.dataIndex){case a.record.durationField:b.setDuration(c,a.record.getDurationUnit());break;case a.record.effortField:b.setEffort(c,a.record.getEffortUnit());break;default:if(d.putRawData){d.putRawData(Ext.clone(c),b)}else {if(d.dataIndex){b.set(a.dataIndex,c)}};}},getColumnValuesWithMetaData:function(a){return Ext.Array.map(this.columns,function(b){var c={dataIndex:b.dataIndex,record:a};if(b.getRawData){c.value=b.getRawData(a)}else {if(b.dataIndex){c.value=a.get(b.dataIndex)}}return c})},enableListeners:function(){var a=this;if(!Ext.getVersion().isGreaterThan('6.2.0')){a.gantt.lockedGrid.view.on('beforerefresh',a.gantt.selModel.onBeforeViewRefresh,a.gantt.selModel);a.gantt.normalGrid.view.on('beforerefresh',a.gantt.selModel.onBeforeViewRefresh,a.gantt.selModel)}},disableListeners:function(){var a=this;if(!Ext.getVersion().isGreaterThan('6.2.0')){a.gantt.lockedGrid.view.un('beforerefresh',a.gantt.selModel.onBeforeViewRefresh,a.gantt.selModel);a.gantt.normalGrid.view.un('beforerefresh',a.gantt.selModel.onBeforeViewRefresh,a.gantt.selModel)}}});Ext.define('Gnt.template.TaskTooltip',{extend:'Ext.XTemplate',mixins:['Gnt.mixin.Localizable'],disableFormats:!0,dateFormat:null,maxItemsInTooltip:2,overflowTextTpl:null,markup:['<tpl if="records">','<tpl for="records">','<tpl if="xindex &lt;= _maxItemsInTooltip_">','_bodyTpl_','</tpl>','</tpl>','<tpl if="records.length &gt; _maxItemsInTooltip_">','<div class="sch-task-tip-extra">','{[this.getOverflowText(values)]}','</div>','</tpl>','<tpl else>','_bodyTpl_','</tpl>'].join(''),bodyMarkup:['<h2 class="sch-task-tip-header">{Name}</h2>','<table class="sch-task-tip">','<tr><td>_startText_:</td> <td align="right">{[this.getStartDateString(values)]}</td></tr>','<tr><td>_endText_:</td> <td align="right">{[this.getEndDateString(values)]}</td></tr>','<tr><td>_percentText_:</td><td align="right">{[this.getPercentDoneString(values)]}%</td></tr>','</table>'].join(''),constructor:function(a){this.markup=a||this.markup;this.markup=this.markup.replace(/_bodyTpl_/g,this.bodyMarkup).replace(/_maxItemsInTooltip_/g,this.maxItemsInTooltip).replace(/_startText_/g,this.L('startText')).replace(/_endText_/g,this.L('endText')).replace(/_percentText_/g,this.L('percentText'));this.dateFormat=this.L('format');this.overflowTextTpl=new Ext.XTemplate(this.L('overflowText'));this.callParent([this.markup])},getStartDateString:function(a){var b=a._record;var c=a._useBaselineData?b.getBaselineStartDate():b.getStartDate();return a._record.getDisplayStartDate(this.dateFormat,!0,c,!1,a._useBaselineData)},getEndDateString:function(a){var b=a._record;var c=a._useBaselineData?b.getBaselineEndDate():b.getEndDate();return a._record.getDisplayEndDate(this.dateFormat,!0,c,!1,a._useBaselineData)},getPercentDoneString:function(a){var b=a._record;var c=a._useBaselineData?b.getBaselinePercentDone():b.getPercentDone();return Math.round(c)},getOverflowText:function(a){if(a.records.length>this.maxItemsInTooltip){return this.overflowTextTpl.apply({nbrOverflowing:a.records.length-this.maxItemsInTooltip})}}});Ext.define('Gnt.panel.Gantt',{extend:'Sch.panel.TimelineTreePanel',alias:['widget.ganttpanel'],alternateClassName:['Sch.gantt.GanttPanel'],mixins:['Gnt.view.dependency.Mixin'],requires:['Ext.layout.container.Border','Ext.tree.plugin.TreeViewDragDrop','Ext.util.CSS','Sch.plugin.NonWorkingTime','Gnt.patches.CellEditor','Gnt.patches.CellEditor_2','Gnt.patches.CellEditing','Gnt.patches.Rows','Gnt.patches.SpreadsheetModel','Gnt.patches.SpreadsheetModel_2','Gnt.patches.SpreadsheetModel_3','Gnt.patches.SpreadsheetModel_4','Gnt.patches.SpreadsheetModel_5','Gnt.patches.TablePanel','Gnt.patches.TreeView','Gnt.patches.TreeViewDragDrop','Gnt.patches.SelectionExtender2','Gnt.patches.LockingView','Gnt.data.ResourceStore','Gnt.data.AssignmentStore','Gnt.data.Calendar','Gnt.data.TaskStore','Gnt.data.DependencyStore','Gnt.view.Gantt','Gnt.patches.RightClick','Gnt.plugin.ConstraintResolutionGui','Gnt.plugin.ProjectLines','Gnt.plugin.Replicator','Gnt.template.TaskTooltip'],uses:['Sch.plugin.CurrentTimeLine','Gnt.patches.GanttPanel'],viewType:'ganttview',layout:'border',rowLines:!0,syncRowHeight:!1,rowHeight:24,rowHeightStyleSheetNode:null,tooltipTpl:!0,rowNumberColumn:null,topLabelField:null,leftLabelField:null,bottomLabelField:null,rightLabelField:null,rollupLabelField:null,rollupIntersectThreshold:5,weekendsAreWorkdays:!1,skipWeekendsDuringDragDrop:!0,enableTaskDragDrop:!0,enableProgressBarResize:!1,toggleParentTasksOnClick:!0,addRowOnTab:!0,recalculateParents:!0,cascadeChanges:!1,enableBaseline:!1,baselineVisible:!1,enableAnimations:!1,animate:!1,workingTimePlugin:null,todayLinePlugin:null,highlightWeekends:!0,allowParentTaskMove:!0,allowParentTaskDependencies:!0,enableDragCreation:!0,eventRenderer:null,eventRendererScope:null,eventTemplate:null,parentEventTemplate:null,rollupTemplate:null,milestoneTemplate:null,taskBodyTemplate:null,parentTaskBodyTemplate:null,milestoneBodyTemplate:null,autoHeight:null,calendar:null,crudManager:null,taskStore:null,dependencyStore:null,resourceStore:null,assignmentStore:null,columnLines:!1,dndValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,taskResizeHandles:'both',resizeValidatorFn:Ext.emptyFn,resizeConfig:null,progressBarResizeConfig:null,dragDropConfig:null,createConfig:null,autoFitOnLoad:!1,showRollupTasks:!1,enableConstraintsResolutionGui:!0,showProjectLines:!0,projectLinesConfig:null,constraintResolutionGuiConfig:null,scrollTaskIntoViewOnClick:!1,enableTaskReordering:!0,refreshLockedTreeOnDependencyUpdate:!1,_lockedDependencyListeners:null,_lastSpreadsheetSelection:null,earlyColumns:null,lateColumns:null,earlyDatesListeners:null,lateDatesListeners:null,fullRefreshColumnsListeners:null,refreshTimeout:100,batchUpdate:!1,eventBorderWidth:Ext.theme&&Ext.theme.name.match('Triton|Crisp')?0:1,ganttEditingPlugin:null,simpleCascadeThreshold:30,forceDefineTimeSpanByStore:!0,keepSelection:!0,setShowRollupTasks:function(a){this.showRollupTasks=a;this.getSchedulingView().setShowRollupTasks(a)},onCalendarSet:function(b,a){if(this.needToTranslateOption('weekendsAreWorkdays')){a.setWeekendsAreWorkDays(this.weekendsAreWorkdays)}if(this.workingTimePlugin){this.workingTimePlugin.bindCalendar(a);this.timeAxisViewModel.setCalendar(a)}},initStores:function(){if(this.crudManager){if(!(this.crudManager instanceof Gnt.data.CrudManager)){this.crudManager=Ext.create(this.crudManager.xclass||'Gnt.data.CrudManager',Ext.clone(this.crudManager))}if(!this.taskStore){this.taskStore=this.crudManager.getTaskStore(this)}if(!this.dependencyStore){this.dependencyStore=this.crudManager.getDependencyStore(this)}if(!this.resourceStore){this.resourceStore=this.crudManager.getResourceStore(this)}if(!this.assignmentStore){this.assignmentStore=this.crudManager.getAssignmentStore(this)}}if(!this.taskStore){Ext.Error.raise('You must specify a taskStore config.')}var a=Ext.StoreMgr.lookup(this.taskStore);if(!a){Ext.Error.raise('You have provided an incorrect taskStore identifier')}if(!(a instanceof Gnt.data.TaskStore)){Ext.Error.raise('A `taskStore` should be an instance of `Gnt.data.TaskStore` (or of a subclass)')}this.mon(a,{calendarset:this.onCalendarSet,scope:this});this.mon(a,{beforeindentationchange:this.onBeforeBatchStoreUpdate,indentationchange:this.onBatchStoreUpdate,beforebatchremove:this.onBeforeBatchStoreUpdate,batchremove:this.onBatchStoreUpdate,scope:this});Ext.apply(this,{store:a,taskStore:a});var d=a.calendar;if(this.dependencyStore){this.dependencyStore=Ext.StoreMgr.lookup(this.dependencyStore);a.setDependencyStore(this.dependencyStore)}else {this.dependencyStore=a.dependencyStore}this.dependencyStore.allowParentTaskDependencies=this.allowParentTaskDependencies;if(!(this.dependencyStore instanceof Gnt.data.DependencyStore)){Ext.Error.raise('The Gantt dependency store should be a Gnt.data.DependencyStore, or a subclass thereof.')}var c=this.resourceStore?Ext.StoreMgr.lookup(this.resourceStore):a.getResourceStore();if(!(c instanceof Gnt.data.ResourceStore)){Ext.Error.raise('A `ResourceStore` should be an instance of `Gnt.data.ResourceStore` (or of a subclass)')}var b=this.assignmentStore?Ext.StoreMgr.lookup(this.assignmentStore):a.getAssignmentStore();if(!(b instanceof Gnt.data.AssignmentStore)){Ext.Error.raise('An `assignmentStore` should be an instance of `Gnt.data.AssignmentStore` (or of a subclass)')}this.bindAssignmentStore(b,!0);this.bindResourceStore(c,!0);if(this.needToTranslateOption('weekendsAreWorkdays')){d.setWeekendsAreWorkDays(this.weekendsAreWorkdays)}},onBeforeBatchStoreUpdate:function(){this.batchUpdate=!0;this.taskStore.filterUpdateSuspended=!0;this.lockedGrid.view.viewReady=this.normalGrid.view.viewReady=!1;this.taskStore.suspendEvent('refresh','add','insert','remove');var a=this.getSchedulingView().getNavigationModel().getPosition();if(a){this._lastNavigationPosition=a.clone()}if(this.bufferedRenderer){this.suspendLayouts()}},onBatchStoreUpdate:function(){var b=this.getTaskStore(),c,a;b.resumeEvent('refresh','add','insert','remove');this.lockedGrid.view.viewReady=this.normalGrid.view.viewReady=!0;b.filterUpdateSuspended=!1;a=this._lastNavigationPosition;if(a){c=this.getSchedulingView().getNavigationModel();if(a.record&&!b.getNodeById(a.record.getId())){a.record=b.getAt(a.recordIndex)}c.setPosition(a);delete this._lastNavigationPosition}this.refreshViews();if(this.bufferedRenderer){this.resumeLayouts(!0);b.reApplyFilter()}this.batchUpdate=!1},initComponent:function(){this.autoHeight=!1;this.initStores();if(this.getCrudManager()){this.mon(this.getCrudManager(),{beforeresponseapply:this.onBeforeCrudResponseApply,requestdone:this.onCrudRequestDone,priority:-900,scope:this})}if(this.needToTranslateOption('cascadeChanges')){this.setCascadeChanges(this.cascadeChanges)}if(this.needToTranslateOption('recalculateParents')){this.setRecalculateParents(this.recalculateParents)}if(this.needToTranslateOption('skipWeekendsDuringDragDrop')){this.setSkipWeekendsDuringDragDrop(this.skipWeekendsDuringDragDrop)}this.dependencyViewConfig=this.dependencyViewConfig||{};Ext.applyIf(this.dependencyViewConfig,{enableDependencyDragDrop:this.enableDependencyDragDrop});this.normalViewConfig=this.normalViewConfig||{};Ext.applyIf(this.normalViewConfig,{taskStore:this.taskStore,dependencyStore:this.dependencyStore,snapRelativeToEventStartDate:this.snapRelativeToEventStartDate,progressBarResizeConfig:this.progressBarResizeConfig,enableDependencyDragDrop:this.enableDependencyDragDrop,enableTaskDragDrop:this.enableTaskDragDrop,enableProgressBarResize:this.enableProgressBarResize,enableDragCreation:this.enableDragCreation,allowParentTaskMove:this.allowParentTaskMove,allowParentTaskDependencies:this.allowParentTaskDependencies,toggleParentTasksOnClick:this.toggleParentTasksOnClick,taskResizeHandles:this.taskResizeHandles,enableBaseline:this.baselineVisible||this.enableBaseline,leftLabelField:this.leftLabelField,rightLabelField:this.rightLabelField,topLabelField:this.topLabelField,bottomLabelField:this.bottomLabelField,rollupLabelField:this.rollupLabelField,rollupIntersectThreshold:this.rollupIntersectThreshold,eventTemplate:this.eventTemplate,parentEventTemplate:this.parentEventTemplate,milestoneTemplate:this.milestoneTemplate,rollupTemplate:this.rollupTemplate,taskBodyTemplate:this.taskBodyTemplate,parentTaskBodyTemplate:this.parentTaskBodyTemplate,milestoneBodyTemplate:this.milestoneBodyTemplate,resizeConfig:this.resizeConfig,dragDropConfig:this.dragDropConfig,showRollupTasks:this.showRollupTasks});if(this.topLabelField||this.bottomLabelField){this.addCls('sch-gantt-topbottom-labels '+(this.topLabelField?'sch-gantt-top-label':''));this.rowHeight=Math.max(60,this.rowHeight)}this.configureFunctionality();this.mon(this.taskStore,{beforecascade:this.onBeforeCascade,cascade:this.onAfterCascade,scope:this});if(this.tooltipTpl===!0){this.tooltipTpl=new Gnt.template.TaskTooltip()}this.callParent(arguments);var b=this.getSelectionModel();var c=Ext.grid.selection&&Ext.grid.selection.SpreadsheetModel&&b instanceof Ext.grid.selection.SpreadsheetModel;if(this.keepSelection&&c){this.mon(this.taskStore,{remove:this.tryRestoreSelectionAfterRemove,priority:1,scope:this});if(Ext.getVersion().isLessThan('6.0.1')||Ext.getVersion().isGreaterThan('6.2.0')){this.mon(this.taskStore,{remove:this.storeSelectionBeforeRemove,priority:2001,scope:this})}this.mon(this.taskStore,{beforebatchremove:this.storeSelectionBeforeRemove,batchremove:this.tryRestoreSelectionAfterBatchRemove,scope:this})}if(c){var g=this.lockedGrid;var f=b.applyExtensible;b.applyExtensible=function(b){var a=f.apply(this,arguments);g.view.el.appendChild(a.handle);this.applyExtensible=f;return a}}if(this.autoFitOnLoad){var d=typeof this.autoFitOnLoad==='object'?this.autoFitOnLoad:{};this.normalGrid.on('afterlayout',function(){if(this.store.getCount()){this.zoomToFit(null,d)}this.mon(this.store,'load',function(){this.zoomToFit(null,d)},this)},this,{single:!0})}this.bodyCls=(this.bodyCls||'')+' sch-ganttpanel-container-body';var a=this.getSchedulingView();this.relayEvents(a,['taskclick','taskdblclick','taskcontextmenu','beforetaskresize','taskresizestart','partialtaskresize','beforetaskresizefinalize','aftertaskresize','beforeprogressbarresize','progressbarresizestart','afterprogressbarresize','beforetaskdrag','taskdragstart','beforetaskdropfinalize','beforedragcreate','dragcreatestart','beforedragcreatefinalize','dragcreateend','afterdragcreate','taskdrop','aftertaskdrop','labeledit_beforestartedit','labeledit_beforecomplete','labeledit_complete','scheduleclick','scheduledblclick','schedulecontextmenu','rowlongpress','containerlongpress']);this.relayEvents(this.lockedGrid.getView(),['rowlongpress','containerlongpress']);if(this.addRowOnTab){var e=this.lockedGrid.getView();e.onRowExit=Ext.Function.createInterceptor(e.onRowExit,this.beforeRowExit,this)}this.registerRenderer(a.columnRenderer,a);var h=' sch-ganttpanel sch-horizontal ';this.addCls(h);if(this.eventBorderWidth<1){this.addCls('sch-gantt-no-task-border')}if(this.baselineVisible){this.showBaseline()}this.on('add',function(a,b){if(b instanceof Ext.Editor){a.lockedGrid.suspendLayouts();a.suspendLayouts();a.lockedGrid.add(b);a.resumeLayouts();a.lockedGrid.resumeLayouts()}});this.on('viewready',this.onMyViewReady,this);this.on({dragcreatestart:function(){var b=this.findPlugin('scheduler_pan');var a=this.getSchedulingView().getScrollable();if(b){b.disable()}a.setDisabled&&a.setDisabled(!0)},afterdragcreate:function(){var b=this.findPlugin('scheduler_pan');var a=this.getSchedulingView().getScrollable();if(b){b.enable()}a.setDisabled&&a.setDisabled(!1)},scope:this});if(this.scrollTaskIntoViewOnClick){this.lockedGrid.on('itemclick',this.onRowClicked,this)}Ext.Array.each(this.lockedGrid.plugins||[],function(a){if(Sch.plugin&&Sch.plugin.TreeCellEditing&&a instanceof Sch.plugin.TreeCellEditing){this.ganttEditingPlugin=a;return !1}},this)},tryRestoreSelectionAfterRemove:function(f,m,k){var e=this.getSelectionModel();var a=this._lastSpreadsheetSelection||e.selected;this._lastSpreadsheetSelection=null;if(!a||f.getCount()===0){return}var j=this.lockedGrid.getView();if(a.isCells){var b=a.getRange();if(b[1][0]===-1){return}var i=j.getNodes().length-1;e.selectCells([b[0][0],Math.min(i,b[0][1])],[b[1][0],Math.min(i,b[1][1])])}else {if(a.isRows){var d=a.getRecords();if(d.length){var c=!1;for(var g=0,l=d.length;g<l;g++){if(c=c||f.indexOf(d[g])!==-1){break}}if(!c){var h=j.getRecord(Math.min(k,f.getCount()-1));h&&e.select(h)}}}}},storeSelectionBeforeRemove:function(){var a=this.getSelectionModel().getSelected();if(!a){return}a=a.clone();if(a.isRows){var b=a.getRecords();if(b.length){a._lastRecordIndex=this.getView().indexOf(b[b.length-1])}}this._lastSpreadsheetSelection=a},tryRestoreSelectionAfterBatchRemove:function(c,k){var a=this._lastSpreadsheetSelection;this._lastSpreadsheetSelection=null;this.getSelectionModel().onStoreRemove(c,k,null,!1);if(!a||c.getCount()===0){return}var i=this.getSelectionModel();var j=this.lockedGrid.getView();if(a.isCells){var b=a.getRange();if(b[1][0]===-1){return}var h=j.getNodes().length;i.selectCells([b[0][0],Math.min(h,b[0][1])],[b[1][0],Math.min(h,b[1][1])])}else {if(a.isRows){var f=a.getRecords();var d=!1;for(var e=0,l=f.length;e<l;e++){if(d=d||c.indexOf(f[e])!==-1){break}}if(!d){var g=j.getRecord(Math.min(a._lastRecordIndex,c.getCount()-1));g&&i.select(g)}}}},getTreeViewDragDropPlugin:function(){var c=this.lockedGrid.view.plugins||[];var a;for(var b=0;b<c.length;b++){a=c[b];if(a instanceof Ext.tree.plugin.TreeViewDragDrop){return a}}},doSetTreeViewDragDropDisabled:function(b){var a=this.getTreeViewDragDropPlugin();if(a){if(b){a.disable()}else {a.enable()}}},setTreeViewDragDropDisabled:function(a){var c=this;var b=this.lockedGrid.view;if(b.rendered){c.doSetTreeViewDragDropDisabled(a)}else {b.on('render',function(){c.doSetTreeViewDragDropDisabled(a)})}},restoreSpreadsheetSelectionModel:function(){var a=this.getSelectionModel(),b=this.getTreeViewDragDropPlugin();if(a.isLocked()&&b&&!b.disabled){a.setLocked(!1);this.setTreeViewDragDropDisabled(!0);this.lockedGrid.view.on('cellmousedown',a.handleMouseDown,a);a.navigationListeners=a.navigationModel.on({navigate:a.onNavigate,scope:a,destroyable:!0})}},setReadOnly:function(a){this.callParent(arguments);this.fireEvent('setreadonly',this,a)},getTimeSpanDefiningStore:function(){return this.taskStore},bindAutoTimeSpanListeners:function(){if(!this.autoFitOnLoad){this.callParent(arguments)}},onBeforeCascade:function(){this.lockedGrid.view.onUpdate=this.normalGrid.view.onUpdate=Ext.emptyFn;this.suspendLayouts()},onAfterCascade:function(i,a){var d=this;this.lockedGrid.view.onUpdate=this.lockedGrid.view.self.prototype.onUpdate;this.normalGrid.view.onUpdate=this.normalGrid.view.self.prototype.onUpdate;d.resumeLayouts();if(this.batchUpdate){return}if(a.nbrAffected>0){var e=this.lockedGrid.getView();if(a.nbrAffected<=d.simpleCascadeThreshold){var g=this.getView();var b=this.getSchedulingView();b.suspendEvents(!0);for(var h in a.affected){var f=a.affected[h];var c=e.store.indexOf(f);if(c>=0){g.refreshNode(c)}}b.resumeEvents();return}this.refreshViews()}},updateFullRefreshColumns:function(){var a=this;if(a.refreshTimer){return}if(a.fullRefreshColumns&&a.fullRefreshColumns.length){a.refreshTimer=setTimeout(function(){a.refreshTimer=null;a.redrawColumns(a.fullRefreshColumns)},a.refreshTimeout)}},bindFullRefreshListeners:function(b){var a=this;a.fullRefreshColumnsListeners=b.mon(this.taskStore,{nodeappend:a.updateFullRefreshColumns,nodeinsert:a.updateFullRefreshColumns,noderemove:a.updateFullRefreshColumns,destroyable:!0,scope:this})},bindSequentialDataListeners:function(a){var b=this.lockedGrid.view;var c=this.taskStore;a.mon(c,{nodeappend:function(e,d){if(!c.fillCount){this.updateAutoGeneratedCells(a,b.store.indexOf(d.parentNode))}},nodeinsert:function(d,e,c){this.updateAutoGeneratedCells(a,b.store.indexOf(c))},noderemove:function(e,d,c){if(!c){this.updateAutoGeneratedCells(a,b.store.indexOf(d))}},nodemove:function(d,c){this.updateAutoGeneratedCells(a,b.store.indexOf(c))},scope:this})},bindEarlyDatesListeners:function(){var a=Ext.Function.createBuffered(this.updateEarlyDateColumns,this.refreshTimeout,this,[]);this.earlyDatesListeners=this.mon(this.taskStore,{earlydatesreset:a,scope:this,destroyable:!0})},bindLateDatesListeners:function(){var a=Ext.Function.createBuffered(this.updateLateDateColumns,this.refreshTimeout,this,[]);this.lateDatesListeners=this.mon(this.taskStore,{latedatesreset:a,scope:this,destroyable:!0})},startEditScrollToEditor:function(){var a=this.ganttEditingPlugin;!Sch.disableOverrides&&a&&a.on('beforeedit',function(b,a){a.column.getEl().scrollIntoView(a.column.ownerCt.getEl());a.view.scrollCellIntoView(a.cell)},this,{single:!0})},beforeRowExit:function(d,b,c,e){if(!(d instanceof Ext.event.Event)){e=c;c=b;b=d}if(e&&!c){var a=this.lockedGrid.getView();var f=a.getRecord(b);var g=a.saveFocusState;a.saveFocusState=function(){return Ext.emptyFn};f.addTaskBelow({leaf:!0});a.saveFocusState=g;if(Ext.getVersion().isGreaterThanOrEqual('6.5.0')){this.startEditScrollToEditor()}}},needToTranslateOption:function(a){return this.hasOwnProperty(a)||this.self.prototype.hasOwnProperty(a)&&this.self!=Gnt.panel.Gantt},resolveTaskRecord:function(a){return this.getSchedulingView().resolveTaskRecord(a)},fitTimeColumns:function(){this.getSchedulingView().fitColumns()},getResourceStore:function(){return this.getTaskStore().getResourceStore()},getAssignmentStore:function(){return this.getTaskStore().getAssignmentStore()},getCrudManager:function(){return this.crudManager},getTaskStore:function(){return this.taskStore},getEventStore:function(){return this.taskStore},getDependencyStore:function(){return this.dependencyStore},onDragDropStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onDragDropEnd:function(){if(this.tip){this.tip.enable()}},configureFunctionality:function(){var a=this.plugins=[].concat(this.plugins||[]);if(this.enableConstraintsResolutionGui&&!Ext.Array.findBy(a,function(a){return a instanceof Gnt.plugin.ConstraintResolutionGui||a.ptype=='constraintresolutiongui'})){a.push(Ext.apply(this.constraintResolutionGuiConfig||{},{pluginId:'constraintresolutiongui',ptype:'constraintresolutiongui'}))}if(this.showProjectLines){a.push(Ext.apply({pluginId:'gantt_projectlines',ptype:'gantt_projectlines'},this.projectLinesConfig))}if(this.enableTaskReordering){if(!this.hasOwnProperty('lockedViewConfig')){this.lockedViewConfig=Ext.apply({},this.lockedViewConfig||{})}this.lockedViewConfig.plugins=[].concat(this.lockedViewConfig.plugins||[]);var c=this.lockedViewConfig.plugins;var b;Ext.Array.each(c,function(a){if(a==='treeviewdragdrop'||a.ptype==='treeviewdragdrop'){b=!0}});if(!b){var d=Ext.apply({},Ext.isObject(this.enableTaskReordering)&&this.enableTaskReordering||{},{ptype:'treeviewdragdrop',pluginId:'bryntum_treedragdrop',nodeHighlightOnDrop:!1,nodeHighlightOnRepair:!1,containerScroll:!0,dragZone:{onBeforeDrag:Ext.Function.bind(this.onBeforeTaskReorder,this)},dropZone:{onNodeDrop:this.onTaskReorder,onNodeOver:this.onTaskReorderOver}});c.push(d)}}},getWorkingTimePlugin:function(){return this.workingTimePlugin},registerLockedDependencyListeners:function(){var a=this;var b=this.getDependencyStore();this._lockedDependencyListeners=this._lockedDependencyListeners||{load:function(){var b=a.getTaskStore();b.resetEarlyDates();b.resetLateDates();a.lockedGrid.getView().refreshView()},clear:function(){var b=a.getTaskStore();b.resetEarlyDates();b.resetLateDates();a.lockedGrid.getView().refreshView()},add:function(c,b){a.refreshTasksForDependencies(b)},update:function(g,b,f){if(f!=Ext.data.Model.COMMIT){var e=a.lockedGrid.view;if(b.previous[b.fromField]){var c=a.taskStore.getModelById(b.previous[b.fromField]);if(c){e.refreshNode(c)}}if(b.previous[b.toField]){var d=a.taskStore.getModelById(b.previous[b.toField]);if(d){e.refreshNode(d)}}}a.refreshTasksForDependencies([b])},remove:function(c,b){a.refreshTasksForDependencies(b)}};this.mun(b,this._lockedDependencyListeners);this.mon(b,this._lockedDependencyListeners)},getDependencyTasks:function(d){var a=d.getSourceTask(this.taskStore),b=d.getTargetTask(this.taskStore),c=[];if(a&&a.getTreeStore()){c.push(a)}if(b&&b.getTreeStore()){c.push(b)}return c},refreshLockedViewRows:function(b){var c=this.lockedGrid.view;for(var a=0;a<b.length;a++){c.refreshNode(b[a])}},refreshTasksForDependencies:function(d){var c=this,a={},b=[];Ext.Array.each(d,function(f){var e=c.getDependencyTasks(f);for(var d=0;d<e.length;d++){if(!a[e[d].getId()]){a[e[d].getId()]=1;b.push(e[d])}}c.refreshLockedViewRows(b)})},showBaseline:function(){this.getSchedulingView().showBaseline()},hideBaseline:function(){this.getSchedulingView().hideBaseline()},toggleBaseline:function(){this.getSchedulingView().toggleBaseline()},zoomToFit:function(a,b){b=Ext.apply({adjustStart:1,adjustEnd:1},b);if(!a&&this.taskStore.isTreeFiltered()){a=this.getSchedulingView().store.getRange()}var c=a?this.taskStore.getTimeSpanForTasks(a):this.taskStore.getTotalTimeSpan();if(this.zoomToSpan(c,b)===null){if(!a){this.fitTimeColumns()}}},getCascadeChanges:function(){return this.taskStore.cascadeChanges},setCascadeChanges:function(a){this.taskStore.cascadeChanges=a},getRecalculateParents:function(){return this.taskStore.recalculateParents},setRecalculateParents:function(a){this.taskStore.recalculateParents=a},setSkipWeekendsDuringDragDrop:function(a){this.taskStore.skipWeekendsDuringDragDrop=this.skipWeekendsDuringDragDrop=a},getSkipWeekendsDuringDragDrop:function(){return this.taskStore.skipWeekendsDuringDragDrop},bindResourceStore:function(b,d){var a=this;var c={scope:a,update:a.onResourceStoreUpdate,add:a.onResourceStoreDataChanged,remove:a.onResourceStoreDataChanged,write:a.onResourceStoreDataChanged,refresh:a.onResourceStoreDataChanged,sort:a.onResourceStoreDataChanged,filter:a.onResourceStoreDataChanged,clear:a.onResourceStoreDataChanged};if(!d&&a.resourceStore){if(b!==a.resourceStore&&a.resourceStore.autoDestroy){a.resourceStore.destroy()}else {a.mun(a.resourceStore,c)}if(!b){a.resourceStore=null}}if(b){b=Ext.data.StoreManager.lookup(b);a.mon(b,c);this.taskStore.setResourceStore(b)}a.resourceStore=b;if(b&&!d){a.refreshViews()}},bindAssignmentStore:function(b,d){var a=this;var c={scope:a,beforetaskassignmentschange:a.onBeforeSingleTaskAssignmentChange,taskassignmentschanged:a.onSingleTaskAssignmentChange,update:a.onAssignmentStoreUpdate,add:a.onAssignmentStoreDataChanged,remove:a.onAssignmentStoreDataChanged,write:a.onAssignmentStoreDataChanged,refresh:a.onAssignmentStoreDataChanged,filter:a.onAssignmentStoreDataChanged,sort:a.onAssignmentStoreDataChanged,clear:a.onAssignmentStoreDataChanged,commit:a.onAssignmentStoreDataChanged};if(!d&&a.assignmentStore){if(b!==a.assignmentStore&&a.assignmentStore.autoDestroy){a.assignmentStore.destroy()}else {a.mun(a.assignmentStore,c)}if(!b){a.assignmentStore=null}}if(b){b=Ext.data.StoreManager.lookup(b);a.mon(b,c);this.taskStore.setAssignmentStore(b)}a.assignmentStore=b;if(b&&!d){a.refreshViews()}},onResourceStoreUpdate:function(b,a){Ext.Array.each(a.getTasks(),function(b){var a=this.lockedGrid.view.store.indexOf(b);if(a>=0){this.getView().refreshNode(a)}},this)},onResourceStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreUpdate:function(d,c){var b=c.getTask();if(b){var a=this.lockedGrid.view.store.indexOf(b);if(a>=0){this.getView().refreshNode(a)}}},onBeforeSingleTaskAssignmentChange:function(){this.assignmentStore.un('add',this.onAssignmentStoreDataChanged,this);this.assignmentStore.un('remove',this.onAssignmentStoreDataChanged,this)},onSingleTaskAssignmentChange:function(d,c){this.assignmentStore.on('add',this.onAssignmentStoreDataChanged,this);this.assignmentStore.on('remove',this.onAssignmentStoreDataChanged,this);if(this.rendered){var a=this.taskStore.getModelById(c);if(a&&a.parentNode){var b=this.taskStore.indexOf(a);if(b>=0){this.getView().refreshNode(b)}}}},updateAutoGeneratedCells:function(e,b){var a=this.lockedGrid.view;var h=a.all.startIndex;var d=a.all.endIndex;if(b<0||b>d){return}for(var c=Math.max(h,b);c<=d;c++){var g=a.store.getAt(c);var f=this.getCellDom(a,g,e);if(f){f.firstChild.innerHTML=e.renderer(null,null,g)}}},getCellDom:function(d,c,b){var a=d.getNode(c,!0);return a&&Ext.fly(a).down(b.getCellSelector(),!0)},redrawCell:function(e,a,c,d,b){if(!this.isDestroyed){var f=this.lockedGrid.view;var g=this.getCellDom(f,a,e);if(g){var h=[];if(c===undefined){c=this.taskStore.indexOf(a)}if(d===undefined){d=f.indexOf(a)}if(b===undefined){b=e.getIndex()}f.renderCell(e,a,c,d,b,h);var i=Ext.DomHelper.createDom(h.join(''));Ext.fly(g).down('.'+Ext.baseCSSPrefix+'grid-cell-inner').syncContent(i)}}},redrawColumns:function(b){if(b.length&&!this.isDestroyed){var c=this.lockedGrid.view;for(var a=c.all.startIndex;a<=c.all.endIndex;a++){var f=c.store.getAt(a);for(var d=0,g=b.length;d<g;d++){var e=b[d];this.redrawCell(e,f,a,a,e.getIndex())}}}},updateEarlyDateColumns:function(){this.earlyColumns&&this.earlyColumns.length&&this.redrawColumns(this.earlyColumns)},updateLateDateColumns:function(){this.lateColumns&&this.lateColumns.length&&this.redrawColumns(this.lateColumns)},onMyViewReady:function(){this.on('beforeedit',this.onBeforeEdit,this);this.setupColumnListeners();var a=this.down('splitter');if(a){a.on('dragend',function(){this.saveState()},this,{delay:10})}if(this.ganttEditingPlugin){if((Ext.isIE10m||Ext.isFirefox)&&Ext.getVersion().isLessThan('6.0.2')){this.applyIETabbingPatch()}this.ganttEditingPlugin.on({editingstart:this.onEditingStart,edit:this.onAfterEdit,canceledit:this.onAfterEdit})}},onBeforeCrudResponseApply:function(){this.fireEvent('beforedatarefresh',this);var a=this.getDependencyView();a&&a.stopDrawDependencies()},onCrudRequestDone:function(){this.fireEvent('datarefresh',this);var a=this.getDependencyView();a&&a.startDrawDependencies()},applyIETabbingPatch:function(){var a=function(c,b){var a=b.column;a.preventUpdate=a._oldPreventUpdate;this.redrawCell(a,b.record)};var b=function(c,b){var a=b.column;a._oldPreventUpdate=a.preventUpdate;a.preventUpdate=!0};this.ganttEditingPlugin.on({edit:a,canceledit:a,scope:this});this.ganttEditingPlugin.on({beforeedit:b,priority:-50})},onBeforeEdit:function(c,a){var b=a.column;return !this.isReadOnly()&&a.record.isEditable(a.field)&&(!b.isEditable||b.isEditable(a.record))},onEditingStart:function(c,b){var a=b.field;if(a.originalInstantUpdate){a.setInstantUpdate(!0)}},onAfterEdit:function(c,b){var a=b.column.getEditor();if(a.setInstantUpdate){a.setInstantUpdate(!1)}},setupColumnListeners:function(){var b=this;var a=this.lockedGrid.getHeaderContainer();a.on('add',this.onLockedColumnAdded,this);a.on('remove',this.onLockedColumnRemoved,this);a.items.each(function(c){b.onLockedColumnAdded(a,c)})},onLockedColumnRemoved:function(c,a){var b=Gnt.column;if(b){if(a.isDependencyColumn&&a.useSequenceNumber){Ext.Array.remove(this.fullRefreshColumns,a)}else {if(a.isEarlyStartDateColumn||a.isEarlyEndDateColumn){Ext.Array.remove(this.earlyColumns,a)}else {if(a.isLateStartDateColumn||a.isLateEndDateColumn){Ext.Array.remove(this.lateColumns,a)}else {if(a.isTotalSlackColumn||a.isFreeSlackColumn){Ext.Array.remove(this.earlyColumns,a);Ext.Array.remove(this.lateColumns,a)}}}}}if(this.earlyDatesListeners&&!(this.slackColumns&&this.slackColumns.length)&&!(this.earlyColumns&&this.earlyColumns.length)){this.earlyDatesListeners.destroy()}if(this.lateDatesListeners&&!(this.slackColumns&&this.slackColumns.length)&&!(this.lateColumns&&this.lateColumns.length)){this.lateDatesListeners.destroy()}if(this.fullRefreshColumnsListeners&&!(this.fullRefreshColumns&&this.fullRefreshColumns.length)){this.fullRefreshColumnsListeners.destroy()}},onLockedColumnAdded:function(c,a){var b=Gnt.column;if(b){if(a.isWBSColumn||a.isSequenceColumn){this.bindSequentialDataListeners(a)}else {if(a.isDependencyColumn&&a.useSequenceNumber){this.fullRefreshColumns=this.fullRefreshColumns||[];this.fullRefreshColumns.push(a);this.bindFullRefreshListeners(a)}else {if(a.isEarlyStartDateColumn||a.isEarlyEndDateColumn){this.earlyColumns=this.earlyColumns||[];this.earlyColumns.push(a)}else {if(a.isLateStartDateColumn||a.isLateEndDateColumn){this.lateColumns=this.lateColumns||[];this.lateColumns.push(a)}else {if(a.isTotalSlackColumn||a.isFreeSlackColumn){this.earlyColumns=this.earlyColumns||[];this.earlyColumns.push(a);this.lateColumns=this.lateColumns||[];this.lateColumns.push(a)}}}}}}if(!this.earlyDatesListeners&&(this.slackColumns&&this.slackColumns.length||this.earlyColumns&&this.earlyColumns.length)){this.bindEarlyDatesListeners()}if(!this.lateDatesListeners&&(this.slackColumns&&this.slackColumns.length||this.lateColumns&&this.lateColumns.length)){this.bindLateDatesListeners()}},getState:function(){var a=this,b=a.callParent(arguments);if(a.lockedGrid.rendered){b.lockedWidth=a.lockedGrid.getWidth()}return b},applyState:function(a){var b=this;b.callParent(arguments);if(a&&a.lockedWidth){b.lockedGrid.setWidth(a.lockedWidth)}},completeEdit:function(){this.ganttEditingPlugin&&this.ganttEditingPlugin.completeEdit()},cancelEdit:function(){this.ganttEditingPlugin&&this.ganttEditingPlugin.cancelEdit()},setRowHeight:function(a,d){var e=this.isViewport?'.sch-ganttpanel':'#'+this.getId();var c=e+' .'+Ext.baseCSSPrefix+'grid-cell';var b=c+'{ height:'+a+'px; }';if(!this.rowHeightStyleSheetNode){this.rowHeightStyleSheetNode=Ext.util.CSS.createStyleSheet(b).ownerNode}else {this.rowHeightStyleSheetNode.innerHTML=b}this.timeAxisViewModel.setViewRowHeight(a,d)},getTaskEditor:function(d){var c=this.plugins;for(var b=0,e=c.length;b<e;b++){var a=c[b];if(a.isTaskEditor&&(!d||a.matchFilters(d))){return a}}},onRowClicked:function(b,a){this.getSchedulingView().scrollEventIntoView(a,!1,!1)},onBeforeTaskReorder:function(d,b){var a=b.record;var c=Ext.grid.selection&&Ext.grid.selection.SpreadsheetModel&&this.getSelectionModel() instanceof Ext.grid.selection.SpreadsheetModel;d._reorderingTask=a;return (!c||Boolean(b.getTarget('.sch-gantt-column-dragdrop')))&&!this.isReadOnly()&&a&&!a.isReadOnly()},onTaskReorderOver:function(f,g,e,d){var a=this.self.prototype.onNodeOver.apply(this,arguments);if(a!==this.dropNotAllowed){var c=this.getTargetFromEvent(e);if(c){var b=this.view.getRecord(c);a=b!==d._reorderingTask&&!b.isReadOnly()?this.dropAllowed:this.dropNotAllowed}}return a},onTaskReorder:function(l,h,k,e){var a=this.valid;if(a){var j=this.getTargetFromEvent(k);var c=this.view.getRecord(j);e._reorderingTask&&!c.isReadOnly();a=c!==e._reorderingTask&&!c.isReadOnly();if(a){var g=h.view.store;var d=e.records;var b={};var i=h.view.up('ganttpanel');i.suspendRefresh();Ext.Array.each(d,function(a){b[a.parentNode.id]=a.parentNode});g.suspendAutoRecalculateParents++;a=this.self.prototype.onNodeDrop.apply(this,arguments);g.suspendAutoRecalculateParents--;if(a){b[d[0].parentNode.id]=d[0].parentNode;var f=Ext.Object.getValues(b);f.sort(function(a,b){return a.data.depth>b.data.depth?-1:1});Ext.Array.each(f,function(a){a.refreshCalculatedParentNodeData()})}i.resumeRefresh(!0)}}return a},getSelectedRows:function(){var b=this.getSelectionModel().getSelected();var a=[];if(Ext.grid.selection.Cells&&b instanceof Ext.grid.selection.Cells){b.eachRow(function(b){a.push(b)})}else {a=this.getSelectionModel().getSelection()}return a},destroy:function(){clearTimeout(this.refreshTimer);if(this.destroyStores){var a=this.taskStore.calendarManager;this.assignmentStore&&this.assignmentStore.destroy();this.assignmentStore=null;this.resourceStore&&this.resourceStore.destroy();this.resourceStore=null;this.taskStore&&this.taskStore.destroy();this.taskStore=null;this.dependencyStore&&this.dependencyStore.destroy();this.dependencyStore=null;a&&a.destroy()}if(this.rowHeightStyleSheetNode){this.rowHeightStyleSheetNode.parentNode.removeChild(this.rowHeightStyleSheetNode);this.rowHeightStyleSheetNode=null}this.callParent(arguments)},collapseAll:function(){this.taskStore.suspendEvent('refresh','add','insert','remove');this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=!0;this.callParent(arguments);this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=!1;this.taskStore.resumeEvent('refresh','add','insert','remove');this.refreshViews()},expandAll:function(){this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=!0;this.callParent(arguments);this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=!1;this.refreshViews()},getCalendar:function(){return this.getTaskStore().getCalendar()}});Ext.define('Gnt.view.ResourceHistogram',{extend:'Sch.view.TimelineGridView',alias:'widget.resourcehistogramview',requires:['Sch.patches.DragDropManager','Sch.patches.NavigationModel','Ext.XTemplate','Ext.util.Format','Sch.util.Date'],mixins:['Sch.mixin.GridViewCanvas'],_cmpCls:'gnt-resourcehistogramview',scheduledEventName:'bar',eventSelector:'.gnt-resourcehistogram-bar',barTpl:null,barRenderer:Ext.emptyFn,limitLineRenderer:Ext.emptyFn,lineRenderer:Ext.emptyFn,lineTpl:null,limitLineTpl:null,_barCls:'gnt-resourcehistogram-bar',_limitLineCls:'gnt-resourcehistogram-limitline',_limitLineVerticalCls:'gnt-resourcehistogram-limitline-vertical',_lineCls:'gnt-resourcehistogram-line',barCls:null,limitLineCls:null,lineCls:null,limitLineWidth:1,rowHeight:60,showLimitLinesThreshold:10,showVerticalLimitLines:!0,labelMode:!1,labelPercentFormat:'0',labelUnitsFormat:'0.0',histogram:null,unitHeight:null,initComponent:function(a){if(this.barCls){this.eventSelector='.'+this.barCls}this.createTemplates();this.callParent(arguments);this.unitHeight=this.getAvailableRowHeight()/(this.scaleMax-this.scaleMin+this.scaleStep)},createTemplates:function(a){if(a||!this.barTpl){this.barTpl=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="gnt-resourcehistogram-bar '+(this.barCls||'')+' {cls}" gnt-bar-index="{index}" style="left:{left}px;top:{top}px;height:{height}px;width:{width}px">','<tpl if="text !== \'\'">','<span class="gnt-resourcehistogram-bar-text" style="bottom:'+Math.floor(this.rowHeight/2)+'px">{text}</span>','</tpl>','</div>','</tpl>')}if(a||!this.lineTpl){this.lineTpl=new Ext.XTemplate('<tpl for=".">','<div class="gnt-resourcehistogram-line '+(this.lineCls||'')+' {cls}" style="top:{top}px;"></div>','</tpl>')}if(a||!this.limitLineTpl){this.limitLineTpl=new Ext.XTemplate('<tpl for=".">','<div class="gnt-resourcehistogram-limitline '+(this.limitLineCls||'')+' {cls}" style="left:{left}px;top:{top}px;width:{width}px;height:{height}px"></div>','</tpl>')}},renderLines:function(){return this.lineTpl.apply(this.prepareLines())},prepareLines:function(){var i=this.scaleMin,d=this.scaleMax,f=i,l=this.scaleLabelStep,j=this.getAvailableRowHeight(),a=[],c=this._lineCls,k=c+'min';var b,e;if(this.scalePoints){for(var h=0,m=this.scalePoints.length;h<m;h++){var g=this.scalePoints[h];b={value:g.value,top:g.top||Math.round(j-this.unitHeight*(g.value-i)),cls:g.cls+(g.label?' '+c+'-label':'')+(h===0?' '+c+'-min':h==m?' '+c+'-max':'')};e=this.lineRenderer(a,b);a.push(Ext.apply(b,e))}}else {while(f<=d){b={value:f,top:Math.round(j-this.unitHeight*(f-i)),cls:k};e=this.lineRenderer(a,b);a.push(Ext.apply(b,e));f+=this.scaleStep;k=f%l?'':c+'-label';if(f==d){k+=' '+c+'-max'}}if(a.length&&a[a.length-1].value!==d){b={value:d,top:Math.round(j-this.unitHeight*(d-i)),cls:(d%l?'':c+'-label')+' '+c+'-max'};e=this.lineRenderer(a,b);a.push(Ext.apply(b,e))}}return a},renderLimitLines:function(a){return this.limitLineTpl.apply(this.prepareLimitLines(a))},getLimitLinesConnector:function(a,b){return {left:a.right,width:1,top:Math.min(a.top,b.top),height:Math.abs(a.top-b.top)+this.limitLineWidth,cls:this._limitLineCls+'-top'+' '+this._limitLineVerticalCls}},pushLimitLine:function(c,d,b){var a=c[c.length-1];if(b){if(a){a.width=b.right-a.left;a.right=b.right}else {d.left=b.left;d.width=d.right-b.left}}if(a&&this.showVerticalLimitLines){if(!a.visible){c.pop()}c.push(this.getLimitLinesConnector(a,d))}var e=this.limitLineRenderer(c,d,b);c.push(Ext.apply(d,e))},prepareLimitLines:function(f){if(!f){return}var c=[],r=this.scaleMin,q=this.scaleMax,o=this.scaleStep,p=this.scaleUnit,k=this.getAvailableRowHeight(),s=this._limitLineCls,l=this.getTimeAxisViewModel()&&this.getTimeAxisViewModel().getTotalWidth(),a,b,d;for(var g=0,t=f.length;g<t;g++){var i=this.calendar.convertMSDurationToUnit(f[g].allocationMS,p);var h=!0;if(i*this.unitHeight>k){i=q+o;h=!1}else {if(i<=0){i=0;h=!1}}var j=f[g].startDate&&this.getCoordinateFromDate(f[g].startDate,!0)||0;var e=f[g].endDate&&this.getCoordinateFromDate(f[g].endDate,!0)||l;if(j<0){j=0}if(e<0){e=l}b={left:j,width:e-j,right:e,top:'',height:0,cls:'',visible:h};b.top=Math.round(k-(i-r)*this.unitHeight);if(h){b.cls+=' '+s+'-top'}d=c[c.length-1]||a;var m=b.width<=this.showLimitLinesThreshold;if(d&&(b.top==d.top||m&&!h)){d.width=e-d.left;d.right=e;b=null;if(c[c.length-1]){a=null}else {if(a.width>this.showLimitLinesThreshold){this.pushLimitLine(c,a);a=null}}}else {if(m&&h){if(a){var n=a.width+b.width;a.top=Math.round(b.top*b.width/n+a.top*a.width/n);a.width=e-a.left;a.right=e}else {a=b}if(a.width>this.showLimitLinesThreshold){this.pushLimitLine(c,a);b=a=null}}else {this.pushLimitLine(c,b,a);b=a=null}}}b&&this.pushLimitLine(c,b,a);d=c[c.length-1];if(d&&!d.visible){c.pop()}return c},renderBars:function(b,a){return this.barTpl.apply(this.prepareBars(b,a))},prepareBars:function(g,h){if(!g){return}var m=[],i=this.getAvailableRowHeight(),n=this._barCls,j=this.scaleUnit,r=Sch.util.Date.getShortNameOfUnit(j),l=this.scaleMin,u=this.scaleMax,t=this.scaleStep,s=u+t,k=this.timeAxis.getStart(),f=this.timeAxis.getEnd(),a,c;for(var e=0,w=g.length;e<w;e++){var b=g[e];if(b.totalAllocation){c=this.calendar.convertMSDurationToUnit(b.allocationMS,j);var q=b.endDate<=f;var p=Sch.util.Date.betweenLesser(b.startDate,k,f);var o=this.getCoordinateFromDate(p?b.startDate:k,!0);var v=this.getCoordinateFromDate(q?b.endDate:f,!0);a={id:'bar-'+h+'-'+e,index:e,left:o,width:v-o,height:i,top:0,text:'',cls:''};if(this.labelMode){switch(this.labelMode){case 'percent':a.text=Ext.util.Format.number(b.totalAllocation,this.labelPercentFormat)+'%';break;case 'units':a.text=Ext.util.Format.number(c,this.labelUnitsFormat)+r;break;default:a.text=this.labelMode.apply({allocation:c,percent:b.totalAllocation});}}if(c<=s){a.height=c>=l?Math.round((c-l)*this.unitHeight):0;a.top=i-a.height}else {a.cls+=' '+n+'-partofbar'}if(b.totalAllocation>100||b.totalOverAllocationMS>0){a.cls+=' '+n+'-overwork'}var d=this.barRenderer(h,b,a);if(d&&d.cls){d.cls=a.cls+' '+d.cls}a=Ext.apply(a,d);m.push(a)}}return m},getAvailableRowHeight:function(){return this.rowHeight-this.cellTopBorderWidth-this.cellBottomBorderWidth},resolveEventRecord:function(e){var d=this.findItemByChild(e);if(d){var c=this.getRecord(d);if(c){var a={resource:c};var g=this.histogram.allocationData[c.getId()];var f=e.getAttribute('gnt-bar-index');var b=g.bars[f];if(b){a.startDate=b.startDate;a.endDate=b.endDate;a.assignments=b.assignments;a.allocationMS=b.allocationMS;a.totalAllocation=b.totalAllocation}return a}}return null},resolveEventRecordFromResourceRow:function(a){return this.resolveEventRecord(a)},getDataForTooltipTpl:function(a){return a}});Ext.define('Gnt.panel.ResourceHistogram',{extend:'Sch.panel.TimelineGridPanel',requires:['Sch.patches.TablePanel','Ext.XTemplate','Sch.util.Date','Sch.plugin.NonWorkingTime','Gnt.column.Scale','Gnt.view.ResourceHistogram'],mixins:['Gnt.mixin.Localizable'],alias:'widget.resourcehistogram',viewType:'resourcehistogramview',layout:'border',preserveScrollOnRefresh:!0,showScaleLines:!1,showLimitLines:!0,showLimitLinesThreshold:10,showVerticalLimitLines:!0,cacheLimitDurationMS:0,cacheLimitDuration:6,cacheLimitDurationUnit:'mo',calendarResources:null,calendarListenersHash:null,calendar:null,taskStore:null,resourceStore:null,assignmentStore:null,startDate:null,endDate:null,highlightWeekends:!0,allocationData:null,scaleUnit:'HOUR',scaleMin:0,scaleMax:24,scaleLabelStep:4,scaleStep:2,rowHeight:50,groupAllocationByDay:!0,scaleColumnClass:'Gnt.column.Scale',scaleColumnConfigs:['scalePoints','scaleStep','scaleLabelStep','scaleMin','scaleMax','scaleLabelStep','scaleStep'],normalViewConfigs:['barCls','barTpl','barRenderer','lineRenderer','limitLineRenderer','lineTpl','lineCls','limitLineTpl','limitLineCls','limitLineWidth','labelMode','labelPercentFormat','labelUnitsFormat','scaleMin','scaleMax','scaleStep','scaleLabelStep','scalePoints','scaleUnit','loadMask','showLimitLinesThreshold','showVerticalLimitLines','calendar'],cacheUpdateSuspended:!1,suspendedCacheUpdatesCount:0,gapThreshold:24*3600000,rowLines:!0,initComponent:function(){this.cacheLimitDurationMS=Sch.util.Date.getUnitDurationInMs(this.cacheLimitDurationUnit)*this.cacheLimitDuration;this.resetAllocationDataCache();this.initStores();this.lockedGridConfig=Ext.applyIf(this.lockedGridConfig||{},{reserveScrollbar:!1,width:300,forceFit:!0});this.normalViewConfig=Ext.apply(this.normalViewConfig||{},{histogram:this,trackOver:!1,rowHeight:this.rowHeight,preserveScrollOnRefresh:this.preserveScrollOnRefresh});this.lockedViewConfig=Ext.apply(this.lockedViewConfig||{},{rowHeight:this.rowHeight,preserveScrollOnRefresh:this.preserveScrollOnRefresh});if(this.scalePoints){this.scalePoints.sort(function(a,b){return a.value>b.value?1:-1});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}this.initColumns();Ext.Array.each(this.normalViewConfigs,function(a){if(a in this){this.normalViewConfig[a]=this[a]}},this);this.callParent(arguments);var b='gnt-resourcehistogram sch-horizontal ';this.addCls(b);this.registerRenderer(this.columnRenderer,this);var a=this.getSchedulingView();this.relayEvents(a,['barclick','bardblclick','barcontextmenu'])},onRender:function(){var a=this.getScaleColumn();if(a){a.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight())}this.callParent(arguments)},initStores:function(){var a=!1;if(this.crudManager){this.setCrudManager(this.crudManager);a=!0}this.store=this.resourceStore;this.taskStore=this.taskStore||this.store.getTaskStore();this.calendar=this.calendar||this.taskStore&&this.taskStore.getCalendar();if(!this.calendar){throw 'Cannot get project calendar instance: please specify either "calendar" or "taskStore" option'}this.assignmentStore=this.assignmentStore||this.store.getAssignmentStore()||this.taskStore&&this.taskStore.getAssignmentStore();if(!a){this.bindStores()}},getCrudManager:function(){return this.crudManager},setCrudManager:function(a){this.unbindStores();this.crudManagerListeners&&this.crudManagerListeners.destroy();this.crudManager=a;this.taskStore=this.crudManager.getTaskStore();this.store=this.resourceStore=this.crudManager.getResourceStore();this.assignmentStore=this.crudManager.getAssignmentStore();this.crudManagerListeners=this.mon(this.crudManager,{beforeloadapply:{fn:this.beforeCrudManagerLoad,priority:-999},load:this.afterCrudManagerLoad,destroyable:!0,scope:this});this.bindStores()},beforeCrudManagerLoad:function(){this.suspendStoreListeners()},afterCrudManagerLoad:function(){this.beforeCrudOperationStart(this.crudManager,null,'load');this.resumeStoreListeners(!0);this.onCrudOperationComplete()},bindStores:function(){if(this.taskStore){this.mon(this.taskStore,{refresh:this.onTaskStoreRefresh,load:this.onTaskStoreRefresh,update:this.onTaskUpdateOrAppend,nodeappend:this.onTaskUpdateOrAppend,scope:this})}if(this.assignmentStore){this.mon(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentUpdate,add:this.onAssignmentsChange,scope:this})}this.calendar&&this.mon(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.bindCalendarListeners();this.store&&this.mon(this.store,{update:this.onResourceUpdate,refresh:this.onResourceStoreRefresh,scope:this,priority:100})},unbindStores:function(){if(this.taskStore){this.mun(this.taskStore,{refresh:this.onTaskStoreRefresh,load:this.onTaskStoreRefresh,update:this.onTaskUpdateOrAppend,nodeappend:this.onTaskUpdateOrAppend,scope:this})}if(this.assignmentStore){this.mun(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentUpdate,add:this.onAssignmentsChange,scope:this})}this.calendar&&this.mun(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.unbindCalendarListeners();this.store&&this.mun(this.store,{update:this.onResourceUpdate,refresh:this.onResourceStoreRefresh,scope:this,priority:100})},suspendStoreListeners:function(){this.cacheUpdateSuspended=!0;this.suspendedCacheUpdatesCount=0;this.unbindStores()},resumeStoreListeners:function(a){this.cacheUpdateSuspended=!1;this.bindStores();if(a&&this.suspendedCacheUpdatesCount){this.clearCacheAndRefresh()}},clearCacheAndRefresh:function(a){this.resetAllocationDataCache(a);this.refreshIfRendered(a)},createDefaultColumns:function(){var b=[],a;b.push({flex:1,resizable:!1,text:this.L('resourceText'),dataIndex:this.resourceStore.model.prototype.nameField,renderer:function(a){return Ext.String.htmlEncode(a)}});a={width:40,resizable:!1,availableHeight:this.rowHeight};Ext.copyTo(a,this,this.scaleColumnConfigs,!0);a=this.scaleCol=Ext.create(this.scaleColumnClass,a);a.on({beforerender:function(){a.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight());if(this.scalePoints){this.scalePoints=a.scalePoints}},scope:this});b.push(a);return b},initColumns:function(){if(!this.columns){this.columns=this.createDefaultColumns();var a=this.scaleCol;if(this.scalePoints){this.scaleMin=a.scaleMin;this.scaleMax=a.scaleMax;this.scaleStep=a.scaleStep}}else {var c=!Ext.isArray(this.columns)?[this.columns]:this.columns;for(var b=0;b<c.length;b++){var d=c[b];if(this.isScaleColumn(d)){Ext.copyToIf(d,this,this.scaleColumnConfigs)}}}},isScaleColumn:function(b){var a=b.xtype&&Ext.ClassManager.getByAlias('widget.'+b.xtype);a=a&&a.prototype;return b instanceof Gnt.column.Scale||a&&a.isXType('scalecolumn')},getScaleColumn:function(){return this.lockedGrid.down('scalecolumn')},destroy:function(){this.unbindStores();this.callParent(arguments)},getResourceStore:function(){return this.resourceStore},getAssignmentStore:function(){return this.assignmentStore},getEventStore:function(){return this.taskStore},getTimeSpanDefiningStore:function(){return this.taskStore},unbindResourceCalendarListener:function(c,a){var b=this.calendarResources[a];if(b){Ext.Array.remove(b,c);if(!b.length){this.calendarListenersHash[a].destroy();delete this.calendarListenersHash[a];delete this.calendarResources[a]}}},bindResourceCalendarListener:function(c){var a=this,d=c.getOwnCalendar(),b=d.getCalendarId();if(!a.calendarListenersHash[b]){a.calendarListenersHash[b]=a.mon(d,{load:a.onCalendarChange,calendarchange:a.onCalendarChange,scope:a,destroyable:!0})}if(!a.calendarResources[b]){a.calendarResources[b]=[c]}else {if(Ext.Array.indexOf(a.calendarResources,c)===-1){a.calendarResources[b].push(c)}}},bindCalendarListeners:function(){var a=this;a.unbindCalendarListeners();a.store.each(function(c){var b=c.getOwnCalendar();if(b&&b!==a.calendar){a.bindResourceCalendarListener(c)}})},unbindCalendarListeners:function(){for(var a in this.calendarListenersHash){this.calendarListenersHash[a].destroy()}this.calendarResources=[];this.calendarListenersHash={}},onTaskStoreRefresh:function(){this.clearCacheAndRefresh()},onCalendarChange:function(c){var a=this.calendarResources[c.getCalendarId()];if(a){for(var b=0;b<a.length;b++){this.clearCacheAndRefresh(a[b])}}},onProjectCalendarChange:function(){this.clearCacheAndRefresh()},onTaskUpdateOrAppend:function(d,a){var b;var c=a.getTreeStore();if(!c.isSettingRoot&&!a.isRoot()){if(this.assignmentStore&&a.getAssignmentStore()!=this.assignmentStore){b=this.assignmentStore.getAssignmentsForTask(a.getId())}else {b=a.getAssignments()}this.onAssignmentsChange(this.assignmentStore,b)}},onAssignmentsRefresh:function(a){this.onAssignmentsChange(a,a.getRange())},onAssignmentUpdate:function(f,d,h,b){var e=this,c=e.assignmentStore.model.prototype.resourceIdField,a;if(h==Ext.data.Model.EDIT){if(b&&Ext.Array.contains(b,c)){var g=d.previous[c];a=this.resourceStore.getModelById(g);if(a){this.clearCacheAndRefresh(a)}}e.onAssignmentsChange(f,[d])}},onAssignmentsChange:function(f,a){var d=this,b;if(!Ext.isArray(a)){a=[a]}for(var c=0,e=a.length;c<e;c++){b=d.resourceStore.getModelById(a[c].getResourceId());if(b&&!b.inOnCalendarChange){d.clearCacheAndRefresh(b)}}},findEndIndex:function(d,b){b=b||this.getEndDate();var c=d.length-1;for(var a=c;a>=0;a--){if(d[a].startDate<b){c=a;break}}return c},findStartIndex:function(d,b){b=b||this.getStartDate();var c=0;for(var a=0,e=d.length;a<e;a++){if(d[a].endDate>b){c=a;break}}return c},resetAllocationDataCache:function(b){var a=this;if(!b){a.allocationData={}}else {a.allocationData=a.allocationData||{};a.allocationData[b.getId()]=null}},constrainAllocationDataCache:function(a){var b=this,c=new Date(b.timeAxis.getStart()-this.cacheLimitDurationMS),d=new Date(b.timeAxis.getEnd()-0+this.cacheLimitDurationMS),h=a.maxBars.length-1,f=0,i=a.bars.length-1,g=0,e=!1;if(a.cacheEnd>d){h=b.findEndIndex(a.maxBars,d);i=b.findEndIndex(a.bars,d);a.cacheEnd=d;e=!0}if(a.cacheStart<c){f=b.findStartIndex(a.maxBars,c);g=b.findStartIndex(a.bars,c);a.cacheStart=c;e=!0}if(e){a.maxBars=Ext.Array.splice(a.maxBars,f,h+1-f);a.bars=Ext.Array.splice(a.bars,g,i+1-g)}return e},updateAllocationDataCache:function(i,f,d){var o=Sch.util.Date,b=this,a,g,h,c,e;if(b.cacheUpdateSuspended){b.suspendedCacheUpdatesCount++;return}f=f||b.getStartDate();d=d||b.getEndDate();if(!i){b.resourceStore.each(function(a){b.updateAllocationDataCache(a,f,d)})}else {a=b.allocationData[i.getId()]||{};g=a.cacheStart;h=a.cacheEnd;if(g!=f||h!=d){if(g&&h&&o.intersectSpans(g,h,f,d)){if(g>f){c=b.processAllocationData(i.getAllocationInfo({startDate:f,endDate:g,includeResCalIntervals:!0}));if(c.maxBars.length){if(c.maxBars[c.maxBars.length-1].startDate.getTime()===g.getTime()){c.maxBars.pop()}}if(c.bars.length&&a.bars.length){var l=c.bars[c.bars.length-1];var k=a.bars[0];if(l.startDate>=k.startDate&&l.endDate<=k.endDate){c.bars.pop()}}c.maxBars.length&&(c.maxBars[c.maxBars.length-1].endDate=g);a.maxBars.length&&(a.maxBars[0].startDate=g);a.bars=c.bars.concat(a.bars);a.maxBars=c.maxBars.concat(a.maxBars);a.maxBarsStartIndex=0;a.barsStartIndex=0;a.cacheStart=f}if(h<d){e=b.processAllocationData(i.getAllocationInfo({startDate:h,endDate:d,includeResCalIntervals:!0}));if(e.maxBars.length){var n=e.maxBars[0];if(n.endDate.getTime()===h.getTime()){e.maxBars.shift()}else {n.startDate=h}}if(e.bars.length&&a.bars.length){var j=e.bars[0];var m=a.bars[a.bars.length-1];if(j.startDate>=m.startDate&&j.endDate<=m.endDate){e.bars.shift()}}e.maxBars.length&&(e.maxBars[e.maxBars.length-1].endDate=d);a.maxBars.length&&(a.maxBars[a.maxBars.length-1].endDate=h);a.bars=a.bars.concat(e.bars);a.maxBars=a.maxBars.concat(e.maxBars);a.maxBarsEndIndex=a.maxBars.length-1;a.barsEndIndex=a.bars.length-1;a.cacheEnd=d}if(b.cacheLimitDuration>0){b.constrainAllocationDataCache(a)}a.maxBarsStartIndex=b.findStartIndex(a.maxBars,f);a.barsStartIndex=b.findStartIndex(a.bars,f);a.maxBarsEndIndex=b.findEndIndex(a.maxBars,d);a.barsEndIndex=b.findEndIndex(a.bars,d)}else {a=b.processAllocationData(i.getAllocationInfo({startDate:f,endDate:d,includeResCalIntervals:!0}));a.maxBarsStartIndex=0;a.maxBarsEndIndex=a.maxBars.length-1;a.barsStartIndex=0;a.barsEndIndex=a.bars.length-1;a.cacheStart=f;a.cacheEnd=d}}b.allocationData[i.getId()]=a}},isBarAssignmentsChanged:function(d){var b=d.bar,a=d.period;if(!b.assignments||!a.inResourceCalendar||!a.totalAllocation||!a.inTasksCalendar){return !1}for(var c=0,e=b.assignments.length;c<e;c++){if(a.assignmentsHash[b.assignments[c].getTaskId()]){return !1}}return !0},openBar:function(b,a){if(this.groupAllocationByDay){a.bar={startDate:b,totalAllocation:a.totalAllocation,allocationMS:a.allocationMS,assignments:a.period.assignments,totalOverAllocationMS:a.totalOverAllocationMS}}else {a.bar={startDate:b,totalAllocation:a.period.totalAllocation,allocationMS:a.period.totalAllocationMS,assignments:a.period.assignments,totalOverAllocationMS:a.period.totalOverAllocationMS||0}}a.barOpened=!0;return a.bar},closeBar:function(b,a){if(!a.barOpened){return !1}if(b){a.bar.endDate=b}a.bars.push(a.bar);a.barOpened=!1},splitBar:function(a,b,c){this.closeBar(a,b);return this.openBar(c||a,b)},appendZeroMaxBars:function(c,f,b){if(!c){return !1}var h=this,g=Sch.util.Date.getDurationInDays(c,f);if(g<2){return !1}var d=!0,a=b.maxBar,e=b.maxBars;if(a){if(!a.allocationMS){d=!1}else {a.endDate=Sch.util.Date.getStartOfNextDay(c,!0);e.push(a)}}if(d){b.maxBar={startDate:a&&a.endDate||h.getStart(),allocationMS:0}}b.maxAllocationMS=0;return b.maxBar},getPeriodDay:function(c,b,a){return this.getMergePeriodStart.apply(this,arguments)},getMergePeriodStart:function(a,c,b){return Ext.Date.clearTime(a,!0)},getTotalAllocationAverage:function(c){var a=0,b=0;Ext.Array.each(c,function(c){a+=c.totalAllocation*c.duration;b+=c.duration});a/=b;return a},processAllocationData:function(c){var d,h,g,n,i,p,o,v,k,u,s,x,j,m,w=[],l=[],b=this,a={bars:w,maxBars:l};if(!c||!c.length){return a}var f=b.getPeriodDay(c[0].startDate,c[0]);if(this.showLimitLines&&f>this.getStartDate()){l.push({startDate:this.getStartDate(),endDate:f,allocationMS:0})}for(var r=0,y=c.length;r<y;r++){d=c[r];f=b.getPeriodDay(d.startDate,d,a);a.period=d;if(b.groupAllocationByDay&&f-n!==0){if(this.showLimitLines){if(b.appendZeroMaxBars(n,f,a)){g=a.maxBar}}n=f;v=a.allocationMS;x=a.totalOverAllocationMS;u=a.maxAllocationMS;o=0;s=0;k=0;j=0;m=!1;var e=r;var t=[];while(c[e]&&b.getPeriodDay(c[e].startDate,c[e],a)-f===0){if(c[e].inResourceCalendar){k+=c[e].endDate-c[e].startDate;if(c[e].totalAllocationMS){o+=c[e].totalAllocationMS;s+=c[e].totalOverAllocationMS||0;if(!m&&j&&j!=c[e].totalAllocation){m=!0}t.push({totalAllocation:c[e].totalAllocation,duration:c[e].endDate-c[e].startDate});j=c[e].totalAllocation}}e++}if(m){j=b.getTotalAllocationAverage(t)}a.allocationMS=o;a.totalOverAllocationMS=s;a.maxAllocationMS=k;a.totalAllocation=j}else {f=!1}b.onProcessAllocationDataIterateFn&&b.onProcessAllocationDataIterateFn(a);if(b.showLimitLines){if(f&&k!=u){if(g){g.endDate=f;l.push(g)}g=a.maxBar={startDate:f,allocationMS:k}}g.endDate=d.endDate}if(!a.barOpened){if(d.inTask){h=b.openBar(new Date(d.startDate),a)}}else {if(!d.inTask){b.closeBar(null,a)}else {var q=!1;if(b.isBarAssignmentsChanged(a)){i=h.endDate;p=new Date(d.startDate);q=!0}else {if(f&&f-h.endDate>=b.gapThreshold){i=Ext.Date.clearTime(h.endDate,!0);if(i<h.endDate){i=Sch.util.Date.add(i,Sch.util.Date.DAY,1)}p=Ext.Date.clearTime(d.startDate,!0);q=!0}else {if(f&&o!==v&&d.totalAllocation){i=p=Ext.Date.clearTime(d.startDate,!0);q=!0}}}h.assignments=a.period.assignments;if(q){b.closeBar(i,a);h=b.openBar(p,a)}else {if(!b.groupAllocationByDay){a.allocationMS+=d.totalAllocationMS;a.totalOverAllocationMS+=d.totalOverAllocationMS||0;a.maxAllocationMS+=d.endDate-d.startDate;a.totalAllocation=d.totalAllocation}}}}if(a.barOpened){h.endDate=d.endDate}}b.closeBar(null,a);if(b.showLimitLines){if(b.appendZeroMaxBars(n||b.getStart(),b.getEnd(),a)){g=a.maxBar}if(g){l.push(g)}}b.onProcessAllocationDataFinalizeFn&&b.onProcessAllocationDataFinalizeFn(a);return {bars:w,maxBars:l}},onResourceUpdate:function(f,a,e,c){if(Ext.Array.indexOf(c,a.calendarIdField)>-1){this.resetAllocationDataCache(a);var d=a.previous[a.calendarIdField];this.unbindResourceCalendarListener(a,d);var b=a.getOwnCalendar();if(b&&b!==this.calendar){this.bindResourceCalendarListener(a)}}},onResourceStoreRefresh:function(){var a=this;a.clearCacheAndRefresh();a.bindCalendarListeners()},refreshIfRendered:function(b){var a=this;if(a.rendered&&a.resourceStore&&b){var c=a.resourceStore.indexOf(b);if(c>=0){a.getView().refreshNode(c)}}else {if(a.rendered){a.refreshViews()}}},columnRenderer:function(k,j,g,i,h){var d=this,f=g.getId(),e=this.normalGrid.getView(),a,c,b;d.updateAllocationDataCache(g);a=d.allocationData[f];c=a&&a.bars;b=a&&a.maxBars;if(c&&(a.barsStartIndex>0||a.barsEndIndex<c.length-1)){c=c.slice(a.barsStartIndex,a.barsEndIndex+1)}if(b&&(a.maxBarsStartIndex>0||a.maxBarsEndIndex<b.length-1)){b=b.slice(a.maxBarsStartIndex,a.maxBarsEndIndex+1)}return (d.showScaleLines?e.renderLines():'')+e.renderBars(c,f)+(d.showLimitLines?e.renderLimitLines(b):'')},setRowHeight:function(b,a){}});Ext.define('Gnt.patches.AbstractClipboard',{extend:'Sch.util.Patch',target:'Ext.plugin.AbstractClipboard',minVersion:'6.0.0',overrides:{privates:{getData:function(h,b){var g=this,c=g.getFormats(),e,f,a,d;if(Ext.isString(b)){if(!c[b]){Ext.raise('Invalid clipboard format "'+b+'"')}e=g[c[b].get](b,h)}else {e={};d=[];if(b){for(a in b){if(!c[a]){Ext.raise('Invalid clipboard format "'+a+'"')}d.push(a)}}else {d=Ext.Object.getAllKeys(c)}for(f=d.length;f-->0;){a=d[f];e[a]=g[c[a].get](a,h&&!f)}}return e}}}});Ext.define('Gnt.patches.CellContext',{extend:'Sch.util.Patch',target:'Ext.grid.CellContext',minVersion:'6.2.1',overrides:{setRow:function(a){if(a===null){a=undefined}return this.callParent(arguments)},setColumn:function(a){if(a===null){a=undefined}return this.callParent(arguments)}}});Ext.define('Gnt.patches.CheckColumn',{extend:'Sch.util.Patch',target:'Ext.grid.column.Check',minVersion:'6.2.0',overrides:{constructor:function(a){this.callParent([a||{}])}}});Ext.define('Gnt.patches.ComponentManager',{extend:'Sch.util.Patch',target:'Ext.ComponentManager',minVersion:'6.0.0',maxVersion:'6.2.0',applyFn:function(){Ext.ComponentManager.onGlobalFocus=function(d){var h=this,f=d.toElement,e=d.fromElement,c=Ext.Component.fromElement(f),b=Ext.Component.fromElement(e),g=h.getCommonAncestor(b,c),i,a;if(b&&!(b.destroyed||b.destroying)){if(b.handleBlurEvent){b.handleBlurEvent(d)}for(a=b;a&&a!==g;a=a.getRefOwner()){if(a instanceof Gnt.widget.AssignmentGrid&&a.view.refreshing&&a.getRefOwner() instanceof Gnt.field.Assignment){break}if(!(a.destroyed||a.destroying)){a.onFocusLeave({event:d.event,type:'focusleave',target:e,relatedTarget:f,fromComponent:b,toComponent:c})}}}if(c&&!c.destroyed){if(c.handleFocusEvent){c.handleFocusEvent(d)}for(a=c;a&&a!==g;a=a.getRefOwner()){a.onFocusEnter({event:d.event,type:'focusenter',relatedTarget:e,target:f,fromComponent:b,toComponent:c})}}}}});Ext.define('Gnt.patches.DelimitedValue',{extend:'Sch.util.Patch',target:'Ext.util.DelimitedValue',minVersion:'6.0.0',overrides:{decode:function(a){if(a===''){return []}return this.callParent(arguments)}}});Ext.define('Gnt.patches.GanttPanel',{extend:'Sch.util.Patch',minVersion:'6.0.2',maxVersion:'6.2.1',target:'Gnt.panel.Gantt',overrides:{onBeforeBatchStoreUpdate:function(){this.callParent();var b=this.getSelectionModel(),a=b.getSelected();if(a&&a.isCells&&this.keepSelection){this._lastCellSelectedRange=b.getSelected().getRange();var c=[];a.eachRow(function(a){c.push(a)});this._lastCellSelectedRecords=c}},onBatchStoreUpdate:function(){this.callParent();var c=this._lastCellSelectedRecords;if(c&&c.length){var g=this.lockedGrid.view;var a=-1,e,b;for(var d=0,h=c.length;d<h;d++){b=g.indexOf(c[d]);if(b!==-1){if(a===-1){a=e=b}else {if(b-a>1){break}else {a=b}}}else {if(a!==-1){break}}}if(a!==-1){a=Math.min(g.getNodes().length-1,a);var f=this._lastCellSelectedRange;this.getSelectionModel().selectCells([f[0][0],e],[f[1][0],a])}this._lastCellSelectedRecords=null;this._lastCellSelectedRange=null}}}});Ext.define('Gnt.patches.LabelEditor',{extend:'Sch.util.Patch',target:'Gnt.feature.LabelEditor',minVersion:'6.0.0',maxVersion:'6.0.1',ieOnly:!0,overrides:{constructor:function(){this.callParent(arguments);if(this.rendered){this.getEl().setVisibilityMode(Ext.dom.Element.OFFSETS)}else {this.on('render',function(){this.getEl().setVisibilityMode(Ext.dom.Element.OFFSETS)},this,{single:!0})}}}});Ext.define('Gnt.patches.SelectionExtender',{extend:'Sch.util.Patch',target:'Ext.grid.selection.SelectionExtender',minVersion:'6.0.0',overrides:{onDrag:function(a){if(!Ext.fly(a.getTarget()).up('.sch-ganttview')){this.callParent(arguments)}}}});Ext.define('Gnt.patches.Tooltip',{extend:'Sch.util.Patch',target:'Ext.tip.ToolTip',minVersion:'5.1.0',overrides:{onDocMouseDown:function(){if(this.isDisabled()){return}this.callParent(arguments)}}});Ext.define('Gnt.plugin.Clipboard',{extend:'Ext.grid.plugin.Clipboard',alias:'plugin.gantt_clipboard',requires:['Gnt.patches.DelimitedValue','Gnt.patches.AbstractClipboard'],memory:'raw',formats:{raw:{get:'getRawData',put:'putRawData'}},putTextData:function(b,a){return},getRawData:function(b,i){var f=this,g=f.getCmp().getSelectionModel(),a=[],j=b==='raw',h=b==='text',c,e,d=g.getSelected();if(!d){return a}a.schedulingFields={};d.eachCell(function(l){var d=l.column,o=l.column.getView(),g=l.record,m=d.dataIndex,k;if(!f.isColumnCopyPasteable(d,b)){return}if(c!==g){c=g;a.push(e=[])}if(a.length<2){if(d.isStartDateColumn){a.schedulingFields.startDate=1}else {if(d.isEndDateColumn){a.schedulingFields.endDate=1}else {if(d.isDurationColumn&&!d.isEffortColumn){a.schedulingFields.duration=1}}}}if(j){if(d.getRawData){k=d.getRawData(g)}else {if(m){k=g.data[m]}}}else {var n=o.all.item(l.rowIdx);if(!n){n=Ext.fly(o.createRowElement(g,l.rowIdx))}var p=n.down(d.getCellInnerSelector());k=p.dom.innerHTML;if(h){k=Ext.util.Format.stripTags(k)}}e.push(k);if(i&&m){g.set(m,g.getField(m).getDefaultValue())}});return a},getCellData:function(a,b){return Ext.util.TSV.encode(this.getRawData(a,b))},isColumnCopyPasteable:function(a,b){return !a.ignoreExport&&(b!='raw'||a.dataIndex||a.getRawData)},putRawData:function(h,u){var v=this,t=h.length,i=this.getCmp().getView(),r=i.dataSource.getCount()-1,o=i.getVisibleColumnManager().getColumns().length-1,s=i.getNavigationModel(),a=s.getPosition(),f,e,n,b,c,g,k,l,m;if(!a||this.getCmp().isReadOnly()){return}a=(new Ext.grid.CellContext(i)).setPosition(a.record,a.column);n=a.colIdx;for(var j=0;j<t;j++){var q=h[j];var d=a.record;g={};if(d.isReadOnly()){continue}for(f=0;a.colIdx<o&&f<q.length;){b=a.column;c=q[f];if(v.isColumnCopyPasteable(b,u)){var p;if(h.schedulingFields.startDate&&h.schedulingFields.endDate){p=b.fieldProperty==='durationField'||b.fieldProperty==='startDateField'||b.fieldProperty==='endDateField';if(b.fieldProperty==='startDateField'){l=c}if(b.isEndDateColumn){m=b.prepareNewEndDate(c,a.record)}}e=b.dataIndex;if(!p){if(b.putRawData){b.putRawData(c,a.record)}else {if(e&&e!=='index'){k=b.field;if(k){if(!k.getErrors(c).length){g[e]=c}}else {g[e]=c}}}}f++}if(a.colIdx===o){break}a.setColumn(a.colIdx+1)}d.beginEdit();d.set(g);if(l!==undefined&&m!==undefined){d.setStartEndDate(l,m)}d.endEdit();if(a.rowIdx===r){break}a.setPosition(a.rowIdx+1,n)}}});Ext.define('Gnt.plugin.DependencyEditor',{extend:'Ext.form.Panel',alias:'plugin.gantt_dependencyeditor',ptype:'gantt_dependencyeditor',mixins:['Ext.AbstractPlugin','Gnt.mixin.Localizable'],requires:['Ext.util.Filter','Ext.form.field.Display','Ext.form.field.ComboBox','Ext.form.field.Number','Gnt.model.Dependency','Ext.data.ArrayStore'],hideOnBlur:!0,showLag:!1,triggerEvent:'dependencydblclick',constrain:!0,lockableScope:'top',header:!1,border:!1,frame:!0,labelWidth:60,floating:!0,hideMode:'offsets',bodyPadding:10,initComponent:function(){this.buttons=this.hasOwnProperty('buttons')?this.buttons:this.buttons||[{text:this.L('okButtonText'),itemId:'okbutton',scope:this,handler:function(){this.getForm().updateRecord(this.dependencyRecord);this.collapse()}},{text:this.L('cancelButtonText'),itemId:'cancelbutton',scope:this,handler:function(){this.collapse()}},{text:this.L('deleteButtonText'),itemId:'deletebutton',scope:this,handler:function(){var a=this.taskStore&&this.taskStore.getDependencyStore();a.remove(this.dependencyRecord);this.collapse()}}];this.callParent(arguments);this.saveButton=this.down('#okbutton');this.deleteButton=this.down('#deletebutton');this.addCls('sch-gantt-dependencyeditor')},getState:function(){if(this.rendered){return this.callParent(arguments)}},init:function(a){this.ownerCmp=a;a.on(this.triggerEvent,this.onTriggerEvent,this);this.gantt=a;this.taskStore=a.getTaskStore();this.add(this.buildFields())},renderAndCollapse:function(){this.render(Ext.getBody());this.collapse(Ext.Component.DIRECTION_TOP,!1);this.hide();if(this.hideOnBlur){this.on({show:function(){this.mon(Ext.getBody(),{click:this.onMouseClick,scope:this})},hide:function(){this.mun(Ext.getBody(),{click:this.onMouseClick,scope:this})},delay:50})}},show:function(a,d){this.dependencyRecord=a;this.getForm().loadRecord(a);this.fromLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getSourceTask().getName()));this.toLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getTargetTask().getName()));if(this.typeField){var b=this.taskStore&&this.taskStore.getDependencyStore(),c=b&&b.allowedDependencyTypes;this.typeField.store.filter();this.typeField.setReadOnly(c&&c.length<2)}this.callParent([]);this.el.setXY(d);this.expand(!this.constrain);if(this.constrain){this.doConstrain(Ext.util.Region.getRegion(Ext.getBody()))}this.saveButton&&this.saveButton.setVisible(!this.gantt.isReadOnly());this.deleteButton&&this.deleteButton.setVisible(!this.gantt.isReadOnly())},buildFields:function(){var a=this,b=a.taskStore&&a.taskStore.getDependencyStore();var c=[a.fromLabel=new Ext.form.TextField({readOnly:!0,border:!1,fieldLabel:a.L('fromText'),cls:'sch-gantt-dependencyeditor-readonly'}),a.toLabel=new Ext.form.TextField({readOnly:!0,border:!1,fieldLabel:a.L('toText'),cls:'sch-gantt-dependencyeditor-readonly'}),a.typeField=a.buildTypeField()];if(a.showLag){c.push(a.lagField=new Ext.form.NumberField({name:b?b.model.prototype.lagField:Gnt.model.Dependency.prototype.lagField,fieldLabel:a.L('lagText')}))}return c},onTriggerEvent:function(c,a,b,d){if(!this.rendered){this.renderAndCollapse()}if(a!==this.dependencyRecord){this.show(a,b.getXY())}},filterAllowedTypes:function(e){var a=this.taskStore&&this.taskStore.getDependencyStore();if(!a||!a.allowedDependencyTypes){return !0}var c=a.allowedDependencyTypes;var d=a.model.Type;for(var b=0,g=c.length;b<g;b++){var f=d[c[b]];if(e.getId()==f){return !0}}return !1},buildTypeField:function(){var b=this.taskStore?this.taskStore.getDependencyStore().model:Gnt.model.Dependency;var a=b.Type;this.typesFilter=new Ext.util.Filter({filterFn:this.filterAllowedTypes,scope:this});var c=new Ext.data.ArrayStore({fields:[{name:'id',type:'int'},'text'],data:[[a.EndToStart,this.L('endToStartText')],[a.StartToStart,this.L('startToStartText')],[a.EndToEnd,this.L('endToEndText')],[a.StartToEnd,this.L('startToEndText')]]});c.filter(this.typesFilter);return new Ext.form.field.ComboBox({name:b.prototype.typeField,fieldLabel:this.L('typeText'),triggerAction:'all',queryMode:'local',editable:!1,valueField:'id',displayField:'text',store:c})},onMouseClick:function(a){if(this.collapsed||a.within(this.getEl())||a.getTarget('.'+Ext.baseCSSPrefix+'layer')||a.getTarget('.sch-ignore-click')){return}this.collapse()},afterCollapse:function(){delete this.dependencyRecord;this.hide();this.callParent(arguments);if(this.hideOnBlur){this.mun(Ext.getBody(),'click',this.onMouseClick,this)}}});Ext.define('Gnt.plugin.ProgressLine',{extend:'Ext.AbstractPlugin',alias:'plugin.gantt_progressline',config:{statusDate:null},drawLineOnlyWhenStatusDateVisible:!1,tpl:'<tpl for=".">'+'<line x1="{x1}" y1="{y1}" x2="{x2}" y2="{y2}" class="sch-gantt-progress-line">'+'</line>'+'</tpl>',constructor:function(a){if(typeof this.tpl==='string'){this.tpl=new Ext.XTemplate(this.tpl)}this.callParent([a]);if(!this.getStatusDate()){this.setStatusDate(new Date())}},destroy:function(){this.cmp.un(this.getPanelListeners());this.unbindViewListeners();this.callParent(arguments)},init:function(a){this.schedulerView=a.getSchedulingView();this.callParent(arguments);this.schedulerView.on('viewready',this.onViewReady,this);a.on(this.getPanelListeners())},enable:function(){if(this.disabled){this.callParent(arguments);this.bindViewListeners();this.drawProgressLine()}},disable:function(){if(!this.disabled){this.callParent(arguments);this.unbindViewListeners();this.drawProgressLine()}},setStatusDate:function(a){this.callParent(arguments);this.drawProgressLine()},onViewReady:function(){this.bindViewListeners();this.drawProgressLine()},bindViewListeners:function(){this.schedulerView.on(this.getViewListeners())},unbindViewListeners:function(){this.schedulerView.un(this.getViewListeners())},getViewListeners:function(){return {beforerefresh:{fn:this.onBeforeViewRefresh,priority:-900,scope:this},refresh:this.onViewRefresh,itemupdate:this.drawProgressLine,itemadd:this.drawProgressLine,itemremove:this.drawProgressLine,scope:this}},getPanelListeners:function(){return {beforedatarefresh:this.onBeforeDataRefresh,datarefresh:this.onDataRefresh,scope:this}},onBeforeDataRefresh:function(){if(!this.disabled){this._wasEnabled=!0;this.disable()}},onDataRefresh:function(){if(this._wasEnabled){this.enable()}},calculateCoordinateForTask:function(e,d,c){var b=e.isSegmented()?Ext.fly(d).down('.sch-segment-in-progress .sch-gantt-progress-bar'):Ext.fly(d).down('.sch-gantt-progress-bar');if(b){var a=b.getBox();return {x:a.right+c[0],y:a.top+a.height/2+c[1]}}},shouldDrawProgressLine:function(){return !this.disabled&&(!this.drawLineOnlyWhenStatusDateVisible||this.schedulerView.timeAxis.dateInAxis(this.getStatusDate()))},onBeforeViewRefresh:function(){this.refreshSuspended=!0},onViewRefresh:function(){this.refreshSuspended=!1;this.drawProgressLine()},drawProgressLine:function(){var a=this.schedulerView;if(!a||!a.rendered||!a.isItemCanvasAvailable()||this.refreshSuspended){return}var b=this.getStatusDate(),d=a.timeAxis.dateInAxis(b);if(!d){b=b<a.timeAxis.getStart()?a.timeAxis.getStart():a.timeAxis.getEnd()}var e=a.getCoordinateFromDate(b);var f=this.shouldDrawProgressLine()?this.getProgressLineRenderData(e):[];var c=a.getEl().down('.sch-svg-canvas');c&&c.remove();a.getItemCanvasEl(11,{tag:'svg',role:'presentation',cls:'sch-svg-canvas',html:this.tpl.apply(f)})},getProgressLineRenderData:function(c){var g=this,b=g.schedulerView,a=Ext.getVersion().isGreaterThan('6.2.0')?[b.getX(),b.el.up('.'+Ext.baseCSSPrefix+'scroller').getY()]:b.getXY(),f=b.getScroll(),d=[],e=this.getStatusDate();a=[f.left-a[0],f.top-a[1]];Ext.Array.each(b.getNodes(),function(j){if(!j){return}var f=b.getRecord(j),i=Ext.fly(j).getBox(),h;if(f&&b.timeAxis.isRangeInAxis(f)&&!f.isMilestone()&&(f.isInProgress()||!f.isStarted()&&f.getStartDate()<e||f.isCompleted()&&f.getStartDate()>e)){h=g.calculateCoordinateForTask(f,j,a);h&&d.push({x1:c,y1:a[1]+i.top,x2:h.x,y2:h.y},{x1:h.x,y1:h.y,x2:c,y2:a[1]+i.bottom})}if(!h){d.push({x1:c,y1:a[1]+i.top,x2:c,y2:a[1]+i.bottom})}});return d}});Ext.define('Gnt.plugin.TaskContextMenu',{extend:'Ext.menu.Menu',requires:['Sch.util.Date','Gnt.model.Task'],mixins:['Ext.AbstractPlugin','Gnt.mixin.Localizable'],alias:'plugin.gantt_taskcontextmenu',xtype:'gantt_taskcontextmenu',ptype:'gantt_taskcontextmenu',lockableScope:'top',plain:!0,triggerEvent:['rowcontextmenu','containercontextmenu','rowlongpress','containerlongpress'],hideEvent:null,grid:null,rec:null,triggerEventXY:null,lastHighlightedItem:null,taskEditorInjected:!1,config:{splitDuration:0,splitDurationUnit:'d',maxSplitDuration:1,maxSplitDurationUnit:'d',minSplitDuration:1,minSplitDurationUnit:'h'},initComponent:function(){var a=this.hideEvent;this.defaults=this.defaults||{};this.defaults.scope=this;this.triggerEvent=[].concat(this.triggerEvent);if(a){if(!Ext.isArray(a)){a=[a]}}if(Ext.isIE){a=a||[];a.push('itemclick')}this.hideEvent=a;this.items=this.createMenuItems();this.callParent(arguments)},init:function(a){this.ownerCmp=a;this.grid=a;this.bindTriggerEvent();this.bindHideEvent()},getState:function(){if(this.rendered){return this.callParent(arguments)}},isNotProject:function(a){return !a||!a.isProject},isReadOnly:function(a){return this.getCmp().isReadOnly()||a&&a.isReadOnly()},createMenuItems:function(){var a=this;return [{handler:this.deleteTask,requiresTask:!0,itemId:'deleteTask',text:this.L('deleteTask'),isValidAction:function(b){return !a.isReadOnly(b)}},{handler:this.editLeftLabel,requiresTask:!0,itemId:'editLeftLabel',text:this.L('editLeftLabel'),isValidAction:function(b){return a.grid.getSchedulingView().getLeftEditor()&&!a.isReadOnly(b)}},{handler:this.editRightLabel,requiresTask:!0,itemId:'editRightLabel',text:this.L('editRightLabel'),isValidAction:function(b){return a.grid.getSchedulingView().getRightEditor()&&!a.isReadOnly(b)}},{handler:this.toggleMilestone,requiresTask:!0,itemId:'toggleMilestone',text:this.L('convertToMilestone'),isValidAction:function(b){return this.isNotProject(b)&&!a.isReadOnly(b)}},{handler:this.splitTask,requiresTask:!0,itemId:'splitTask',isValidAction:function(b,c){return b&&!a.isReadOnly(b)&&b.getStartDate()&&b.getEndDate()&&!b.isMilestone()&&b.isLeaf()&&c&&c.getTarget('.sch-gantt-task-bar')},text:this.L('splitTask')},{text:this.L('add'),itemId:'addTaskMenu',menu:{plain:!0,defaults:{scope:this},items:[{handler:this.addTaskAboveAction,requiresTask:!0,itemId:'addTaskAbove',text:this.L('addTaskAbove'),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}},{handler:this.addTaskBelowAction,itemId:'addTaskBelow',text:this.L('addTaskBelow'),isValidAction:function(b){return b&&a.isNotProject(b)&&!a.isReadOnly(b.parentNode)||!b&&!a.isReadOnly()}},{handler:this.addMilestone,itemId:'addMilestone',requiresTask:!0,text:this.L('addMilestone'),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}},{handler:this.addSubtask,requiresTask:!0,itemId:'addSubtask',text:this.L('addSubtask'),isValidAction:function(b){return !a.isReadOnly(b)}},{handler:this.addSuccessor,requiresTask:!0,itemId:'addSuccessor',text:this.L('addSuccessor'),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}},{handler:this.addPredecessor,requiresTask:!0,itemId:'addPredecessor',text:this.L('addPredecessor'),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}}]}},{text:this.L('deleteDependency'),requiresTask:!0,itemId:'deleteDependencyMenu',isValidAction:function(b){return b&&!a.isReadOnly(b)&&b.getAllDependencies().length>0},menu:{plain:!0,listeners:{beforeshow:this.populateDependencyMenu,mouseover:this.onDependencyMouseOver,mouseleave:this.onDependencyMouseOut,scope:this}}}]},bindGridEvents:function(a,e,b){b=b||this;var d=this.getCmp();if(a){for(var c=a.length-1;c>=0;c--){d.on(a[c],e,b)}}},isMenuOptionEnabled:null,bindTriggerEvent:function(){this.bindGridEvents(this.triggerEvent,this.onTriggerEvent)},bindHideEvent:function(){this.bindGridEvents(this.hideEvent,this.onHideEvent)},onHideEvent:function(){this.hide()},swallowNextClickEvent:function(){Ext.getBody().on('click',function(a){a.stopPropagation()},null,{single:!0,capture:!0})},populateDependencyMenu:function(a){if(a.up('menuitem').isDisabled()){return !1}var c=this.getCmp(),d=c.getTaskStore(),b=this.rec.getAllDependencies(),e=c.dependencyStore;a.removeAll();if(!b.length){return !1}var f=this.rec.getId()||this.rec.internalId;Ext.Array.each(b,function(b){var c=b.getSourceId(),g=d.getModelById(c==f?b.getTargetId():c);if(g){a.add({dependency:b,text:Ext.String.htmlEncode(Ext.util.Format.ellipsis(g.getName(),30)),scope:this,handler:function(a){e.remove(a.dependency)},disabled:this.isReadOnly(this.rec)})}},this)},onDependencyMouseOver:function(c,a,d){if(a){var b=this.getCmp().getSchedulingView();if(this.lastHighlightedItem){b.unhighlightDependency(this.lastHighlightedItem.dependency)}this.lastHighlightedItem=a;b.highlightDependency(a.dependency)}},onDependencyMouseOut:function(a,b){if(this.lastHighlightedItem){this.getCmp().getSchedulingView().unhighlightDependency(this.lastHighlightedItem.dependency)}},onTriggerEvent:function(){var a=this.getTriggerEventContext.apply(this,arguments);if(!a.e.type.match('longpress')||a.e.pointerType!=='mouse'){this.activateMenu(a.record,a.e)}},getTriggerEventContext:function(){var b={};for(var a=0,c=arguments.length-1;a<=c;a++){if(arguments[a] instanceof Gnt.model.Task){b.record=arguments[a];break}}for(a=arguments.length-1;a>=0;a--){if(arguments[a] instanceof Ext.EventObjectImpl){b.e=arguments[a];break}}return b},activateMenu:function(b,a){if(this.getCmp().taskStore.getRootNode()===b){return}if(a.type.match('longpress')){this.swallowNextClickEvent()}a.stopEvent();this.rec=b;this.triggerEventXY=a.getXY();this.configureMenuItems(a);this.showAt(a.getXY())},addTaskEditorEntry:function(){this.insert(0,{text:this.L('taskInformation'),itemId:'taskEditor',requiresTask:!0,handler:function(){this.getCmp().getTaskEditor(this.rec).showTask(this.rec)},isValidAction:function(a){return this.getCmp().getTaskEditor(a)},scope:this});this.taskEditorInjected=!0},setTaskEditorEntryLabel:function(b){var a=this.down('#taskEditor');if(b&&a){a.setText(b.isProject?this.L('projectInformation'):this.L('taskInformation'))}},configureMenuItems:function(c){var a=this.rec;var d=this;if(this.getCmp().getTaskEditor()){if(!this.taskEditorInjected){this.addTaskEditorEntry()}this.setTaskEditorEntryLabel(a)}Ext.Array.each(this.query('menuitem'),function(b){b.setDisabled(!d.isMenuItemEnabled(b,a,c))});var b=this.down('#toggleMilestone');if(a&&b){b.setText(a.isMilestone()?this.L('convertToRegular'):this.L('convertToMilestone'))}},isMenuItemEnabled:function(a,b,c){var d=a.requiresTask&&!b||a.isValidAction&&!a.isValidAction.call(a.scope||a,b,c);return !d&&(!this.isMenuOptionEnabled||this.isMenuOptionEnabled(a,b)!==!1)},copyTask:function(b,c){var d=b&&b.self||this.getCmp().getTaskStore().getModel();var a=new d({leaf:!0});a.setPercentDoneWithoutPropagation(0);a.setName(this.L('newTaskText',this.texts));a.set(a.startDateField,b&&b.getStartDate()||null);a.set(a.endDateField,b&&b.getEndDate()||null);a.set(a.durationField,b&&b.getDuration()||null);a.set(a.durationUnitField,b&&b.getDurationUnit()||Sch.util.Date.DAY);c&&a.set(c);return a},addTaskAbove:function(a){var b=this.rec;if(b){b.addTaskAbove(a)}else {this.getCmp().taskStore.getRootNode().appendChild(a)}},addTaskBelow:function(a){var b=this.rec;if(b){b.addTaskBelow(a)}else {this.getCmp().taskStore.getRootNode().appendChild(a)}},deleteTask:function(){var a=this.getCmp().getSelectedRows().slice();if(this.rec&&!Ext.Array.contains(a,this.rec)){a.push(this.rec)}this.getCmp().getTaskStore().removeTasks(a)},editLeftLabel:function(){this.getCmp().getSchedulingView().editLeftLabel(this.rec)},editRightLabel:function(){this.getCmp().getSchedulingView().editRightLabel(this.rec)},addTaskAboveAction:function(){this.addTaskAbove(this.copyTask(this.rec))},addTaskBelowAction:function(){this.addTaskBelow(this.copyTask(this.rec))},addSubtask:function(){var a=this.rec;var b=this.copyTask(this.isNotProject(a)&&a);a.addSubtask(b)},addSuccessor:function(){var a=this.rec;a.addSuccessor(this.copyTask(a))},addPredecessor:function(){var a=this.rec;a.addPredecessor(this.copyTask(a))},addMilestone:function(){var a=this.rec,b={},c;b[a.startDateField]=a.getEndDate();b[a.durationField]=0;c=this.copyTask(a,b);a.addTaskBelow(c)},toggleMilestone:function(){if(this.rec.isMilestone()){this.rec.convertToRegular()}else {this.rec.convertToMilestone()}},getSplitDate:function(b){var e=b.task,g=b.date,c=b.tick,f=b.timeAxis,a=this.getMaxSplitDuration(),d;if(c){d=c.getStartDate();if(a){a=e.getUnitConverter().convertDurationToMs(a,this.getMaxSplitDurationUnit());if(a<c.getEndDate()-c.getStartDate()){d=null}}}return d||f.roundDate(g,e.getStartDate())},getSplitDuration:function(b){if(this.splitDuration){return this.splitDuration}var g=b.task,i=b.pos,h=b.date,c=b.tick;if(c){var a=g.calculateDuration(c.getStartDate(),c.getEndDate(),Sch.util.Date.MILLI),f=g.getUnitConverter(),e=this.getMinSplitDuration(),d=this.getMaxSplitDuration();if(e||d){if(d){a=Math.min(a,f.convertDurationToMs(d,this.getMaxSplitDurationUnit()))}if(e){a=Math.max(a,f.convertDurationToMs(e,this.getMinSplitDurationUnit()))}}return f.convertMSDurationToUnit(a,this.getSplitDurationUnit(g,i,h,c))}},getSplitDurationUnit:function(a){return this.splitDuration?this.splitDurationUnit:Sch.util.Date.MILLI},splitTask:function(){var a=this,e=a.grid.getSchedulingView(),d=e.getDateFromX(a.triggerEventXY[0]),c=e.timeAxis;var b={task:a.rec,pos:a.triggerEventXY,date:d,timeAxis:c,tick:c.getAt(Math.floor(c.getTickFromDate(d)))};b.task.split(a.getSplitDate(b),a.getSplitDuration(b),a.getSplitDurationUnit(b))}});Ext.define('Gnt.plugin.taskeditor.BaseEditor',{extend:'Ext.window.Window',requires:['Ext.window.MessageBox'],mixins:['Ext.AbstractPlugin','Gnt.mixin.Localizable'],lockableScope:'top',closeOnBlur:!0,taskEditorCls:'Gnt.widget.taskeditor.TaskEditor',isTaskEditor:!0,taskEditor:null,panelConfig:null,height:340,width:600,layout:'card',constrain:!0,triggerEvent:'taskdblclick',closeAction:'hide',modal:!0,gantt:null,assignmentStore:null,resourceStore:null,taskStore:null,monitorDataUpdates:!1,monitorDataUpdatesInterval:500,taskEditorConfigs:'l10n,task,taskStore,assignmentStore,resourceStore',taskFilters:null,constructor:function(a){a=a||{};this.taskFilters=[];Ext.apply(this,a);this.title=this.L('title');if(!a.buttons){this.buttons=['->',{itemId:'teOkBtn',text:this.L('okText'),handler:this.onOkClick,scope:this},{text:this.L('cancelText'),handler:this.close,scope:this}]}this.callParent([a]);this.addCls('gnt-taskeditor-window');if(this.closeOnBlur){this.on('show',this.onFirstShow,this,{single:!0})}this.on('beforehide',this.onBeforeHide,this)},showErrorMessage:function(){!Ext.Msg.isVisible()&&Ext.Msg.alert(this.L('alertCaption'),this.L('alertText'))},onOkClick:function(){!this.completeEditing()&&this.showErrorMessage()},getState:function(){if(this.rendered){return this.callParent(arguments)}},init:function(a){this.assignmentStore=this.assignmentStore||a.getAssignmentStore();this.resourceStore=this.resourceStore||a.getResourceStore();this.taskStore=this.taskStore||a.getTaskStore();this.buildTaskEditor(Ext.apply(this.buildTaskEditorConfig(a),this.panelConfig));this.add(this.taskEditor);this.mon(a,this.triggerEvent,this.onTriggerEvent,this);this.gantt=a},buildTaskEditorConfig:function(b){var e={width:null,height:null,border:!1,showBaseline:b.enableBaseline,showRollup:b.showRollupTasks,allowParentTaskDependencies:b.allowParentTaskDependencies};var d=this.taskEditorConfigs.split(',');for(var c=0;c<d.length;c++){var a=d[c];if(typeof this[a]!=='undefined'){e[a]=this[a]}}return e},buildTaskEditor:function(b){this.taskEditor=Ext.create(this.taskEditorCls,b);var a=this.taskEditor.eventIndicator;this.relayEvents(this.taskEditor,['load'+a,'validate','beforeupdate'+a,'afterupdate'+a])},onTriggerEvent:function(b,a){this.showTask(a)},showTask:function(b){if(this.taskEditor&&b&&this.matchFilters(b)){this.taskEditor.loadTask(b);var a=this.gantt.isReadOnly();if(a!=this.taskEditor.setReadOnly()){this.taskEditor.setReadOnly(a)}var c=this.down('#teOkBtn');if(c){c.setVisible(!a)}this.show()}},matchFilters:function(c){if(!c){return}for(var a=0;a<this.taskFilters.length;a++){var b=this.taskFilters[a];if(!b.fn.call(b.scope,c)){return !1}}return !0},addFilter:function(b,a){this.taskFilters.push({fn:b,scope:a||this})},validate:function(){if(this.taskEditor){return this.taskEditor.validate()}},completeEditing:function(){if(this.taskEditor){var a=this.taskEditor.getActiveTab();if(a.editingPlugin&&a.editingPlugin.completeEdit){a.editingPlugin.completeEdit()}if(!this.taskEditor.validate()){return !1}if(this.taskEditor.updateTask()){this.hide();return !0}return !1}},updateTask:function(){if(this.taskEditor){return this.taskEditor.updateTask()}},afterRender:function(){var a=this;a.callParent(arguments);a.startDataUpdatesMonitoring()},onFirstShow:function(){if(this.zIndexManager.mask){this.mon(this.zIndexManager.mask,'click',function(){if(this.isVisible()){this.hide()}},this)}},startDataUpdatesMonitoring:function(){var a=this,c=a.down('#teOkBtn'),b=!0;function monitor(){if(b&&c&&a.taskEditor){c.setDisabled(!a.taskEditor.isDataChanged()||!a.taskEditor.isDataValid());b=Ext.Function.defer(monitor,a.monitorDataUpdatesInterval)}}function unmonitor(){b!==!0&&clearTimeout(b);b=!0}if(a.monitorDataUpdates&&c){a.on({'show':monitor,'hide':unmonitor,'destroy':unmonitor})}},onBeforeHide:function(){Ext.each(this.query('[cancelEdit]'),function(a){a.cancelEdit()})}});Ext.define('Gnt.util.Data',{singleton:!0,cloneModelSet:function(b,e,f){var d=[],a;var c=function(c){a=c.copy();a.phantom=!1;a.originalRecord=c;if(e){if(e.call(f||b,a,c)===!1){return}}d.push(a)};if(b.each){b.each(c)}else {Ext.Array.each(b,c)}return d},applyCloneChanges:function(g,c,f,n){var h=[];var l=c.autoSyncSuspended;if(c.autoSync&&!l){c.suspendAutoSync()}var i=g.getRemovedRecords();for(var a=0,k=i.length;a<k;a++){if(i[a].originalRecord){h.push(i[a].originalRecord)}}if(h.length){c.remove(h);g.removed.length=0}var b=g.getModifiedRecords(),e,d,j;for(a=0,k=b.length;a<k;a++){e=b[a].originalRecord;d=b[a].getData();delete d[b[a].idProperty];if(e){e.beginEdit();for(var m in d){e.set(m,d[m])}if(f){f.call(n||b[a],d,b[a])}e.endEdit()}else {if(f){f.call(n||b[a],d,b[a])}j=c.add(d);b[a].originalRecord=j&&j[0]}b[a].commit(!0)}if(c.autoSync&&!l){c.resumeAutoSync();c.sync()}}});Ext.define('Gnt.widget.taskeditor.BaseEditor',{extend:'Ext.tab.Panel',requires:['Gnt.util.Data'],mixins:['Gnt.mixin.Localizable'],margin:'5 0 0 0',height:340,width:600,layout:'fit',border:!1,plain:!1,defaults:{margin:5,border:!1},eventIndicator:'task',task:null,taskBuffer:null,taskStore:null,assignmentStore:null,resourceStore:null,tabBar:{cls:'gnt-taskeditor-header'},clonedStores:null,taskStoreConfigsToClone:'calendarManager,model,weekendsAreWorkdays,cascadeChanges,skipWeekendsDuringDragDrop,moveParentAsGroup,enableDependenciesForParentTasks,availabilitySearchLimit,dependenciesCalendar,scheduleByConstraints,projectStartDate',constructor:function(b){var a=this;b=b||{};Ext.apply(a,b);if(!a.clonedStores){a.clonedStores=a.task||a.taskStore?a.cloneStores():{}}var d=a.buildItems(b);var c=a.items;if(c){d.push.apply(d,Ext.isArray(c)?c:[c]);delete b.items}a.items=d;if(a.items.length<=1){b.tabBar=b.tabBar||{};Ext.applyIf(b.tabBar,{hidden:!0})}this.callParent([b]);if(this.task){this.loadTask(this.task)}else {a.setReadOnly(!0)}},buildItems:function(){return []},cloneTaskBranch:function(b,f,g){b=b||this.task;var c=this,e=c.getTaskStore(),i=e&&e.getRoot(),h=c.clonedStores,d,a;b.bubble(function(e){if(e!==i){var b=f[e.getId()];if(b){if(a){b.appendChild(a)}a=null;return !1}else {b=c.cloneTask(e);f[e.getId()]=b;b.taskStore=h.taskStore}if(a){b.appendChild(a)}else {d=b}a=b;g&&g(b,e)}});return {branch:a,task:d}},cloneRelevantTasks:function(a){a=a||this.task;var b=this,c={};var f=b.cloneTaskBranch(a,c),g=f.task,d=[f.branch],e=b.getTaskStore();Ext.Array.each(a.predecessors,function(f){var a=b.cloneTaskBranch(f.getSourceTask(),c,e&&e.scheduleByConstraints&&function(a){a.pinWithoutPropagation()});if(a.branch){d.push(a.branch)}});Ext.Array.each(a.successors,function(e){var a=b.cloneTaskBranch(e.getTargetTask(),c);if(a.branch){d.push(a.branch)}});return {task:g,tasks:d}},loadTask:function(a){if(!a){return}this.clonedStores=this.cloneStores({task:a});this.loadClonedStores(this.clonedStores,a)},buildTaskStoreCloneConfig:function(a,c){var b=Ext.apply({isCloned:!0,storeId:null,calendar:a.getCalendar(),batchSync:!1,recalculateParents:!1,autoNormalizeNodes:!1,autoSync:!1,autoLoad:!1,proxy:{type:'memory',reader:{type:'json'}}},c);return Ext.copyIf(b,a,this.taskStoreConfigsToClone)},cloneTaskStore:function(d,c){var a=this.getTaskStore(),b;if(a){b=new a.self(this.buildTaskStoreCloneConfig(a,c));this.mon(a,{calendarset:function(c,a){b.setCalendar(a)}})}return b},cloneDependencyStore:function(d,c){var b=this.getTaskStore();var a=this.dependencyStore||b&&b.getDependencyStore();if(!a){return null}return new a.self(Ext.apply({isCloned:!0,model:a.model,strictDependencyValidation:a.strictDependencyValidation,allowedDependencyTypes:a.allowedDependencyTypes,storeId:null,autoSync:!1,autoLoad:!1,proxy:{type:'memory',reader:{type:'json'}}},c))},cloneAssignmentStore:function(d,c){var b=this.getTaskStore();var a=this.assignmentStore||b&&b.getAssignmentStore();if(!a){return null}return new a.self(Ext.apply({isCloned:!0,model:a.model,storeId:null,autoSync:!1,autoLoad:!1,proxy:{type:'memory',reader:{type:'json'}}},c))},cloneResourceStore:function(d,c){var b=this.getTaskStore();var a=this.resourceStore||b&&b.getResourceStore();if(!a){return null}return new a.self(Ext.apply({isCloned:!0,model:a.model,storeId:null,autoSync:!1,autoLoad:!1,proxy:{type:'memory',reader:{type:'json'}}},c))},cloneStores:function(a){a=a||{};var c=a.task||this.task,b=this.clonedStores||{},d=b.resourceStore||this.cloneResourceStore(c,a.resourceStore),e=b.assignmentStore||this.cloneAssignmentStore(c,a.assignmentStore),f=b.dependencyStore||this.cloneDependencyStore(c,a.dependencyStore);var g=b.taskStore||this.cloneTaskStore(c,Ext.apply({assignmentStore:e,resourceStore:d,dependencyStore:f},a.taskStore));d.taskStore=g;Ext.apply(b,{resourceStore:d,assignmentStore:e,dependencyStore:f,taskStore:g});return b},getTaskStore:function(a){a=a||this.task;return this.taskStore||a&&a.getTaskStore()},loadClonedStores:function(b,c){var a=this,e=a.cloneRelevantTasks(c),f=e.tasks,d=e.task;a.taskBuffer=d;b.taskStore.setRootNode({expanded:!0,children:f});d.taskStore.on({update:function(e,b,c){if(b===d&&c==Ext.data.Model.EDIT){a.onTaskUpdated.call(a,b);b.fireEvent(a.eventIndicator+'updated',b)}}});a.loadClonedDependencyStore(b,c);a.loadClonedResourceStore(b,c);a.loadClonedAssignmentStore(b,c)},loadClonedDependencyStore:function(a,b){a=a||this.clonedStores;a.dependencyStore&&a.dependencyStore.loadData(Gnt.util.Data.cloneModelSet(b.getAllDependencies(),function(b,a){b.setId(a.getId())}))},loadClonedResourceStore:function(a){a=a||this.clonedStores;a.resourceStore&&a.resourceStore.loadData(Gnt.util.Data.cloneModelSet(this.resourceStore||this.getTaskStore().getResourceStore(),function(b,a){b.setId(a.getId())}))},loadClonedAssignmentStore:function(a,b){a=a||this.clonedStores;a.assignmentStore&&a.assignmentStore.loadData(Gnt.util.Data.cloneModelSet(b.getAssignments(),function(b,a){b.setId(a.getId())}))},cloneTask:function(a){return a.copy(a.getId(),!1)},getTabByComponent:function(a){var b;this.items.each(function(c){if(a===c||a.isDescendantOf(c)){b=c;return !1}},this);return b},validate:function(){var b,d=this.getActiveTab(),c=[],a;b=this.doValidate(function(a){c.push(a)});if(!b&&d&&!Ext.Array.contains(c,d)){a=c[0];this.setActiveTab(a)}else {if(!b&&d){a=d}else {if(!b){a=c[0]}}}return this.fireEvent('validate',this,a)!==!1&&b},updateTask:function(){var a=this,b=!1;if(a.fireEvent('beforeupdate'+a.eventIndicator,a,function(){a.doUpdateTask()})!==!1){a.doUpdateTask();a.fireEvent('afterupdate'+a.eventIndicator,a);b=!0}return b},onDestroy:function(){if(this.clonedStores.taskStore){this.clonedStores.taskStore.destroy()}this.callParent(arguments)},doValidate:function(){return !0},isDataValid:function(){return this.doValidate()},isDataChanged:function(){return !1},doUpdateTask:function(){throw 'Abstract method called'},updateReadOnly:function(){throw 'Abstract method called'},getReadOnly:function(){return !this.task||this.readOnly},setReadOnly:function(a){this.readOnly=a;this.updateReadOnly()},onTaskUpdated:function(){this.updateReadOnly()},init:function(a){this.ownerCmp=a;this.callParent(arguments)}});Ext.define('Gnt.widget.taskeditor.BaseForm',{extend:'Ext.form.Panel',highlightTaskUpdates:!0,task:null,taskBuffer:null,taskStore:null,taskListeners:null,autoScroll:!0,labelWidth:130,padding:10,border:!1,defaultType:'textfield',initComponent:function(){this.defaults=this.defaults||{};this.defaults.labelWidth=this.defaults.labelWidth||this.labelWidth;if(this.task){this.fieldNames=this.getFieldNames(this.task)}if(!this.items){this.buildFields()}this.callParent(arguments);this.addBodyCls('gnt-taskeditor-form');if(this.task){this.loadRecord(this.task,this.taskBuffer)}},getFieldNames:function(b){if(!b){return}var a={};for(var c in this.fieldNames){a[c]=b[c]}return a},renameFields:function(f){var a=this.getFieldNames(f);if(!a){return}var e=this.getForm(),d=!1,b;for(var c in this.fieldNames){b=e.findField(this.fieldNames[c]);if(b&&a[c]&&a[c]!=b.name){d=!0;b.name=a[c]}}if(d){this.fieldNames=a}},setSuppressTaskUpdate:function(b){var a=this.getForm().getFields();a.each(function(a){a.setSuppressTaskUpdate&&a.setSuppressTaskUpdate(b)})},isDataChanged:function(){return this.isDirty()},buildTaskBuffer:function(a){var b=this;b.taskBuffer=a.copy();b.taskBuffer.taskStore=a.taskStore},loadRecord:function(b,e){var a=this;if(b&&b!==a.task){a.renameFields(b)}a.task=b;a.taskBuffer=e;if(!a.taskBuffer){a.buildTaskBuffer(b)}a.taskListeners&&a.taskListeners.destroy();a.taskListeners=a.mon(a.taskBuffer,{taskupdated:a.onTaskUpdated,destroyable:!0,scope:a});var c=a.getForm();c._record=b;this.suspendLayouts();var d=b.getData();c.getFields().each(function(b){if(b.getName() in d){if(b.setTask){b.setTask(a.taskBuffer)}else {b.setValue(d[b.getName()])}a.updateFieldReadOnly(b);if(c.trackResetOnLoad){b.resetOriginalValue()}}});this.resumeLayouts(!0);this.fireEvent('afterloadrecord',this,b)},updateFieldReadOnly:function(a){var b=this;if(!a.disabled){if(!a.forceReadOnly){var c=a.isTaskField;if(b.getReadOnly()){a.setReadOnly(!0);c&&!a.isReadOnlyUpdateSuspended()&&a.suspendReadOnlyUpdate()}else {if(!c){var d=b.taskBuffer.isEditable(a.name);if(this.editable===!1){if(d&&a.inputEl){a.inputEl.dom.readOnly=!0}}a.setReadOnly(!d)}else {a.resumeReadOnlyUpdate();a.updateReadOnly(b.taskBuffer)}}}}},updateReadOnly:function(){var a=this,b=a.getForm();b.getFields().each(function(b){a.updateFieldReadOnly(b)})},updateRecord:function(b){var a=this;b=b||a.task;if(b&&a.fireEvent('beforeupdaterecord',a,b,a.updateRecordFn)!==!1){a.setSuppressTaskUpdate(!0);a.updateRecordFn.call(a,b);a.setSuppressTaskUpdate(!1);a.fireEvent('afterupdaterecord',a,b);return !0}return !1},updateRecordWithFieldValue:function(b,a){var c=b.getField(a.name);if(a.applyChanges){a.applyChanges(b)}else {if(c&&a.name in this.getForm().getFieldValues()){b.set(a.name,a.getValue())}}},updateRecordFn:function(a){var b=this;a.beginEdit();b.getForm().getFields().each(function(c){b.updateRecordWithFieldValue(a,c)});a.endEdit()},initFieldDefinition:function(b,d){var a=this;var c={taskStore:a.taskStore,task:a.task,highlightTaskUpdates:a.highlightTaskUpdates};if(!b.readOnly&&a.task){c.readOnly=!a.task.isEditable(b.name)}return Ext.apply(b,c,d)},getTaskFieldValue:function(b){var c=this,a=this.task;return a?a.get(c.fieldNames[b]):''},onTaskUpdated:function(b,a){this.updateReadOnly()},getReadOnly:function(){return this.readOnly},setReadOnly:function(a){this.readOnly=a;this.updateReadOnly()}});Ext.define('Gnt.widget.taskeditor.ProjectForm',{extend:'Gnt.widget.taskeditor.BaseForm',alias:'widget.projectform',requires:['Gnt.model.Project','Ext.Date','Ext.form.FieldSet','Ext.form.FieldContainer','Ext.form.field.Text','Gnt.field.Calendar','Gnt.field.StartDate','Gnt.field.EndDate','Gnt.field.ReadOnly','Ext.form.field.Checkbox'],mixins:['Gnt.mixin.Localizable'],alternateClassName:['Gnt.widget.ProjectForm'],showCalendar:!1,nameConfig:null,readOnlyConfig:null,allowDependenciesConfig:null,startConfig:null,finishConfig:null,calendarConfig:null,defaults:{anchor:'100%',labelWidth:110},constructor:function(b){b=b||{};var a=b.taskStore&&b.taskStore.projectModel&&b.taskStore.projectModel.prototype||Gnt.model.Project.prototype;this.fieldNames={calendarIdField:a.calendarIdField,readOnlyField:a.readOnlyField,allowDependenciesField:a.allowDependenciesField,startDateField:a.startDateField,endDateField:a.endDateField,nameField:a.nameField,descriptionField:a.descriptionField};this.callParent(arguments);this.addBodyCls('gnt-projecteditor-projectform')},buildFields:function(){var a=this,b=a.fieldNames;a.items=a.items||[];a.items.push(a.initFieldDefinition({xtype:'textfield',fieldLabel:a.L('nameText'),name:b.nameField,allowBlank:!1,value:a.getTaskFieldValue(b.nameField)},a.nameConfig),{xtype:'container',layout:'hbox',defaults:{flex:1,labelWidth:110,margin:'5 5 5 0'},items:[a.initFieldDefinition({allowBlank:!1,xtype:'startdatefield',fieldLabel:a.L('startText'),format:Ext.Date.defaultFormat,name:b.startDateField,value:a.getTaskFieldValue(b.startDateField)},a.startConfig),a.initFieldDefinition({allowBlank:!1,margin:'5 0',xtype:'enddatefield',format:Ext.Date.defaultFormat,fieldLabel:a.L('finishText'),name:b.endDateField,value:a.getTaskFieldValue(b.endDateField)},a.finishConfig)]},{xtype:'container',layout:'hbox',padding:'0 0 0 110',defaults:{flex:1,margin:'5 5 5 0'},items:[a.initFieldDefinition({xtype:'readonlyfield',boxLabel:a.L('readOnlyText'),allowBlank:!1,name:b.readOnlyField,value:a.getTaskFieldValue(b.readOnlyField)},a.readOnlyConfig),a.initFieldDefinition({xtype:'checkboxfield',boxLabel:a.L('allowDependenciesText'),allowBlank:!1,name:b.allowDependenciesField,value:a.getTaskFieldValue(b.allowDependenciesField)},a.allowDependenciesConfig)]});if(a.showCalendar){a.items.push(a.initFieldDefinition({allowBlank:!1,flex:1,margin:'5 0 5 0',xtype:'calendarfield',fieldLabel:this.L('calendarText'),name:b.calendarIdField,value:a.getTaskFieldValue(b.calendarIdField)},a.calendarConfig))}}});Ext.define('Gnt.widget.taskeditor.ProjectEditor',{extend:'Gnt.widget.taskeditor.BaseEditor',alias:'widget.projecteditor',requires:['Gnt.widget.taskeditor.ProjectForm','Ext.form.field.HtmlEditor'],alternateClassName:['Gnt.widget.ProjectEditor'],eventIndicator:'project',projectFormClass:'Gnt.widget.taskeditor.ProjectForm',showDescription:!0,projectFormConfig:null,descriptionConfig:null,descriptionPanel:null,descriptionEditor:null,projectForm:null,buildItems:function(){var a=this,c=[],b=this.task;a.projectForm=Ext.create(a.projectFormClass,Ext.applyIf(a.projectFormConfig||{},{task:b,border:!1,taskStore:a.taskStore}));c.push(a.projectForm);if(a.showDescription){a.descriptionEditor=Ext.create('Ext.form.field.HtmlEditor',Ext.apply({listeners:{afterrender:function(b){a.descriptionEditor.setValue(a.task.get(a.task.descriptionField))}},readOnly:b&&!b.isEditable(b.descriptionField),isDataChanged:function(){return this.isDirty()}},a.descriptionConfig));a.descriptionPanel=Ext.create('Ext.panel.Panel',{border:!1,layout:'fit',items:a.descriptionEditor});c.push(a.descriptionPanel)}if(!a.projectForm.title){a.projectForm.title=a.L('generalText')}if(a.descriptionPanel&&!a.descriptionPanel.title){a.descriptionPanel.title=this.L('descriptionText')}return c},loadProject:function(a){this.loadTask.apply(this,arguments)},loadTask:function(a){if(!a){return}this.task=a;var b=this.projectForm;b.setSuppressTaskUpdate(!0);b.getForm().reset();this.callParent(arguments);b.loadRecord(a,this.taskBuffer);if(this.descriptionEditor){this.descriptionEditor.setValue(a.getDescription())}this.setReadOnly(a.isReadOnly());b.setSuppressTaskUpdate(!1);this.fireEvent('loadproject',this,a)},setReadOnly:function(c){var b=this,a=b.task;this.callParent(arguments);if(a){if(b.descriptionEditor){b.descriptionEditor.setReadOnly(c||!a.isEditable(a.descriptionField))}}},onTaskUpdated:function(a){this.setReadOnly(a.isReadOnly())},updateProject:function(){this.updateTask()},loadClonedDependencyStore:Ext.emptyFn,loadClonedResourceStore:Ext.emptyFn,loadClonedAssignmentStore:Ext.emptyFn,doValidate:function(a){var b=this.callParent(arguments);if(this.projectForm&&!this.projectForm.isValid()){b=!1;a&&a(this.getTabByComponent(this.projectForm))}return b},doUpdateTask:function(){var a=this.task;this.projectForm&&this.projectForm.updateRecord();this.descriptionEditor&&a.set(a.descriptionField,this.descriptionEditor.getValue())},isDataChanged:function(a){var b=this.callParent(arguments);if(this.projectForm&&this.projectForm.isDataChanged()){b=!0;a&&a(this.getTabByComponent(this.projectForm))}if(this.descriptionEditor&&this.descriptionEditor.isDataChanged()){b=!0;a&&a(this.getTabByComponent(this.descriptionEditor))}return b},updateReadOnly:function(){var a=this,c=a.taskBuffer,b=a.getReadOnly(),d=b||c.isReadOnly();a.projectForm&&a.projectForm.setReadOnly(b)}});Ext.define('Gnt.plugin.taskeditor.ProjectEditor',{extend:'Gnt.plugin.taskeditor.BaseEditor',alternateClassName:['Gnt.plugin.ProjectEditor'],requires:['Gnt.widget.taskeditor.ProjectEditor'],alias:'plugin.gantt_projecteditor',ptype:'gantt_projecteditor',taskEditorCls:'Gnt.widget.taskeditor.ProjectEditor',taskEditorConfigs:'l10n,task,taskStore,assignmentStore,resourceStore,projectFormClass,showDescription,projectFormConfig,descriptionConfig',constructor:function(a){this.callParent(arguments);this.addCls('gnt-projecteditor-window');this.addFilter(function(a){return a&&a.isProject})},init:function(a){this.callParent(arguments);a.projectEditor=this}});Ext.define('Gnt.widget.taskeditor.TaskForm',{extend:'Gnt.widget.taskeditor.BaseForm',alias:'widget.taskform',requires:['Gnt.model.Task','Ext.Date','Ext.form.FieldSet','Ext.form.FieldContainer','Ext.form.field.Text','Ext.form.field.Date','Ext.form.field.Checkbox','Gnt.field.Percent','Gnt.field.StartDate','Gnt.field.EndDate','Gnt.field.Duration','Gnt.field.Effort','Gnt.field.BaselineStartDate','Gnt.field.BaselineEndDate','Gnt.field.BaselineEffort'],mixins:['Gnt.mixin.Localizable'],alternateClassName:['Gnt.widget.TaskForm'],showGeneral:!0,showBaseline:!0,editBaseline:!1,nameConfig:null,durationConfig:null,startConfig:null,finishConfig:null,percentDoneConfig:null,baselineStartConfig:null,baselineFinishConfig:null,baselinePercentDoneConfig:null,baselineEffortConfig:null,effortConfig:null,constructor:function(b){b=b||{};this.showBaseline=b.showBaseline;this.editBaseline=b.editBaseline;var a=b.taskStore?b.taskStore.model.prototype:Gnt.model.Task.prototype;this.fieldNames={baselineEndDateField:a.baselineEndDateField,baselinePercentDoneField:a.baselinePercentDoneField,baselineStartDateField:a.baselineStartDateField,baselineEffortField:a.baselineEffortField,calendarIdField:a.calendarIdField,readOnlyField:a.readOnlyField,clsField:a.clsField,draggableField:a.draggableField,durationField:a.durationField,durationUnitField:a.durationUnitField,effortField:a.effortField,effortUnitField:a.effortUnitField,endDateField:a.endDateField,manuallyScheduledField:a.manuallyScheduledField,nameField:a.nameField,percentDoneField:a.percentDoneField,resizableField:a.resizableField,rollupField:a.rollupField,schedulingModeField:a.schedulingModeField,startDateField:a.startDateField,noteField:a.noteField,constraintTypeField:a.constraintTypeField,constraintDateField:a.constraintDateField};this.callParent(arguments);this.addBodyCls('gnt-taskeditor-taskform')},buildFields:function(){var a=this,b=a.fieldNames;a.items=a.items||[];if(a.showGeneral){a.items.push(a.initFieldDefinition({xtype:'textfield',fieldLabel:a.L('taskNameText'),name:b.nameField,labelWidth:this.labelWidth,allowBlank:!1,width:'100%',value:a.getTaskFieldValue(b.nameField)},a.nameConfig),{xtype:'fieldcontainer',layout:'hbox',defaults:{labelWidth:this.labelWidth,allowBlank:!1},items:[a.initFieldDefinition({xtype:'percentfield',fieldLabel:a.L('percentDoneText'),name:b.percentDoneField,margin:'0 8 0 0',flex:1,value:a.getTaskFieldValue(b.percentDoneField)},a.percentDoneConfig),a.initFieldDefinition({xtype:'durationfield',fieldLabel:a.L('durationText'),name:b.durationField,flex:1,value:a.getTaskFieldValue(b.durationField)},a.durationConfig)]},{xtype:'fieldset',title:a.L('datesText'),layout:'hbox',items:[{xtype:'container',layout:'anchor',flex:1,margin:'0 8 0 0',defaults:{labelWidth:this.labelWidth},items:[a.initFieldDefinition({xtype:'startdatefield',fieldLabel:a.L('startText'),width:'100%',allowBlank:!0,format:Ext.Date.defaultFormat,name:b.startDateField,value:a.getTaskFieldValue(b.startDateField)},a.startConfig),a.initFieldDefinition({xtype:'effortfield',fieldLabel:a.L('effortText'),name:b.effortField,invalidText:a.L('invalidEffortText'),width:'100%',allowBlank:!0,value:a.getTaskFieldValue(b.effortField)},a.effortConfig)]},a.initFieldDefinition({xtype:'enddatefield',fieldLabel:a.L('finishText'),flex:1,format:Ext.Date.defaultFormat,labelWidth:this.labelWidth,allowBlank:!0,name:b.endDateField,value:a.getTaskFieldValue(b.endDateField)},a.finishConfig)]})}if(a.showBaseline){a.items.push({xtype:'fieldset',title:a.L('baselineText'),layout:'hbox',items:[{xtype:'container',layout:'anchor',flex:1,margin:'0 8 0 0',defaults:{labelWidth:this.labelWidth,cls:'gnt-baselinefield'},items:[a.initFieldDefinition({xtype:'baselinestartdatefield',fieldLabel:a.L('baselineStartText'),name:b.baselineStartDateField,value:a.getTaskFieldValue(b.baselineStartDateField),width:'100%',readOnly:!a.editBaseline,forceReadOnly:!a.editBaseline},a.baselineStartConfig),a.initFieldDefinition({xtype:'percentfield',fieldLabel:a.L('baselinePercentDoneText'),width:'100%',name:b.baselinePercentDoneField,value:a.getTaskFieldValue(b.baselinePercentDoneField),readOnly:!a.editBaseline,forceReadOnly:!a.editBaseline},a.baselinePercentDoneConfig)]},{xtype:'container',layout:'anchor',flex:1,margin:'0 8 0 0',defaults:{labelWidth:this.labelWidth,cls:'gnt-baselinefield'},items:[a.initFieldDefinition({xtype:'baselineenddatefield',fieldLabel:a.L('baselineFinishText'),name:b.baselineEndDateField,cls:'gnt-baselinefield',flex:1,labelWidth:this.labelWidth,value:a.getTaskFieldValue(b.baselineEndDateField),readOnly:!a.editBaseline,forceReadOnly:!a.editBaseline},a.baselineFinishConfig),a.initFieldDefinition({xtype:'baselineeffortfield',fieldLabel:a.L('baselineEffortText'),name:b.baselineEffortField,cls:'gnt-baselinefield',flex:1,labelWidth:this.labelWidth,value:a.getTaskFieldValue(b.baselineEffortField),readOnly:!a.editBaseline,forceReadOnly:!a.editBaseline},a.baselineEffortConfig)]}]})}},updateRecordWithFieldValue:function(c,a){var b=this;if(a.name!=b.fieldNames.constraintTypeField&&a.name!=b.fieldNames.constraintDateField){return this.callParent(arguments)}},updateRecordFn:function(a){var f=this,d=f.fieldNames,e=f.getForm(),c=e.findField(d.constraintTypeField),b=e.findField(d.constraintDateField);a.beginEdit();this.callParent(arguments);if(c&&b&&a.setConstraint){a.setConstraint(c.getValue(),b.getValue())}a.endEdit()},buildTaskBuffer:function(a){this.callParent(arguments);if(!a.getReadOnly()&&a.isReadOnly()){this.taskBuffer.isReadOnly=function(){return !0}}}});Ext.define('Gnt.widget.taskeditor.AdvancedForm',{extend:'Gnt.widget.taskeditor.TaskForm',alias:'widget.advanced_taskform',requires:['Gnt.model.Task','Ext.form.FieldSet','Ext.form.FieldContainer','Ext.form.field.Text','Ext.form.field.Date','Gnt.field.SchedulingMode','Gnt.field.ManuallyScheduled','Gnt.field.Calendar','Gnt.field.ConstraintType','Gnt.field.ConstraintDate','Gnt.field.ReadOnly'],mixins:['Gnt.mixin.Localizable'],alternateClassName:['Gnt.widget.AdvancedForm'],border:!1,margin:0,layout:{type:'table',columns:2},defaults:{width:'97%'},showGeneral:!1,showBaseline:!1,editBaseline:!1,showCalendar:!0,showManuallyScheduled:!0,showSchedulingMode:!0,showWbsCode:!0,showRollup:!1,showConstraint:!0,showReadOnly:!1,calendarConfig:null,manuallyScheduledConfig:null,schedulingModeConfig:null,wbsCodeConfig:null,rollupConfig:null,constraintTypeConfig:null,constraintDateConfig:null,readOnlyConfig:null,constructor:function(a){this.callParent(arguments);this.addBodyCls('gnt-taskeditor-advancedtaskform')},buildFields:function(){var a=this,b=a.fieldNames;a.items=a.items||[];if(a.showCalendar){a.items.push(a.initFieldDefinition({xtype:'calendarfield',fieldLabel:this.L('calendarText'),name:b.calendarIdField,value:a.getTaskFieldValue(b.calendarIdField)},a.calendarConfig))}if(a.showManuallyScheduled){a.items.push(a.initFieldDefinition({xtype:'manuallyscheduledfield',fieldLabel:a.L('manuallyScheduledText'),name:b.manuallyScheduledField,value:a.getTaskFieldValue(b.manuallyScheduledField)},a.manuallyScheduledConfig))}if(a.showSchedulingMode){a.items.push(a.initFieldDefinition({xtype:'schedulingmodefield',fieldLabel:a.L('schedulingModeText'),name:b.schedulingModeField,value:a.getTaskFieldValue(b.schedulingModeField),allowBlank:!1},a.schedulingModeConfig))}if(a.showWbsCode){a.items.push(a.initFieldDefinition({xtype:'textfield',fieldLabel:a.L('wbsCodeText'),name:'wbsCode',forceReadOnly:!0,readOnly:!0,value:a.task&&a.task.getWBSCode()},a.wbsCodeConfig))}if(a.showRollup){this.items.push(a.initFieldDefinition({xtype:'checkboxfield',fieldLabel:this.L('rollupText'),name:b.rollupField,uncheckedValue:!1,value:a.getTaskFieldValue(b.rollupField)},a.rollupConfig))}if(a.showReadOnly){this.items.push(a.initFieldDefinition({xtype:'readonlyfield',fieldLabel:a.L('readOnlyText'),name:b.readOnlyField,value:a.getTaskFieldValue(b.readOnlyField)},a.readOnlyConfig))}if(a.showConstraint){a.items.push(a.initFieldDefinition({xtype:'constrainttypefield',fieldLabel:a.L('Constraint Type'),name:b.constraintTypeField,value:a.getTaskFieldValue(b.constraintTypeField)},a.constraintTypeConfig),a.initFieldDefinition({xtype:'constraintdatefield',fieldLabel:a.L('Constraint Date'),name:b.constraintDateField,value:a.getTaskFieldValue(b.constraintDateField)},a.constraintDateConfig))}}});Ext.define('Gnt.widget.AssignmentEditGrid',{extend:'Ext.grid.Panel',alias:'widget.assignmenteditgrid',requires:['Ext.util.Filter','Ext.data.JsonStore','Ext.window.MessageBox','Ext.form.field.ComboBox','Ext.grid.plugin.CellEditing','Gnt.util.Data','Gnt.data.AssignmentStore','Gnt.data.ResourceStore','Gnt.column.ResourceName','Gnt.column.AssignmentUnits'],mixins:['Gnt.mixin.Localizable'],assignmentStore:null,resourceStore:null,readOnly:!1,cls:'gnt-assignmentgrid',defaultAssignedUnits:100,confirmAddResource:!0,addResources:!0,taskId:null,refreshTimeout:100,resourceDupStore:null,resourceComboStore:null,assignmentUnitsEditor:null,initComponent:function(){var a=this;var d=this.assignmentStore;var e=this.taskStore||d.getTaskStore();this.store=this.store||new d.self({model:d.model,taskStore:e});var f=e.getResourceStore();this.resourceDupStore=this.resourceDupStore||new f.self({model:f.model,taskStore:e});this.resourceComboStore=new Ext.data.JsonStore({autoDestroy:!0,model:this.resourceDupStore.model});if(this.addResources!==undefined){this.addResources=this.addResources}this.columns=this.buildColumns();if(!this.readOnly){this.plugins=this.buildPlugins()}a.loadResources();var c=Ext.Function.createBuffered(a.refreshResources,a.refreshTimeout,a,[]);a.mon(a.resourceStore,{add:c,remove:c,load:c,clear:c});a.tbar=a.tbar||[{xtype:'button',iconCls:'x-fa fa-plus',text:a.L('addAssignmentText'),itemId:'add-assignment-btn',handler:function(){a.insertAssignment()}},{xtype:'button',iconCls:'x-fa fa-trash',text:a.L('dropAssignmentText'),itemId:'drop-assignment-btn',disabled:!0,handler:function(){a.setActionableMode(!1);var b=a.getSelectionModel().getSelection();if(b&&b.length){var c=a.store.indexOf(b[0]);a.store.remove(b);if(a.store.getCount()>0){a.getSelectionModel().select(c===a.store.getCount()?c-1:c)}}}}];a.loadTaskAssignments();var b=Ext.Function.createBuffered(a.refreshAssignments,a.refreshTimeout,a,[]);a.mon(a.assignmentStore,{add:b,remove:b,load:b,clear:b});a.callParent(arguments);a.on({selectionchange:function(c,b){if(!a.dropBtn){a.dropBtn=a.down('#drop-assignment-btn')}a.dropBtn&&a.dropBtn.setDisabled(!b.length)}})},suspendRefreshResources:function(){this.refreshResourcesSuspended++},resumeRefreshResources:function(){this.refreshResourcesSuspended--},refreshResources:function(){if(!this.refreshResourcesSuspended&&!this.isDestroyed){this.loadResources()}},suspendRefreshAssignments:function(){this.refreshAssignmentsSuspended++},resumeRefreshAssignments:function(){this.refreshAssignmentsSuspended--},refreshAssignments:function(){if(!this.refreshAssignmentsSuspended&&!this.isDestroyed){this.loadTaskAssignments()}},loadResources:function(b){if(!this.resourceStore){return !1}var a=Gnt.util.Data.cloneModelSet(this.resourceStore);this.resourceDupStore.loadData(a);this.resourceComboStore.loadData(a);if(!b){this.loadTaskAssignments()}return !0},afterRender:function(){var a;this.callParent(arguments);if(this.taskId){var b=this.taskStore||this.assignmentStore.getTaskStore();a=b&&b.getModelById(this.taskId)}if(a){this.setEditableFields(a)}},getUnitsEditor:function(){if(!this.readOnly){if(!this.assignmentUnitsEditor){this.assignmentUnitsEditor=this.down('assignmentunitscolumn').getEditor()}}return this.assignmentUnitsEditor},setEditableFields:function(b){var a=this.getUnitsEditor();if(a){switch(b.getSchedulingMode()){case 'DynamicAssignment':a.setReadOnly(!0);break;default:a.setReadOnly(!1);}}},setReadOnly:function(a){if(this.cellEditing){if(a){this.cellEditing.disable()}else {this.cellEditing.enable()}}},loadTaskAssignments:function(a){a=a||this.taskId;if(!a){return !1}var d=this.taskStore||this.assignmentStore.getTaskStore(),b=d&&d.getModelById(a),c;if(b){c=b.getAssignments()}else {if(!this.assignmentStore){return !1}c=this.assignmentStore.queryBy(function(b){return b.getTaskId()==a})}this.taskId=a;var f=this.store,e=this.resourceDupStore,g=Gnt.util.Data.cloneModelSet(c,function(b,c){var d=c.getResourceId();var a=e.queryBy(function(b){var a=b.originalRecord;return (a.getId()||a.internalId)==d});if(a.getCount()){a=a.first();b.setResourceId(a.getId()||a.internalId)}});f.loadData(g);if(b&&this.rendered){this.setEditableFields(b)}return !0},insertAssignment:function(a,b){if(!a||!a.isModel){a=new this.store.model(a);if(!a){a.setUnits(this.defaultAssignedUnits)}}if(a.getResourceId()===undefined){a.setResourceId(null)}a.setTaskId(this.taskId);this.store.insert(0,a);var d=this,c=a.isValid;a.isValid=function(){return c.apply(this,arguments)&&d.isValidAssignment(this)};if(!b&&this.cellEditing){this.cellEditing.startEditByPosition({row:0,column:0})}return a},isValid:function(){var a=!0;this.store.each(function(b){if(!b.isValid()){a=!1;return !1}});return a},getAssignmentErrors:function(d){var a=this,c=[],b=d.getResourceId();if(!b){c.push(a.L('noValueText'))}else {if(!a.resourceDupStore.getModelById(b)){c.push(Ext.String.format(a.L('noResourceText'),b))}else {a.store.each(function(e){if(e.getResourceId()==b&&e!==d){c.push(a.L('Resource is already assigned'));return !1}})}}return c},isValidAssignment:function(a){return !this.getAssignmentErrors(a).length},buildPlugins:function(){var a=this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1});var b=a.startEdit;a.startEdit=function(){this.completeEdit();return b.apply(this,arguments)};a.on({beforeedit:this.onEditingStart,scope:this});return [a]},hide:function(){this.cancelEdit();this.callParent(arguments)},cancelEdit:function(){this.cellEditing.cancelEdit()},onEditingStart:function(c,a){var b=this.store.model.prototype;if(a.field==b.resourceIdField){this.assignment=a.record;this.resourceId=a.record.getResourceId();this.resourceComboStore.loadData(this.resourceDupStore.getRange());this.resourceComboStore.filter(this.resourcesFilter)}},resourceRender:function(d,a,c){var b=this.getAssignmentErrors(c);var e=c.getResourceName(this.resourceDupStore)||d;if(b&&b.length){a.tdCls='gnt-cell-invalid';a.tdAttr='data-errorqtip="'+b.join('<br>')+'"'}else {a.tdCls='';a.tdAttr='data-errorqtip=""'}return Ext.String.htmlEncode(e)},filterResources:function(d){var a=d.getId(),c=this.store.model.prototype.resourceIdField,b=!0;if(a!==this.resourceId){this.store.each(function(d){if(a==d.get(c)){b=!1;return !1}})}return b},onResourceComboAssert:function(a){var b=a.getRawValue();if(b){var e=this.resourceDupStore.findExact(a.displayField,b);var d=e!==-1?this.resourceDupStore.getAt(e):!1;if(!d){var g=this.assignment;var f=this;var c=function(h){var e=f.resourceStore.model,c={};c[e.prototype.nameField]=b;c=new e(c);c.setId(c.internalId);var d=f.resourceDupStore.add(c);if(d&&d.length){if(!h){a.getStore().add(c);a.setValue(d[0].getId())}else {g.setResourceId(d[0].getId())}}};if(this.confirmAddResource){var i=Ext.String.format(this.L('confirmAddResourceText'),Ext.String.htmlEncode(b));var h=Ext.Msg.confirm(this.L('confirmAddResourceTitle'),i,function(a){if(a=='yes'){c(!0)}});setTimeout(function(){h.toFront()},1)}else {c()}}else {a.select(d,!0)}}},buildColumns:function(){var a=this;this.resourceCombo=new Ext.form.field.ComboBox({queryMode:'local',store:this.resourceComboStore,allowBlank:!1,editing:this.addResources,validateOnChange:!1,autoSelect:!1,forceSelection:!this.addResources,valueField:this.resourceComboStore.model.prototype.idProperty,displayField:this.resourceComboStore.model.prototype.nameField,queryCaching:!1,listConfig:{getInnerTpl:function(){return '{'+this.displayField+':htmlEncode}'}}});this.resourcesFilter=new Ext.util.Filter({filterFn:this.filterResources,scope:this});if(this.addResources){Ext.Function.interceptBefore(this.resourceCombo,'assertValue',function(){a.onResourceComboAssert(this)})}return [{xtype:'resourcenamecolumn',editor:this.resourceCombo,dataIndex:this.assignmentStore.model.prototype.resourceIdField,renderer:this.resourceRender,resourceStore:a.resourceDupStore,scope:this},{xtype:'assignmentunitscolumn',assignmentStore:this.assignmentStore,dataIndex:this.assignmentStore.model.prototype.unitsField}]},saveResources:function(){Gnt.util.Data.applyCloneChanges(this.resourceDupStore,this.resourceStore)},saveTaskAssignments:function(){this.suspendRefreshAssignments();this.suspendRefreshResources();this.saveResources();var c=this.store.model,b=this.resourceDupStore,a=!0;Gnt.util.Data.applyCloneChanges(this.store,this.assignmentStore,function(f){var d=b.getById(this.getResourceId());if(!d||!d.originalRecord){a=!1;return}var e=d.originalRecord;f[c.prototype.resourceIdField]=e.getId()||e.internalId});this.resumeRefreshAssignments();this.resumeRefreshResources();return a},isDataChanged:function(){var a=this;return a.store&&a.store.getUpdatedRecords().length>0||a.store.getNewRecords().length>0||a.store.getRemovedRecords().length>0},isDataValid:function(){var a=!0;this.store.each(function(b){if(!b.isValid()){a=!1;return !1}});return a}});Ext.define('Gnt.widget.DependencyGrid',{extend:'Ext.grid.Panel',alias:'widget.dependencygrid',requires:['Ext.data.JsonStore','Ext.grid.plugin.CellEditing','Ext.form.field.ComboBox','Ext.util.Filter','Sch.util.Date','Gnt.model.Dependency','Gnt.util.Data','Gnt.field.Duration'],mixins:['Gnt.mixin.Localizable'],readOnly:!1,showCls:!1,cls:'gnt-dependencygrid',task:null,dependencyStore:null,taskModel:null,direction:'predecessors',oppositeStore:null,taskStoreListeners:null,refreshTimeout:100,dependencyModel:'Gnt.model.Dependency',allowParentTaskDependencies:!1,useSequenceNumber:!1,lagEditor:null,typesCombo:null,margin:0,border:!1,initComponent:function(){var a=this;if(!a.readOnly){a.plugins=a.buildPlugins()}if(!a.taskModel){if(a.dependencyStore){var b=a.dependencyStore.getTaskStore();if(b){a.taskModel=b.getModel()}else {a.taskModel=Gnt.model.Task}}else {a.taskModel=Gnt.model.Task}}if(a.oppositeStore){a.setOppositeStore(a.oppositeStore)}a.store=a.store||new Ext.data.JsonStore({autoDestroy:!0,model:a.dependencyModel});if(a.task){a.setTask(a.task);a.loadDependencies(a.task)}if(!a.title){a.title=a.direction==='predecessors'?a.L('predecessorsText'):a.L('successorsText')}a.columns=a.buildColumns();a.tbar=a.tbar||[{iconCls:'x-fa fa-plus',text:a.L('addDependencyText'),itemId:'add-dependency-btn',handler:function(){a.insertDependency()}},{iconCls:'x-fa fa-trash',text:a.L('dropDependencyText'),itemId:'drop-dependency-btn',disabled:!0,handler:function(){var c=a.getSelectionModel().getSelection();if(c&&c.length){var b=a.store;var d=b.indexOf(c[0]);a.cancelEdit();b.remove(c);if(b.getCount()>0){a.getSelectionModel().select(d===b.getCount()?d-1:d)}}}}];a.callParent(arguments);a.on({selectionchange:function(c,b){if(!a.dropDepBtn){a.dropDepBtn=a.down('#drop-dependency-btn')}a.dropDepBtn&&a.dropDepBtn.setDisabled(!b.length)},scope:a})},destroy:function(){if(this.deferredStoreBind){this.tasksCombo.un('render',this.bindTaskStore,this)}this.cellEditing.destroy();this.tasksCombo.destroy();this.typesCombo.destroy();this.lagEditor.destroy();this.callParent(arguments)},setTask:function(a){if(!a){return}this.task=a;var b=a.dependencyStore||a.getTaskStore().dependencyStore;if(b&&b!==this.dependencyStore){if(this.dependencyStore){this.mun(this.dependencyStore,this.onDependencyStoreDataChanged,this)}this.dependencyStore=b;if(this.typesCombo){this.typesCombo.store.filter(this.typesFilter)}this.mon(this.dependencyStore,this.onDependencyStoreDataChanged,this)}this.setReadOnly(a.isReadOnly())},setReadOnly:function(a){if(this.cellEditing){if(a){this.cellEditing.disable()}else {this.cellEditing.enable()}}if(this.items){this.down('toolbar').setVisible(!a)}},onDependencyStoreDataChanged:function(){this.loadDependencies()},buildPlugins:function(){var a=this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1});a.on({beforeedit:this.onEditingStart,edit:this.onEditingDone,scope:this});return [a]},hide:function(){this.cancelEdit();this.callParent(arguments)},cancelEdit:function(){this.cellEditing.cancelEdit()},onEditingStart:function(c,b){var a=this.store.model.prototype;switch(b.field){case a.lagField:this.lagEditor.durationUnit=b.record.getLagUnit();break;case a.typeField:this.typesCombo.store.filter(this.typesFilter);if(this.typesCombo.store.count()<2){return !1};break;case a.fromField:if(this.direction=='predecessors'){this.activeDependency=b.record;this.refilterTasksCombo()};break;case a.toField:if(this.direction!='predecessors'){this.activeDependency=b.record;this.refilterTasksCombo()};break;}},onEditingDone:function(c,a){var b=this.store.model.prototype;if(a.field==b.lagField){a.record.setLagUnit(this.lagEditor.durationUnit)}this.getView().refreshView()},dependencyTypeRender:function(b){var a=this.store.model.Type;switch(b){case a.EndToStart:return this.L('endToStartText');case a.StartToStart:return this.L('startToStartText');case a.EndToEnd:return this.L('endToEndText');case a.StartToEnd:return this.L('startToEndText');}return b},taskValidate:function(c,b){if(!c){return [this.L('blankTaskText')]}if(!b.isValid()){var a=this.getDependencyErrors(b);if(a&&a.length){return a}return [this.L('invalidDependencyText')]}},taskRender:function(e,a,f){var b=this.taskValidate(e,f),c;if(b&&b.length){a.tdCls='gnt-cell-invalid';a.tdAttr='data-errorqtip="'+b.join('<br>')+'"'}else {a.tdCls='';a.tdAttr='data-errorqtip=""'}var d=this.dependencyStore&&this.dependencyStore.getTaskStore();if(d){c=d.getModelById(e);return c&&Ext.String.htmlEncode(c.getName())||''}return ''},filterTasks:function(e){var c=e.getId(),a,b,d;if(this.direction==='predecessors'){b=c;d=this.task.getId();a=this.activeDependency&&this.activeDependency.getSourceId()}else {d=c;b=this.task.getId();a=this.activeDependency&&this.activeDependency.getTargetId()}return !this.activeDependency||c==a||this.isValidDependency(b,d)},refilterTasksCombo:function(){this.tasksCombo.getStore().addFilter(this.tasksFilter)},bindTaskStore:function(){if(!this.destroyed){var b=this.dependencyStore&&this.dependencyStore.getTaskStore();if(b){if(!this.taskStoreListeners){var a=Ext.Function.createBuffered(this.bindTaskStore,this.refreshTimeout,this,[]);this.taskStoreListeners=this.mon(b,{nodeappend:a,nodeinsert:a,noderemove:a,update:a,refresh:a,clear:a,'nodestore-datachange-end':a,scope:this,destroyable:!0})}var c=new Ext.data.JsonStore({autoDestroy:!0,model:b.model,sorters:b.model.prototype.nameField});var d=b.getRoot();c.loadData(Gnt.util.Data.cloneModelSet(b.toArray(),function(b,a){if(a===d||a.hidden||a.isReadOnly()){return !1}if(!a.getId()){b.setId(a.getId())}}));this.tasksFilter=new Ext.util.Filter({id:'dependencygrid-tasksfilter',filterFn:this.filterTasks,scope:this});c.filter(this.tasksFilter);this.tasksCombo.bindStore(c)}}},buildTasksCombo:function(){var a=this;return new Ext.form.field.ComboBox({queryMode:'local',allowBlank:!1,editing:!1,forceSelection:!0,valueField:this.taskModel.prototype.idProperty,displayField:this.taskModel.prototype.nameField,queryCaching:!1,listConfig:{getInnerTpl:function(){return '{'+this.displayField+':htmlEncode}'}},validator:function(b){if(!b){return a.L('blankTaskText')}return !0}})},filterAllowedTypes:function(d){if(!this.dependencyStore||!this.dependencyStore.allowedDependencyTypes){return !0}var b=this.dependencyStore.allowedDependencyTypes;var c=this.store.model.Type;for(var a=0,f=b.length;a<f;a++){var e=c[b[a]];if(d.getId()==e){return !0}}return !1},buildTypesCombo:function(){var a=this.store.model.Type;this.typesFilter=new Ext.util.Filter({id:'typesfilter',filterFn:this.filterAllowedTypes,scope:this});var b=new Ext.data.ArrayStore({fields:[{name:'id',type:'int'},'text'],data:[[a.EndToStart,this.L('endToStartText')],[a.StartToStart,this.L('startToStartText')],[a.EndToEnd,this.L('endToEndText')],[a.StartToEnd,this.L('startToEndText')]]});b.filter(this.typesFilter);return new Ext.form.field.ComboBox({triggerAction:'all',queryMode:'local',editable:!1,valueField:'id',displayField:'text',store:b})},buildLagEditor:function(){return new Gnt.field.Duration({minValue:Number.NEGATIVE_INFINITY})},buildColumns:function(){var c=this,b=this.store.model.prototype,a=[],e=this.dependencyStore&&this.dependencyStore.getTaskStore();this.tasksCombo=this.buildTasksCombo();if(!e){this.deferredStoreBind=!0;this.tasksCombo.on('afterrender',this.bindTaskStore,this)}else {this.bindTaskStore()}var d=b[this.direction==='predecessors'?'fromField':'toField'];if(this.useSequenceNumber){a.push({text:this.L('snText'),dataIndex:d,renderer:function(e,f,d){var a=c.dependencyStore&&c.dependencyStore.getTaskStore(),b=a&&a.getModelById(d.get('From'));return b?b.getSequenceNumber():''},width:50})}else {a.push({text:this.L('idText'),dataIndex:d,width:50})}a.push({text:this.L('taskText'),dataIndex:d,flex:1,editor:this.tasksCombo,renderer:function(b,d,a){return c.taskRender(b,d,a)}});this.lagEditor=this.buildLagEditor();this.typesCombo=this.buildTypesCombo();a.push({text:this.L('typeText'),dataIndex:b.typeField,width:120,renderer:this.dependencyTypeRender,scope:this,editor:this.typesCombo},{text:this.L('lagText'),dataIndex:b.lagField,width:100,editor:this.lagEditor,renderer:function(d,e,a){return c.lagEditor.valueToVisible(d,a.get(b.lagUnitField),2)}},{text:this.L('clsText'),dataIndex:b.clsField,hidden:!this.showCls,width:100});return a},insertDependency:function(d,f){if(!this.dependencyStore){return}var e=this.task.getId(),b=this.store.model.prototype,a={},h=this;if(d){a=d}else {a[b.typeField]=this.typesCombo.store.getAt(0).getId();a[b.lagField]=0;a[b.lagUnitField]=Sch.util.Date.DAY}if(this.direction==='predecessors'){a[b.toField]=e}else {a[b.fromField]=e}var c=this.store.insert(0,a);if(c.length){var g=c[0].isValid;c[0].isValid=function(){return g.call(this,!1)&&h.isValidDependency(this)}}if(!f){this.cellEditing.startEditByPosition({row:0,column:1})}return c},onOppositeStoreChange:function(){this.getView().refreshView()},setOppositeStore:function(b){var a={update:this.onOppositeStoreChange,datachanged:this.onOppositeStoreChange,scope:this};if(this.oppositeStore){this.mun(this.oppositeStore,a)}this.oppositeStore=b;this.mon(this.oppositeStore,a)},loadDependencies:function(a){var d=this;a=a||this.task;if(!a){return}if(this.task!==a){this.setTask(a)}var b;if(this.direction==='predecessors'){b=a.getIncomingDependencies(!0);if(!this.oppositeStore){this.oppositeData=a.getOutgoingDependencies(!0)}}else {b=a.getOutgoingDependencies(!0);if(!this.oppositeStore){this.oppositeData=a.getIncomingDependencies(!0)}}var c=Gnt.util.Data.cloneModelSet(b,function(a){var b=a.isValid;a.isValid=function(){return b.call(this,!1)&&d.isValidDependency(this)}});this.store.loadData(c);this.fireEvent('loaddependencies',this,this.store,c,a)},getDependencyErrors:function(c,e){var a=this,j=a.dependencyStore,d=[],b,h;if(c instanceof Gnt.model.Dependency){b=c;c=a.task.getId();e=c;h=b.getType();if(a.direction==='predecessors'){c=b.getSourceId()}else {e=b.getTargetId()}}if(b){a.store.each(function(f){if(c==f.getSourceId()&&e==f.getTargetId()&&f!==b){d.push(a.L('duplicatingDependencyText'));return !1}});if(d.length){return d}}var f=a.store.getRange();b&&f.splice(Ext.Array.indexOf(f,b),1);var i=a.task[a.direction];var g=j.getDependencyError(c,e,h,f,i);if(g){switch(g){case -3:case -8:case -5:case -6:return [a.L('transitiveDependencyText')];case -4:case -7:return [a.L('cyclicDependencyText')];case -9:return [a.L('parentChildDependencyText')];}return [this.L('invalidDependencyText')]}return d},isValidDependency:function(){return !this.getDependencyErrors.apply(this,arguments).length},isValid:function(){var a=!0;this.store.each(function(b){if(!b.isValid()){a=!1;return !1}});return a},saveDependencies:function(){if(!this.dependencyStore||!this.isValid()){return}Gnt.util.Data.applyCloneChanges(this.store,this.dependencyStore)},isDataChanged:function(){var a=this;return a.store&&a.store.getUpdatedRecords().length>0||a.store.getNewRecords().length>0||a.store.getRemovedRecords().length>0},isDataValid:function(){return this.isValid()}});Ext.define('Gnt.widget.taskeditor.TaskEditor',{extend:'Gnt.widget.taskeditor.BaseEditor',alias:'widget.taskeditor',requires:['Ext.form.field.HtmlEditor','Ext.layout.container.Table','Gnt.widget.taskeditor.TaskForm','Gnt.widget.taskeditor.AdvancedForm','Gnt.widget.AssignmentEditGrid','Gnt.widget.DependencyGrid'],alternateClassName:['Gnt.widget.TaskEditor'],taskFormClass:'Gnt.widget.taskeditor.TaskForm',advancedFormClass:'Gnt.widget.taskeditor.AdvancedForm',showAssignmentGrid:!0,showDependencyGrid:!0,allowParentTaskDependencies:!0,showNotes:!0,showAdvancedForm:!0,showRollup:!1,showReadOnly:!0,showBaseline:!0,taskFormConfig:null,dependencyGridClass:'Gnt.widget.DependencyGrid',dependencyGridConfig:null,assignmentGridClass:'Gnt.widget.AssignmentEditGrid',assignmentGridConfig:null,advancedFormConfig:null,notesConfig:null,notesPanel:null,notesEditor:null,taskForm:null,assignmentGrid:null,dependencyGrid:null,advancedForm:null,margin:0,buildItems:function(){var a=this,c=[];var b=a.clonedStores||{};a.taskFormConfig=a.taskFormConfig||{};Ext.applyIf(a.taskFormConfig,{showBaseline:a.showBaseline,showRollup:!1});a.taskForm=Ext.create(a.taskFormClass,Ext.apply({task:a.task,border:!1,taskStore:a.taskStore},a.taskFormConfig));if(!a.taskForm.title){a.taskForm.title=a.L('generalText')}c.push(a.taskForm);if(a.showDependencyGrid){a.dependencyGrid=Ext.create(a.dependencyGridClass,Ext.apply({allowParentTaskDependencies:a.allowParentTaskDependencies,taskModel:a.taskStore.model,dependencyModel:a.taskStore.getDependencyStore().getModel(),task:a.task,margin:0,border:!1},a.dependencyGridConfig));c.push(a.dependencyGrid)}if(a.showAssignmentGrid&&a.assignmentStore&&a.resourceStore){if(!b.assignmentStore){b.assignmentStore=a.cloneAssignmentStore(a.task)}if(!b.resourceStore){b.resourceStore=a.cloneResourceStore(a.task)}a.assignmentGrid=Ext.create(a.assignmentGridClass,Ext.apply({assignmentStore:a.assignmentStore,resourceStore:a.resourceStore,border:!1,margin:0,store:b.assignmentStore,resourceDupStore:b.resourceStore,listeners:{afterrender:{fn:function(b){a.task&&b.loadTaskAssignments(a.task.get(a.task.idProperty))},single:!0}}},a.assignmentGridConfig));if(!a.assignmentGrid.title){a.assignmentGrid.title=a.L('resourcesText')}c.push(a.assignmentGrid)}if(a.showAdvancedForm){a.advancedFormConfig=a.advancedFormConfig||{};a.advancedForm=Ext.create(a.advancedFormClass,Ext.applyIf(a.advancedFormConfig,{showRollup:a.showRollup,showReadOnly:a.showReadOnly,border:!1,task:a.task,taskStore:a.taskStore}));if(!a.advancedForm.title){a.advancedForm.title=a.L('advancedText')}c.push(a.advancedForm)}if(a.showNotes){a.notesEditor=Ext.create('Ext.form.field.HtmlEditor',Ext.apply({listeners:{afterrender:function(b){a.task&&a.notesEditor.setValue(a.task.get(a.task.noteField))}},readOnly:a.task&&!a.task.isEditable(a.task.noteField),isDataChanged:function(){return this.isDirty()}},a.notesConfig));a.notesPanel=Ext.create('Ext.Container',{border:!1,margin:0,layout:'fit',items:a.notesEditor});if(!a.notesPanel.title){a.notesPanel.title=a.L('notesText')}c.push(a.notesPanel)}return c},bindDependencyGrid:function(){var a=this.clonedStores.dependencyStore;var b=this.dependencyGrid;b.store.taskStore=this.clonedStores.taskStore;if(a){this.mon(b,{loaddependencies:function(c,b){a.loadData(b.getRange().concat(Gnt.util.Data.cloneModelSet(c.oppositeData)))}});this.mon(b.store,{add:function(c,b){a.add(b)},remove:function(c,b){a.remove(b)}});this.dependencyGridBound=!0}},loadTask:function(b){if(!b){return}this.task=b;var a=this,d=a.taskForm,f=a.dependencyGrid,c=a.assignmentGrid,j=b.isReadOnly();d.setSuppressTaskUpdate(!0);d.getForm().reset();a.callParent(arguments);var e=a.clonedStores,g=a.taskBuffer;if(f){if(!a.dependencyGridBound){a.bindDependencyGrid()}f.loadDependencies(b);f.tab.setVisible(a.allowParentTaskDependencies||b.isLeaf())}if(c){if(e.assignmentStore!==c.getStore()){c.reconfigure(e.assignmentStore)}if(c.resourceDupStore!==e.resourceStore){c.resourceDupStore=e.resourceStore}c.loadResources(!0);c.loadTaskAssignments(b.getId()||b.getPhantomId());c.task=g}d.loadRecord(b,g);if(a.advancedForm){a.advancedForm.setSuppressTaskUpdate(!0);var i=a.advancedForm.getForm();i.reset();a.advancedForm.loadRecord(b,d.taskBuffer);var h=i.findField('wbsCode');if(h){h.setValue(b.getWBSCode())}a.advancedForm.setSuppressTaskUpdate(!1)}d.setSuppressTaskUpdate(!1);if(a.notesEditor){a.notesEditor.setValue(b.getNote())}a.setReadOnly(j);a.fireEvent('loadtask',a,b)},updateReadOnly:function(){var a=this,d=a.taskBuffer,b=a.getReadOnly(),c=b||d.isReadOnly();if(a.taskForm){if(b!=a.taskForm.getReadOnly()){a.taskForm.setReadOnly(b)}else {a.taskForm.updateReadOnly()}}if(a.assignmentGrid){a.assignmentGrid.setReadOnly(c);a.assignmentGrid.down('toolbar').setVisible(!c)}if(a.dependencyGrid){a.dependencyGrid.setReadOnly(c)}if(a.notesEditor){a.notesEditor.setReadOnly(c||!d.isEditable(d.noteField))}if(a.advancedForm){if(b!=a.advancedForm.getReadOnly()){a.advancedForm.setReadOnly(b)}else {a.advancedForm.updateReadOnly()}}},doValidate:function(a){var b=this.callParent(arguments);if(this.taskForm&&!this.taskForm.isValid()){b=!1;a&&a(this.getTabByComponent(this.taskForm),this.taskForm)}if(this.dependencyGrid&&!this.dependencyGrid.isValid()){b=!1;a&&a(this.getTabByComponent(this.dependencyGrid),this.dependencyGrid)}if(this.assignmentGrid&&!this.assignmentGrid.isValid()){b=!1;a&&a(this.getTabByComponent(this.assignmentGrid),this.assignmentGrid)}if(this.advancedForm&&!this.advancedForm.isValid()){b=!1;a&&a(this.getTabByComponent(this.advancedForm),this.advancedForm)}return b},doUpdateTask:function(){this.dependencyGrid&&this.dependencyGrid.saveDependencies();this.taskForm&&this.taskForm.updateRecord();this.advancedForm&&this.advancedForm.updateRecord();this.notesEditor&&this.task.set(this.task.noteField,this.notesEditor.getValue());this.assignmentGrid&&this.assignmentGrid.saveTaskAssignments()},isDataChanged:function(a){var b=this.callParent(arguments);if(this.taskForm&&this.taskForm.isDataChanged()){b=!0;a&&a(this.getTabByComponent(this.taskForm))}if(this.dependencyGrid&&this.dependencyGrid.isDataChanged()){b=!0;a&&a(this.getTabByComponent(this.dependencyGrid))}if(this.assignmentGrid&&this.assignmentGrid.isDataChanged()){b=!0;a&&a(this.getTabByComponent(this.assignmentGrid))}if(this.advancedForm&&this.advancedForm.isDataChanged()){b=!0;a&&a(this.getTabByComponent(this.advancedForm))}if(this.notesEditor&&this.notesEditor.isDataChanged()){b=!0;a&&a(this.getTabByComponent(this.notesEditor))}return b}});Ext.define('Gnt.plugin.taskeditor.TaskEditor',{extend:'Gnt.plugin.taskeditor.BaseEditor',alternateClassName:['Gnt.plugin.TaskEditor'],requires:['Gnt.widget.taskeditor.TaskEditor'],alias:'plugin.gantt_taskeditor',ptype:'gantt_taskeditor',taskEditorCls:'Gnt.widget.taskeditor.TaskEditor',height:390,width:600,taskEditorConfigs:'l10n,task,taskStore,assignmentStore,resourceStore,generalText,resourcesText,dependencyText,addDependencyText,'+'dropDependencyText,notesText,advancedText,wbsCodeText,addAssignmentText,dropAssignmentText,showAssignmentGrid,showDependencyGrid,'+'allowParentTaskDependencies,showNotes,showStyle,showAdvancedForm,taskFormClass,advancedFormClass,taskFormConfig,dependencyGridConfig,'+'assignmentGridConfig,advancedFormConfig,styleFormConfig,dependencyGridClass,assignmentGridClass',constructor:function(a){this.callParent(arguments);this.addFilter(function(a){return a&&!a.isProject})},init:function(a){this.callParent(arguments);a.taskEditor=this}});Ext.define('Gnt.selection.SpreadsheetModel',{extend:'Ext.grid.selection.SpreadsheetModel',requires:['Gnt.patches.CellContext'],uses:['Gnt.column.WBS'],alias:'selection.gantt_spreadsheet',privates:{getNumbererColumnConfig:function(){var a=this;return {xtype:'wbscolumn',text:'&nbsp;',width:a.rowNumbererHeaderWidth,editRenderer:'&#160;',tdCls:a.rowNumbererTdCls,cls:a.rowNumbererHeaderCls,sortable:!1,draggable:!1,hideable:!1,menuDisabled:!0,lockable:!1,ignoreExport:!0,locked:!0}}}});Ext.define('Gnt.template.CalendarDateInfo',{extend:'Ext.XTemplate',disableFormats:!0,workingHoursText:null,nonWorkingText:null,basedOnText:null,overrideText:null,inCalendarText:null,dayInCalendarText:null,markup:'<div class="gnt-calendar-overridedate">'+'<tpl if="isWorkingDay">__WORKINGHOURS__ {date}:<tpl else>{date} __NONWORKING__</tpl>'+'</div>'+'<ul class="gnt-calendar-availabilities">'+'<tpl for="availability">'+'<li>{.}</li>'+'</tpl>'+'</ul>'+'<span class="gnt-calendar-overridesource"> __BASEDON__: '+'<tpl if="override">__OVERRIDE__ "{name}" __INCALENDAR__ "{calendarName}"<tpl else>__DAYINCALENDAR__ "{calendarName}"</tpl>'+'</span>',constructor:function(a){Ext.apply(this,a);this.markup=this.markup.replace('__WORKINGHOURS__',this.workingHoursText).replace('__NONWORKING__',this.nonWorkingText).replace('__BASEDON__',this.basedOnText).replace('__OVERRIDE__',this.overrideText).replace('__INCALENDAR__',this.inCalendarText).replace('__DAYINCALENDAR__',this.dayInCalendarText);this.callParent([this.markup])}});Ext.define('Gnt.template.CalendarLegend',{extend:'Ext.Template',disableFormats:!0,markup:'<ul class="gnt-calendar-legend">'+'<li class="gnt-calendar-legend-item">'+'<div class="gnt-calendar-legend-itemstyle {workingDayCls}"></div>'+'<span class="gnt-calendar-legend-itemname">{workingDayText}</span>'+'<div style="clear: both"></div>'+'</li>'+'<li>'+'<div class="gnt-calendar-legend-itemstyle {nonWorkingDayCls}"></div>'+'<span class="gnt-calendar-legend-itemname">{weekendsText}</span>'+'<div style="clear: both"></div>'+'</li>'+'<li class="gnt-calendar-legend-override">'+'<div class="gnt-calendar-legend-itemstyle {overriddenDayCls}">31</div>'+'<span class="gnt-calendar-legend-itemname">{overriddenDayText}</span>'+'<div style="clear: both"></div>'+'</li>'+'<li class="gnt-calendar-legend-override">'+'<div class="gnt-calendar-legend-itemstyle {overriddenWeekDayCls}">31</div>'+'<span class="gnt-calendar-legend-itemname">{overriddenWeekText}</span>'+'<div style="clear: both"></div>'+'</li>'+'</ul>',constructor:function(){this.callParent([this.markup])}});Ext.define('Gnt.widget.Calendar',{extend:'Ext.picker.Date',alias:'widget.ganttcalendar',requires:['Gnt.data.Calendar','Sch.util.Date'],mixins:['Gnt.mixin.Localizable'],calendar:null,startDate:null,endDate:null,initComponent:function(){if(!this.calendar){Ext.Error.raise('Required attribute "calendar" missing during initialization of `Gnt.widget.Calendar`')}if(!this.startDate){Ext.Error.raise('Required attribute "startDate" missing during initialization of `Gnt.widget.Calendar`')}if(!this.endDate){this.endDate=Sch.util.Date.add(this.startDate,Sch.util.Date.MONTH,1)}this.setCalendar(this.calendar);this.minDate=this.value=this.startDate;this.callParent(arguments);this.injectDates()},injectDates:function(){var a=this;var b=a.disabledDates=[];Ext.Array.each(a.calendar.getHolidaysRanges(a.startDate,a.endDate),function(c){c.forEachDate(function(c){b.push(Ext.Date.format(c,a.format))})});a.setDisabledDates(b)},setCalendar:function(a){var b={update:this.injectDates,remove:this.injectDates,add:this.injectDates,load:this.injectDates,clear:this.injectDates,scope:this};if(this.calendar){this.mun(a,b)}this.calendar=a;if(a){this.mon(a,b)}}});Ext.define('Gnt.widget.calendar.AvailabilityGrid',{extend:'Ext.grid.Panel',requires:['Ext.Button','Ext.data.Store','Ext.grid.column.Date','Ext.grid.plugin.CellEditing','Ext.window.MessageBox'],mixins:['Gnt.mixin.Localizable'],alias:'widget.calendaravailabilitygrid',calendarDay:null,minHeight:160,addButton:null,removeButton:null,maxIntervalsNum:5,initComponent:function(){if(!this.tbar){this.tbar=this.buildToolbar()}Ext.applyIf(this,{store:new Ext.data.Store({fields:['startTime','endTime'],autoDestroy:!0,data:this.calendarDay.getAvailability()}),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2})],columns:[{xtype:'datecolumn',header:this.L('startText'),format:'g:i a',dataIndex:'startTime',flex:1,editor:{xtype:'timefield',allowBlank:!1,initDate:'31/12/1899'}},{xtype:'datecolumn',header:this.L('endText'),format:'g:i a',dataIndex:'endTime',flex:1,editor:{xtype:'timefield',allowBlank:!1,initDate:'31/12/1899'}}],listeners:{selectionchange:this.onAvailabilityGridSelectionChange,scope:this}});this.callParent(arguments)},buildToolbar:function(){this.addButton=new Ext.Button({text:this.L('addText'),iconCls:'x-fa fa-plus',handler:this.addAvailability,scope:this});this.removeButton=new Ext.Button({text:this.L('removeText'),iconCls:'x-fa fa-trash',handler:this.removeAvailability,scope:this,disabled:!0});return {padding:'0 0 5 0',items:[this.addButton,this.removeButton]}},onAvailabilityGridSelectionChange:function(b,a){this.removeButton.setDisabled(!a.length)},setAvailability:function(a){this.store.loadData(a);this.addButton.setDisabled(this.store.getCount()>=this.maxIntervalsNum)},addAvailability:function(){var b=this.getStore(),a=b.count();if(a>=this.maxIntervalsNum){return}b.add({startTime:new Date(0,0,0,12,0),endTime:new Date(0,0,0,13,0)});if(a+1>=this.maxIntervalsNum&&this.addButton){this.addButton.disable()}},removeAvailability:function(){var b=this.getStore(),c=b.getCount(),a=this.getSelection();if(!a.length){return}b.remove(a[0]);if(c<this.maxIntervalsNum&&this.addButton){this.addButton.enable()}},isValid:function(a){try{this.calendarDay.verifyAvailability(this.getIntervals())}catch(b){if(!a){Ext.MessageBox.show({title:this.L('error'),msg:b,modal:!0,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}return !1}return !0},extractTimeFromDate:function(a){return new Date(0,0,0,a.getHours(),a.getMinutes(),a.getSeconds())},getIntervals:function(){var a=[];var b=this;this.getStore().each(function(d){var c=b.extractTimeFromDate(d.get('endTime'));if(c-new Date(0,0,0,0,0,0)===0){c=new Date(0,0,1,0,0)}a.push({startTime:b.extractTimeFromDate(d.get('startTime')),endTime:c})});return a}});Ext.define('Gnt.widget.calendar.DayEditor',{extend:'Gnt.widget.calendar.AvailabilityGrid',requires:['Ext.grid.plugin.CellEditing','Gnt.data.Calendar','Sch.util.Date'],mixins:['Gnt.mixin.Localizable'],alias:'widget.calendardayeditor',height:160,initComponent:function(){var a=this.calendarDay.getIsWorkingDay();this.dockedItems=this.dockedItems||[{xtype:'radiogroup',dock:'top',name:'dayType',padding:'0 5px',margin:0,items:[{boxLabel:this.L('workingTimeText'),name:'IsWorkingDay',inputValue:!0,checked:a},{boxLabel:this.L('nonworkingTimeText'),name:'IsWorkingDay',inputValue:!1,checked:!a}],listeners:{change:this.onDayTypeChanged,scope:this}}];this.on('afterrender',this.myApplyState,this);this.callParent(arguments)},getDayTypeRadioGroup:function(){return this.down('radiogroup[name="dayType"]')},myApplyState:function(){if(!this.isWorkingDay()){this.viewSetDisabled(!0);this.addButton.disable()}},viewSetDisabled:function(a){if(a){this.getView().getEl().mask();this.getHeaderContainer().getEl().mask()}else {this.getView().getEl().unmask();this.getHeaderContainer().getEl().unmask()}},onDayTypeChanged:function(b){var a=b.getValue();if(Ext.isArray(a.IsWorkingDay)){return}this.viewSetDisabled(!a.IsWorkingDay);this.addButton.setDisabled(!a.IsWorkingDay||this.getStore().getCount()>=this.maxIntervalsNum)},isWorkingDay:function(){return this.getDayTypeRadioGroup().getValue().IsWorkingDay},isValid:function(){if(this.isWorkingDay()){return this.callParent()}return !0},getIntervals:function(){if(!this.isWorkingDay()){return []}return this.callParent()}});Ext.define('Gnt.widget.calendar.WeekEditor',{extend:'Ext.form.Panel',requires:['Ext.grid.Panel','Gnt.data.Calendar','Sch.util.Date','Gnt.widget.calendar.AvailabilityGrid'],mixins:['Gnt.mixin.Localizable'],alias:'widget.calendarweekeditor',weekName:null,startDate:null,endDate:null,weekAvailability:null,calendarWeekAvailability:null,defaultWeekAvailability:null,backupWeekAvailability:null,layout:'anchor',defaults:{border:!1,anchor:'100%'},calendarDayModel:null,currentDayIndex:null,_weekDaysGrid:null,_availabilityGrid:null,initComponent:function(){this.backupWeekAvailability=[];this.items=[{xtype:'radiogroup',padding:'0 5px',name:'dayType',items:[{boxLabel:this.L('defaultTimeText'),name:'IsWorkingDay',inputValue:0},{boxLabel:this.L('workingTimeText'),name:'IsWorkingDay',inputValue:1},{boxLabel:this.L('nonworkingTimeText'),name:'IsWorkingDay',inputValue:2}],listeners:{change:this.onDayTypeChanged,scope:this}},{layout:{type:'hbox',align:'stretch'},padding:'0 0 5px 0',items:[{margin:'0 10px 0 5px',flex:1,items:this.getWeekDaysGrid()},{flex:1,margin:'0 5px 0 0',items:this.getAvailabilityGrid()}]}];this.callParent(arguments)},getWeekDaysGrid:function(){if(this._weekDaysGrid!=null){return this._weekDaysGrid}var a=Ext.Date.dayNames;return this._weekDaysGrid=new Ext.grid.Panel({hideHeaders:!0,minHeight:160,columns:[{dataIndex:'name',flex:1}],store:new Ext.data.Store({autoDestroy:!0,fields:['id','name'],idProperty:'id',data:[{id:1,name:a[1]},{id:2,name:a[2]},{id:3,name:a[3]},{id:4,name:a[4]},{id:5,name:a[5]},{id:6,name:a[6]},{id:0,name:a[0]}]}),listeners:{viewready:this.onWeekDaysListViewReady,selectionchange:this.onWeekDaysListSelectionChange,beforeselect:this.onWeekDaysListBeforeSelect,scope:this}})},getAvailabilityGrid:function(){if(!this._availabilityGrid){this._availabilityGrid=new Gnt.widget.calendar.AvailabilityGrid({calendarDay:new this.calendarDayModel()})}return this._availabilityGrid},getDayTypeRadioGroup:function(){if(!this.dayTypeRadioGroup){this.dayTypeRadioGroup=this.down('radiogroup[name="dayType"]')}return this.dayTypeRadioGroup},getWeekAvailability:function(){return this.weekAvailability},onWeekDaysListViewReady:function(){var a=this.getWeekDaysGrid(),b=a.getStore().getAt(0);this.currentDayIndex=b.getId();this.readFromData();a.getSelectionModel().select(b,!1,!0)},onWeekDaysListBeforeSelect:function(){if(!this.saveToData()){return !1}},applyChanges:function(b){if(!this.saveToData()){return !1}var e=this.weekAvailability;var d=!1;for(var a=0;a<7;a++){var c=e[a];if(c){d=!0;if(!b[a]){b[a]=c}b[a].setIsWorkingDay(c.getIsWorkingDay());b[a].setAvailability(c.getAvailability())}else {b[a]=null}}if(!d){Ext.MessageBox.show({title:this.L('error'),msg:this.L('noOverrideError'),modal:!0,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK});return !1}return !0},onWeekDaysListSelectionChange:function(b,a){this.currentDayIndex=a[0].getId();this.readFromData()},getCurrentTypeOfWeekDay:function(a){return this.weekAvailability[a]?this.weekAvailability[a].getIsWorkingDay()?1:2:0},getCurrentWeekDay:function(a){return this.weekAvailability[a]||this.calendarWeekAvailability[a]||this.defaultWeekAvailability[a]},saveToData:function(){var a=this.currentDayIndex;var d=this.getDayTypeRadioGroup().getValue().IsWorkingDay;var b=this.weekAvailability;if(d===0){b[a]=null;return !0}var c=this.getAvailabilityGrid();if(d==1){if(!c.isValid()){return !1}if(!b[a]){b[a]=this.copyDefaultWeekDay(a)}b[a].setIsWorkingDay(!0);b[a].setAvailability(c.getIntervals());this.backupWeekAvailability[a]=null;return !0}if(!b[a]){b[a]=this.copyDefaultWeekDay(a)}b[a].setIsWorkingDay(!1);b[a].setAvailability([]);return !0},copyDefaultWeekDay:function(b){var a=(this.calendarWeekAvailability[b]||this.defaultWeekAvailability[b]).copy();a.phantom=!0;a.beginEdit();a.setType('WEEKDAYOVERRIDE');a.setOverrideStartDate(this.startDate);a.setOverrideEndDate(this.endDate);a.setName(this.weekName);a.endEdit();return a},readFromData:function(d){var e=this.getCurrentWeekDay(this.currentDayIndex);var c=this.getCurrentTypeOfWeekDay(this.currentDayIndex);var b=this.getAvailabilityGrid();b.setAvailability(d||e.getAvailability());var a=this.getDayTypeRadioGroup();a.suspendEvents();a.setValue({IsWorkingDay:[c]});a.resumeEvents();b.setDisabled(c!=1)},onDayTypeChanged:function(h,i,g){var c=h.getValue();if(c.IsWorkingDay==null||Ext.isArray(c.IsWorkingDay)){return}var b=this.weekAvailability;var d=this.backupWeekAvailability;var a=this.currentDayIndex;var f=this.getAvailabilityGrid();var e;if(g.IsWorkingDay==1){d[a]=f.getIntervals()}switch(c.IsWorkingDay){case 0:b[a]=null;break;case 1:if(!b[a]){b[a]=this.copyDefaultWeekDay(a)};e=d[a];b[a].setIsWorkingDay(!0);break;case 2:if(!b[a]){b[a]=this.copyDefaultWeekDay(a)};b[a].setAvailability([]);b[a].setIsWorkingDay(!1);break;default:throw 'Unrecognized day type';}this.readFromData(e)}});Ext.define('Gnt.widget.calendar.DatePicker',{extend:'Ext.picker.Date',alias:'widget.gntdatepicker',workingDayCls:'gnt-datepicker-workingday',nonWorkingDayCls:'gnt-datepicker-nonworkingday',overriddenDayCls:'gnt-datepicker-overriddenday',overriddenWeekDayCls:'gnt-datepicker-overriddenweekday',weekOverridesStore:null,dayOverridesCalendar:null,update:function(){this.callParent(arguments);this.refreshCssClasses()},refreshCssClasses:function(){var c=this,b=c.cells.elements;this.removeCustomCls();for(var a=0;a<c.numDays;a++){var d=b[a].firstChild.dateValue;b[a].className+=' '+this.getDateCls(new Date(d))}},getDateCls:function(a){var b='';if(a.getMonth()!==this.getActive().getMonth()){return}var c=this.dayOverridesCalendar;if(c.getOwnCalendarDay(a)){b+=' '+this.overriddenDayCls;if(!c.isWorkingDay(a)){b+=' '+this.nonWorkingDayCls}}else {var e=null;this.weekOverridesStore.each(function(b){var c=b.get('startDate'),d=b.get('endDate');if(c!=null&&d!=null&&Ext.Date.between(a,c,d)){e=b;return !1}});if(e){b+=' '+this.overriddenWeekDayCls;var f=a.getDay(),d=e.get('weekAvailability');if(d&&d[f]&&!d[f].getIsWorkingDay()){b+=' '+this.nonWorkingDayCls}}else {if(!c.isWorkingDay(a)){b+=' '+this.nonWorkingDayCls}}}return b||this.workingDayCls},removeCustomCls:function(){this.cells.removeCls([this.overriddenDayCls,this.nonWorkingDayCls,this.workingDayCls,this.overriddenWeekDayCls])}});Ext.define('Gnt.widget.calendar.Calendar',{extend:'Ext.form.Panel',requires:['Ext.XTemplate','Ext.data.Store','Ext.grid.Panel','Ext.grid.plugin.CellEditing','Ext.layout.container.HBox','Ext.layout.container.Column','Ext.layout.container.Fit','Ext.layout.container.Anchor','Ext.form.FieldContainer','Ext.form.field.Checkbox','Ext.form.field.ComboBox','Ext.form.field.Text','Ext.tab.Panel','Gnt.data.Calendar','Gnt.model.Week','Gnt.widget.calendar.DayEditor','Gnt.widget.calendar.WeekEditor','Gnt.widget.calendar.DatePicker','Gnt.template.CalendarLegend','Gnt.template.CalendarDateInfo','Gnt.patches.CellEditor_2'],mixins:['Gnt.mixin.Localizable'],alias:'widget.calendar',defaults:{border:!1},workingDayCls:'gnt-datepicker-workingday',nonWorkingDayCls:'gnt-datepicker-nonworkingday',overriddenDayCls:'gnt-datepicker-overriddenday',overriddenWeekDayCls:'gnt-datepicker-overriddenweekday',calendar:null,calendarManager:null,dayGridConfig:null,weekGridConfig:null,datePickerConfig:null,readOnly:!1,dayGrid:null,weekGrid:null,datePicker:null,legendTpl:null,dateInfoTpl:null,dayOverridesCalendar:null,weekOverridesStore:null,currentDayOverrideEditor:null,calendarDayModel:null,scrollable:!0,layout:{type:'vbox',align:'stretch'},initComponent:function(){var a=this;a.setupTemplates();var b=a.calendar;if(!b&&a.calendarManager){b=a.calendarManager.getProjectCalendar()||a.calendarManager.getRoot().firstChild}if(!a.calendarDayModel){a.calendarDayModel=b&&b.getModel&&b.getModel()||b.model}a.buildItems();a.bindListeners();a.callParent(arguments);a.projectCalendarCheckbox=a.down('#projectCalendarCheckbox');a.projectCalendarCheckbox.setVisible(a.calendarManager);a.setReadOnly(a.readOnly);b&&a.setCalendar(b)},setReadOnly:function(a){this.readOnly=a;this.cmbParentCalendar.setDisabled(a);this.down('#calendarName').setDisabled(a);if(this.calendarManager&&this.calendarManager.getProjectCalendar()!==this.calendar){this.projectCalendarCheckbox.setDisabled(a)}this.setGridReadOnly(this.dayGrid,a);this.setGridReadOnly(this.weekGrid,a)},getReadOnly:function(){return this.readOnly},isReadOnly:function(){return this.getReadOnly()},setGridReadOnly:function(b,a){var c=b.getPlugin('editingPlugin');c&&c[a?'disable':'enable']();b.down('#btnAdd').setDisabled(a);b.down('#btnEdit').setDisabled(a);b.down('#btnRemove').setDisabled(a)},bindListeners:function(){var a=this;a.on('calendarset',a.onCalendarSet);a.on('afterrender',a.onCalendarSet);a.dayGrid.on({selectionchange:a.onDayGridSelectionChange,validateedit:a.onDayGridValidateEdit,edit:a.onDayGridEdit,scope:a});a.dayGrid.store.on({update:a.refreshView,remove:a.refreshView,add:a.refreshView,scope:a});a.weekGrid.on({selectionchange:a.onWeekGridSelectionChange,validateedit:a.onWeekGridValidateEdit,edit:a.onWeekGridEdit,scope:a});a.weekGrid.store.on({update:a.refreshView,remove:a.refreshView,add:a.refreshView,scope:a});a.datePicker.on({select:a.onDateSelect,scope:a})},buildItems:function(){this.dateInfoPanel=new Ext.Component({cls:'gnt-calendar-dateinfo',margin:'20 10',flex:1,border:!1});this.cmbParentCalendar=new Ext.form.field.ComboBox({name:'cmb_parentCalendar',fieldLabel:this.L('parentCalendarText'),labelAlign:'top',store:{autoDestroy:!0,fields:['Id','Name']},queryMode:'local',displayField:'Name',valueField:'Id',anchor:'100%',editable:!1,emptyText:this.L('selectParentText')});this.buildWeekGrid();this.buildDayGrid();this.buildDatePicker();this.items=[{xtype:'container',layout:'hbox',items:[{xtype:'container',flex:1,margin:'15 5 15 15',layout:'anchor',items:[{xtype:'fieldcontainer',defaults:{width:'100%'},layout:'vbox',items:[{xtype:'textfield',itemId:'calendarName',labelAlign:'top',fieldLabel:this.L('calendarNameText')},{xtype:'checkbox',itemId:'projectCalendarCheckbox',fieldLabel:this.L('isProjectCalendarText')},this.cmbParentCalendar]},{xtype:'component',padding:'10 0 0 0',renderTpl:this.legendTpl,anchor:'100%',renderData:{workingDayText:this.L('workingDayText'),weekendsText:this.L('weekendsText'),overriddenDayText:this.L('overriddenDayText'),overriddenWeekText:this.L('overriddenWeekText'),workingDayCls:this.workingDayCls,nonWorkingDayCls:this.nonWorkingDayCls,overriddenDayCls:this.overriddenDayCls,overriddenWeekDayCls:this.overriddenWeekDayCls}}]},this.datePicker,this.dateInfoPanel]},{xtype:'tabpanel',minHeight:200,flex:1,items:[this.dayGrid,this.weekGrid]}]},buildDayGrid:function(){var a=this.calendarDayModel.prototype;this.dayGrid=new Ext.grid.Panel(Ext.apply({title:this.L('dayOverridesText'),itemId:'dayGrid',tbar:[{text:this.L('addText'),itemId:'btnAdd',action:'add',iconCls:'x-fa fa-plus',handler:this.addDay,scope:this},{text:this.L('editText'),itemId:'btnEdit',action:'edit',iconCls:'x-fa fa-edit',handler:this.editDay,scope:this},{text:this.L('removeText'),itemId:'btnRemove',action:'remove',iconCls:'x-fa fa-trash',handler:this.removeDay,scope:this}],store:new Gnt.data.Calendar(),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2,pluginId:'editingPlugin'})],columns:[{header:this.L('dayOverrideNameHeaderText'),dataIndex:a.nameField,flex:1,editor:{allowBlank:!1}},{header:this.L('dateText'),dataIndex:a.dateField,width:100,xtype:'datecolumn',editor:{xtype:'datefield'}}]},this.dayGridConfig||{}));this.dayOverridesCalendar=this.dayGrid.store},updateGrids:function(){this.dayGrid&&this.fillDaysStore();this.weekGrid&&this.fillWeeksStore()},buildWeekGrid:function(){this.weekGrid=new Ext.grid.Panel(Ext.apply({title:this.L('weekOverridesText'),itemId:'weekGrid',plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2,pluginId:'editingPlugin'})],store:new Ext.data.Store({autoDestroy:!0,model:'Gnt.model.Week'}),tbar:[{text:this.L('addText'),itemId:'btnAdd',action:'add',iconCls:'x-fa fa-plus',handler:this.addWeek,scope:this},{text:this.L('editText'),itemId:'btnEdit',action:'edit',iconCls:'x-fa fa-edit',handler:this.editWeek,scope:this},{text:this.L('removeText'),itemId:'btnRemove',action:'remove',iconCls:'x-fa fa-trash',handler:this.removeWeek,scope:this}],columns:[{header:this.L('overrideName'),dataIndex:'name',flex:1,editor:{allowBlank:!1}},{xtype:'datecolumn',header:this.L('startDate'),dataIndex:'startDate',width:100,editor:{xtype:'datefield',allowBlank:!1}},{xtype:'datecolumn',header:this.L('endDate'),dataIndex:'endDate',width:100,editor:{xtype:'datefield',allowBlank:!1}}]},this.weekGridConfig||{}));this.weekOverridesStore=this.weekGrid.store},buildDatePicker:function(){this.datePicker=new Gnt.widget.calendar.DatePicker(Ext.apply({dayOverridesCalendar:this.dayGrid.store,weekOverridesStore:this.weekGrid.store,margin:'15 10 0 10',showToday:!1},this.datePickerConfig))},onCalendarSet:function(){this.weekOverridesStore.commitChanges()},setCalendar:function(a){if(this.calendar){this.mun(this.calendar,{load:this.onCalendarChange,add:this.onCalendarChange,remove:this.onCalendarChange,update:this.onCalendarChange,parentchange:this.onParentChange,scope:this})}this.calendar=a;if(a){this.mon(this.calendar,{load:this.onCalendarChange,add:this.onCalendarChange,remove:this.onCalendarChange,update:this.onCalendarChange,parentchange:this.onParentChange,scope:this})}this.onCalendarChange();this.fireEvent('calendarset',a)},onParentChange:function(){this.updateComboBox()},updateComboBox:function(){var a=this,b=[];if(a.calendarManager){var e=a.calendarManager.getRoot();var c=a.calendarManager.getNodeByCalendar(a.calendar);e.cascadeBy(function(a){var d=a.getCalendar();if(a!==e&&a!==c&&!c.contains(a)){b.push({Id:d.calendarId,Name:a.getName()||d.calendarId})}})}else {b=a.calendar.getParentableCalendars()}this.cmbParentCalendar.store.loadData([{Id:-1,Name:this.L('noParentText')}].concat(b));var d=this.calendar&&this.calendar.parent,f=d&&d.calendarId;this.cmbParentCalendar.setValue(f||-1)},onCalendarChange:function(){this.updateComboBox();if(this.calendarManager){var a=this.calendar===this.calendarManager.getProjectCalendar();this.projectCalendarCheckbox.setDisabled(a);this.projectCalendarCheckbox.setValue(a)}this.fillDaysStore();this.fillWeeksStore();this.refreshView()},setupTemplates:function(){var a=this.L('tplTexts');if(!(this.dateInfoTpl instanceof Ext.Template)){this.dateInfoTpl=new Gnt.template.CalendarDateInfo({workingHoursText:a.tplWorkingHours,nonWorkingText:a.tplIsNonWorking,basedOnText:a.tplBasedOn,overrideText:a.tplOverride,inCalendarText:a.tplInCalendar,dayInCalendarText:a.tplDayInCalendar})}if(!(this.legendTpl instanceof Ext.Template)){this.legendTpl=new Gnt.template.CalendarLegend()}},afterRender:function(){this.callParent(arguments);this.onDateSelect(this.datePicker,new Date())},fillDaysStore:function(){var a=Gnt.util.Data.cloneModelSet(this.calendar,function(a){return a.getType()=='DAY'&&a.getDate()});this.dayOverridesCalendar.loadData(a)},copyCalendarDay:function(a){var b=a.copy(null);b.__COPYOF__=a.getId();return b},fillWeeksStore:function(){var b=this;var a=[];this.calendar.forEachNonStandardWeek(function(d){var c=Ext.apply({},d);c.weekAvailability=Ext.Array.map(c.weekAvailability,function(a){return a&&b.copyCalendarDay(a)||null});c.mainDay=b.copyCalendarDay(c.mainDay);a.push(c)});this.weekOverridesStore.loadData(a)},addDay:function(){var d=this.datePicker.getValue();if(this.dayOverridesCalendar.getOwnCalendarDay(d)){this.alert({msg:this.L('overrideErrorText')});return}var c=this.calendar.model;var b=c.prototype;var a={};a[b.nameField]=this.L('newDayName');a[b.typeField]='DAY';a[b.dateField]=d;a=new c(a);this.dayGrid.getStore().insert(0,a);this.dayGrid.getSelectionModel().select([a],!1,!1)},editDay:function(){var d=this,e=this.dayGrid.getSelection(),c=e[0];if(c){var a=this.currentDayOverrideEditor=new Gnt.widget.calendar.DayEditor({addText:this.L('addText'),removeText:this.L('removeText'),workingTimeText:this.L('workingTimeText'),nonworkingTimeText:this.L('nonworkingTimeText'),calendarDay:c});var b=Ext.create('Ext.window.Window',{title:this.L('dayOverridesText'),modal:!0,width:280,height:260,layout:'fit',items:a,buttons:[{text:this.L('okText'),handler:function(){if(a.isValid()){var e=a.calendarDay;e.setIsWorkingDay(a.isWorkingDay());e.setAvailability(a.getIntervals());d.applyCalendarDay(e,c);d.refreshView();b.close()}}},{text:this.L('cancelText'),handler:function(){b.close()}}]});b.show()}},removeDay:function(){var b=this.dayGrid,a=b.getSelection();if(!a[0]){return}b.getStore().remove(a[0]);this.refreshView()},refreshView:function(){var c=this.datePicker.getValue(),e=this.getCalendarDay(c),f=this.weekGrid,h=this.dayGrid,b=this.dayOverridesCalendar.getOwnCalendarDay(c),a;var d;if(b){h.getSelectionModel().select([b],!1,!0);d=b.getName()}else {a=this.getWeekOverrideByDate(c);if(a){f.getSelectionModel().select([a],!1,!0);d=a.get('name')}}var g={name:d||e.getName(),date:Ext.Date.format(c,'M j, Y'),calendarName:this.calendar.name||this.calendar.calendarId,availability:e.getAvailability(!0),override:Boolean(b||a),isWorkingDay:e.getIsWorkingDay()};this.dateInfoPanel.update(this.dateInfoTpl.apply(g));this.down('#calendarName').setValue(this.calendar.name);this.datePicker.rendered&&this.datePicker.refreshCssClasses()},onDayGridSelectionChange:function(b,a){if(a[0]){this.datePicker.setValue(a[0].getDate());this.refreshView()}},onDayGridEdit:function(b,a){if(a.field==='Date'){a.grid.getStore().clearCache();this.datePicker.setValue(a.value)}this.refreshView()},onDayGridValidateEdit:function(c,a){var b=this.dayGrid.store;if(a.value&&a.field===b.model.prototype.dateField&&b.getOwnCalendarDay(a.value)&&a.value-a.originalValue!==0){this.alert({msg:this.L('overrideErrorText')});return !1}},onDateSelect:function(){this.refreshView()},getCalendarDay:function(b){var a=this.dayOverridesCalendar.getOwnCalendarDay(b);if(a){return a}a=this.getWeekOverrideDay(b);if(a){return a}return this.calendar.weekAvailability[b.getDay()]||this.calendar.defaultWeekAvailability[b.getDay()]},getWeekOverrideDay:function(c){var a=this.getWeekOverrideByDate(c),d=c.getDay();if(a==null){return null}var b=a.get('weekAvailability');if(!b){return null}return b[d]},getWeekOverrideByDate:function(b){var a=null;this.weekOverridesStore.each(function(c){if(Ext.Date.between(b,c.get('startDate'),c.get('endDate'))){a=c;return !1}});return a},intersectsWithCurrentWeeks:function(a,b,d){var c=!1;this.weekOverridesStore.each(function(e){if(e==d){return}var f=e.get('startDate');var g=e.get('endDate');if(f<=a&&a<g||f<b&&b<=g){c=!0;return !1}});return c},addWeek:function(){var e=this.weekOverridesStore;var b=this.datePicker.getValue();var d;for(var c=7;c>0;c--){d=Sch.util.Date.add(b,Sch.util.Date.DAY,c);if(!this.intersectsWithCurrentWeeks(b,d)){break}}if(!c){this.alert({msg:Ext.String.format(this.L('overrideDateError'),Ext.Date.format(b,'Y/m/d'))});return}var a=new this.calendar.model();a.setType('WEEKDAYOVERRIDE');a.setName(this.L('newDayName'));a.setOverrideStartDate(b);a.setOverrideEndDate(d);a.setWeekday(-1);var f=e.insert(0,{name:this.L('newDayName'),startDate:b,endDate:d,weekAvailability:[],mainDay:a})[0];this.weekGrid.getSelectionModel().select([f],!1,!1)},editWeek:function(){var c=this.weekGrid.getSelection(),e=this;if(c.length===0){return}var a=c[0];var d=new Gnt.widget.calendar.WeekEditor({startDate:a.get('startDate'),endDate:a.get('endDate'),weekName:a.get('name'),calendarDayModel:this.calendar.model,weekAvailability:a.get('weekAvailability'),calendarWeekAvailability:this.calendar.weekAvailability,defaultWeekAvailability:this.calendar.defaultWeekAvailability});var b=Ext.create('Ext.window.Window',{title:this.L('weekOverridesText'),modal:!0,width:370,defaults:{border:!1},layout:'fit',items:d,buttons:[{action:'ok',text:this.L('okText'),handler:function(){if(d.applyChanges(a.get('weekAvailability'))){e.refreshView();b.close()}}},{text:this.L('cancelText'),handler:function(){b.close()}}]});b.show()},removeWeek:function(){var a=this.weekGrid.getSelection();if(a[0]){this.weekOverridesStore.remove(a[0]);this.refreshView()}},onWeekGridSelectionChange:function(b,a){if(a[0]){this.datePicker.setValue(a[0].get('startDate'))}},onWeekGridEdit:function(e,b){var a=b.record,c=a.get('startDate'),d=a.get('endDate');if(b.field=='startDate'||b.field=='endDate'){Ext.Array.each(a.get('weekAvailability').concat(a.get('mainDay')),function(a){if(a){a.setOverrideStartDate(c);a.setOverrideEndDate(d)}});this.datePicker.setValue(c)}this.refreshView()},alert:function(a){a=a||{};Ext.MessageBox.show(Ext.applyIf(a,{title:this.L('error'),icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK}))},onWeekGridValidateEdit:function(e,a){var b=a.record,c=a.field=='startDate'?a.value:b.get('startDate'),d=a.field=='endDate'?a.value:b.get('endDate');if(c>d){this.alert({msg:this.L('startAfterEndError')});a.cancel=!0;return !1}if(this.intersectsWithCurrentWeeks(c,d,b)){this.alert({msg:this.L('weeksIntersectError')});a.cancel=!0;return !1}},applyCalendarDay:function(b,a){a.beginEdit();a.setName(b.getName());a.setIsWorkingDay(b.getIsWorkingDay());a.setDate(b.getDate());a.setOverrideStartDate(b.getOverrideStartDate());a.setOverrideEndDate(b.getOverrideEndDate());var c=b.getAvailability(!0);var d=a.getAvailability(!0);if(c+''!=d+''){a.setAvailability(b.getAvailability())}a.endEdit()},applySingleDay:function(a,b){if(a.__COPYOF__){this.applyCalendarDay(a,this.calendar.getModelById(a.__COPYOF__))}else {if(a.store){a.unjoin(a.store)}a.setId(null);b.push(a.getData())}},applyChanges:function(){var i=this;var a=this.calendar;var f=this.down('combobox[name="cmb_parentCalendar"]').getValue(),e=this.down('#calendarName').getValue(),h=this.projectCalendarCheckbox.getValue();if(this.calendarManager){var g=this.calendarManager.getModelById(a.calendarId);if(g){g.setName(e)}if(this.calendarManager.getProjectCalendar()!==a&&h){this.projectCalendarCheckbox.setDisabled(!0);this.calendarManager.setProjectCalendar(a)}}a.suspendEvents(!0);a.suspendCacheUpdate++;a.name=e;a.setParent(f?Gnt.data.Calendar.getCalendar(f):null);if(a.getProxy()&&a.getProxy().extraParams){a.getProxy().extraParams.calendarId=a.calendarId}Gnt.util.Data.applyCloneChanges(this.dayOverridesCalendar,a,function(b,a){a.originalRecord&&a.originalRecord.setAvailability(a.getAvailability(!0))});var d=[];var c=[];var b={};this.weekOverridesStore.each(function(a){Ext.Array.each(a.get('weekAvailability').concat(a.get('mainDay')),function(a){if(a){if(a.__COPYOF__){b[a.__COPYOF__]=!0}i.applySingleDay(a,d)}})});a.forEachNonStandardWeek(function(a){Ext.Array.each(a.weekAvailability.concat(a.mainDay),function(a){if(a&&!b[a.getId()]){c.push(a)}})});a.add(d);a.remove(c);a.suspendCacheUpdate--;a.clearCache();a.resumeEvents();this.fireEvent('calendarset',a)},hasChanges:function(){if(!this.calendar){return !1}var e=this.dayOverridesCalendar.getModifiedRecords().length||this.dayOverridesCalendar.getRemovedRecords().length,d=this.weekOverridesStore.getModifiedRecords().length||this.weekOverridesStore.getRemovedRecords().length,c=this.down('#calendarName').getValue()!=this.calendar.name,f=this.calendar.parent&&this.calendar.parent.calendarId||-1,b=this.cmbParentCalendar.getValue()!=f,a=!1;if(this.calendarManager){a=this.projectCalendarCheckbox.getValue()&&this.calendarManager.getProjectCalendar()!==this.calendar}return e||d||c||b||a}});Ext.define('Gnt.widget.calendar.CalendarManager',{extend:'Ext.Container',requires:['Ext.tree.Panel','Ext.menu.Menu','Ext.tree.plugin.TreeViewDragDrop','Gnt.patches.TreeViewDragDrop','Gnt.widget.calendar.Calendar','Gnt.data.calendar.BusinessTime'],mixins:['Gnt.mixin.Localizable'],alias:'widget.calendarmanager',treePanelConfig:null,treePanel:null,calendarPanelConfig:null,calendarManager:null,readOnly:!1,calendarPanel:null,layout:'border',width:800,height:600,initComponent:function(){var a=this;a.cls=a.cls+' gnt-calendarmanager';a.treePanel=a.buildTreePanel();a.calendarPanel=new Gnt.widget.calendar.Calendar(Ext.apply({region:'center',calendar:a.calendar,split:!0,scrollable:!0,calendarManager:a.calendarManager,readOnly:a.readOnly},a.calendarPanelConfig));a.items=[a.treePanel,a.calendarPanel];a.callParent(arguments);a.contextMenu=a.buildContextMenu();a.setReadOnly(a.readOnly);var b=a.calendarManager;a.setCalendar(a.calendar||b.getProjectCalendar()||b.getRoot().firstChild);a.counter=1},setReadOnly:function(a){this.readOnly=a;var c=this.treePanel;c.down('#btnAdd').setDisabled(a);c.down('#btnRemove').setDisabled(a);var b=c.getView(),d=a?'disable':'enable';if(b.rendered){b.getPlugin('treeDragDrop')[d]()}else {b.on('render',function(){b.getPlugin('treeDragDrop')[d]()},this,{single:!0})}this.contextMenu.setDisabled(a);this.calendarPanel.setReadOnly(a)},getReadOnly:function(){return this.readOnly},isReadOnly:function(){return this.getReadOnly()},buildTreePanel:function(){var a=this;return new Ext.tree.Panel(Ext.apply({split:!0,region:'west',width:200,store:a.calendarManager,displayField:a.calendarManager.model.prototype.nameField,rootVisible:!1,tbar:[{itemId:'btnAdd',text:a.L('addText'),action:'add',iconCls:'x-fa fa-plus',handler:a.doAddRootNode,scope:a},{itemId:'btnRemove',text:a.L('removeText'),action:'remove',iconCls:'x-fa fa-trash',handler:a.doRemoveCalendar,scope:a}],viewConfig:{plugins:{ptype:'treeviewdragdrop',pluginId:'treeDragDrop',allowContainerDrops:!0,dropZone:{onNodeDrop:function(b,d,e,c){var a=this.valid;this.overRecord=this.view.getRecord(b);this.currentPosition='append';Ext.Array.each(c.records,function(b){if(b.contains(this.overRecord)){a=!1;return !1}},this);this.valid=a;if(this.overRecord.isLeaf()){this.overRecord.set('expanded',!0);this.overRecord.childNodes=[]}return this.self.prototype.onNodeDrop.apply(this,arguments)}}},getRowClass:function(b){if(a.calendarManager.getProjectCalendar()==b.calendar){return 'gnt-project-calendar-row'}},listeners:{drop:a.onDrop,scope:a}},listeners:{containercontextmenu:a.onContainerContextMenu,itemcontextmenu:a.onItemContextMenu,selectionchange:a.onSelectionChange,scope:a}},a.treePanelConfig))},buildContextMenu:function(){return new Ext.menu.Menu({margin:'0 0 10 0',items:[{text:this.L('add_node'),handler:this.doAddRootNode,itemId:'add-node',scope:this},{text:this.L('add_child'),handler:this.doAddChildNode,scope:this},{text:this.L('add_sibling'),handler:this.doAddSiblingCalendar,scope:this},{text:this.L('remove'),handler:this.doRemoveCalendar,itemId:'remove-node',scope:this}]})},showContextMenu:function(b,a){var c=this.contextMenu.query('menuitem');Ext.Array.each(c,function(b){b.setVisible(!!a)});this.contextMenu.down('#add-node').setVisible(!a);b.stopEvent();this.contextMenu.showAt(b.getXY())},onContainerContextMenu:function(b,a){this.showContextMenu(a)},onItemContextMenu:function(e,a,d,c,b){this.showContextMenu(b,a)},hasChanges:function(){return this.calendarPanel.hasChanges()},onSelectionChange:function(e,i,j){var a=this,h=a.calendarManager,b=a.calendarPanel;if(i.length>0){var f=i[0];var c=f.getCalendar();var d=h.getProjectCalendar();var g=c===d||d&&Boolean(f.findChild(f.idProperty,d.calendarId));if(!a.isReadOnly()){a.treePanel.down('#btnRemove').setDisabled(g);a.contextMenu.down('#remove-node').setDisabled(g)}if(b.calendar&&b.hasChanges()){Ext.Msg.show({title:a.L('confirm_action'),msg:a.L('confirm_message'),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=='yes'){a.applyChanges();b.setCalendar(c)}else {if(d=='no'){b.setCalendar(c)}else {e.suspendEvents();e.select(h.getNodeByCalendar(b.calendar));e.resumeEvents()}}}})}else {b.setCalendar(c)}}},onDrop:function(d,c,a,b){a=a||this.calendarManager.getRootNode();a.expand()},onDestroy:function(){this.contextMenu.destroy();this.callParent(arguments)},applyChanges:function(){this.calendarPanel.applyChanges()},doAddRootNode:function(){this.addCalendar()},doAddChildNode:function(){var a=this.treePanel.getSelectionModel().getSelection();this.addCalendar(a[0])},doAddSiblingCalendar:function(){var a=this.treePanel.getSelectionModel().getSelection();this.addCalendar(a[0]&&a[0].parentNode)},doRemoveCalendar:function(){var a=this.treePanel.getSelectionModel().getSelection();this.removeCalendar(a[0])},addCalendar:function(b){var d=Ext.ClassManager.get(this.calendarManager.calendarClass).prototype;var c=this.calendarManager.model.prototype;var a=c.getModelConfig(d);a[c.nameField]=this.L('calendarName')+this.counter++;a.expanded=!0;a.leaf=!0;b=b||this.treePanel.getRootNode();b.data.expanded=!0;b.appendChild(a)},removeCalendar:function(a){var c=this.treePanel.getRootNode();if(a){var b=a.nextSibling||a.previousSibling||(a.parentNode==c?c.firstChild:a.parentNode);if(b){this.treePanel.getSelectionModel().select(b)}a.remove()}},setCalendar:function(a){if(a instanceof Gnt.model.Calendar){this.treePanel.setSelection(a)}else {this.treePanel.setSelection(this.calendarManager.getNodeByCalendar(a))}}});Ext.define('Gnt.widget.calendar.CalendarManagerWindow',{extend:'Ext.window.Window',requires:['Gnt.widget.calendar.CalendarManager'],mixins:['Gnt.mixin.Localizable'],alias:'widget.calendarmanagerwindow',layout:'fit',border:!1,constrain:!0,defaultFocus:'btnCancel',calendarConfig:null,calendarManager:null,panel:null,closing:!1,initComponent:function(){this.panel=new Gnt.widget.calendar.CalendarManager({calendarManager:this.calendarManager,calendarPanelConfig:this.calendarConfig});Ext.applyIf(this,{width:Math.min(Ext.getBody().getWidth()-100,1050),height:Math.min(Ext.getBody().getHeight()-100,700)});Ext.apply(this,{title:this.title||this.L('title'),items:[this.panel],buttons:[{text:this.L('ok'),handler:function(){this.applyChanges()},scope:this},{text:this.L('cancel'),itemId:'btnCancel',handler:function(){this.close()},scope:this}],listeners:{beforeclose:this.onBeforeClose,close:this.onAfterClose,show:this.onAfterShow}});this.callParent(arguments)},applyChanges:function(){this.panel.applyChanges()},onBeforeClose:function(){var a=this;var b=this.panel;if(!a.closing&&b.hasChanges()){Ext.Msg.show({title:a.L('confirm_action'),msg:a.L('confirm_message'),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(c){switch(c){case 'yes':b.applyChanges();a.close();break;case 'no':a.closing=!0;a.close();break;}}});return !1}},onAfterClose:function(){this.closing=!1},onAfterShow:function(){this.focus()}});Ext.define('Gnt.widget.calendar.CalendarWindow',{extend:'Ext.window.Window',requires:['Gnt.widget.calendar.Calendar'],mixins:['Gnt.mixin.Localizable'],alias:'widget.calendarwindow',calendarConfig:null,calendar:null,calendarWidget:null,initComponent:function(){Ext.applyIf(this,{width:Math.min(Ext.getBody().getWidth()-100,800),height:Math.min(Ext.getBody().getHeight()-100,650)});Ext.apply(this,{layout:'fit',title:this.title||this.L('title'),items:this.calendarWidget=new Gnt.widget.calendar.Calendar(Ext.apply({calendar:this.calendar},this.calendarConfig)),buttons:[{text:this.L('ok'),handler:function(){this.applyChanges();this.close()},scope:this},{text:this.L('cancel'),handler:this.close,scope:this}]});this.callParent(arguments)},applyChanges:function(){this.calendarWidget.applyChanges()},setCalendar:function(a){this.calendarWidget.setCalendar(a)}});Ext.define('Gnt.widget.calendar.ResourceCalendarGrid',{extend:'Ext.grid.Panel',requires:['Ext.data.Store','Ext.grid.plugin.CellEditing','Sch.util.Date','Gnt.model.Calendar','Gnt.data.Calendar'],mixins:['Gnt.mixin.Localizable'],alias:'widget.resourcecalendargrid',resourceStore:null,calendarStore:null,border:!0,height:180,cellEditingConfig:null,initComponent:function(){var a=this;this.calendarStore=this.calendarStore||{xclass:'Ext.data.Store',model:'Gnt.model.Calendar'};if(!(this.calendarStore instanceof Ext.data.Store)){this.calendarStore=Ext.create(this.calendarStore)}var b=Ext.create('Ext.grid.plugin.CellEditing',Ext.apply({clicksToEdit:2},this.cellEditingConfig));b.on({beforeedit:function(d,a){var c=a.record;if(a.value===null||a.value===undefined){var b=c.getProjectCalendar();if(b){a.value=b.calendarId}}},edit:function(b,a){this.onCalendarChange(a.record,a.value)},scope:this});Ext.apply(a,{store:a.resourceStore,columns:[{text:this.L('name'),dataIndex:a.resourceStore.getModel().prototype.nameField,flex:1},{text:this.L('calendar'),dataIndex:a.resourceStore.getModel().prototype.calendarIdField,flex:1,renderer:function(e,g,d){var b=d.getCalendar();var f=a.calendarStore.getModelById?'getModelById':'getById';var c=a.calendarStore[f](b&&b.calendarId);return c&&c.getName()||e},editor:{xtype:'combobox',store:a.calendarStore,queryMode:'local',displayField:'Name',valueField:'Id',editable:!1,allowBlank:!1}}],plugins:b});this.calendarStore.loadData(this.getCalendarData());this.callParent(arguments)},getCalendarData:function(){return Ext.Array.map(Gnt.data.Calendar.getAllCalendars(),function(a){return {Id:a.calendarId,Name:a.name||a.calendarId}})},onCalendarChange:function(b,a){b.setCalendarId(a)},destroy:function(){this.calendarStore.destroy();this.callParent(arguments)}});